/*! Copyright (c) 2015 WhatsApp Inc.  All Rights Reserved. */
webpackJsonp([0],Array(887).concat([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){window.history.pushState({},"",window.location.href)}function o(){if(!Store.Conn.connected)return!1;var e=n(1065),t=Store.Msg.some(function(e){return 0===e.ack&&e.local&&e.isSentByMe}),r=Store.Chat.some(function(e){return!!e.composeContents.text});return t||r||e.hasText}var a=n(417),s=r(a),c=n(2),l=r(c),u=n(6),d=n(34);_.defaults(window.Store,n(1207));var p=n(54),h=n(8),f=n(12),m=n(65),g=n(15),v=n(1116),y=n(1154),E=n(410),b=n(1221),S=n(1099),M=n(133),T=n(10),C=n(14),w=n(137),x=n(438),N=n(1220),P=n(1126),k=n(130),D=n(129),O=n(78),A=n(1227),R=n(1191),I=n(1178),L=n(0),F=n(1),U=n(425),j=n(197),B=n(63),G=n(134),z=n(131),Y=z.HotKeys,H=z.HotKeyMapMixin,W=n(82);W&&!function(){var e=n(435);Store.ProfilePicThumb.on("change",function(t){t.tag||navigator.serviceWorker.ready.then(function(){e.send(navigator.serviceWorker.controller,"removePP",t.id)})})}();var q=[[document,"mousemove"],[document,"scroll"],[document,"keydown"],[window,"focus"],[window,"blur"],[window,"resize"]],V=u.createClass({displayName:"Main",mixins:[M,H({}),D,O,k],propTypes:{launchUrl:u.PropTypes.string,onLaunchUrlHandled:u.PropTypes.func.isRequired,animate:u.PropTypes.bool},statics:{hasPending:o},getInitialState:function(){return this.onBlur=this.safeDebounce(function(){if(document.activeElement===document.body){var e=B.Manager.top;e&&e.uie.requestFocus()}},10),{drawerActive:!1}},componentWillMount:function(){m.uiActive=!0,m.markAvailable(),this.regNativeListener(window,"click",function(e){var t=e.target;if(t&&"A"===t.nodeName&&t.hasAttribute("href")){var n=U.parseInviteLink(t.getAttribute("href"));n&&(e.preventDefault(),T.openModal(u.createElement(I,{groupCode:n})))}},!0)},componentWillReceiveProps:function(e){e.launchUrl&&this.props.launchUrl!==e.launchUrl&&(this.launchInviteUrl(e.launchUrl),this.props.onLaunchUrlHandled())},componentWillUnmount:function(){this.onBlur=null,A.trigger(N.Event+":"+N.Events.LOGGED_OUT),U.canMuckHistory&&(window.removeEventListener("popstate",i),window.history.back()),m.uiActive=!1,this.clearIdleMonitor(),this.clearServerPropsQueryLoop()},componentDidMount:function(){if(A.trigger(N.Event+":"+N.Events.LOGGED_IN),this.props.launchUrl&&(this.launchInviteUrl(this.props.launchUrl),this.props.onLaunchUrlHandled()),U.canMuckHistory&&(window.history.pushState({},"",window.location.href),window.addEventListener("popstate",i)),this.beginIdleMonitor(!0),this.beginServerPropsQueryLoop(),this.addObserverAndRun(Store.Conn,"change:tos",this.showTOS),G.focus(d.findDOMNode(this)),p.isSafari){var e=g.getNUX(h.NUX.SAFARI_LIMITED_SUPPORT);(!e||e<e.maxViews)&&(this.safeDelay(function(){var e=l10n.t("whatsapp_safari_limited").replace("__chrome_homepage__",h.BROWSER_LINK.CHROME).replace("__firefox_homepage__",h.BROWSER_LINK.FIREFOX).replace("__opera_homepage__",h.BROWSER_LINK.OPERA);T.openModal(u.createElement(E,{onOK:T.closeModal.bind(T),okText:l10n.t("ok_got_it")},u.createElement("div",{dangerouslySetInnerHTML:{__html:e}})))},250),g.setNUX(h.NUX.SAFARI_LIMITED_SUPPORT,{views:1,maxViews:1}))}},launchInviteUrl:function(e){F.log("main:openUrl:"+e)();var t=U.parseInviteLink(e);return!!t&&(F.log("code opened!"+t)(),T.openModal(u.createElement(I,{groupCode:t})),!0)},beginIdleMonitor:function(e){var t=this;e=e?h.IDLE_TIMEOUT:0,this.idleMonitor=l["default"].loop(function(){return l["default"].delay(e).addCancelControl().then(function(){m.markUnavailable(3e4);var t=void 0,n=new l["default"](function(e){t=e});return q.forEach(function(e){var n=(0,s["default"])(e,2),r=n[0],i=n[1];r.addEventListener(i,t)}),n.addCancelControl()["finally"](function(){q.forEach(function(e){var n=(0,s["default"])(e,2),r=n[0],i=n[1];r.removeEventListener(i,t)})}).then(function(){m.markAvailable(),e=h.IDLE_TIMEOUT})})})["finally"](function(){t.idleMonitor=null})["catch"](l["default"].CancellationError,_.noop).endWithControls("cancel")},clearIdleMonitor:function(){this.idleMonitor&&this.idleMonitor.control.cancel()},beginServerPropsQueryLoop:function(){var e=this;this.serverPropsQueryLoop=w.setTimeout(function(){Store.Props.fetch()["catch"](C.WapDrop,_.noop),e.beginServerPropsQueryLoop()},L().add("1","days").valueOf())},clearServerPropsQueryLoop:function(){w.clearTimeout(this.serverPropsQueryLoop)},calculateConversationPaneScale:function(){if(!(this.refs.chatlist&&this.refs.container&&this.refs.conversation))return null;var e=d.findDOMNode(this.refs.chatlist),t=d.findDOMNode(this.refs.conversation),n=d.findDOMNode(this.refs.container);return t.clientWidth/(n.clientWidth-e.clientWidth)},onRightDrawerIn:function(){this.rightDrawerOut=!1,T.onPanesWillChange(3),this.setState({drawerActive:!0},T.onPanesDidChange.bind(T,3));var e=this.calculateConversationPaneScale();null!==e&&this.animateConversationPane(e)},onRightDrawerOut:function(){this.rightDrawerOut=!0;var e=this.calculateConversationPaneScale();null!==e&&this.animateConversationPane(e),1!==e&&(T.onPanesWillChange(2),this.setState({drawerActive:!1},T.onPanesDidChange.bind(T,2)))},onRightDrawerAnimationComplete:function(){this.state.drawerActive&&this.rightDrawerOut&&this.setState({drawerActive:!1})},animateConversationPane:function(e){Velocity(d.findDOMNode(this.refs.conversation),{scaleX:[1,e]},{duration:300,easing:[.1,.82,.25,1]})},onRotateFocus:function(e){var t=this,n=1;e&&(e.stopPropagation(),e.preventDefault(),n=e.shiftKey?-1:1,Y.flashFocus=Date.now());var r=_.toArray(d.findDOMNode(this).querySelectorAll("[data-tab]"));if(T.existsDrawerLeft(function(e){if(e){var n=d.findDOMNode(t.refs.chatlist);r=_.reject(r,function(e){return n.contains(e)})}}),T.existsDrawerMid(function(e){if(e){var n=d.findDOMNode(t.refs.conversation);n&&(r=_.reject(r,function(e){return n.contains(e)}))}}),r.length){r=_.sortBy(r,function(e){return parseInt(e.getAttribute("data-tab"),10)||0});var i=0,o=document.activeElement;o&&(i=x.ring(_.findIndex(r,function(e){return e.contains(o)})+n,r));var a=r[i];Y.flashFocus=Date.now(),a.restoreFocus?a.restoreFocus():G.focus(a)}},showTOS:function(){switch(Store.Conn.tos){case 1:case 2:T.openModal(u.createElement(R,null),void 0,void 0,!0);break;case 3:f.logout()}},render:function(){var e=this.state.drawerActive?"app three":"app two";this.props.animate||(e+=" no-animation"),p.isSafari&&(e+=" safari-fix");var t={tab:this.onRotateFocus,"shift+tab":this.onRotateFocus};return u.createElement(j,{state:j.State.INACTIVE,ref:"container",displayName:"Main"},u.createElement(Y,{handlers:t,className:e,onBlur:this.onBlur},u.createElement(b,null),u.createElement(S,null),u.createElement("div",{className:"drawer-manager"},u.createElement(y,{direction:y.Dir.LEFT}),u.createElement(y,{direction:y.Dir.MID}),u.createElement(y,{direction:y.Dir.RIGHT,ref:"rightDrawer",onDrawerIn:this.onRightDrawerIn,onDrawerOut:this.onRightDrawerOut,onDrawerAnimationComplete:this.onRightDrawerAnimationComplete})),u.createElement(v,{ref:"chatlist"}),u.createElement(P,{ref:"conversation",animate:this.props.animate})))}});e.exports=V},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(){var e=new Uint8Array(8);window.crypto.getRandomValues(e);for(var t=new Array(16),n=0,r=0;n<e.length;n++,r+=2){var i=e[n];t[r]=Q[i>>4],t[r+1]=Q[15&i]}return"3EB0"+String.fromCharCode.apply(String,t)}function o(e){return e in Z}function a(e){return new f["default"](function(t,n){J.push(e),$[e.id]={resolve:t,reject:n},ee.debounceAndCap(100,500)})}function s(e){return S.getPlaintextMediaInfo(e).then(function(t){if(200===t.status){var n=t.data;return n.length!==e.length?(y.error("Msg:refreshMedia returned length differs from orig")(),f["default"].reject("Msg:refreshMedia returned length differs from orig")):n.map(function(t,n){var r=e[n],i=r.duration||t.d;i=i?i.toString():void 0;var o={clientUrl:t.url,mimetype:r.mimetype||t.mt,duration:i};"image"===r.type&&(o.fullWidth=t.w,o.fullHeight=t.h);var a=$[r.id];return a&&(delete $[r.id],a.resolve(o)),o})}return y.error("Msg:refreshMedia error "+t.status)(),f["default"].reject("Msg:refreshMedia error "+t.status)})["catch"](function(t){return e.forEach(function(e){var n=$[e.id];n&&(delete $[e.id],n.reject(t))}),f["default"].reject(t)})}function c(e,t){function n(){i=0}if(t&&!e.mediaKey)return y.log("processMedia encrypted msg without mediaKey")(),f["default"].reject(new M.MediaNeedsReupload);e.mediaState=V.FETCHING;var r=void 0;r=t?f["default"].resolve():a(e)["catch"](M.Server5xxDrop,function(){return f["default"].reject(new Y)}).then(function(t){e.set(t)});var i=0,o=r.loop(function(t){var r="GET";return L.getResponseIfOnline(e.clientUrl,r,null,w.RESP_TYPE.ARRAY_BUFFER).then(function(r){if(i++,!(r&&r.status<500)){if(i>3)return f["default"].reject(new M.MediaNeedsReupload);if(!r&&I.online)return void(e.clientUrl&&(e.clientUrl=e.clientUrl.replace(/^https:\/\/[^\/]+\.whatsapp\.net/,"https://mms.whatsapp.net")));e.mediaState=V.NEED_POKE;var o=Math.floor(1e3*U.expBackoff(i,60,void 0,.1));return f["default"].all([f["default"].delay(o),I.waitForOnline]).addResolveControl("poke",n)}return r.status>=400?f["default"].reject(new M.MediaNeedsReupload):void t(r.response)})});return o.then(function(n){return t?(e.mediaState=V.DECRYPTING,e.needsMediaAck&&T.ackE2EMedia(e.type,e.mediaKey,e.clientUrl).then(function(){e.needsMediaAck=!1}),C.decryptE2EMedia(e.type,n,e.mediaKey,e.mimetype)["catch"](M.MediaEncryptionError,function(e){return y.assert(!1,"decryption-error","msg:processEncryptedMedia "+e)(),f["default"].reject(new H)})):new Blob([n],{type:e.mimetype})}).then(function(t){return e.mimetype||(e.mimetype=t.type),R.transcode(t,e.mimetype).then(function(e){return{media:t,blob:e}})}).then(function(t){var n=t.media,r=t.blob,i=window.URL.createObjectURL(r),o=void 0;switch(e.type){case"image":o=R.image(i).then(function(e){var t=e.fullWidth,n=e.fullHeight;return{fullWidth:t,fullHeight:n}});break;case"video":o=R.video(r).then(function(e){var t=e.fullWidth,n=e.fullHeight;return{fullWidth:t,fullHeight:n}});break;case"audio":case"ptt":o=R.audio(i)["return"]({});break;case"document":o=f["default"].resolve({});break;default:o=f["default"].resolve({})}return o.then(function(e){return(0,p["default"])({decryptedMediaBlob:n,url:i},e)})}).then(function(t){e.set((0,p["default"])({mediaState:V.RESOLVED},t))})}function l(e){return e.mediaState=V.REUPLOADING,S.requestMediaReupload(e)["catch"](M.WapDrop,function(e){return!(e instanceof M.LogoutDrop)},function(){throw new M.MediaNeedsReupload}).then(function(t){return 200===t.status?P.isEncryptedMedia(t.url)?(e.set({clientUrl:t.url,mediaKey:t.mediaKey||e.mediaKey,needsMediaAck:!0}),c(e,!0)):(e.set({clientUrl:t.url,needsMediaAck:!1}),c(e,!1)):404===t.status?f["default"].reject(new H):t.status>=400?f["default"].reject(new M.MediaNeedsReupload):void 0})}function u(e){if(!e)return null;var t=new k({from:e.from,to:e.to,id:e.id,participant:e.participant,self:e.self}),n=Store.Msg.get(t);return n||(e.id=t,n=new X(e)),n}var d=n(412),p=r(d),h=n(2),f=r(h),m=n(883),g=r(m),v=n(8),y=n(1),E=n(79),b=n(200),S=n(45),M=n(14),T=n(1089),C=n(1087),w=n(135),x=n(21),N=n(415),P=n(80),k=n(55),D=n(1084),O=n(101),A=n(1086),R=n(1091),I=n(136),L=n(29),F=n(81),U=n(103),j=n(10),B=n(1021),G=n(418),z=n(434),Y=M.define("WapBlockedMedia"),H=M.define("MediaNotOnPhone"),W={NOTIFICATION:"notification",GROUP_NOTIFICATION:"group_notification",GP2:"gp2",BROADCAST_NOTIFICATION:"broadcast_notification",E2E_NOTIFICATION:"e2e_notification",CALL_LOG:"call_log",CHAT:"chat",IMAGE:"image",VIDEO:"video",LOCATION:"location",AUDIO:"audio",PTT:"ptt",VCARD:"vcard",CIPHERTEXT:"ciphertext",DOCUMENT:"document",UNKNOWN:"unknown",MULTI_VCARD:"multi_vcard"},q=(0,g["default"])({},W.IMAGE,"image/jpeg"),V={INIT:"media_init",PREPARING:"media_preparing",UPLOADING:"media_uploading",SENDING:"media_sending",REUPLOADING:"media_reuploading",FETCHING:"media_fetching",DECRYPTING:"media_decrypting",RESOLVED:"media_resolved",NEED_POKE:"media_need_poke",NEED_UPLOAD:"media_need_upload",ERROR_MISSING:"media_error_missing",REMOTE_UPLOADING:"media_remote_uploading",REMOTE_NEED_UPLOAD:"media_remote_need_upload"},K=z.Message.VideoMessage.ATTRIBUTION,X=E.extend(D,{Collection:"Msg",props:{id:"msgKey",body:"string",type:{type:"string",values:_.values(W)},subtype:"string",t:"number",notifyName:"string",from:"string",to:"string",author:"string",self:{type:["string"],values:["in","out"],"default":"in"},ack:"number",invis:"boolean",isNewMsg:"boolean",star:["boolean",!0,!1],recvFresh:"boolean",clientUrl:"string",url:"string",caption:"string",mimetype:"string",duration:"string",filehash:"string",size:"number",loc:"string",lat:"string",lng:"string",height:"number",width:"number",filename:"string",title:"string",description:"string",canonicalUrl:"string",matchedText:"string",thumbnail:"string",recipients:"array",broadcast:"boolean",avparams:"object",mediaKey:"string",pageCount:"number",isGif:"boolean",gifAttribution:"number",quotedMsg:"Msg",quotedStanzaID:"string",quotedParticipant:"string",mentionedJidList:"array",multicast:"boolean",vcardList:"array"},session:{fullHeight:"number",fullWidth:"number",decryptedMediaBlob:"object",uploadhash:"string",mediaState:{type:"string",values:_.values(V),"default":V.INIT},mustDownloadMedia:{type:"boolean","default":!1},promises:{type:"object","default":function(){return{}}},_shouldUploadFromPhone:{type:"boolean","default":!1},local:"boolean",reupload:"function",needsMediaAck:"boolean",search:"boolean",msgChunk:"object",startOfDay:"number",startOfDaySkew:"number",_quotedMsgObj:"object",isQuotedMsgAvailable:{type:"boolean","default":!0},_forceRMRCallback:{type:"function","default":null}},children:{senderObj:b},initialize:function(){this.sender&&(this.senderObj=Store.Contact.gadd({id:this.sender}),this.listenTo(this.senderObj,"all",this._getEventBubblingHandler("senderObj")));var e;(e=Store.Msg.preAck[this.id])&&(y.log("Msg:initialize updating msg with out of order ack",e)(),this.updateAck(e.ack),delete Store.Msg.preAck[this.id]),this.isMedia&&!this.mimetype&&(this.mimetype=q[this.type]),this.type===W.CIPHERTEXT&&this.listenToOnce(this,"change:type",this.onCiphertextDecrypted)},derived:{chat:{fn:function(){return Store.Chat.get(this.id.remote)}},isGroupMsg:{fn:function(){return x.isGroup(this.from)||x.isGroup(this.to)}},isSentByMe:{fn:function(){var e=this.id;return"in"!==e.self&&!this.isNotification&&this.from===Store.Conn.me}},isNotification:{deps:["type"],fn:function(){switch(this.type){case W.GROUP_NOTIFICATION:case W.GP2:case W.BROADCAST_NOTIFICATION:case W.NOTIFICATION:case W.E2E_NOTIFICATION:case W.CALL_LOG:return!0;default:return!1}}},isMedia:{deps:["type"],fn:function(){return["image","video","audio"].indexOf(this.type)>-1}},isMMS:{deps:["type"],fn:function(){return o(this.type)}},hasSymbol:{deps:["type"],fn:function(){return["image","video","audio","ptt","location","vcard","document","unknown"].indexOf(this.type)>-1}},eventType:{deps:["type","invis","isNewMsg"],fn:function(){var e;return this.isNewMsg?(e=this.eventTypeFromMsgType(),this.invis?"i"===e?"i":"n":e):"i"}},sender:{fn:function(){return this.isSentByMe?this.from:this.isGroupMsg?this.author:this.from}},containsEmoji:{deps:["body","caption"],fn:function(){switch(this.type){case W.CHAT:return this.body&&N.containsEmoji(this.body);case W.IMAGE:return this.caption&&N.containsEmoji(this.caption);default:return!1}}},isFailed:{deps:["isSentByMe","ack"],fn:function(){return this.isSentByMe&&this.ack<0}},vcard:{deps:["type","body"],fn:function(){if(this.type===W.VCARD)try{return B.parse(this.body)}catch(e){return}}},vcardWAid:{deps:["type","body"],fn:function(){if(this.type===W.VCARD){var e=this.body.match(/TEL[^\n]*;waid=(\d+):/);return e?e[1]+"@c.us":void 0}}},isUnsentMedia:{deps:["ack","isMMS","isSentByMe"],fn:function(){return this.ack<1&&this.isMMS&&this.isSentByMe}},dir:{deps:["type","body","subtype","caption"],fn:function(){switch(this.type){case W.CHAT:return A.dir(this.body);case W.VCARD:return this.subtype?A.dir(this.subtype):void 0;case W.IMAGE:return this.caption?A.dir(this.caption):void 0;default:return}}},rtl:{deps:["type","body","subtype","caption"],fn:function(){switch(this.type){case W.CHAT:return"rtl"===A.dir(this.body);case W.VCARD:return!!this.subtype&&"rtl"===A.dir(this.subtype);case W.IMAGE:return!!this.caption&&"rtl"===A.dir(this.caption);default:return!1}}},linkPreview:{deps:["matchedText","body"],fn:function(){return _.isString(this.matchedText)&&this.body.indexOf(this.matchedText)>-1}},isPersistent:{fn:function(){return this.type===W.E2E_NOTIFICATION&&"encrypt"===this.subtype}}},typeCanChange:function(){return this.type===W.CIPHERTEXT},mayFail:function(){return this.isSentByMe&&this.ack<1},canReply:function(){return this.chat.canSend&&!this.mayFail()&&!this.isNotification&&this.type!==W.UNKNOWN&&this.type!==W.CIPHERTEXT&&O.supportsFeature(O.F.REPLIES_OUT)},canForward:function(){return!this.isUnsentMedia&&this.type!==W.CIPHERTEXT&&this.type!==W.UNKNOWN},isGroupLeave:function(){return"gp2"===this.type&&("leave"===this.subtype||"remove"===this.subtype)&&_.head(this.recipients)===Store.Conn.me},isTrusted:function(){return this.sender===Store.Conn.me||(!(!this.senderObj||!this.senderObj.isMyContact)||(this.isGroupMsg?this.chat.isTrusted():!!O.supportsFeature(O.F.SPAM)&&this.chat.notSpam))},resumeRemoteUpload:function(){if(this._shouldUploadFromPhone=!0,this.mediaState===V.REMOTE_NEED_UPLOAD&&this.promises.mediaPromise){var e=this.promises.mediaPromise;return e.control.requestPhoneUpload(),e}return this.downloadMedia()},forceDownloadMedia:function(){return this.mustDownloadMedia=!0,this.downloadMedia()},forceRMR:function(){var e=this;return new f["default"](function(t,n){e.promises.mediaPromise&&e.promises.mediaPromise.control&&e.promises.mediaPromise.control.forceRMR||n("forceRMR control undefined"),e.promises.mediaPromise.control.forceRMR(t)})},isForcingRMR:function(){return!!this._forceRMRCallback},cancelDownload:function(){this.promises.mediaPromise.control.cancel()},resumeUpload:function(){return y.assert(this.mediaState===V.NEED_UPLOAD,"resume-non-need-upload","resumeUpload called while state was "+this.mediaState)(),this.reupload()},cancelUpload:function(){this.promises.uploadPromise2.control.cancel()},downloadMedia:function(){var e=this;if(this.mediaState===V.PREPARING)return f["default"].resolve();var t=f["default"].resolve();if(!this.decryptedMediaBlob||this.promises.mediaPromise&&this.promises.mediaPromise.isPending()){if(this.promises.mediaPromise)return this.promises.mediaPromise.control.poke(),this.promises.mediaPromise}else t=G.validateBlob(this.decryptedMediaBlob).then(function(t){return t?f["default"].reject("BLOB VALID"):void e.set({mediaState:V.FETCHING,url:null})});return this.promises.mediaPromise=t.loop(function(t){var n=void 0;if(e.mediaState===V.REMOTE_UPLOADING)n=f["default"].sit("phoneResolved");else if(e.mediaState===V.REMOTE_NEED_UPLOAD){var r=O.supportsFeature(O.F.MEDIA_RETRY);if(e._shouldUploadFromPhone&&r)return e.set({_shouldUploadFromPhone:!1,mediaState:V.REMOTE_UPLOADING}),void Store.Msg.send(e).then(function(t){"success"!==t&&e.promises.mediaPromise.control.phoneResolved(!1)});n=f["default"].sit("requestPhoneUpload",function(){return!1}).addResolveControl("phoneResolved",_.identity)}return n?n.then(function(n){n?t():e.mediaState=V.REMOTE_NEED_UPLOAD}):void t()}).loop(function(t){var n=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],r=void 0;return n?r=l(e):(r=f["default"].resolve(),r=r.then(function(){return c(e,P.isEncryptedMedia(e.clientUrl))})),r.then(function(e){t(e)})["catch"](M.MediaNeedsReupload,function(){return f["default"].loop(function(t){return y.log("msg:downloadMedia need rmr, will auto "+e.mustDownloadMedia)(),e.mustDownloadMedia?(e.mustDownloadMedia=!1,void t(!0)):(e.mediaState=V.NEED_POKE,f["default"].sit("poke"))})})["catch"](Y,M.MediaLoadError,function(t){return y.error("msg:processMedia: "+t)(),e.mediaState=V.NEED_POKE,f["default"].sit("poke")["return"](!1)})["catch"](H,function(){return e.mediaState=V.ERROR_MISSING,L.waitForBBEvent(e,"change:clientUrl")["return"](!1)})})["catch"]("BLOB VALID",_.noop)["catch"](M.LogoutDrop,_.noop).endWithControls("poke","phoneResolved","cancel","requestPhoneUpload","forceRMR")},"delete":function(){this.decryptedMediaBlob&&this.unset("decryptedMediaBlob"),P.isBlob(this.url)&&URL.revokeObjectURL(this.url),E.prototype["delete"].call(this),Store.Msg.remove(this.id),Store.StarredMsg.remove(this.id),this.msgChunk&&this.msgChunk.remove(this.id);var e=Store.Chat.get(this.id.remote);if(e&&(e.unreadMsgAnchor===this&&(e.unreadMsgAnchor=void 0),e.lastReceivedKey===this.id)){e.lastReceivedKey=void 0;var t=e.getLastReceivedMsg();t&&(e.lastReceivedKey=t.id)}},quotedMsgObj:function(){if(!this.quotedMsg)return null;if(this._quotedMsgObj)return this._quotedMsgObj;var e=!this.quotedParticipant||this.quotedParticipant===Store.Conn.me,t=e?"out":"in",n={id:this.quotedStanzaID,from:e?Store.Conn.me:this.id.remote,to:e?this.id.remote:Store.Conn.me,self:t,author:this.quotedParticipant},r=x.isGroup(n.from)||x.isGroup(n.to);return r&&Store.Conn.me!==this.quotedParticipant&&(n.participant=this.quotedParticipant),_.assign(n,this.quotedMsg),this._quotedMsgObj=u(n)},contextInfo:function(){var e=_.omit(this.toJSON(),["id","t","notifyName","from","to","author","self","ack","invis","isNewMsg","star","recvFresh","recipients","broadcast","avparams","quotedMsg","quotedStanzaID","quotedParticipant","senderObj","multicast"]);return{quotedMsg:e,quotedParticipant:this.sender,quotedStanzaID:this.id.id}},displayName:function(e,t){if(!this.sender)return"";if(this.sender===Store.Conn.me)return l10n.t("web_you");var n=this.senderObj,r=e?n.shortName:void 0;if(r)return r;if(n.name)return n.name;var i=t&&this.notifyName?" ~"+this.notifyName:"";return l10n.isRTL()?l10n.embedLTR(x.formattedUser(this.sender))+i:x.formattedUser(this.sender)+i},isQuoted:function(e){var t=this.quotedMsgObj();return!!t&&t.sender===e},isMentioned:function(e){return _.indexOf(this.mentionedJidList,e)>-1},mentionMap:function(){if(!this.isGroupMsg||!O.supportsFeature(O.F.MENTIONS_IN))return null;if(!_.size(this.mentionedJidList))return null;var e={};return _.forEach(this.mentionedJidList,function(t){var n=x.user(t),r=void 0,i=Store.Contact.get(t);i&&(i.name?r=i.name:i.notifyName&&(r=i.notifyName.name)),r||t!==Store.Conn.me||(r=Store.Conn.pushname),r=r||x.formattedUser(t),e["@"+n]={jid:t,display:r}}),e},updateAck:function(e){var t=this.ack;_.isNumber(e)&&("undefined"==typeof t||e>t)?this.ack=e:e===-1&&0===this.ack&&(this.ack=-1,this.mediaState===X.MEDIA_STATE.REMOTE_UPLOADING&&(this.promises.mediaPromise?this.promises.mediaPromise.control.phoneResolved(!1):this.mediaState=X.MEDIA_STATE.REMOTE_NEED_UPLOAD))},sendMediaMsg:function(e){var t=this,n=e.filehash;return this.mediaKey&&(delete e.name,e.mimetype=this.mimetype,e.size=this.size,e.type=this.type===W.PTT?"audio":this.type,e.height=this.height,e.width=this.width,e.duration=this.duration,e.filehash=this.filehash,this.type===W.DOCUMENT&&(e.filename=this.filename)),this.set({mediaState:V.SENDING,avparams:e,filehash:e.filehash,uploadhash:n,size:parseInt(e.size,10)}),Store.Msg.send(this).then(function(e){y.assert("dropped"!==e,"media-dropped","id: "+t.id)(),t.mediaState=t.decryptedMediaBlob?V.RESOLVED:V.INIT})},sendPlayed:function(){if("ptt"===this.type&&!(this.isSentByMe||this.ack>=v.ACK_PLAYED)){var e=this;S.sendMessagePlayed(this.id).then(function(t){e.ack=v.ACK_PLAYED})["catch"](M.WapDrop,_.noop)}},avParams:function(){return this.avparams?this.avparams:{url:this.clientUrl,type:this.type,mimetype:this.mimetype,filehash:this.filehash,filename:this.filename,duration:this.duration,width:this.fullWidth,height:this.fullHeight}},resend:function(){return this.isFailed?(this.ack=0,this.isMMS?this.resumeRemoteUpload():Store.Msg.send(this)):f["default"].resolve()},onCiphertextDecrypted:function(){var e=this.chat,t=e.msgs.length,n=e.msgs.indexOf(this);n!==-1&&t-n<=10&&j.alertNewMsg(this)},handleUpload:function(e,t,n){var r=this,i=t.then(function(t){return e["return"](t)}).then(function(e){var t=e.avParams,n=e.mediaKey;y.assert(t,"empty-av-params","id: "+r.id)(),r.set({reupload:void 0,clientUrl:t.url,mediaKey:n,mediaState:V.SENDING}),r.promises.uploadPromise2=null,r.sendMediaMsg(t)})["catch"](M.GaveUpRetry,f["default"].CancellationError,M.CapabilityError,M.Server5xxDrop,function(e){y.error("msg:handleUpload failed to upload "+r.id+", "+e)(),r.set({mediaState:V.NEED_UPLOAD}),r.promises.uploadPromise2=null})["catch"](M.MediaMissing,function(){y.warn("msg:handleUpload can not forward "+r.id+", not on phone")(),r.set({uploadPromise2:null,mediaState:V.ERROR_MISSING})})["catch"](M.LogoutDrop,function(e){return _.noop})["catch"](function(e){y.assert(!1,"upload-uncaught-error","Error: "+e)()}),o=function(){return r.mediaState===V.NEED_UPLOAD?r.handleUpload(e,n(r.to),n):r.uploadPromise2||e};return this.set({mediaState:V.UPLOADING,uploadPromise2:t,reupload:o}),this.promises.uploadPromise2=t,i},eventTypeFromMsgType:function(){var e,t,n=this.type,r=this.subtype;return n===W.GP2||n===W.GROUP_NOTIFICATION?"subject"===r?e="n":"add"===r||"invite"===r?(t=_.head(this.recipients),e=t===Store.Conn.me?"s":"i"):"remove"===r?(t=_.head(this.recipients),e=t===Store.Conn.me?"n":"i"):e="create"===r?"n":"i":e=n===W.BROADCAST_NOTIFICATION||n===W.NOTIFICATION||n===W.E2E_NOTIFICATION?"create"===r?"n":"i":n===W.CALL_LOG?"n":this.broadcast?"i":"d",e}}),Q=[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70],Z={image:1,video:1,audio:1,ptt:1,document:1},J=[],$={},ee=new F(function(){var e=J;J=[],s(e)});X.TYPE=W,X.MEDIA_STATE=V,X.GIF_ATTRIBUTION=K,X.newTag=i,X.typeIsMMS=o,e.exports=X},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(46),o=r(i),a=n(420),s=r(a),c=n(2),l=r(c),u=n(883),d=r(u),p=n(888),h=r(p),f=n(417),m=r(f),g=n(1),v=n(14),y=n(10),_=n(29),E=n(30),b={async:function(e,t){var n=e.split(".").slice(-1),r=(0,m["default"])(n,1),i=r[0];return this._asyncKey(i,e,t)},asyncState:function(e,t){var n=this,r=E.mapValues(e,function(e,t){return n._asyncKey(t,e)});for(var i in t)void 0===r[i]&&(r[i]=t[i]);return r},_asyncKey:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?this.props:arguments[2],r=t.split("."),i=this._getAsyncIndex(r),o=r.slice(0,i),a=(0,h["default"])(o),s=a[0],c=a.slice(1),l=r.slice(i+1),u=n[r[0]];return i&&(u=this._getObservable(e,s,c,n,r[i])),u?E.isFunction(u.on)||E.isFunction(u.off)?this._asyncObserver(e,r,c,u,l):g.trace("asyncMixin path resolved to non-observable: "+t):g.trace("asyncMixin path resolved to nonexistent state! path: "+t)},_getObservable:function(e,t,n,r,i){var o=n.length?r[t].getp(n):r[t];return o?Store[i].get(o):null},_asyncObserver:function(e,t,n,r,i){var o=this;this._loadStale(r);var a="change:"+i.join("."),s=function(){return o.setOrQueueState((0,d["default"])({},e,r.getp(i)))};return r.on(a,s),r.isState&&r._uiObservers++,this._asyncs=this._asyncs||{},this._asyncs[e]={key:e,splitPath:t,basePath:n,observable:r,callback:s,eventKey:a},r.getp(i)},_loadStale:function(e){var t=this;if(e.stale){var n=e.id;y.uiBusy?!function(){var r=t._waAsyncWaits||(t._waAsyncWaits=[]),i=_.waitForBBEvent(y,"ui_idle").then(function(){return e.getCollection().find(n)})["finally"](function(){t._waAsyncWaits=E.without(t._waAsyncWaits,i)})["catch"](v.WapDrop,E.noop)["catch"](l["default"].CancellationError,E.noop);r.push(i)}():e.getCollection().find(n)["catch"](v.WapDrop,E.noop)}},componentWillMount:function(){this.__willMount=!0,this.__stateQueue&&(this.setState(E.assign.apply(E,[{}].concat((0,s["default"])(this.__stateQueue)))),this.__stateQueue=void 0)},setOrQueueState:function(e){this.__willMount?this.setState(e):(this.__stateQueue=this.__stateQueue||[],this.__stateQueue.push(e))},_observersMatch:function(e,t,n,r){return n[e]===r[e]&&(!t.length||n[e].getp(t)===r[e].getp(t))},componentWillReceiveProps:function(e){var t=this;if(this._asyncs){var n={};E.forIn(this._asyncs,function(r,i){var o=r.splitPath,a=r.basePath,s=(0,m["default"])(o,1),c=s[0];if(!t._observersMatch(c,a,t.props,e)){var l=r.observable,u=r.callback,d=r.eventKey;l.off(d,u),l.isState&&l._uiObservers--,n[i]=t._asyncKey(i,o.join("."),e)}}),(0,o["default"])(n).length&&this.setOrQueueState(n)}},componentWillUnmount:function(){this._waAsyncUnmount=!0;var e=this._waAsyncWaits;if(e)for(;e.length;)e.shift().cancel();this._asyncs&&E.forIn(this._asyncs,function(e){var t=e.observable,n=e.callback,r=e.eventKey;t.off(r,n),t.isState&&t._uiObservers--})},_getAsyncIndex:function(e){for(var t=1;t<e.length;++t)if(e[t].charAt(0).toLowerCase()!==e[t].charAt(0))return t;return 0}};e.exports=b},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n,r,o,a){if(r<n)return-1;var s,c=Math.round((n+r)/2),l=e[c],u=l.offsetLeft-o;if(u>=t)s=a;else{if(u+l.clientWidth>t)return c;s=!a}return s?i(e,t,n,c-1,o,a):i(e,t,c+1,r,o,a)}function o(e,t){for(var n=0,r=e.childNodes,i=0;i<r.length;i++){var o=r[i];if(o===t)break;n+=o.clientWidth}return n}var a=n(1042),s=r(a),c=n(2),l=r(c),u=n(6),d=n(34),p=n(415),h=n(54),f=n(130),m=n(78),g=n(133),v=n(10),y=n(29),E=n(43),b=n(884),S=n(101),M=n(1094),T=n(1228),C=n(1019),w=n(1092),x=n(1036),N=n(1037),P=n(1040),k=n(1041),D=n(1093),O=n(1038),A=n(1231),R=4096,I={SMALL:"small",LARGE:"large"},L=/\uFE0F/g,F=u.createClass({displayName:"EmojiText",mixins:[m,f,g,b],statics:{EMOJI_SIZE:I},propTypes:{text:u.PropTypes.string,highlight:u.PropTypes.array,mention:u.PropTypes.object,emojiSize:u.PropTypes.oneOf(_.values(I)),element:u.PropTypes.string,classes:u.PropTypes.string,direction:u.PropTypes.string,linkify:u.PropTypes.bool,titlify:u.PropTypes.bool,ellipsify:u.PropTypes.bool,selectable:u.PropTypes.bool,format:u.PropTypes.bool,wbr:u.PropTypes.number,dirMismatch:u.PropTypes.bool},getInitialState:function(){var e=this.props,t=e.ellipsify,n=e.format,r=e.text;if(t&&n)throw new Error("ellipsify && format are not supported together");return this.debouncedRecompute=this.safeDebounce(this.recompute,20),this.reged=!1,{ellipsified:null,text:r?r.replace(L,""):r}},getDefaultProps:function(){return{emojiSize:I.SMALL,element:"span"}},componentWillMount:function(){h.isWebkit&&this.props.ellipsify&&this.containsEmoji()&&this.regResizeListener()},componentWillReceiveProps:function(e){var t=e.text?e.text.replace(L,""):void 0;if(h.isWebkit&&this.props.ellipsify&&t!==this.state.text){var n=(t||"").substring(0,R);p.containsEmoji(n)?(this.recompute(),this.regResizeListener()):(this.setState({ellipsified:null}),this.unregResizeListener())}this.setState({text:t})},containsEmoji:function(){var e=(this.state.text||"").substring(0,R);return p.containsEmoji(e)},regResizeListener:function(){this.reged||(this.regNativeListener(window,"resize",this.debouncedRecompute),this.regCmd("resize",this.debouncedRecompute),this.reged=!0)},unregResizeListener:function(){this.reged&&(this.unregNativeListener(window,"resize",this.debouncedRecompute),this.unregCmd("resize",this.debouncedRecompute),this.reged=!1)},recompute:function(){this.setState({ellipsified:null},this.ellipsify)},ellipsifyCheck:function(){this.isMounted()&&this.containsEmoji()&&this.ellipsify()},componentDidMount:function(){h.isWebkit&&this.props.ellipsify&&(v.uiBusy?y.waitForBBEvent(v,"ui_idle").then(this.ellipsifyCheck)["catch"](l["default"].CancellationError,_.noop):this.ellipsifyCheck())},ellipsify:function(){var e=d.findDOMNode(this);if(e){var t=e.querySelectorAll("img");if(0!==t.length){var n,r=!l10n.isRTL(),a=0;if(n=e.clientWidth){if(n===e.scrollWidth)return;a=0}else{var s=e.parentNode;if(a=o(s,e),n=s.clientWidth-a,s.clientWidth===s.scrollWidth)return}var c=i(t,r?n:0,0,t.length-1,r?a:0,r);if(!(c<0)){var l=t[c],u=10;u-=Math.floor(u/4);var p=i(t,r?n-u:u,0,c,r?a:0,r);p>-1&&(l=t[p]);for(var h=e.childNodes,f=[],m=0;m<h.length;m++){var g=h[m];if(g===l)break;3===g.nodeType?f.push(g.textContent||""):f.push(g.alt||"")}
if(f.length){var v=f.length-1;f[v]=f[v].trimRight()}this.setState({ellipsified:f.join("")})}}}},render:function(){if(!this.state.text)return null;var e=this.state.ellipsified;e||(e=this.props.ellipsify?(this.state.text||"").substring(0,R):this.state.text);var t=this.props.selectable?"selectable-text":void 0,n=new s["default"];n.set("default",{className:t}),n.set(w,{size:this.props.emojiSize});var r=[],i=S.supportsFeature(S.F.RICH_TEXT)&&this.props.format;i&&r.push(new C),this.props.linkify&&r.push(new N),i&&(r.push(new k),r.push(new x),r.push(new P)),this.props.wbr&&r.push(new T(this.props.wbr)),r.push(new w);var o=this.props.highlight;o&&o.length>0&&r.push(new D(o)),this.props.mention&&r.push(new O(this.props.mention));var a=M.parse(e,r),c=M.serialize(a,new A(n)),l=E(this.props.classes,{emojitext:!this.props.classes,ellipsify:this.props.ellipsify,"inverse-text-direction":this.props.dirMismatch,"selectable-text":this.props.selectable}),d={className:l,dir:this.props.direction};this.props.titlify&&(d.title=this.state.text);var p=this.props.element;return u.createElement(p,d,c,this.props.ellipsified?"ĳ":null)}});e.exports=F},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(417),o=r(i),a=n(1238),s=r(a),c=n(2),l=r(c),u=n(6),d=n(8),p=n(1),h=n(79),f=n(1016),m=n(974),g=n(200),v=n(1085),y=n(1015),E=n(1007),b=n(1200),S=n(101),M=n(10),T=n(65),C=n(45),w=n(15),x=n(196),N=n(14),P=n(55),k=n(80),D=n(21),O=n(426),A=n(64).ActionToast,R=n(64).ActionType,I=n(1035),L=n(1021),F=3e5,U={GROUP:"group",BROADCAST:"broadcast",CHAT:"chat"},j=h.extend({Collection:"Chat",props:{id:"string",t:"number",unreadCount:{type:"number","default":0},archive:"boolean",isReadOnly:"boolean",modifyTag:"number",muteExpiration:{type:"number","default":0},name:"string",notSpam:"boolean",pendingMsgs:"boolean"},session:{viewed:"boolean",createdLocally:"boolean",pendingAction:"number",formattedTitle:"string",active:"boolean",pausedTimerId:"number",presenceResendTimerId:"number",recording:"boolean",typing:"boolean",unreadDivider:"object",colors:"object",composeContents:{type:"object","default":function(){return{}}},popupPanels:"object",popupPositionChange:"number",squelch:"number",pendingSeenCount:{type:"number","default":0},markedUnread:"boolean",msgChunks:{type:"array","default":function(){return[]}},trusted:"boolean",canSend:"boolean",unreadMsgAnchor:"object",disableUnreadAnchor:"boolean",promises:{type:"object","default":function(){return{}}},ftsCache:{type:"object","default":function(){return{}}},lastReceivedKey:"object",composeQuotedMsg:m},collections:{msgs:E,mediaMsgs:b},children:{presence:f,contact:g,mute:v,groupMetadata:y},initialize:function(){if(this.msgs.msgLoadState.contextLoaded=!0,this.isNewlyCreated()&&(this.msgs.msgLoadState.noEarlierMsgs=!0),this.presence=Store.Presence.gadd(this.id),this.listenTo(this.presence,"all",this._getEventBubblingHandler("presence")),this.mute=Store.Mute.add({id:this.id,expiration:this.muteExpiration},{merge:!0}),this.listenTo(this.mute,"all",this._getEventBubblingHandler("mute")),D.isPSA(this.id)&&this._updatePSAName(),this.contact=Store.Contact.gadd(this.id),this.name&&!this.contact.name&&(this.contact.name=this.name),this.listenTo(this.contact,"all",this._getEventBubblingHandler("contact")),this.listenTo(this.contact,"change:formattedName",this.updateTitle),this.isGroup&&(this.trusted=!0),this.isGroup||this.isBroadcast){var e;this.isBroadcast&&!Store.GroupMetadata.get(this.id)&&(e=!0),this.groupMetadata=Store.GroupMetadata.gadd({id:this.id}),this.listenTo(this.groupMetadata,"all",this._getEventBubblingHandler("groupMetadata")),this.listenTo(this.groupMetadata,"change:stale",this.updateReadOnly),this.listenTo(this.groupMetadata,"change:trusted change:stale",this.isTrusted),this.listenTo(this.groupMetadata.participants,"add remove reset",this.updateReadOnly),this.listenTo(this.groupMetadata.participants,"change:contact.formattedShortName",this.updateTitle),this.updateReadOnly();var t=this.id;this.listenTo(this,"change:isReadOnly",function(){this.isTrusted(),this.updateCanSend(),Store.ProfilePicThumb.update(t)["catch"](N.WapDrop,_.noop),Store.GroupMetadata.update(t)["catch"](N.WapDrop,_.noop)}),e&&Store.GroupMetadata.update(t)["catch"](N.WapDrop,_.noop)}else this.listenTo(this.presence,"change:isOnline",this._presenceOnlineChanged),this.listenTo(this.contact,"change:isMyContact",this.isTrusted),this.listenTo(Store.Blocklist,"add remove reset",this.updateCanSend);Store.Chat.notSpam[this.id]&&!this.notSpam&&this.sendNotSpam()["catch"](_.noop),Store.Chat.notSpam[this.id]=!!this.notSpam,this.notSpam||this.listenTo(this,"change:notSpam",this.onNotSpamChange),this.updateTitle(),this.isTrusted(),this.updateCanSend(),this.listenTo(this.msgs,"add",this.onNewMsg),this.listenTo(this.msgs,"remove",this.updateSortTime),this.listenTo(this.msgs,"bulk_add",this.addMediaMsgs),this.listenTo(this,"change:msgs",this.resetMediaMsgs),this._saveAssignedColors=_.debounce(this.saveAssignedColors,1e3),this.listenTo(this,"change:active",this.onActiveUpdate),this.pendingAction=0,this.listenTo(this,"change:pendingAction",this.onPendingActionUpdate),this.listenTo(this,"change:t change:modifyTag",this._clearFtsCache)},derived:{kind:{fn:function(){return this.isGroup?U.GROUP:this.isBroadcast?U.BROADCAST:this.isUser?U.CHAT:void 0}},isGroup:{fn:function(){return D.isGroup(this.id)}},isBroadcast:{fn:function(){return D.isBroadcast(this.id)}},isUser:{fn:function(){return D.isUser(this.id)}},isPSA:{fn:function(){return D.isPSA(this.id)}},hasUnread:{deps:["unreadCount"],fn:function(){return 0!==this.unreadCount}}},onActiveUpdate:function(){this.isGroup&&this.active&&(this.squelch=-1),this.presence.chatActive=this.active},onPendingActionUpdate:function(){this.pendingAction<0&&(p.log("chat:onPendingActionUpdate pendingAction value is invalid")(),this.pendingAction=0)},onNotSpamChange:function(){Store.Chat.notSpam[this.id]=this.notSpam,this.isTrusted(),this.notSpam&&this.stopListening(this,"change:notSpam")},hasMaybeSentMsgToChat:function(){return _.some(this.getAllMsgs(),function(e){return e.isSentByMe})},isTrusted:function(){var e=void 0;return this.isGroup?e=S.supportsFeature(S.F.SPAM)?this.isReadOnly||this.notSpam||this.groupMetadata.isTrusted():this.groupMetadata.isTrusted():this.isBroadcast?e=!0:this.isUser&&(e=!S.supportsFeature(S.F.SPAM)||(this.notSpam||this.contact.isMyContact)),!e&&this.hasMaybeSentMsgToChat()&&(e=!0),this.trusted=e},updateTitle:function(){this.isBroadcast?this.formattedTitle=this.contact.name||this.groupMetadata.participants.map(function(e){return e.contact.formattedShortName}).join(", "):this.isUser?this.formattedTitle=this.contact.name||D.formattedUser(this.id):this.isGroup&&(this.formattedTitle=this.contact.name)},sendExit:function(){var e=this;if(!this.isGroup)return l["default"].reject(new N.ActionError);if(this.promises.sendExit)return this.promises.sendExit;this.promises.sendExit=C.leaveGroup(this.id);var t=new R(l10n.t("action_group_exiting")),n=this.promises.sendExit.then(function(e){return 200===e.status?new R(l10n.t("action_group_exited")):e.status>=400?new R(l10n.t("action_group_exit_failed")):void 0})["catch"](function(e){return p.error("models:chat:sendExit dropped")(e),new R(l10n.t("action_group_exit_failed"),l10n.t("action_try_again"),this.sendExit.bind(this))});return M.openToast(u.createElement(A,{id:A.genId(),initialAction:t,pendingAction:n})),this.promises.sendExit.bind(this).then(function(e){200!==e.status||e._duplicate||this.exit()})["finally"](function(){e.promises.sendExit=null})},canExit:function(){return S.supportsFeature(S.F.GROUP_EXIT)},exit:function(){this.isGroup&&(this.groupMetadata.participants.remove(Store.Conn.me),this.isReadOnly=!0)},sendDelete:function(){var e=this;if(this.promises.sendDelete)return this.promises.sendDelete;var t=this.msgs.last(),n=t?t.id:void 0;this.promises.sendDelete=C.sendConversationDelete(this.id,n);var r,i=this.kind;switch(i){case U.GROUP:r=l10n.t("action_group_deleting");break;case U.BROADCAST:r=l10n.t("action_broadcast_deleting");break;case U.CHAT:r=l10n.t("action_chat_deleting")}r=new R(r);var o=this.promises.sendDelete.bind(this).then(function(e){if(200===e.status)switch(i){case U.GROUP:return new R(l10n.t("action_group_deleted"));case U.BROADCAST:return new R(l10n.t("action_broadcast_deleted"));case U.CHAT:return new R(l10n.t("action_chat_deleted"))}else if(e.status>=400)switch(i){case U.GROUP:return new R(l10n.t("action_group_delete_failed"));case U.BROADCAST:return new R(l10n.t("action_broadcast_delete_failed"));case U.CHAT:return new R(l10n.t("action_chat_delete_failed"))}})["catch"](function(e){p.error("models:chat:sendDelete dropped")(e);var t=void 0;switch(i){case U.GROUP:t=l10n.t("action_group_delete_failed");break;case U.BROADCAST:t=l10n.t("action_broadcast_delete_failed");break;case U.CHAT:t=l10n.t("action_chat_delete_failed")}return new R(t,l10n.t("action_try_again"),this.sendDelete.bind(this))});return M.openToast(u.createElement(A,{id:A.genId(),initialAction:r,pendingAction:o})),this.promises.sendDelete.bind(this).then(function(e){if(200===e.status&&!e._duplicate){var n=this.msgs.last();t===n?this["delete"](!0):this.deleteMsgsBeforeMsgInclusive(t)}})["finally"](function(){e.promises.sendDelete=null})},updateCanSend:function(){return this.isReadOnly?this.canSend=!1:this.isUser?this.canSend=!(this.contact.isBlocked()||this.isPSA):this.canSend=!0},canDelete:function(){return S.supportsFeature(S.F.DELETE)},canClear:function(){return S.supportsFeature(S.F.CHAT_CLEAR)},sendClear:function(e){var t=this;if(this.promises.sendClear)return this.promises.sendClear;var n=this.msgs.last(),r=n?n.id:void 0;this.promises.sendClear=C.sendConversationClear(this.id,r,!e);var i=new R(l10n.t("action_chat_clearing")),o=this.promises.sendClear.then(function(e){return 200===e.status?new R(l10n.t("action_chat_cleared")):e.status>=400?new R(l10n.t("action_chat_clear_failed")):void 0})["catch"](function(n){return p.error("models:chat:sendClear dropped")(n),new R(l10n.t("action_chat_clear_failed"),l10n.t("action_try_again"),t.sendClear.bind(t,e))});return M.openToast(u.createElement(A,{id:A.genId(),initialAction:i,pendingAction:o})),this.promises.sendClear.then(function(r){200!==r.status||r._duplicate||t.deleteMsgsBeforeMsgInclusive(n,e)})["finally"](function(){t.promises.sendClear=null})},"delete":function(e){this.cancelPendingPromises(),h.prototype["delete"].call(this),this.groupMetadata["delete"](),this.presence["delete"](),Store.Mute.remove(this.id),this.mute["delete"](),this.deleteMsgs(),Store.Chat.remove(this.id),M.clearChat(this),this.mediaMsgs["delete"]()},isDirty:function(){return 0!==this.unreadCount},isNewlyCreated:function(){return!!this.createdLocally&&0===this.msgs.length},isVisible:function(){return this.viewed||!this.isNewlyCreated()},resetMediaMsgs:function(){this.mediaMsgs["delete"](),this.mediaMsgs.add(this.msgs.models.filter(function(e){return e.isMedia}))},addMediaMsgs:function(e,t){var n=_.isArray(e)?e:[e],r=n.filter(function(e){return e.isMedia});r.length>0&&this.mediaMsgs.add(r,t)},onNewMsg:function(e){if(e&&"i"!==e.eventType&&(this.t=e.t,this.promises.updateSortTime&&this.promises.updateSortTime.cancel(),this.archive&&(this.archive=!1),e.isSentByMe||this.presence.handle({id:this.id,participant:e.author,type:"available"}),!e.isSentByMe))if("d"===e.eventType)this.unreadCount=this.unreadCount+1||1,e.type!==m.TYPE.CIPHERTEXT&&M.alertNewMsg(e),this.msgs.length<d.MSG_PRELOAD_THRESHOLD&&this.loadEarlierMsgs();else if("s"===e.eventType){if("gp2"===e.type&&"add"===e.subtype&&_.head(e.recipients)===Store.Conn.me&&!this.contact.name)return;M.alertNewMsg(e)}},setArchive:function(e,t){var n=this;if(this.archive===e)return l["default"].reject(new N.ActionError);if(this.promises.setArchive)return this.promises.setArchive;var r=this.lastReceivedKey,i=C.sendConversationArchive(this.id,e,r),o=new R(e?l10n.t("action_chat_archiving"):l10n.t("action_chat_unarchiving"));t=t||A.genId();var a=i.then(function(r){var i=void 0;return 200===r.status?(i=e?l10n.t("action_chat_archived"):l10n.t("action_chat_unarchived"),new R(i,l10n.t("action_undo"),n.setArchive.bind(n,!e,t))):r.status>=400?new R(e?l10n.t("action_chat_archive_failed"):l10n.t("action_chat_unarchive_failed")):void 0})["catch"](function(r){p.error("models:chat:setArchive dropped")(r);var i=e?l10n.t("action_chat_archive_failed"):l10n.t("action_chat_unarchive_failed");return new R(i,l10n.t("action_try_again"),n.setArchive.bind(n,e,t))});return M.openToast(u.createElement(A,{id:t,initialAction:o,pendingAction:a})),this.promises.setArchive=i.bind(this).then(function(t){200!==t.status||t._duplicate||(this.archive=e)})["finally"](function(){n.promises.setArchive=null})},canArchive:function(){return this.isBroadcast?S.supportsFeature(S.F.ARCHIVE_BROADCAST):S.supportsFeature(S.F.ARCHIVE)},sendSeen:function(){if(this.markedUnread||0===this.unreadCount)return l["default"].resolve();if(!T.available)return this.listenTo(T,"change:available",this.sendSeen),l["default"].resolve();this.stopListening(T,"change:available",this.sendSeen);var e=this.unreadCount-this.pendingSeenCount,t=this.unreadCount===-1&&e===-1;if(e<=0&&!t)return l["default"].resolve();this.disableUnreadAnchor=!0,this.pendingSeenCount=this.unreadCount;var n=this,r=function(){n.pendingSeenCount=n.pendingSeenCount-e,n.pendingSeenCount<0&&(p.error("models:chat:sendSeen unread "+n.unreadCount+" pending: "+n.pendingSeenCount+" delta: "+e)(),n.pendingSeenCount=0)},i=this.lastReceivedKey;return S.gte([0,4])?C.sendConversationSeen(this.id,i,e).bind(this).then(function(t){return r(),200!==t.status||t._duplicate||this.markSeen(e),t})["catch"](N.WapDrop,function(e){r(),p.error("models:chat:sendConversationSeen dropped")()}):(r(),this.markSeen(e),C.sendConversationSeen(this.id,i,e).bind(this).then(function(e){return e})["catch"](N.WapDrop,function(e){p.error("models:chat:sendConversationSeen dropped")()}))},markSeen:function(e){e&&"number"==typeof e?e>0&&e<=this.unreadCount?this.unreadCount=this.unreadCount-e:e===-1&&this.unreadCount<=0&&(this.unreadCount=0):this.unreadCount=0,this.unreadMsgAnchor=void 0,this.markedUnread=!1},markUnread:function(e,t){var n=this;if(e?this.active&&(this.markedUnread=!0):this.markedUnread=!1,this.promises.markUnread)return this.promises.markUnread;this.promises.markUnread=e?this.sendUnseen():this.sendSeen();var r=new R(e?l10n.t("action_chat_marking_unread"):l10n.t("action_chat_marking_read"));t=t||A.genId();var i=this.promises.markUnread.then(function(r){if(200===r.status){var i=e?l10n.t("action_chat_marked_unread"):l10n.t("action_chat_marked_read");return new R(i,l10n.t("action_undo"),n.markUnread.bind(n,!e,t))}if(r.status>=400)return new R(e?l10n.t("action_chat_mark_unread_failed"):l10n.t("action_chat_mark_read_failed"))})["catch"](function(r){var i=e?l10n.t("action_chat_mark_unread_failed"):l10n.t("action_chat_mark_read_failed");return new R(i,l10n.t("action_try_again"),n.markUnread.bind(n,e,t))});return M.openToast(u.createElement(A,{id:t,initialAction:r,pendingAction:i})),this.promises.markUnread["finally"](function(){n.promises.markUnread=null})},canMarkUnseen:function(){return S.supportsFeature(S.F.CHAT_MARK_UNSEEN)},sendUnseen:function(){var e=this,t=this.msgs.last(),n=t?t.id:void 0;return C.sendConversationUnseen(this.id,n).then(function(t){return 200===t.status?e.markUnseen():e.markedUnread=!1,t})},markUnseen:function(){this.active&&(this.markedUnread=!0),this.unreadCount=-1},markRecording:function(){if((this.presence.isOnline||this.isGroup)&&!this.recording){var e=this.id;C.sendChatstateRecording(e).then(function(t){t.status>=400&&p.error("models:chat send presence recording error "+e)()})["catch"](N.WapDrop,_.noop),this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),d.PRESENCE_RESEND_WAIT)}this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.recording=!0,this.typing=!1},markComposing:function(){if((this.presence.isOnline||this.isGroup)&&!this.typing){var e=this.id;C.sendChatstateComposing(e).then(function(t){t.status>=400&&p.error("models:chat send presence composing error "+e)()})["catch"](N.WapDrop,_.noop),this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),d.PRESENCE_RESEND_WAIT)}this.typing=!0,this.pausedTimerId&&clearTimeout(this.pausedTimerId),this.pausedTimerId=_.delay(this.markPaused.bind(this),d.SEND_PAUSED_WAIT)},markPaused:function(){if((this.presence.isOnline||this.isGroup)&&(this.typing||this.recording)){var e=this.id;C.sendChatstatePaused(e).then(function(t){t.status>=400&&p.error("models:chat send presence paused error "+e)()})["catch"](N.WapDrop,_.noop)}this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=this.recording=!1},_resendPresence:function(){var e=this.id;if(this.recording)C.sendChatstateRecording(e).then(function(t){t.status>=400&&p.error("models:chat send presence resend recording error "+e)()})["catch"](N.WapDrop,_.noop);else{if(!this.typing)return void this.unset("presenceResendTimerId");C.sendChatstateComposing(e).then(function(t){t.status>=400&&p.error("models:chat send presence resend composing error "+e)()})["catch"](N.WapDrop,_.noop)}this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),d.PRESENCE_RESEND_WAIT)},_messageSent:function(){this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=!1},_presenceOnlineChanged:function(){this.presence.isOnline?this._resendPresence():this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId"))},handleGroupAction:function(e,t,n){var r;switch(e){case"subject":return void(this.contact.name=n.subject);case"add":case"promote":case"demote":var i="promote"===e;return r=_.map(n.participants,function(e){return{id:e,isAdmin:i}}),void this.groupMetadata.participants.add(r,{merge:!0});case"remove":return r=this.groupMetadata.participants,void _.each(n.participants,function(e){r.remove(e)});case"modify":return;default:return}},preload:function(){1===this.msgs.length&&this.loadEarlierMsgs()},loadEarlierMsgs:function(e){return e||(e=this.msgs),e.msgLoadState.noEarlierMsgs?l["default"].resolve():e.msgLoadState.isLoadingEarlierMsgs?e.loadEarlierPromise:this._loadMsgs("before",e).then(function(t){return _.isArray(t)&&t.length<d.PAGE_SIZE&&(e.msgLoadState.noEarlierMsgs=!0),t})},isMostRecentCMC:function(e){return this.msgs===e},loadRecentMsgs:function(e){return e||(e=this.msgs),this.isMostRecentCMC(e)?l["default"].resolve():e.msgLoadState.isLoadingRecentMsgs?e.loadRecentPromise:this._loadMsgs("after",e)},_loadMsgs:function(e,t){var n;n="after"===e?t.last():t.head();var r={};return n?r=n.id.clone():r.remote=this.id,r.count=d.PAGE_SIZE,r.direction=e,this._loadMsgsPromise(n,t,Store.Msg.findQuery(r),e)},_loadMsgsPromise:function(e,t,n,r){"after"===r?t.msgLoadState.isLoadingRecentMsgs=!0:"before"===r?t.msgLoadState.isLoadingEarlierMsgs=!0:"around"===r&&(t.msgLoadState.isLoadingAroundMsgs=!0);var i=this.regCancellablePromise(n)["finally"](function(){var n=e&&e.msgChunk!==t;t.msgLoadState.contextLoaded=!0,n&&(e.msgChunk.msgLoadState.contextLoaded=!0),"after"===r?t.msgLoadState.isLoadingRecentMsgs=!1:"before"===r?t.msgLoadState.isLoadingEarlierMsgs=!1:"around"===r&&(t.msgLoadState.isLoadingAroundMsgs=!1)})["catch"](function(e){return p.error("chat:loadMsgs:error "+e)(),404===e?l["default"].reject(new N.E404):l["default"].reject(e)});return"after"===r?t.loadRecentPromise=i:"before"===r?t.loadEarlierPromise=i:"around"===r&&(t.loadAroundPromise=i),i},getSearchContext:function(e,t){var n=void 0,r=void 0;e instanceof m?n=e:e instanceof P&&(r=e);var i=n?n.msgChunk:void 0,o=(0,s["default"])(d.PAGE_SIZE/3*2);if(!i||!i.msgLoadState.contextLoaded){i||(i=new E,this.msgChunks.push(i),n&&i.add(n));var a=n?n.id.clone():r.clone();a.count=o;var c=function(){if(n)return n.msgChunk;var e=Store.Msg.get(r);return e&&e.msgChunk?e.msgChunk:i};this._loadMsgsPromise(n,i,Store.Msg.getContext(a,c),"around").then(function(e){var t=e[0],a=r?Store.Msg.get(r):n;a&&_.isArray(t)&&t.length<o&&(a.msgChunk.msgLoadState.noEarlierMsgs=!0,a.msgChunk!==i&&(i.msgLoadState.noEarlierMsgs=!0))})["catch"](function(){t&&(t.isQuotedMsgAvailable=!1)})}return{collection:i,msg:n,key:r,highlightMsg:!0}},sendStarMsgs:function(e,t,n){var r=this;if(!e)return l["default"].reject(new N.ActionError);if(_.some(e,function(e){return!e.id}))return l["default"].reject(new N.ActionError);if(this.promises.sendStarMsgs)return this.promises.sendStarMsgs;this.promises.sendStarMsgs=C.sendMessageStarred(this.id,_.map(e,function(e){return e.id}),t);var i=_.size(e),o={count:i,_plural:i},a=new R(t?l10n.t("action_message_starring",o):l10n.t("action_message_unstarring",o));n=n||A.genId();var s=this.promises.sendStarMsgs.then(function(i){if(200===i.status){var a=t?l10n.t("action_message_starred",o):l10n.t("action_message_unstarred",o);return new R(a,l10n.t("action_undo"),r.sendStarMsgs.bind(r,e,!t,n))}if(i.status>=400)return new R(t?l10n.t("action_message_star_failed",o):l10n.t("action_message_unstar_failed",o))})["catch"](function(i){p.error("models:chat:sendStarMsgs dropped")(i);var a=t?l10n.t("action_message_star_failed",o):l10n.t("action_message_unstar_failed",o);return new R(a,l10n.t("action_try_again"),r.sendStarMsgs.bind(r,e,t,n))});return M.openToast(u.createElement(A,{id:n,initialAction:a,pendingAction:s})),this.promises.sendStarMsgs.then(function(n){200===n.status&&(_.forEach(e,function(e){e.set("star",t)}),t?Store.StarredMsg.add(e):Store.StarredMsg.remove(e))})["finally"](function(){r.promises.sendStarMsgs=null})},sendNotSpam:function(e,t){var n=this;if(!S.supportsFeature(S.F.SPAM))return l["default"].resolve();if(this.notSpam)return l["default"].resolve();if(this.notSpam=!0,this.promises.sendNotSpam)return this.promises.sendNotSpam;if(this.promises.sendNotSpam=C.sendConversationNotSpam(this.id),e){var r=new R(l10n.t("action_mark_as_not_spam"));t=t||A.genId();var i=this.promises.sendNotSpam.then(function(e){return 200===e.status?new R(l10n.t("action_marked_as_not_spam")):e.status>=400?new R(l10n.t("action_mark_as_not_spam_failed")):void 0})["catch"](function(r){return p.error("models:chat:sendNotSpam dropped")(r),new R(l10n.t("action_mark_as_not_spam_failed"),l10n.t("action_try_again"),n.sendNotSpam(e,t))});M.openToast(u.createElement(A,{id:t,initialAction:r,pendingAction:i}))}return this.promises.sendNotSpam["finally"](function(){n.promises.sendNotSpam=null})},sendSpamReport:function(e){var t=this;if(this.promises.sendSpamReport)return this.promises.sendSpamReport;this.promises.sendSpamReport=C.sendSpamReport(this.id);var n=new R(l10n.t("action_spam_report"));e=e||A.genId();var r=this.promises.sendSpamReport.then(function(e){return 200===e.status?new R(l10n.t("action_spam_reported")):e.status>=400?new R(l10n.t("action_spam_report_failed")):void 0})["catch"](function(n){return p.error("models:chat:sendSpamReport dropped")(n),new R(l10n.t("action_spam_report_failed"),l10n.t("action_try_again"),t.sendSpamReport.bind(t,e))});return M.openToast(u.createElement(A,{id:e,initialAction:n,pendingAction:r})),this.promises.sendSpamReport["finally"](function(){t.promises.sendSpamReport=null})},sendDeleteMsgs:function(e,t){var n=this;if(!e)return l["default"].reject(new N.ActionError);if(_.some(e,function(e){return!e.id}))return l["default"].reject(new N.ActionError);if(this.promises.sendDeleteMsgs)return this.promises.sendDeleteMsgs;this.promises.sendDeleteMsgs=C.sendMessageDelete(this.id,_.map(e,function(e){return e.id}),!0);var r=_.size(e),i={count:r,_plural:r},o=new R(l10n.t("action_message_deleting",i));t=t||A.genId();var a=this.promises.sendDeleteMsgs.then(function(e){return 200===e.status?new R(l10n.t("action_message_deleted",i)):e.status>=400?new R(l10n.t("action_message_delete_failed",i)):void 0})["catch"](function(r){return p.error("models:chat:sendDeleteMsgs dropped")(r),new R(l10n.t("action_message_delete_failed",i),l10n.t("action_try_again"),n.sendDeleteMsgs.bind(n,e,t))});return M.openToast(u.createElement(A,{id:t,initialAction:o,pendingAction:a})),this.promises.sendDeleteMsgs.then(function(t){200===t.status&&_.forEach(e,function(e){e["delete"]()})})["finally"](function(){n.promises.sendDeleteMsgs=null})},removeMsg:function(e){var t=e.msgChunk;if(t){var n=t.indexOf(e);n<0||(p.log("models:Chat:removeMsg "+e.get("id"))(),t.remove(e),0===t.length&&(t===this.msgs?(p.log("models:Chat:removeMsg 0 messages left, querying...")(),this.loadEarlierMsgs()):this.removeMsgsCollection(t)))}},deleteMsgs:function(e){var t=this;this.getAllCMCs().forEach(function(n){n.filter(function(t){return(e||!t.star)&&!t.isPersistent}).forEach(function(e){e["delete"]()}),n.msgLoadState.noEarlierMsgs=!0,n!==t.msgs&&t.removeMsgsCollection(n)}),this.unreadCount=0},deleteMsgsOlderThan:function(e,t){var n=this.msgs,r=_.head(n.models);if(r&&!(r.t>=e)){if(r=_.last(n.models),r.t<e)return void this.deleteMsgs(t);var i=function(n){return n&&(n.star&&!t||n.t>=e||n.isPersistent)};this.deleteMsgsPartial(i)}},deleteMsgsBeforeMsgInclusive:function(e,t){if(e&&this.msgs.get(e.id)){var n=this.msgs.indexOf(e),r=function(e,r){return e.msgChunk===this.msgs&&r>n||t&&e.star||e.isPersistent};this.deleteMsgsPartial(r)}},deleteMsgsPartial:function(e){var t=this,n=arguments,r=this.unreadCount,i=_.flatten(this.getAllCMCs().map(function(r){return r.filter(function(){return!e.apply(t,n)})}));if(i.forEach(function(e){e["delete"]()}),_.clone(this.msgChunks).forEach(function(e){0===e.length&&t.removeMsgsCollection(e)}),this.msgs.length>0){var o=r>this.msgs.length?this.msgs.length:r;this.unreadCount=o,this.msgs.msgLoadState.noEarlierMsgs=!0}},getFirstMsgWithStatus:function(){return _.find(this.msgs.models,function(e){return!e.isNotification&&(e.isSentByMe||e.type===m.TYPE.PTT)})},getFirstMsgFromMe:function(){return _.find(this.msgs.models,function(e){return!e.isNotification&&e.isSentByMe})},getLastReceivedMsg:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&(!t.local||t.ack>0))return t}},getLastTimestampMsg:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&"i"!==t.eventTypeFromMsgType())return t}},sendMessage:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments[2],r=arguments[3];if(e=_.trim(e),""===e)return l["default"].resolve();this._messageSent();var i=this.id,o=Store.Conn.me,a=new P({from:o,to:i,id:m.newTag(),participant:void 0,selfDir:"out"}),s=n&&n.contextInfo(),c=_.defaults({id:a,body:e,type:"chat",subtype:t?"url":null,t:x.globalUnixTime(),from:o,to:i,self:"out",local:!0,ack:0},t,s,{mentionedJidList:r}),u=new m(c),d=Store.Msg.send(u);return this.msgs.add(u),d},generateMediaMsgProps:function(e){return{t:x.globalUnixTime(),from:Store.Conn.me,isNewMsg:!0,to:this.id,self:"out",ack:0,local:!0,mediaState:e.mediaState||m.MEDIA_STATE.UPLOADING,id:e.id||new P({from:Store.Conn.me,to:this.id,id:m.newTag(),participant:void 0,selfDir:"out"}),body:e.getThumb?e.getThumb.then(function(e){var t=e.url;return k.parseDataURL(t).data}):void 0,url:e.blob?window.URL.createObjectURL(e.blob):void 0,size:e.blob?e.blob.size:void 0,filehash:e.getFilehash,decryptedMediaBlob:e.blob,duration:e.duration||(e.getDuration?e.getDuration.then(function(e){return _.isFinite(e)?e+"":void 0}):void 0),type:e.type||e.msgType,mimetype:e.mimetype,height:e.height,width:e.width,fullHeight:e.height,fullWidth:e.width,caption:e.caption,filename:e.filename,isGif:e.isGif,gifAttribution:e.gifAttribution,quotedMsg:e.quotedMsg,quotedParticipant:e.quotedParticipant,quotedStanzaID:e.quotedStanzaID}},sendPTT:function(e,t,n){var r=this,i=this.id,o=n?n.contextInfo():null,a={type:"ptt",duration:_.isFinite(t)?t+"":void 0,mediaState:m.MEDIA_STATE.PREPARING};_.defaults(a,o),a=this.generateMediaMsgProps(a);var s=Store.Msg.add(a);this.msgs.add(s),e.then(function(e){return I.prepFileForUpload(e,{precomputedDuration:t})}).then(function(e){return e.uploadPromise2=e.reupload(i),e.id=s.id,e.msgType="ptt",l["default"].props(r.generateMediaMsgProps(e)).then(function(t){return s.handleUpload(l["default"].resolve(),e.uploadPromise2,e.reupload),Store.Msg.add(t,{merge:!0}),t})})["catch"](l["default"].CancellationError,_.noop)["catch"](function(e){p.assert(!1,"media-props-failed","Got Error "+e)(e)})["finally"](function(e){e||(e={id:s.id,ack:-1},Store.Msg.add(e,{merge:!0}))})},sendMedia2:function(e,t){var n=this;e=_.isArray(e)?e:[e];var r=this.id,i=0;l["default"].each(e,function(e){e.uploadPromise2=e.reupload(r)}).mapSeries(function(e){var r=e.caption;"document"===e.msgType&&(e.caption=r||e.filename),0===i&&t&&_.defaults(e,t.contextInfo()),i+=1;var o=n.generateMediaMsgProps(e);return l["default"].props(o)["catch"](function(e){p.assert(!1,"media-props-failed","Got Error "+e)(e)}).then(function(t){if(t){var r=void 0,i=new l["default"](function(e){r=e}),o=e.reupload,a=e.uploadPromise2,s=Store.Msg.add(t),c=s.handleUpload(i,a,o);return n.msgs.add(s),function(){return r(),c}}})}).each(function(e){if(e)return e()})},sendContact:function(e){var t=L.cleanValue(e.formattedName),n="BEGIN:VCARD\nVERSION:3.0\nN:"+L.getName(e)+"\nFN:"+t+"\nTEL;type=CELL;waid="+e.userid+":"+D.formattedUser(e.userid)+"\nEND:VCARD",r={ack:0,body:n,from:Store.Conn.me,id:new P({from:Store.Conn.me,to:this.id,id:m.newTag(),participant:void 0,selfDir:"out"}),local:!0,self:"out",subtype:e.formattedName,t:x.globalUnixTime(),to:this.id,type:"vcard"},i=Store.Msg.add(r);return this.msgs.add(i),Store.Msg.send(i)},forwardMessages:function(e){var t=this,n=this.id,r=this.contact;if(r.isUser&&r.isBlocked())return l["default"].reject(new N.ContactBlocked("Forwarded to contact is blocked",r));var i=[],a=m.TYPE;return l["default"].mapSeries(e,function(e){var r=e.type===a.PTT?a.AUDIO:e.type,o=_.omit(e.toJSON(),"quotedMsg"),s=new P({from:Store.Conn.me,to:n,id:m.newTag(),participant:void 0,selfDir:"out"});switch(_.assign(o,{id:s,from:Store.Conn.me,t:x.globalUnixTime(),to:n,type:r,ack:0,participant:void 0,caption:r===a.DOCUMENT?e.caption:void 0,local:!0,self:"out",isNewMsg:!0,star:!1,decryptedMediaBlob:e.decryptedMediaBlob,fullWidth:e.fullWidth,fullHeight:e.fullHeight}),r){case a.CHAT:case a.VCARD:case a.LOCATION:var c=Store.Msg.add(o);return t.msgs.add(c),[c,null];case a.DOCUMENT:case a.VIDEO:case a.IMAGE:case a.AUDIO:if(e.mediaState===m.MEDIA_STATE.ERROR_MISSING)return i.push(e),null;o.mediaState=m.MEDIA_STATE.UPLOADING;var u=void 0,d=new l["default"](function(e){u=e}),h=Store.Msg.add(o);t.msgs.add(h);var f=I.forwardMediaMsg(h,e,d);return[h,function(){return u(),f}];default:return p.assert(!1,"unrecognized-forward","type = "+r)(),null}}).each(function(e){if(e){var t=(0,o["default"])(e,2),n=t[0],r=t[1];return r?r()["catch"](_.noop):void Store.Msg.send(n)}})["return"](i)},shouldSendEncrypted:function(e,t){return I.shouldSendEncrypted(this,e,t)},updateReadOnly:function(){this.isGroup&&!this.groupMetadata.stale&&(this.isReadOnly=!this.groupMetadata.participants.get(Store.Conn.me)),this.isBroadcast&&this.updateTitle()},sortMsgs:function(e){var t=_.map(e,function(e){var t=e.msgChunk;return{msg:e,chunkT:t.models[0].t,index:t.indexOf(e)}});return _(t).orderBy(["chunkT","index"]).map("msg").value()},_updateAssignedColor:function(){if(this.colors){var e=this.groupMetadata.participants;if(0!==e.size){var t=this.colors,n=_.difference(_.keys(t),e.map("id").map(O));n.forEach(function(e){delete t[e]}),n.length&&this._saveAssignedColors()}}},loadAssignedColors:function(){return this.listenTo(this.groupMetadata.participants,"remove reset ",this._updateAssignedColor),w.getGroupParticipantAssignedColor(this.id)||{}},saveAssignedColors:function(){var e=this.colors;e&&w.setGroupParticipantAssignedColor(this.id,e)},assignedColor:function(e){var t,n=this,r=this.colors||(this.colors=this.loadAssignedColors()),i=O(e);
if(t=r[i])return t;var o=function(){var e={};_.forEach(r,function(t,n){e[t]?e[t].push(n):e[t]=[n]});for(var o=Number.POSITIVE_INFINITY,a=1;a<d.NUM_COLORS;a++){if(!e[a]){t=a;break}e[a].length<o&&(o=e[a].length,t=a)}return r[i]=t,n._saveAssignedColors(),{v:t}}();return"object"==typeof o?o.v:void 0},setSubject:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],n=arguments[1];if(t=t.trim(),!t)return l["default"].reject(new N.ActionError);if(t===this.contact.name)return l["default"].reject(new N.ActionError);var r=C.changeSubject(this.id,t),i=this.contact.name,o=new R(l10n.t("action_group_renaming"));n=n||A.genId();var a=r.then(function(r){return 200===r.status?new R(l10n.t("action_group_renamed",{subject:t}),l10n.t("action_undo"),e.setSubject.bind(e,i,n)):r.status>=400?new R(l10n.t("action_group_rename_failed")):void 0})["catch"](function(r){return p.error("models:chat:setSubject dropped")(r),new R(l10n.t("action_group_rename_failed"),l10n.t("action_try_again"),e.setSubject.bind(e,t,n))});return M.openToast(u.createElement(A,{id:n,initialAction:o,pendingAction:a})),r.then(function(n){200!==n.status||n._duplicate||(e.contact.name=t)})},unstarAll:function(){this.getAllMsgs().forEach(function(e){e&&(e.star=!1)}),Store.StarredMsg.remove(this.getAllMsgs())},replaceMsgsCollection:function(e){p.info("model:Chat:replaceMsgsCollection:"+this.id)(),this.msgs.replace(e),this.notifyMsgCollectionMerge(e,this.msgs,this.msgs),this.msgChunks=_.without(this.msgChunks,e)},notifyMsgCollectionMerge:function(e,t,n){this.trigger("change:cmc:merge",e,t,n)},removeMsgsCollection:function(e){this.msgChunks=_.without(this.msgChunks,e)},getAllCMCs:function(){return this.msgChunks.concat([this.msgs])},getAllMsgs:function(){return _.flatten(this.getAllCMCs().map(function(e){return e.models}))},getMediaMsgs:function(e){if(!e)return this.mediaMsgs;var t=void 0;return this.mediaMsgs.contains(e)||e.msgChunk===this.msgs?(t=this.mediaMsgs,t.hasMediaAfter=!1):t=new b,t.contains(e)||(e.msgChunk?t.add(e.msgChunk.filter(function(e){return e.isMedia})):t.add(e)),S.supportsFeature(S.F.MEDIA_GALLERY)&&t.loadMoreAroundIfNeeded(e),t},fts:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?1:arguments[1],r=arguments[2];if(1===n){var i=this.ftsCache[e];if(i)return i;var o=Store.Msg.search(e,n,r,this.id);this.ftsCache[e]=o;var a=function(){t.ftsCache[e]=null};return _.delay(a,F),o["catch"](a),o}return Store.Msg.search(e,n,r,this.id)},_clearFtsCache:function(){this.ftsCache={}},_updatePSAName:function(){this.name=l10n.t("whatsapp_psa_contact_name")},updateSortTime:function(){var e=this;this.promises.updateSortTime||(this.promises.updateSortTime=l["default"].delay(0).cancellable().then(function(){var t=e.getLastTimestampMsg();return t?(e.t=t.t,l["default"].resolve()):e.msgs.msgLoadState.noEarlierMsgs?(e.t=void 0,l["default"].resolve()):e.pendingMsgs?l["default"].resolve():e.loadEarlierMsgs()}).then(function(t){if(t){var n=e.getLastTimestampMsg();e.t=n?n.t:void 0}})["catch"](_.noop)["finally"](function(){e.promises.updateSortTime=void 0}),this.regCancellablePromise(this.promises.updateSortTime))}}),B={};j.linkPreview=function(e){var t=B[e];return t?t:t=B[e]=l["default"].props({url:e,data:C.queryLinkPreview(e)})},j.KIND=U,e.exports=j},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(e.dataTransfer){try{if(!e.dataTransfer.dropEffect)return}catch(e){return}e.dataTransfer.effectAllowed&&(e.nativeEvent.dataTransfer.dropEffect="copy")}}var o=n(883),a=r(o),s=n(6),c=n(43),l={LEFT:"left",MID:"mid",RIGHT:"right"},u=s.createClass({displayName:"Drawer",propTypes:{children:s.PropTypes.node.isRequired,id:s.PropTypes.string,variant:s.PropTypes.string,noContainer:s.PropTypes.bool,position:s.PropTypes.oneOf(_.values(l)),onDragLeave:s.PropTypes.func,onDrop:s.PropTypes.func,onDragOver:s.PropTypes.func},getDefaultProps:function(){return{position:"left"}},statics:{RIGHT:"right",LEFT:"left",MID:"mid"},getInitialState:function(){return{isDragging:!1}},isDragDropDrawer:function(){return this.props.onDragOver&&this.props.onDragLeave&&this.props.onDrop},onDragOver:function(e){e.preventDefault(),this.isDragDropDrawer()&&(i(e),this.state.isDragging||(this.props.onDragOver(e),this.setState({isDragging:!0})))},onDrop:function(e){e.preventDefault(),e.stopPropagation(),this.setState({isDragging:!1}),this.props.onDrop(e)},onDragLeave:function(e){e.preventDefault(),e.stopPropagation(),this.state.isDragging&&(this.setState({isDragging:!1}),this.props.onDragLeave(e))},render:function(){var e,t=this.props,n=c("drawer",(0,a["default"])({},"drawer-"+t.id,!!t.id));if(this.isDragDropDrawer()){var r=this.state.isDragging?{}:{display:"none"};e=s.createElement("div",{key:"mask",className:"drag-drop-mask",style:r,onDragLeave:this.onDragLeave,onDrop:this.onDrop})}return s.createElement("div",{className:n,onDragOver:this.onDragOver},e,t.children)}});u.Position=l,e.exports=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(412),o=r(i),a=n(414),s=r(a),c=n(6),l=n(43),u=c.createClass({displayName:"DrawerBody",propTypes:{flex:c.PropTypes.bool,classes:c.PropTypes.string,editable:c.PropTypes.bool,wide:c.PropTypes.bool},getDefaultProps:function(){return{editable:!1,wide:!1}},render:function(){var e=this.props,t=e.classes,n=e.flex,r=e.editable,i=e.wide,a=(0,s["default"])(e,["classes","flex","editable","wide"]),u=l("drawer-body",t,{"drawer-editable":r,"drawer-body-flex":n,"drawer-body-wide":i});return c.createElement("div",(0,o["default"])({className:u},a),this.props.children)}});e.exports=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(14),s={rejectOnUnmount:function(){var e=this;return this._reject?this._reject:(this._reject=new o["default"](function(t,n){e._rejectFn=n}),this._reject["catch"](_.noop),this._isMounted===!1&&this._rejectFn(new a.Unmount),this._reject)},componentWillUnmount:function(){this._isMounted=!1,this._rejectFn&&this._rejectFn(new a.Unmount)}};e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(416),o=n(43),a=n(1012),s=a.MenuBar,c=n(102),l={SMALL:"small",LARGE:"large",POPUP:"popup",OFFSET:"offset"},u=r.createClass({displayName:"DrawerHeader",propTypes:{children:r.PropTypes.node,title:r.PropTypes.string,onBack:r.PropTypes.func,onCancel:r.PropTypes.func,a8n:r.PropTypes.string,type:r.PropTypes.oneOf(_.values(l)).isRequired,menu:r.PropTypes.element},render:function(){var e=this.props,t=e.title,n=e.onBack,a=e.onCancel,u=e.type,d=e.children,p=null;if(t){var h=void 0,f=null,m={textAlign:"initial"};u===l.SMALL?(h={fontWeight:400,fontSize:16,lineHeight:"21px"},m.width=54):u===l.LARGE?(h={fontWeight:500,fontSize:19,lineHeight:"normal"},f={backgroundColor:"transparent",padding:"0px"},m.width=54):(h={fontWeight:500,fontSize:19,lineHeight:"19px"},m.width=48,m.opacity=.7);var g=o("icon btn-close-drawer",{"icon-back":u===l.SMALL,"icon-back-light":u!==l.SMALL}),v=n?r.createElement("span",{className:g,"data-a8n":i.key("btn-closer-drawer"),onClick:n}):null,y=o("icon btn-close-drawer",{"icon-x":u===l.SMALL,"icon-x-light":u!==l.SMALL}),_=a?r.createElement("span",{className:y,"data-a8n":i.key("btn-closer-drawer"),onClick:a}):null,E=o({"pane-header":u===l.LARGE},"drawer-title"),b=this.props.menu?r.createElement("span",{className:"pane-list-controls"},r.createElement(s,{key:"drawer-header"},r.createElement(c,{transitionName:"btn"},this.props.menu))):null;p=r.createElement("div",{className:E,style:f},r.createElement("div",{style:m,className:"drawer-title-action"},v,_),r.createElement("span",{"data-a8n":i.key(this.props.a8n),className:"drawer-title-body",style:h},t),b)}var S=o({"drawer-header":u===l.LARGE,"drawer-header-small":u===l.SMALL,"drawer-header-offset":u===l.OFFSET,"drawer-header-popup":u===l.POPUP});return r.createElement("header",{className:S},p,d)}});u.Type=l,e.exports=u},function(e,t,n){"use strict";var r=n(43),i=n(6),o=n(997),a=n(975),s=n(132),c=n(21),l=n(14),u=n(993),d={SMALL:"small",MEDIUM:"medium",LARGE:"large",AUTO:"auto"},p={LOW:"low",HIGH:"high"},h=i.createClass({displayName:"DetailImage",mixins:[a],propTypes:{id:i.PropTypes.string.isRequired,size:i.PropTypes.oneOfType([i.PropTypes.number,i.PropTypes.oneOf(_.values(d))]),className:i.PropTypes.string,loader:i.PropTypes.bool,quality:i.PropTypes.oneOf(_.values(p)),onClick:i.PropTypes.func,onLoad:i.PropTypes.func},getDefaultProps:function(){return{size:d.SMALL,quality:p.LOW}},getInitialState:function(){var e=this.props,t=e.id,n=e.quality,r=!0,i=Store.ProfilePicThumb.get(t);if(c.isBroadcast(this.props.id))return{loading:!1};if(n===p.HIGH){var o=i&&i.imgFull;return o&&u.isCached(o)&&(r=!1,this.props.onLoad&&this.props.onLoad()),{loading:r,imgFull:this.async("id.ProfilePicThumb.imgFull")}}if(n===p.LOW){var a=i&&i.img;return a&&u.isCached(a)&&(r=!1,this.props.onLoad&&this.props.onLoad()),{loading:r,img:this.async("id.ProfilePicThumb.img")}}},onLoad:function(e){this.state.loading&&this.setState({loading:!1}),this.props.onLoad&&this.props.onLoad()},onError:function(e){if(e instanceof l.ServerStatusError){var t=Store.ProfilePicThumb.get(this.props.id);t&&t.onError(e.status)}this.state.loading&&this.setState({loading:!1})},getClasses:function(){var e=this.props,t=e.id,n=e.className;return r("avatar",n,{"icon-user-default":c.isUser(t),"icon-group-default":c.isGroup(t),"icon-broadcast-default":c.isBroadcast(t),"icon-psa-default":c.isPSA(t)})},getStyle:function(){var e=void 0;switch(this.props.size){case d.SMALL:e=49;break;case d.MEDIUM:e=100;break;case d.LARGE:e=200;break;default:e=this.props.size}var t={height:e,width:e};return this.props.onClick&&(t.cursor="pointer"),t},render:function(){var e=this.state.img||this.state.imgFull,t=Store.ProfilePicThumb.get(this.props.id),n=void 0;this.props.loader&&this.state.loading&&(!t||t.stale||e)&&(n=i.createElement("div",{className:"avatar-spinner-container"},i.createElement(s,{size:50,stroke:3})));var a=r("avatar-image",{"is-loaded":!this.state.loading});return e=e?i.createElement(o,{src:e,hasPrivacyChecks:!0,crossOrigin:!1,className:a,onLoad:this.onLoad,onError:this.onError}):null,i.createElement("div",{className:this.getClasses(),style:this.getStyle(),onClick:this.props.onClick},e,n)}});h.Size=d,h.Quality=p,e.exports=h},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(131),a=o.HotKeys,s=n(416),c=n(130),l=n(43),u=n(63),d=r.createClass({displayName:"MenuItem",mixins:[c],propTypes:{children:r.PropTypes.node.isRequired,a8n:r.PropTypes.string,action:r.PropTypes.func,tooltip:r.PropTypes.node,filePickerMimes:r.PropTypes.string,onFilePick:r.PropTypes.func},getInitialState:function(){return{hover:!1,focus:!1}},componentWillMount:function(){this.props.filePickerMimes&&this.regNativeListener(window,"focus",this.onWindowFocus)},onMouseEnter:function(){this.setState({hover:!0})},onMouseLeave:function(){this.setState({hover:!1})},onFocus:function(){this.setState({focus:!0})},onBlur:function(){this.setState({focus:!1})},preventDefault:function(e){e.preventDefault()},onAction:function(e){var t=this.props,n=t.action,r=t.filePickerMimes;if(n){if(n(e),r)return void(this.active=!0);var i=this.context.uim;i&&i.uie.requestDismiss()}},triggerInput:function(){i.findDOMNode(this.refs.filePicker).click()},onWindowFocus:function(e){this.active&&this.onFilePick()},onFilePick:function(e){if(this.props.onFilePick){this.props.onFilePick(e);var t=this.context.uim;t&&t.uie.requestDismiss()}},render:function(){var e=this.props,t=e.children,n=e.tooltip,i=e.filePickerMimes,o=this.state,c=o.hover,u=o.focus;n=(c||u)&&n?n:null;var d={enter:this.onAction},h=l("menu-item menu-shortcut",{"highlighted-menu-item":c||u}),f=void 0;return i&&(f=r.createElement(p,{mime:i,ref:"filePicker",onPick:this.onFilePick})),_.isString(t)&&(t=r.createElement("a",{className:"ellipsify",title:t},t)),r.createElement(a,{component:"li",className:h,handlers:d,"data-a8n":s.key(this.props.a8n),onContextMenu:this.preventDefault,onMouseDown:this.preventDefault,onMouseUp:this.onAction,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onFocus:this.onFocus,onBlur:this.onBlur},t,n,f)}});d.contextTypes={uim:r.PropTypes.instanceOf(u)};var p=r.createClass({displayName:"FilePicker",propTypes:{mime:r.PropTypes.string.isRequired,multiple:r.PropTypes.bool,onPick:r.PropTypes.func.isRequired},getDefaultProps:function(){return{multiple:!0}},render:function(){return r.createElement("input",{accept:this.props.mime,type:"file",multiple:this.props.multiple,style:{display:"none"},onChange:this.props.onPick})}});e.exports=d},function(e,t,n){"use strict";function r(e){var t,n,r="";switch(e.subtype){case"identity":t=Store.Contact.get(e.body),n=t?t.formattedName:f.formattedUser(e.body),r=l10n.t("web_security_code_change",{name:n});break;case"encrypt":var i=e.id.remote;r=f.isGroup(i)?l10n.t("web_group_info_encrypted"):f.isBroadcast(i)?l10n.t("web_broadcast_info_encrypted"):l10n.t("web_contact_info_encrypted")}return r}function i(e,t){var n="";switch(e.subtype){case"miss":n=t?l10n.t("web_missed_voice_call_system_message",{time:h.timestampStr(e.t)}):l10n.t("web_missed_voice_call_chatlist");break;case"miss_video":n=t?l10n.t("web_missed_video_call_system_message",{time:h.timestampStr(e.t)}):l10n.t("web_missed_video_call_chatlist")}return n}function o(e,t){var n,r,i="";if("create"===e){var o=parseInt(t,10);i=l10n.t("web_you_created_list_unnamed",{count:o,_plural:o})}else"add"===e?(n=Store.Contact.get(t),r=n?n.get("name"):"",r=r?r:f.formattedUser(t),i=l10n.t("web_list_recipient_added",{name:r})):"remove"===e&&(n=Store.Contact.get(t),r=n?n.get("name"):"",r=r?r:f.formattedUser(t),i=l10n.t("web_list_recipient_removed",{name:r}));return i}function a(e){var t,n,r="",i=e.get("type"),o=e.get("subtype"),a=e.displayName(),s=e.get("author"),c=e.get("body");if("group_notification"===i)switch(o){case"add":r=s===Store.Conn.me?l10n.t("web_group_participant_added_you"):l10n.t("web_group_participant_added_name",{name:a});break;case"remove":r=s===Store.Conn.me?l10n.t("web_group_participant_removed_you"):l10n.t("web_group_participant_removed_name",{name:a});break;case"leave":r=s===Store.Conn.me?l10n.t("web_group_participant_left_you"):l10n.t("web_group_participant_left_name",{name:a});break;case"picture":r="remove"===c?s===Store.Conn.me?l10n.t("web_photo_removed_by_you"):l10n.t("web_photo_removed_by",{name:a}):s===Store.Conn.me?l10n.t("web_photo_changed_by_you"):l10n.t("web_photo_changed_by",{name:a});break;case"subject":r=s===Store.Conn.me?l10n.t("web_group_subject_changed_by_you",{subject:c}):l10n.t("web_group_subject_changed_by_name",{name:a,subject:c});break;case"modify":t=f.formattedUser(e.get("author")),n=f.formattedUser(c),r=t===a?l10n.t("web_group_participant_changed_number_unknown_name",{name:a,new_number:n}):l10n.t("web_group_participant_changed_number",{name:a,old_number:t,new_number:n});break;default:d.log("wa:formatGroupNotification:unknown message subtype: "+o)()}else if("gp2"===i){var l,u=e.recipients,p=u?u.map(function(e){var t=Store.Contact.get(e);return t?t.get("formattedName"):f.formattedUser(e)}).join(l10n.t("enumeration_comma")):"",h=u?_.head(u):"",m=Store.Contact.get(h),g=m?m.get("formattedName"):h?f.formattedUser(h):"";switch(o){case"add":r=s?s===Store.Conn.me?l10n.t("web_group_participants_you_added_names",{participants:p}):h===Store.Conn.me?l10n.t("web_group_participants_name_added_you",{name:a}):l10n.t("web_group_participants_name_added_names",{name:a,participants:p}):h===Store.Conn.me?l10n.t("web_group_participant_added_you"):l10n.t("web_group_participant_added_name",{name:g});break;case"remove":r=s?s===Store.Conn.me?l10n.t("web_group_participants_you_removed_names",{participants:p}):h===Store.Conn.me?l10n.t("web_group_participants_name_removed_you",{name:a}):l10n.t("web_group_participants_name_removed_names",{name:a,participants:p}):h===Store.Conn.me?l10n.t("web_group_participant_removed_you"):l10n.t("web_group_participant_removed_name",{name:g});break;case"leave":r=h===Store.Conn.me?l10n.t("web_group_participant_left_you"):l10n.t("web_group_participant_left_name",{name:p});break;case"picture":r="remove"===c?s===Store.Conn.me?l10n.t("web_photo_removed_by_you"):l10n.t("web_photo_removed_by",{name:a}):s===Store.Conn.me?l10n.t("web_photo_changed_by_you"):l10n.t("web_photo_changed_by",{name:a});break;case"subject":r=s===Store.Conn.me?l10n.t("web_group_subject_changed_by_you",{subject:c}):l10n.t("web_group_subject_changed_by_name",{name:a,subject:c});break;case"modify":t=f.formattedUser(s),n=f.formattedUser(h),r=t===a?l10n.t("web_group_participant_changed_number_unknown_name",{name:a,new_number:n}):l10n.t("web_group_participant_changed_number",{name:a,old_number:t,new_number:n});break;case"create":r=s===Store.Conn.me?c?l10n.t("web_group_created_by_you",{subject:c}):l10n.t("web_group_created_by_you_no_subject"):c?l10n.t("web_group_created_by_name",{name:a,subject:c}):l10n.t("web_group_created_by_name_no_subject",{name:a});break;case"delete":r=s===Store.Conn.me?l10n.t("web_group_ended_you"):l10n.t("web_group_ended_name",{name:a});break;case"promote":l=u.length,r=1===l&&h===Store.Conn.me?l10n.t("web_group_participant_promoted_you"):l10n.t("web_group_participant_promoted_names",{count:l,participants:p,_plural:l});break;case"demote":l=u.length,r=1===l&&h===Store.Conn.me?l10n.t("web_group_participant_demoted_you"):l10n.t("web_group_participant_demoted_names",{count:l,participants:p,_plural:l});break;case"invite":r=h===Store.Conn.me?l10n.t("web_group_participant_join_via_invite_you"):l10n.t("web_group_participant_join_via_invite_name",{name:g});break;default:d.log("wa:formatGroupNotification:unknown message subtype: "+o)()}}return l10n.isRTL()&&(r=l10n.forceRTL(r)),r}function s(e,t){var n=e.mentionMap();if(n){var r=u.supportsFeature(u.F.RICH_TEXT)?[].concat(x,[new C(n)]):[new C(n)],i=m.parse(t,r);return m.serialize(i,new v)}return c(t)}function c(e){if(!u.supportsFeature(u.F.RICH_TEXT))return e;var t=m.parse(e,x);return m.serialize(t,new v)}var l=n(1086),u=n(101),d=n(1),p=n(54),h=n(196),f=n(21),m=n(1094),g=n(974).TYPE,v=n(1233),y=n(1019),E=n(1037),b=n(1041),S=n(1036),M=n(1040),T=n(1230),C=n(1038),w=n(1232),x=[new y,new E,new b,new S,new M];e.exports={formatBroadcastNotification:o,formatGroupNotification:a,formatE2ENotification:r,formatCallLog:i,asDesktopNotification:function(e){var t,n,c,u,f="",m=e.dir,v=Store.Mute.getGlobalPreviews();switch(e.from!==Store.Conn.me&&e.isGroupMsg&&(f=e.displayName()),e.type){case g.CHAT:if(v)t=s(e,e.body);else if(e.isGroupMsg)t=f?l10n.t("hidden_group_message_text_with_author",{author:f}):l10n.t("hidden_group_message_text"),f="";else{var y=e.chat;t=l10n.t("hidden_message_text",{unreadCount:l10n.n(y.unreadCount),_plural:y.unreadCount})}break;case g.IMAGE:c=p.hasEmoji?"📷 ":"",t=c+(v&&e.caption||l10n.t("web_conversations_most_recent_image"));break;case g.VIDEO:e.isGif?(c=p.hasEmoji?"👾 ":"",u=v&&e.caption||"GIF"):(c=p.hasEmoji?"🎥 ":"",u=v&&e.caption||l10n.t("web_conversations_most_recent_video"),u=u+" ("+h.durationStr(e.duration)+")"),t=c+" "+u;break;case g.PTT:c=p.hasEmoji?"🎤 ":"",t=c+" "+l10n.t("web_conversations_most_recent_voice")+" ("+h.durationStr(e.duration)+")";break;case g.AUDIO:c=p.hasEmoji?"🎵 ":"",t=c+" "+l10n.t("web_conversations_most_recent_audio")+" ("+h.durationStr(e.duration)+")";break;case g.LOCATION:c=p.hasEmoji?"📍 ":"",t=c+(v&&e.loc||l10n.t("web_conversations_most_recent_location"));break;case g.GROUP_NOTIFICATION:case g.GP2:t=a(e),f="";break;case g.BROADCAST_NOTIFICATION:n=e.subtype;var _=e.body;t=o(n,_);break;case g.NOTIFICATION:t=e.body;break;case g.VCARD:c=p.hasEmoji?"👤 ":"",t=c+(e.subtype||l10n.t("web_conversations_most_recent_contact"));break;case g.DOCUMENT:c=p.hasEmoji?"📄 ":"",t=c+(e.subtype||l10n.t("web_conversations_most_recent_file"));break;case g.E2E_NOTIFICATION:t=r(e);break;case g.CALL_LOG:t=i(e,!1);break;case g.CIPHERTEXT:t=l10n.t("placeholder_msg");break;case g.UNKNOWN:t=l10n.t("unsupported_msg");break;default:return d.error("asDesktopNotification: Unrecognized type "+e.type)(),""}var E=l10n.isRTL()?"rtl":"ltr",b="";if(b=h.relativeStr(e.t),f){var S=l.dir(f);return"ltr"!==E||m&&"ltr"!==m||S&&"ltr"!==S?"ltr"!==E||m&&"ltr"!==m?"ltr"!==E||S&&"ltr"!==S?"ltr"===E?(b&&(b="- ‪"+b+"‬‬"),"‫"+f+"‏: "+t+"‏"+b):m&&"rtl"!==m||S&&"rtl"!==S?m&&"rtl"!==m?S&&"rtl"!==S?(b&&(b="- ‪"+b+"‬‬"),"‪"+f+"‎: "+t+"‎"+b):(b&&(b=" - "+b),f+"‏: ‪"+t+"‬‏"):(b&&(b=" - "+b),"‏‪"+f+"‬: "+t+"‏"):(b&&(b=" - "+b),f+"‏: "+t+"‏"):(b&&(b=" - "+b),f+"‎: ‫"+t+"‬‎"):(b&&(b=" - "+b),"‎‫"+f+"‬: "+t+"‎"):(b&&(b=" - "+b),f+"‎: "+t+"‎")}return b?"ltr"===E?t+"‎‏ - ‪"+b+"‬":t+"‏‎ - ‫"+b+"‬":t},msgText:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1];switch(e.type){case g.CIPHERTEXT:return l10n.t("placeholder_msg");case g.CHAT:return t?s(e,e.body):e.body;case g.IMAGE:return e.caption?t?s(e,e.caption):e.caption:l10n.t("web_conversations_most_recent_image");case g.VIDEO:return e.caption?t?s(e,e.caption):e.caption:e.isGif?"GIF":l10n.t("web_conversations_most_recent_video");case g.PTT:var n=h.durationStr(e.duration);return n?n:l10n.t("web_conversations_most_recent_voice");case g.AUDIO:return l10n.t("web_conversations_most_recent_audio");case g.LOCATION:return e.loc||l10n.t("web_conversations_most_recent_location");case g.GROUP_NOTIFICATION:case g.GP2:return a(e);case g.BROADCAST_NOTIFICATION:return o(e.subtype,e.body);case g.NOTIFICATION:return e.body;case g.VCARD:return e.subtype||l10n.t("web_conversations_most_recent_contact");case g.DOCUMENT:var c=e.pageCount>0?l10n.t("web_conversations_most_recent_document",{count:e.pageCount+"",_plural:e.pageCount}):null;return _.compact([e.caption||e.filename||l10n.t("web_conversations_most_recent_file"),c]).join(" • ");case g.E2E_NOTIFICATION:return r(e);case g.CALL_LOG:return i(e,!1);case g.UNKNOWN:return l10n.t("unsupported_msg");default:return""}},emojify:function(e){if(!u.supportsFeature(u.F.RICH_TEXT))return e;var t=[new y,new T((!0))],n=m.parse(e,t);return m.serialize(n,new w)}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(412),o=r(i),a=n(883),s=r(a),c=n(414),l=r(c),u=n(6),d=n(34),p=n(203),h=n(43),f=n(10),m=n(130),g=n(133),v=n(30),y=72,_="data-list-scroll-container",E="data-list-scroll-offset",b=u.createClass({displayName:"List",mixins:[m,g],propTypes:{extraItems:u.PropTypes.number,scrollTop:u.PropTypes.number,animate:u.PropTypes.bool,classes:u.PropTypes.arrayOf(u.PropTypes.string),scrollTarget:u.PropTypes.object,onPointerEventsOff:u.PropTypes.func,onPointerEventsOn:u.PropTypes.func,height:u.PropTypes.number.isRequired,data:u.PropTypes.arrayOf(u.PropTypes.element).isRequired},getDefaultProps:function(){return{classes:[],scrollTarget:null,data:null,height:y,extraItems:30}},statics:{DEFAULT_HEIGHT:y,SCROLL_ATTR:_,SCROLL_OFFSET_ATTR:E},getInitialState:function(){return{scrollTarget:void 0,firstVisibleIndex:0,firstPhysicalIndex:0,lastPhysicalIndex:0,renderVisible:!0}},componentWillReceiveProps:function(e){v.isNumber(e.scrollTop)&&this.state.scrollTarget&&(this.state.scrollTarget.scrollTop=e.scrollTop),this.props.scrollTarget===e.scrollTarget&&this.props.height===e.height&&this.props.data.length===e.data.length||this.initialize(e)},componentWillMount:function(){this.scrollTop=0,this.bodyHeight=0,this._eventLoopBusy=!1,this._uiBusy=!1,this.renderedItems={},this.enablePointerEvents=this.safeDebounce(this._enablePointerEvents,150),this.disableUIBusy=this.safeDebounce(this._disableUIBusy,150)},componentDidMount:function(){var e=this;this.initialize(),this.regNativeListener(window,"resize",function(){e.initialize()})},initialize:function(e){var t=e?e:this.props;this.state.scrollTarget&&this.unregNativeListener(this.state.scrollTarget,"scroll",this.onScroll);for(var n=d.findDOMNode(this),r=void 0,i=n,o=0;o<5;o++){if(i.hasAttribute(_)){r=i;break}i=i.parentNode}var a=void 0;i=n;for(var s=0;s<o;s++){if(i.hasAttribute(E)){a=i;break}i=i.parentNode}if(!r)throw new Error("list scroll container not found");this.regNativeListener(r,"scroll",this.onScroll),this.scrollTop=r.scrollTop,this.offsetTop=a?a.offsetTop:0,this.bodyHeight=r.clientHeight;var c=this.getPhysicalIndexes(t),l=c.firstPhysicalIndex,u=c.lastPhysicalIndex;return this.setState({scrollTarget:r,firstPhysicalIndex:l,lastPhysicalIndex:u,renderVisible:!0}),this.renderedItems={},r},getFirstVisibleIndex:function(e){return Math.floor(Math.max(this.scrollTop-this.offsetTop,0)/e)},getPhysicalIndexes:function(){var e=arguments.length<=0||void 0===arguments[0]?this.props:arguments[0],t=this.getFirstVisibleIndex(e.height),n=Math.max(this.offsetTop-this.scrollTop,0),r=Math.max(this.bodyHeight-n,0),i=Math.min(Math.ceil(r/e.height),e.data.length),o=Math.max(t-e.extraItems,0),a=Math.min(t+i+e.extraItems,e.data.length);return{firstPhysicalIndex:o,lastPhysicalIndex:a}},_enablePointerEvents:function(e){this._pointerEvents=!1,d.findDOMNode(this.refs.viewport).style.pointerEvents="auto",this.props.onPointerEventsOn&&this.props.onPointerEventsOn()},disablePointerEvents:function(e){this.enablePointerEvents(),this._pointerEvents||(this.props.onPointerEventsOff&&this.props.onPointerEventsOff(),d.findDOMNode(this.refs.viewport).style.pointerEvents="none",this._pointerEvents=!0)},onScroll:function(e){this._eventLoopBusy||window.requestAnimationFrame(this._onScroll),this._eventLoopBusy=!0},_disableUIBusy:function(){f.setUiBusy(!1),this._uiBusy=!1},_onScroll:function(){var e=this;if(this.isMounted()){var t=this.state.scrollTarget;this.disablePointerEvents(),this._uiBusy||(f.setUiBusy(!0),this._uiBusy=!0),this.disableUIBusy(),this.scrollTop=t.scrollTop;var n=this.getPhysicalIndexes(),r=n.firstPhysicalIndex,i=n.lastPhysicalIndex,o=void 0;for(o=r;o<i;o++){var a=this.props.data[o].id;if(!this.renderedItems[a])break}return o===i?void(this._eventLoopBusy=!1):void this.setState({firstPhysicalIndex:r,lastPhysicalIndex:i,renderVisible:!1},function(){e._eventLoopBusy=!1})}},getComponents:function(){var e=this,t=this.props,n=t.height,r=t.data,i=this.state,o=i.firstPhysicalIndex,a=i.lastPhysicalIndex,s={},c=v.chain(r).forEach(function(e,t){s[e.key]=t}).slice(o,a).forEach(function(t){e.renderedItems[t.key]=t}).value(),l=this.state.renderVisible?c:this.renderedItems;return v.sortBy(l,"key").map(function(e){return u.createElement(S,{key:e.key,rowHeight:n,classes:0===s[e.key]?"first":null,zIndex:r.length-s[e.key]-1,rowNumber:s[e.key]},e)})},render:function(){var e=this.props,t=e.data,n=e.height,r=e.className,i=e.animate,o={container:{},viewport:{height:t.length*n}},a={container:h("infinite-list",r,{"infinite-list-animate":i&&!this._eventLoopBusy}),viewport:"infinite-list-viewport"};return u.createElement("div",{className:a.container,style:o.container},u.createElement("div",{className:a.viewport,ref:"viewport",style:o.viewport},this.getComponents()))}}),S=u.createClass({displayName:"ListItem",propTypes:{rowNumber:u.PropTypes.number.isRequired,rowHeight:u.PropTypes.number.isRequired,zIndex:u.PropTypes.number.isRequired},getInitialState:function(){return{rendered:!1}},componentDidMount:function(){this.setState({rendered:!0})},render:function(){var e=this.props,t=e.children,n=e.rowNumber,r=e.rowHeight,i=e.zIndex,a=e.classes,c=(0,l["default"])(e,["children","rowNumber","rowHeight","zIndex","classes"]),d=(0,s["default"])({zIndex:i,height:r},p.prefix("transform"),"translate3d(0, "+r*n+"px, 0)"),f=h(a,{"infinite-list-item":!0,"infinite-list-item-keyframe":!this.state.rendered,"infinite-list-item-transition":!0});return u.createElement("div",(0,o["default"])({className:f,style:d},c),t)}});e.exports=b},function(e,t,n){"use strict";var r=n(6),i=n(988),o=n(976),a=n(974),s=n(10),c=n(21),l=n(43),u=function(e){var t=e.msg,n=e.displaySelf,a=e.className,u=e.disableClick,d=t.chat.assignedColor(t.sender),p=t.senderObj,h=l("message-author color-"+d,a,{"title-number":!p.name}),f=u?_.noop:function(){Store.Chat.find(t.author).then(function(e){s.openChat(e)})},m=u?null:"text-clickable",g=void 0;return g=n?r.createElement(o,{text:l10n.t("web_you")}):p.name?r.createElement("span",{className:m,onClick:f},r.createElement(o,{text:p.name})):[r.createElement("span",{className:l("number",m),key:t.id+"-number",onClick:f},c.formattedUser(p.id)),r.createElement("span",{className:l("ellipsify","screen-name",m),key:t.id+"-push-name",onClick:f},r.createElement(o,{classes:"screen-name-text",direction:"auto",text:t.notifyName}))],r.createElement("h3",{className:h},r.createElement(i,null,g))};u.shouldRender=function(e){return!e.isSentByMe&&e.isGroupMsg},u.propTypes={msg:r.PropTypes.instanceOf(a).isRequired,displaySelf:r.PropTypes.bool,disableClick:r.PropTypes.bool,className:r.PropTypes.string},e.exports=u},function(e,t,n){"use strict";function r(e,t){this.list=e,this.index=-1,this.value=void 0,this.getter=t||function(e){return e}}var i=n(68);_.assign(r.prototype,i,{init:function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],n=void 0,r=void 0;if(this.list=e,this.value){if(_.isEmpty(e))return void this.unset();if(n=_.indexOf(e,this.value),n>-1){if(n===this.index)return;r=!0,t=!1}else n=t&&this.index>-1?Math.min(Math.max(this.index,0),e.length-1):-1,r=n>-1;this.set(n,t,r)}},unset:function(){this.value&&this.trigger(this.getter(this.value),!1),this.value=void 0,this.index=-1},reset:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];this.index<0||this.value&&this.trigger(this.getter(this.value),"focus",e)},set:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=arguments.length<=2||void 0===arguments[2]||arguments[2];if(this.list.length){var r=Math.min(Math.max(e,-1),this.list.length-1),i=this.value,o=r>-1?this.list[r]:void 0;o?(this.trigger(this.getter(o),t?"focus":"select"),this.value=o):n&&(this.value=void 0),n&&i&&i!==o&&this.trigger(this.getter(i),!1),this.index=r}},getVal:function(){return this.value},setVal:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=_.indexOf(this.list,e);n>-1?this.set(n,t):(this.unset(),this.value=e)},setFirst:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];_.isEmpty(this.list)||this.set(0,e)},setLast:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];_.isEmpty(this.list)||this.set(this.list.length-1,e)},setPrev:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];_.isEmpty(this.list)||this.set(this.prev(),e)},setNext:function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0];_.isEmpty(this.list)||this.set(this.next(),e)},prev:function(){return _.isEmpty(this.list)?-1:this.index===-1?-1:this.index-1},next:function(){return _.isEmpty(this.list)?-1:Math.min(this.index+1,this.list.length-1)}}),e.exports=r},function(e,t,n){"use strict";var r=n(6),i=r.createClass({displayName:"HiddenToken",propTypes:{children:r.PropTypes.node.isRequired},render:function(){return r.createElement("span",{className:"hidden-token"},"⁠⁠⁠⁠",this.props.children,"⁠⁠⁠⁠⁠")}});e.exports=i},function(e,t,n){"use strict";var r=n(6),i=n(988),o=n(1144),a=n(974),s=n(43),c=n(196),l=n(10),u=n(101),d=r.createClass({displayName:"Meta",propTypes:{msg:r.PropTypes.instanceOf(a).isRequired},openInfoDrawer:function(){l.msgInfoDrawer(this.props.msg)},render:function(){var e,t,n=this.props.msg,l=n.broadcast||n.star?(n.type===a.TYPE.IMAGE||n.type===a.TYPE.VIDEO||n.type===a.TYPE.AUDIO)&&!n.caption:null;if(n.broadcast){var d=s("icon-s",{"icon-broadcast-light":l,"icon-broadcast":!l});e=r.createElement("span",{className:d})}if(n.star){var p=s("icon-s",{"icon-star-light":l,"icon-star":!l&&n.isSentByMe,"icon-star-in":!l&&!n.isSentByMe});t=r.createElement("span",{className:p})}var h=n.isSentByMe?r.createElement(o,{msg:this.props.msg}):null,f=n.isSentByMe&&u.supportsFeature(u.F.MESSAGE_INFO);return r.createElement("div",{className:f?"message-meta text-clickable":"message-meta",onClick:f?this.openInfoDrawer:null},t,e,r.createElement(i,null,r.createElement("span",{className:"message-datetime"
},c.timestampStr(n.t))),h)}});e.exports=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(412),o=r(i),a=n(414),s=r(a),c=n(6),l=n(132),u=n(43),d=n(976),p=function(e){var t=e.className,n=u("empty-icon",t);return c.createElement("div",{className:"empty-icon-container"},c.createElement("span",{className:n}))},h=function(e){var t=e.icon,n=e.title,r=e.text,i=e.className,a=e.children,l=(0,s["default"])(e,["icon","title","text","className","children"]),p=n?c.createElement("div",{className:"empty-title"},n):null,h=r?c.createElement(d,{element:"div",classes:"empty-text",text:r}):null,f=u("empty",i);return c.createElement("div",(0,o["default"])({className:f},l),t,p,h,a)},f=function(){var e=c.createElement(p,{className:"icon-empty-blocked"});return c.createElement(h,{icon:e,title:l10n.t("blocked_empty"),text:l10n.t("add_blocked_description")})},m=function(){var e=c.createElement(p,{className:"icon-empty-archived"});return c.createElement(h,{icon:e,title:l10n.t("archived_empty")})},g=function(){return c.createElement(h,{className:"empty-top",text:l10n.t("search_no_chats_or_contacts")})},v=function(){return c.createElement(h,{className:"empty-top",text:l10n.t("searching_chats_contacts_messages")})},y=function(){return c.createElement(h,{className:"empty-top",text:l10n.t("searching_messages")})},_=function(){return c.createElement(h,{className:"empty-top",text:l10n.t("search_no_contacts")})},E=function(){return c.createElement(h,{className:"empty-top",text:l10n.t("search_no_groups")})},b=function(){return c.createElement(h,{className:"empty-top",text:l10n.t("search_no_messages")})},S=function(){return c.createElement(h,{text:l10n.t("no_chats")})},M=function(){return c.createElement(h,{text:l10n.t("no_contacts")})},T=function(){return c.createElement(h,{text:l10n.t("no_groups")})},C=function(e){return c.createElement(h,{className:"empty-top",text:l10n.t("chat_search_prompt",{chatName:e})})},w=function(){return c.createElement(h,{text:l10n.t("all_chats_archived")})},x=function(){return c.createElement(h,{text:l10n.t("no_starred_messages")})},N=function(){return c.createElement(h,{text:l10n.t("no_media")})},P=function(){return c.createElement(h,null,c.createElement(l,{size:50,stroke:4}))};e.exports={Blocked:f,Archived:m,Search:g,SearchContacts:_,SearchGroups:E,SearchMessages:b,ListChats:S,ListContacts:M,ListGroups:T,AllArchived:w,StarredMsgs:x,MediaMsgs:N,Loading:P,Searching:v,SearchingMessages:y,BeforeSearchMessages:C}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(883),o=r(i),a=n(1),s=n(6),c=n(43),l=n(102),u=n(63),d=n(197),p={DEFAULT_PUSH:"flow-transition-drawer-push",DEFAULT_POP:"flow-transition-drawer-pop",NONE:"none"},h={PUSH:"push",POP:"pop"},f={getInitialState:function(){return{_stack:[],_activeKey:void 0,_transition:void 0}},defaultTransition:function(e){var t,n=_.isFunction(this.getDefaultTransition)?this.getDefaultTransition():{};return _.assign((t={},(0,o["default"])(t,h.PUSH,p.DEFAULT_PUSH),(0,o["default"])(t,h.POP,p.DEFAULT_POP),t),n)[e]},push:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.defaultTransition(h.PUSH):arguments[1],n=this.state._stack.concat(e),r=Math.random();this.setState({_stack:n,_transition:t,_activeKey:r})},pop:function(){var e=arguments.length<=0||void 0===arguments[0]?this.defaultTransition(h.POP):arguments[0],t=_.dropRight(this.state._stack);if(t.length){var n=Math.random();this.setState({_stack:t,_transition:e,_activeKey:n})}else this.endFlow()},endFlow:function(){this.context.uim.uie.requestDismiss()},render:function(){var e=this,t=this.state,n=t._stack,r=t._transition,i=t._activeKey,o=_.last(n);a.assert(!!o,"empty-flow",o)(),o=s.createElement(d,{displayName:"FlowDrawer"+i,key:i,escapable:!0,requestDismiss:function(){return e.pop()}},o);var u=c("flow-drawer-container");return s.createElement(l,{transitionName:r,className:u},o)}};f.Transition=p,f.Dir=h,f.contextTypes={uim:s.PropTypes.instanceOf(u)},e.exports=f},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(200),a=n(1003),s=n(982),c=n(1111),l=n(975),u=n(129),d=n(43),p=n(976),h=n(1008),f=n(134),m=n(131),g=m.HotKeys,v={SMALL:"small",DEFAULT:"default"},y=r.createClass({displayName:"Contact",mixins:[l,u],propTypes:{contact:r.PropTypes.instanceOf(o).isRequired,onClick:r.PropTypes.func,mouseDownAsClick:r.PropTypes.bool,onDelete:r.PropTypes.func,onContext:r.PropTypes.func,contextEnabled:r.PropTypes.func,contextMenu:r.PropTypes.bool,admin:r.PropTypes.bool,active:r.PropTypes.object,className:r.PropTypes.string,secondary:r.PropTypes.node,type:r.PropTypes.oneOf(_.values(v)),showNotifyName:r.PropTypes.bool,searchText:r.PropTypes.string},getInitialState:function(){var e=this.props.contact,t=this.props.active,n={formattedName:this.async("contact.formattedName"),pendingAction:this.async("contact.pendingAction"),active:!!t&&t.value===e,contextMenu:!1};return this.props.showNotifyName&&(n.notifyName=this.async("contact.notifyName")),n},componentWillMount:function(){this.props.active&&this.addObserver(this.props.active,this.props.contact.id.toString(),this.onActiveChange)},onActiveChange:function(e,t){if("focus"===e){var n=i.findDOMNode(this);f.focus(n),t&&h.scrollIntoViewIfNeeded(n)}this.setState({active:!!e})},contextEnabled:function(){return!1},onDelete:function(e){e.stopPropagation(),this.props.onDelete(e,this.props.contact)},onClick:function(e){_.isFunction(this.props.onClick)&&this.props.onClick(e,this.props.contact)},onMouseDown:function(e){0===e.button&&this.onClick(e)},onEnter:function(e){e.preventDefault(),e.stopPropagation(),this.onClick(e)},onContext:function(e){return this.state.contextMenu?void this.setState({contextMenu:!1}):(this.props.onContext(e,this.props.contact,this.onContextClose),void this.setState({contextMenu:!0}))},onContextClose:function(){this.setState({contextMenu:!1})},indicateFocus:function(e){if(!(Date.now()-(g.flashFocus||0)>200)){var t=i.findDOMNode(this.refs.cell);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.onBlur})}},onBlur:function(e){var t=i.findDOMNode(this.refs.cell);t&&(Velocity(t,"stop"),t.style.backgroundColor="")},render:function(){var e=this.props,t=e.contact,n=e.secondary,i=e.onContext,o=e.onDelete,l=e.contextEnabled,u=e.contextMenu,h=e.admin,f=e.showNotifyName,m=e.className;m=d("contact",m,{active:!!this.state.active});var y=void 0,_=void 0,E=void 0;if(!t.name&&f&&this.state.notifyName&&(E=r.createElement("span",{className:"ellipsify screen-name"},r.createElement(p,{classes:"screen-name-text",direction:"auto",text:this.state.notifyName.name}))),h&&(_=r.createElement("div",{className:"chat-meta"},r.createElement("div",{className:"chat-marker chat-marker-admin"},l10n.t("web_group_admin")))),o){var b=d("icon",{"icon-x-alt-small":this.props.type===v.SMALL,"icon-x-alt":this.props.type!==v.SMALL});y=r.createElement("div",{className:"chat-controls"},r.createElement("button",{className:b,onClick:this.onDelete}))}n||(n=r.createElement(c,{status:t.status})),i&&(i=this.onContext);var S=this.props.type===v.SMALL?26:s.Size.DEFAULT,M=r.createElement("div",{className:"chat-avatar"},r.createElement(s,{id:t.id,size:S})),T={enter:this.onEnter},C=this.props.mouseDownAsClick;return r.createElement(g,{handlers:T,onFocus:this.indicateFocus,onBlur:this.onBlur},r.createElement(a,{id:t.id,ref:"cell",className:m,contextEnabled:l||this.contextEnabled,contextMenu:u,pendingAction:this.state.pendingAction,detail:y,image:M,primary:this.state.formattedName,searchText:this.props.searchText,primaryDetail:_,secondary:n,secondaryDetail:E,onClick:C?null:this.onClick,onMouseDown:C?this.onMouseDown:null,onContext:i}))}});y.Type=v,e.exports=y},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var n=t.x||0,r=t.y||0;t.degrees&&(t.radians=t.degrees*(Math.PI/180)),e.translate(n,r),e.rotate(t.radians),e.translate(-n,-r)}function o(e,t,n){var r=e.getContext("2d"),i=r.getImageData(0,0,t,n);e.width=t,e.height=n,r.putImageData(i,0,0)}function a(e){var t=e.getContext("2d");t.fillStyle="rgb(247,247,247)",t.fillRect(0,0,e.width,e.height)}function s(e,t,n){var r=p.boundHeightWidth(e.height,e.width,n,t),i=r.width,o=r.height;if(i>e.width&&o>e.height)return e;var a=document.createElement("canvas"),s=a.getContext("2d");return a.width=i,a.height=o,s.drawImage(e,0,0,i,o),a}function c(e){var t=new g;return t.writeBytes(255,216,255,224,0,16,74,70,73,70,0),t.writeUint16(e.version),t.writeUint8(e.densityUnits),t.writeUint16(e.xDensity),t.writeUint16(e.yDensity),t.writeBytes(0,0),t.readByteArray()}function l(e,t,n,r,i){if(t>r||n>i)throw new Error("Image is too big and must be resized.");var o=new g(e),a=new g(e),s=new g,l=2,u=2,d=!1,p=!1,h=!1,f=!1,m=void 0,v={version:257,densityUnits:0,xDensity:1,yDensity:1};if(o.readUint8()!==E||o.readUint8()!==b.SOI)throw new Error("SOI marker not at the start of the file.");a.advance(l);for(var y=void 0;y||o.size();){if(void 0===y){var M=o.readUint8();if(M!==E)throw new Error("0x"+M.toString(16)+" is not a marker prefix.");y=o.readUint8()}switch(y){case b.APP0:if(p)m=o.readUint16(),a.advance(m+l),o.advance(o.size()-a.size());else{if(m=o.readUint16(),"JFIF\0"!==o.readString(5))throw new Error("APP0 marker missing 'JFIF' magic bytes.");f=!0,v.version=o.readUint16(),v.densityUnits=o.readUint8(),v.xDensity=o.readUint16(),v.yDensity=o.readUint16(),a.advance(m+l),o.advance(o.size()-a.size()),p=!0}break;case b.SOS:if(!h&&!f)throw new Error("Missing magic bytes marker.");o.advance(o.readUint16()-u);for(var T=void 0,C=void 0,w=o.readUint8();o.size();){if(C=o.readUint8(),T=w===E&&_.indexOf(S,C)===-1){y=C;break}w=C}s.writeByteArray(a.readByteArray(a.size()-o.size()-l));continue;case b.APP1:if(m=o.readUint16(),!h&&"Exif\0\0"!==o.readString(6))throw new Error("APP1 marker missing 'EXIF' magic bytes.");h=!0,a.advance(m+l),o.advance(o.size()-a.size());break;case b.APP13:case b.COM:if(!h&&!f)throw new Error("Missing magic bytes marker.");m=o.readUint16(),a.advance(m+l),o.advance(o.size()-a.size());break;case b.EOI:if(!h&&!f)throw new Error("Missing magic bytes marker.");d=!0,s.writeByteArray(a.readByteArray(l));break;case b.SOF0:case b.SOF1:case b.SOF2:case b.SOF3:case b.SOF5:case b.SOF6:case b.SOF7:case b.SOF9:case b.SOF10:case b.SOF11:case b.SOF13:case b.SOF14:case b.SOF15:case b.DQT:case b.DHT:case b.DRI:if(!h&&!f)throw new Error("Missing magic bytes marker.");m=o.readUint16(),s.writeByteArray(a.readByteArray(l+m)),o.advance(o.size()-a.size());break;case b.APP2:case b.APP3:case b.APP4:case b.APP5:case b.APP6:case b.APP7:case b.APP8:case b.APP9:case b.APP10:case b.APP11:case b.APP12:case b.APP14:case b.APP15:throw new Error("Received unexpected APP marker 0x"+y.toString(16));default:throw new Error("Did not understand marker: 0x"+y.toString(16))}if(y=void 0,d)break}if(!d)throw new Error("No EOI tag found.");var x=c(v);return new Blob([x,s.readByteArray()],{type:"image/jpeg"})}var u=n(2),d=r(u),p=n(1090),h=n(889),f=n(418),m=n(14),g=n(13),v=n(1),y=n(1091),E=255,b={SOF0:192,SOF1:193,SOF2:194,SOF3:195,DHT:196,SOF5:197,SOF6:198,SOF7:199,SOF9:201,SOF10:202,SOF11:203,SOF13:205,SOF14:206,SOF15:207,RST0:208,RST1:209,RST2:210,RST3:211,RST4:212,RST5:213,RST6:214,RST7:215,SOI:216,EOI:217,SOS:218,DQT:219,DRI:221,APP0:224,APP1:225,APP2:226,APP3:227,APP4:228,APP5:229,APP6:230,APP7:231,APP8:232,APP9:233,APP10:234,APP11:235,APP12:236,APP13:237,APP14:238,APP15:239,COM:254},S=[0,b.RST0,b.RST1,b.RST2,b.RST3,b.RST4,b.RST5,b.RST6,b.RST7],M={DATA_URL:1,BLOB:2,CANVAS:4,generateVideoThumbAndDuration:function(e,t,n){return y.video(e,!0).then(function(e){var r=e.video,i=e.fullWidth,o=e.fullHeight,a=document.createElement("canvas"),s=p.boundHeightWidth(o,i,n,t);a.width=s.width,a.height=s.height;var c=a.getContext("2d");return c.drawImage(r,0,0,s.width,s.height),{duration:~~r.seekable.end(0),thumb:{url:a.toDataURL("image/jpeg"),width:s.width,height:s.height,fullWidth:i,fullHeight:o}}})},crop:function(e,t,n,r,i,o,a){var s=this,c=arguments.length<=7||void 0===arguments[7]?M.DATA_URL:arguments[7],l=e instanceof HTMLCanvasElement?d["default"].resolve(e):y.loadImage(e);return l.then(function(e){var l=document.createElement("canvas"),u=l.getContext("2d");o&&a?(l.height=a,l.width=o,u.drawImage(e,t,n,r,i,0,0,o,a)):(l.height=i,l.width=r,u.drawImage(e,t,n,r,i));var p={};return s.getImagePromises(p,l,c),d["default"].props(p).then(function(e){return{images:e,width:r,height:i}})})},generateLinkPreview:function(e){return y.loadImage(e).then(function(e){var t=100,n=140;if(e.width<t||e.height<t)return null;var r=document.createElement("canvas"),i=r.getContext("2d");r.height=n,r.width=n;var o=Math.min(e.width,e.height),a=(e.width-o)/2,s=(e.height-o)/2;return i.drawImage(e,a,s,o,o,0,0,n,n),r.toDataURL("image/jpeg").replace(/^data:image\/jpeg;base64,/,"")})["catch"](function(){return null})},resizeDataURI:function(e,t,n){return y.loadImage(e).then(function(e){var r=document.createElement("canvas"),i=p.boundHeightWidth(e.height,e.width,n,t);r.width=i.width,r.height=i.height;var o=r.getContext("2d");return o.drawImage(e,0,0,i.width,i.height),r.toDataURL("image/jpeg")})},getImagePromises:function(e,t,n){!e.blob&&n&this.BLOB&&(e.blob=this.canvasToBlob(t)),!e.dataUrl&&n&this.DATA_URL&&(e.dataUrl=d["default"].resolve(t.toDataURL("image/jpeg"))),!e.canvas&&n&this.CANVAS&&(e.canvas=d["default"].resolve(t))},rotateAndResize:function(e,t,n){var r=this,c=arguments.length<=3||void 0===arguments[3]?M.BLOB:arguments[3],u=e instanceof HTMLCanvasElement,m=void 0,g=void 0,_=void 0;return u?(g=d["default"].resolve(e),_=d["default"].resolve(null)):(m=window.URL.createObjectURL(e),g=y.loadImage(m),_=f.blobToArrayBuffer(e)),d["default"].props({buffer:_,image:g}).then(function(e){var u=e.buffer,f=e.image,m={};try{m=h(u)}catch(g){}var y=0;switch(m.orientation||"UNKNOWN"){case"right-top":y=1;break;case"left-bottom":y=-1;break;case"bottom-right":y=2}var _=document.createElement("canvas"),E=f.naturalWidth||f.width,b=f.naturalHeight||f.height,S={};if(y){var T=function(){var e=Math.max(E,b),l=e/2;_.width=_.height=e;var u=_.getContext("2d");a(_),i(u,{x:l,y:l,degrees:90*y}),1===y?u.drawImage(f,0,e-b):u.drawImage(f,e-E,0),i(u,{x:l,y:l,degrees:y*-90}),o(_,b,E);var p=s(_,t,n);return r.getImagePromises(S,p,c),{v:d["default"].props(S).then(function(e){return{width:p.width,height:p.height,images:e}})}}();if("object"==typeof T)return T.v}else{var C=function(){var e=void 0,i=void 0,o=c&M.BLOB;if(u&&o)try{var s=l(u,E,b,t,n);S.blob=s,o=!1,e=E,i=b}catch(h){v.log("Could not parse JPEG: "+h.message)()}if(o||c&~M.BLOB){var m=p.boundHeightWidth(b,E,n,t);_.width=m.width,_.height=m.height,e=_.width,i=_.height;var g=_.getContext("2d");a(_),g.drawImage(f,0,0,e,i),r.getImagePromises(S,_,c)}return{v:d["default"].props(S).then(function(t){return{width:e,height:i,images:t}})}}();if("object"==typeof C)return C.v}})["finally"](function(){m&&window.URL.revokeObjectURL(m)})},canvasToBlob:function(e){arguments.length<=1||void 0===arguments[1]?"image/jpeg":arguments[1];return e.toBlob?new d["default"](function(t){e.toBlob(t,"image/jpeg")}):d["default"].resolve(window.dataURLtoBlob(e.toDataURL("image/jpeg")))},urlToFile:function(e){var t=this;return y.loadImage(e).then(function(e){var n=document.createElement("canvas");n.width=e.naturalWidth,n.height=e.naturalHeight;var r=n.getContext("2d");return a(n),r.drawImage(e,0,0),t.canvasToBlob(n)})["catch"](function(){return d["default"].reject(new m.MediaDragDropError("unable to render image",e))})},isCached:function(e){if(!e)return!1;var t=new Image;return t.src=e,!!t.complete},loadImage:y.loadImage};e.exports=M},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(412),o=r(i),a=n(414),s=r(a),c=n(6),l=n(34),u=n(130),d=n(43),p={CONTAIN:"contain",COVER:"cover",SCALE_DOWN:"scaleDown",ZOOM_IN:"zoomIn"},h=c.createClass({displayName:"ObjectFit",mixins:[u],propTypes:{children:c.PropTypes.node.isRequired,type:c.PropTypes.oneOf(_.values(p)).isRequired,size:c.PropTypes.shape({width:c.PropTypes.number.isRequired,height:c.PropTypes.number.isRequired}),zoomIn:c.PropTypes.shape({factor:c.PropTypes.number,translateX:c.PropTypes.number,translateY:c.PropTypes.number}),onObjectLoad:c.PropTypes.func},statics:{TYPES:p},getInitialState:function(){return{style:this.props.size,className:"object-fit",computed:!1}},componentDidMount:function(){if(!this.shouldUseNativeObjectFit()){this.initialize();var e=this;this.regNativeListener(window,"resize",function(){e.initialize()})}},componentWillReceiveProps:function(e){this.initialize(e)},initialize:function(e){var t=this;this.shouldUseNativeObjectFit()||(e=e||this.props,e.size&&this.setState(this[e.type](e.size.width,e.size.height,e.zoomIn),function(){_.isFunction(t.props.onObjectLoad)&&t.props.onObjectLoad(t.refs.object.firstChild)}))},shouldUseNativeObjectFit:function(){return!1},cover:function(e,t){var n=l.findDOMNode(this),r=n.clientWidth,i=n.clientHeight,o=e,a=t,s=0,c=0;return o!==r&&(a*=r/o,o=r,a>i&&(s=i/2-a/2)),a<i&&(o*=i/a,a=i,o>r&&(c=r/2-o/2)),{style:{width:o,height:a,top:s,left:c,position:"absolute"},className:"object-fit object-fit-cover",computed:!0}},contain:function(e,t){var n=l.findDOMNode(this),r=n.clientWidth,i=n.clientHeight,o=e,a=t,s=0,c=0,u=o/r,d=a/i;return u>d?(a*=r/o,o=r,a<i&&(s=i/2-a/2)):(o*=i/a,a=i,o<r&&(c=r/2-o/2)),{style:{width:o,height:a,top:s,left:c,position:"absolute"},className:"object-fit object-fit-contain",computed:!0}},scaleDown:function(e,t){var n=l.findDOMNode(this),r=n.clientWidth,i=n.clientHeight,o=t,a=e;return o>i&&(o=i,a=e*(i/t)),a>r&&(a=r,o=t*(r/e)),{style:{width:a,height:o},className:"object-fit object-fit-scaledown",computed:!0}},zoomIn:function(e,t,n){var r=this.scaleDown(e,t);return r.className+=" object-fit-zoomin",r.style.transition="transform 300ms cubic-bezier(.1,.82,.25,1)",n&&(r.style.transform="translateX("+n.translateX+"px) translateY("+n.translateY+"px) scale("+n.factor+")"),r},render:function(){var e=this.props,t=e.children,n=(e.size,e.type,e.zoomIn,e.onObjectLoad,e.className),r=(0,s["default"])(e,["children","size","type","zoomIn","onObjectLoad","className"]);if(this.shouldUseNativeObjectFit())return c.createElement("div",{className:"native-scale-down"},t);var i=d(this.state.className,n),a=this.state.computed?this.state.style:{visibility:"hidden"};return c.createElement("div",(0,o["default"])({},r,{className:i}),c.createElement("div",{style:a,ref:"object"},t))}});e.exports=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(412),o=r(i),a=n(414),s=r(a),c=n(6),l=n(416),u=n(43),d=c.createClass({displayName:"DrawerSection",propTypes:{children:c.PropTypes.node.isRequired,title:c.PropTypes.node,subtitle:c.PropTypes.node,titleOnClick:c.PropTypes.func,footer:c.PropTypes.node,expands:c.PropTypes.bool.isRequired,classes:c.PropTypes.string,onMouseDown:c.PropTypes.func,noContainer:c.PropTypes.bool,a8n:c.PropTypes.string},getDefaultProps:function(){return{expands:!1,noContainer:!1}},render:function(){var e=this.props,t=e.children,n=e.title,r=e.subtitle,i=e.footer,a=e.expands,d=e.classes,p=e.onMouseDown,h=e.noContainer,f=e.titleOnClick,m=e.a8n,g=(0,s["default"])(e,["children","title","subtitle","footer","expands","classes","onMouseDown","noContainer","titleOnClick","a8n"]),v=u(d,{"drawer-section-expand":!!a,"drawer-section":!a,well:!!n});if(!n)return c.createElement("div",{className:v},t);var y=r?c.createElement("div",{className:"col-side"},r):null,E=t;if(!h&&E){var b=u("drawer-section-body",{"drawer-section-body-expand":!!a,chatlist:!!a});E=c.createElement("div",{className:b},t)}var S=u("drawer-section-title title-underlined",{clickable:!!f});return c.createElement("div",(0,o["default"])({className:v,onMouseDown:p},g),c.createElement("div",{className:S,onClick:f||_.noop},c.createElement("div",{"data-a8n":l.key(m),className:"col-main"},n),y),E,i)}});e.exports=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(44),o=r(i),a=n(52),s=r(a),c=n(885),l=function(){function e(){(0,o["default"])(this,e)}return(0,s["default"])(e,[{key:"match",value:function(e){c(!1,"Subclasses of `Mutator` must implement `match(text)`")}},{key:"mutate",value:function(e,t){return e}},{key:"group",get:function(){return 0}},{key:"isFragment",get:function(){return!1}},{key:"isFormatter",get:function(){return!1}},{key:"alwaysApply",get:function(){return!1}},{key:"formatResult",get:function(){return!0}},{key:"mutates",get:function(){return this.mutate!==e.prototype.mutate}}]),e}();e.exports=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n,r){this.key=e,this.src=t,this.crossOrigin=n,this.noXHR=r,this.isHttp="/"===t[0]||v.isHttp(t),this.hasPrivacyChecks=!0,this.promise=null,this.retainCount=0,this.generation=0}function o(e){var t=e.src,n=e.crossOrigin,r=e.noXHR,o=e.hasPrivacyChecks;n=!!n,r=!!r;var a="CO:"+(n?"y":"n")+",XHR:"+(r?"y":"n")+","+t,s=M[a];if(s)return s.retainCount++,s.generation=0,o||(s.hasPrivacyChecks=!1),s;var l=new i(a,t,n,r);return M[a]=l,l.retainCount++,l.promise=c["default"].loop(function(e){var n=l.generation++;if(n>S)throw new g.GaveUpRetry("Too many image retries "+l.src);return c["default"].delay(Math.floor(1e3*y.expBackoff(n,60,0))).then(function(){return l.hasPrivacyChecks&&!u.phoneActive&&n>0?f.waitForBBEvent(u,"change:phoneActive",_.matches({phoneActive:!0})):d.waitForOnline}).cancellable().then(function(){return!(0!==n&&l.isHttp&&!l.noXHR)||m.get(t).timeout(3e4,"imageTagRetryTimeout").then(function(e){var t=e.status;if(t>=200&&t<400)return!0;if(t>=500)return!1;throw new g.ServerStatusError(null,l.src,t)},function(){return!1})}).then(function(t){if(t)return b.loadImage(l.src,l.crossOrigin).then(e)["catch"](function(){if(!l.isHttp)throw new g.ImageError("Invalid Data URI",l.src)})})}).cancellable()["finally"](function(){l===M[l.key]&&delete M[l.key]}),l}function a(e){--e.retainCount<=0&&e.promise.cancel()}var s=n(2),c=r(s),l=n(6),u=n(65),d=n(136),p=n(129),h=n(980),f=n(29),m=n(135),g=n(14),v=n(80),y=n(103),E=n(8),b=n(993),S=10,M={},T=l.createClass({displayName:"ImageTag",mixins:[p,h],propTypes:{hasPrivacyChecks:l.PropTypes.bool,crossOrigin:l.PropTypes.bool,onLoaded:l.PropTypes.func,onError:l.PropTypes.func,noXHR:l.PropTypes.bool,src:l.PropTypes.string.isRequired,className:l.PropTypes.string,style:l.PropTypes.object,onMouseMove:l.PropTypes.func,onClick:l.PropTypes.func,onLoad:l.PropTypes.func},getDefaultProps:function(){return{crossOrigin:!0}},getInitialState:function(){return b.isCached(this.props.src)?{src:this.props.src}:(this.ensureLoaded(),{src:null})},componentWillReceiveProps:function(e){if(this.props.src!==e.src){if(!b.isCached(e.src))return this.ensureLoaded(e),{src:null};this.setState({src:e.src})}},componentWillUnmount:function(){this.ensureLoadedQuery&&a(this.ensureLoadedQuery)},ensureLoaded:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?this.props:arguments[0],n=this.ensureLoadedQuery,r=this.ensureLoadedQuery=o(t);n&&a(n),n!==r&&r.promise.checkpoint(this.rejectOnUnmount()).then(function(){r===e.ensureLoadedQuery&&(e.setState({src:e.props.src}),e.props.onLoaded&&e.props.onLoaded())})["catch"](g.ImageError,g.ServerStatusError,g.GaveUpRetry,function(t){r===e.ensureLoadedQuery&&(e.rejectOnUnmount().isRejected()||e.props.onError&&e.props.onError(t))})["catch"](g.Unmount,c["default"].CancellationError,_.noop)},render:function(){var e=void 0,t=void 0;return this.state.src?(t=this.state.src,e=this.props.onLoad):(t=E.ONE_BY_ONE_TRANS_GIF,e=null),l.createElement("img",{src:t,onLoad:e,onClick:this.props.onClick,onMouseMove:this.props.onMouseMove,style:this.props.style,className:this.props.className})}});e.exports=T},function(e,t,n){"use strict";var r=n(6),i=n(1072),o=n(1073),a=n(102),s=n(419),c=n(43),l=n(132),u=n(1020),d=n(131),p=d.HotKeys,h=n(197),f=n(999),m=r.createClass({displayName:"TextInput",propTypes:{placeholder:r.PropTypes.string,value:r.PropTypes.string,error:r.PropTypes.string,lowProfile:r.PropTypes.bool,multiline:r.PropTypes.bool,supportsEmoji:r.PropTypes.bool,onChange:r.PropTypes.func.isRequired,onBlur:r.PropTypes.func,onFocus:r.PropTypes.func,onEnter:r.PropTypes.func,maxLength:r.PropTypes.number,showRemaining:r.PropTypes.bool,editable:r.PropTypes.bool,spellCheck:r.PropTypes.bool,focusOnMount:r.PropTypes.bool,lockable:r.PropTypes.bool,pending:r.PropTypes.bool,onCancel:r.PropTypes.func,onSave:r.PropTypes.func,onError:r.PropTypes.func,validate:r.PropTypes.func},getDefaultProps:function(){return{maxLength:25,editable:!0}},getInitialState:function(){return{active:!1,locked:this.props.lockable,emojiPicker:!1}},componentDidMount:function(){this.props.focusOnMount&&this.restoreFocus()},onEmojiPicker:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=r.createElement(o,{onEmoji:this.onEmoji});this.setState({emojiPicker:{menu:t,menuDirection:{y:s.Direction.Y.TOP},type:s.Type.EMOJI_PICKER,anchor:e.target}}),this.restoreFocus()},emojiPickerClose:function(){this.setState({emojiPicker:!1})},onEmoji:function(e){this.refs.inputLine.replaceSelection(e)},onEnter:function(){this.props.lockable&&this.onSaveAndLock(),this.props.onEnter&&!this.props.multiline&&this.props.onEnter()},onChange:function(e){this.props.onChange&&this.props.onChange(e)},restoreFocus:function(){this.refs.inputLine&&this.refs.inputLine.restoreFocus()},onBlur:function(e){this.state.active&&this.setState({active:!1}),this.props.onBlur&&this.props.onBlur(e)},onFocus:function(e){e.stopPropagation(),this.state.active||this.setState({active:!0}),this.props.onFocus&&this.props.onFocus(e);var t=this.refs.uiTextInput;t&&t.raiseToTop()},onUnlock:function(e){this.setState({locked:!1})},onSaveAndLock:function(e){var t=!(!this.props.lowProfile&&this.props.error);this.props.validate&&t&&(t=this.props.validate(this.props.value)),t?(this.props.onSave&&this.props.onSave(),this.setState({locked:!0})):this.props.onError&&this.props.onError()},onCancel:function(){this.props.onCancel&&this.props.onCancel(),this.setState({locked:!0})},render:function(){var e=this.props.editable&&!this.state.locked,t=e&&!!this.props.error&&!this.props.lowProfile,n=u.multibyteLength(this.props.value||""),o=this.props.maxLength-n<50&&e,s={container:c("text-input",{"no-placeholder":!this.props.placeholder}),label:c("label-text",{"label-text-float":!!this.props.value}),inputWrapper:c("input-wrapper",{"input-text-error":t,"input-text-active":this.state.active,locked:this.state.locked}),infoWrapper:c("input-info-strip",{"input-text-error":t,"input-text-active":this.state.active})},d=this.props.showRemaining?r.createElement("div",{className:"control-button-container char-counter"},r.createElement("div",{className:"char-counter"},o?this.props.maxLength-n:null)):null,m=e&&this.props.supportsEmoji?r.createElement("button",{className:"icon icon-emoji icon-emoji-input",onClick:this.onEmojiPicker}):void 0,g=void 0;this.props.lockable&&(this.props.pending?g=r.createElement("div",{className:"icon icon-spinner"},r.createElement(l,{size:18,stroke:6})):this.state.locked?this.props.editable&&(g=r.createElement("span",{className:"lock-icon icon icon-pencil",onClick:this.onUnlock,key:"btn-edit",title:l10n.t("edit_button")})):g=r.createElement("span",{className:"lock-icon icon icon-checkmark",onClick:this.onSaveAndLock,key:"btn-done",title:l10n.t("click_to_save_esc_to_cancel")}),g=r.createElement(a,{transitionName:"pop",component:"div",className:"control-button-container"},g));var v=this.props.lowProfile?null:r.createElement("div",{className:s.infoWrapper},r.createElement("div",{className:"error-text"},t?this.props.error:null)),y=void 0;if(this.props.lockable&&!this.state.locked){var _=void 0;this.state.emojiPicker&&(_=r.createElement(h,{displayName:"EmojiPicker",escapable:!0,popable:!0,requestFocus:this.restoreFocus,requestDismiss:this.emojiPickerClose},r.createElement(f,{contextMenu:this.state.emojiPicker}))),y=r.createElement(h,{displayName:"TextInput",escapable:!0,requestFocus:this.restoreFocus,requestDismiss:this.onCancel},_)}else!this.props.lockable&&this.state.emojiPicker&&(y=r.createElement(h,{displayName:"EmojiPicker",escapable:!0,popable:!0,requestFocus:this.restoreFocus,requestDismiss:this.emojiPickerClose},r.createElement(f,{contextMenu:this.state.emojiPicker})));return r.createElement(p,{className:s.container,onFocus:this.restoreFocus},r.createElement("span",{className:s.label},this.props.placeholder),r.createElement("div",{className:"input-spacer"}),r.createElement("div",{className:s.inputWrapper,"data-trump-dominateparent":"click"},r.createElement(i,{ref:"inputLine",value:this.props.value,className:"input-text",multiline:this.props.multiline,onChange:this.onChange,onFocus:this.onFocus,onBlur:this.onBlur,onEnter:this.onEnter,focusOnChange:!1,spellCheck:this.props.spellCheck,maxLength:this.props.maxLength,showRemaining:this.props.showRemaining,editable:this.props.editable&&!this.state.locked}),r.createElement("div",{className:"textinput-controls"},g,r.createElement(a,{transitionName:"pop",component:"div",className:"control-button-container"},m),d)),v,y)}});e.exports=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(412),o=r(i),a=n(414),s=r(a),c=n(6),l=n(10),u=n(63),d=c.createClass({displayName:"UIEMenu",propTypes:{contextMenu:c.PropTypes.object.isRequired},componentDidMount:function(){var e=this,t=this.props.contextMenu,n=t.menu,r=(0,s["default"])(t,["menu"]);l.openContextMenu(n,(0,o["default"])({},r),this.context.uim,function(t){return e.element=t})},componentWillUnmount:function(){l.closeContextMenu(this.context.uim)},getElement:function(){return this.element},render:function(){return null}});d.contextTypes={uim:c.PropTypes.instanceOf(u)},e.exports=d},function(e,t,n){"use strict";var r=n(6),i=n(8),o=n(410),a=n(10),s=n(54),c={GUIDE_ALLOW:"guide-allow",GUIDE_UNBLOCK:"guide-unblock",GUIDE_NONE:"guide-none"},l={CHROME_MEDIA_ERROR:"__chrome_media_error__",FIREFOX_LOCK:"__firefox_lock__",OPERA_MEDIA:"__opera_media__"},u=r.createClass({displayName:"GuidePopup",propTypes:{title:r.PropTypes.string.isRequired,desc:r.PropTypes.string.isRequired,browserPrefixDesc:r.PropTypes.bool.isRequired,type:r.PropTypes.oneOf(_.values(c)).isRequired,onConfirm:r.PropTypes.func,onCancel:r.PropTypes.func},statics:{TYPE:c},getDefaultProps:function(){return{browserPrefixDesc:!0,type:c.GUIDE_NONE,onConfirm:a.closeModal.bind(a)}},componentDidMount:function(){var e=this.getDescription(),t=this.refs.description;e.indexOf(l.CHROME_MEDIA_ERROR)>-1&&(t.innerHTML=t.innerHTML.replace(l.CHROME_MEDIA_ERROR,'<span class="chrome-media-icon"></span>')),e.indexOf(l.FIREFOX_LOCK)>-1&&(t.innerHTML=t.innerHTML.replace(l.FIREFOX_LOCK,'<span class="firefox-lock-icon"></span>')),e.indexOf(l.OPERA_MEDIA)>-1&&(t.innerHTML=t.innerHTML.replace(l.OPERA_MEDIA,'<span class="opera-media-icon"></span>'))},getDescription:function(){var e=this.props.desc+"_"+s.browser;return this.props.browserPrefixDesc&&l10n.hasT(e)?l10n.t(e):l10n.t(this.props.desc)},render:function(){var e="popup-guide";if(s.browser===i.BROWSER_TYPE.CHROME)switch(s.os){case i.OS_TYPE.MAC:e+=" popup-guide-mac";break;case i.OS_TYPE.CHROMEOS:e+=" popup-guide-chrome";break;case i.OS_TYPE.WINDOWS:}var t=null;this.props.type!==c.GUIDE_NONE&&s.browser===i.BROWSER_TYPE.CHROME&&(t=r.createElement("div",{className:"round"},r.createElement("div",{className:"round-body "+this.props.type})));var n=this.props.onCancel?l10n.t("learn_more"):void 0;return r.createElement(o,{title:l10n.t(this.props.title),classes:e,onOK:this.props.onConfirm,okText:l10n.t("ok_got_it"),onCancel:this.props.onCancel,cancelText:n},t,r.createElement("div",{className:"text text-tip",ref:"description"},this.getDescription()))}});e.exports=u},function(e,t,n){"use strict";var r=n(6),i=n(410),o=n(974),a=n(10),s=r.createClass({displayName:"RemoteUpload",propTypes:{msg:r.PropTypes.instanceOf(o).isRequired},render:function(){var e,t;switch(this.props.msg.type){case o.TYPE.IMAGE:
e=l10n.t("retry_upload_photo_title"),t=l10n.t("retry_upload_photo_text");break;case o.TYPE.VIDEO:e=l10n.t("retry_upload_video_title"),t=l10n.t("retry_upload_video_text");break;case o.TYPE.AUDIO:case o.TYPE.PTT:e=l10n.t("retry_upload_audio_title"),t=l10n.t("retry_upload_audio_text");break;case o.TYPE.DOCUMENT:e=l10n.t("retry_upload_doc_title"),t=l10n.t("retry_upload_doc_text");break;default:e=l10n.t("retry_upload_media_title"),t=l10n.t("retry_upload_media_text")}return r.createElement(i,{title:e,onOK:a.closeModal.bind(a),okText:l10n.t("web_ok")},t)}});e.exports=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(212),o=r(i),a=n(1042),s=r(a),c=n(412),l=r(c);e.exports={},e.exports.matchAll=function(e,t,n){for(var r=[],i=void 0;i=e.exec(t);){var o=n?n(i,e):i;o&&r.push(o)}return r};var u=n(43),d=n(6),p=d.createElement,h=0,f=function(e){return function(t,n,r){return p(e,(0,l["default"])({key:"k-"+h++},r),n)}},m=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.filter(function(e){return!!e});return function(){var e=arguments.length<=0||void 0===arguments[0]?new s["default"]:arguments[0],t=arguments[1],n=arguments[2];return r.reduce(function(r,i){var a=i(e,t,n)||{},s=u(r.className,a.className);return(0,o["default"])(r,a,s?{className:s}:{})},{})}},g=function(e,t){return function(n,r,i){return e(n,r,t(i,n,r))}},v=function(e,t){return m(function(e){return e.get("default")},function(t){return t.get(e)},t)},y=function(e,t,n){return g(f(e),v(t,n))};e.exports.jsx={make:y}},function(e,t,n){"use strict";var r=n(6),i=n(976),o=n(132),a=n(975),s=n(884),c=n(102),l=n(43),u=r.createClass({displayName:"Cell",mixins:[a,s],propTypes:{id:r.PropTypes.string.isRequired,contextEnabled:r.PropTypes.func.isRequired,pendingAction:r.PropTypes.number,contextMenu:r.PropTypes.bool,className:r.PropTypes.string,style:r.PropTypes.object,image:r.PropTypes.node,detail:r.PropTypes.node,primary:r.PropTypes.string,searchText:r.PropTypes.string,primaryDetail:r.PropTypes.node,secondary:r.PropTypes.node,secondaryDetail:r.PropTypes.node,isPSA:r.PropTypes.bool,onClick:r.PropTypes.func,onContext:r.PropTypes.func,onMouseDown:r.PropTypes.func},getInitialState:function(){return{hover:!1,contextMenu:!1}},componentWillUpdate:function(e){this.props.contextMenu&&this.state.contextMenu&&!e.contextMenu&&this.setState({contextMenu:!1})},onMenuClick:function(e){this.props.contextEnabled()&&(e.stopPropagation(),e.preventDefault(),this.props.onContext({anchor:e.target}))},onMenuMouseDown:function(e){e.stopPropagation()},onContextMenu:function(e){this.props.contextEnabled()&&(e.stopPropagation(),e.preventDefault(),this.props.onContext({event:e}))},openContextMenu:function(){var e=this;this.props.contextEnabled()&&this.setState({contextMenu:!0},function(){e.refs.context.click()})},mouseOver:function(){this.state.hover||this.props.contextMenu||!this.props.contextEnabled()||this.setState({hover:!0})},mouseEnter:function(){this.state.hover||this.props.contextMenu||!this.props.contextEnabled()||this.setState({hover:!0})},mouseLeave:function(){this.state.hover&&this.setState({hover:!1})},render:function(){var e=this.props.contextMenu||this.state.contextMenu,t=e||this.state.hover,n=l(this.props.className,{chat:!0,hover:t}),a=null,s=null;this.props.pendingAction?s=r.createElement("div",{className:"btn-context icon-spinner"},r.createElement(o,{size:18,stroke:6})):t&&(a=r.createElement("span",{className:"icon icon-down btn-context",key:"icon-context",ref:"context",onMouseDown:this.onMenuMouseDown,onClick:this.onMenuClick}));var u=this.props.detail?r.createElement("div",{className:"chat-body chat-detail"},this.props.detail):null,d=null,p="chat-title";this.props.isPSA&&(d=r.createElement("span",{className:"icon-psa-verified"}),p+=" chat-title-psa");var h=this.props.primary?r.createElement("div",{className:p},r.createElement(i,{text:this.props.primary,direction:"auto",highlight:this.props.searchText?[this.props.searchText]:null,titlify:!0,ellipsify:!0}),d):null;return r.createElement("div",{className:n,style:this.props.style,onClick:this.props.onClick,onMouseDown:this.props.onMouseDown,onContextMenu:this.props.contextEnabled()?this.onContextMenu:null,onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,onMouseLeave:this.state.hover?this.mouseLeave:null},this.props.image,r.createElement("div",{className:"chat-body"},r.createElement("div",{className:"chat-main"},h,this.props.primaryDetail),r.createElement("div",{className:"chat-secondary"},this.props.secondary,r.createElement("div",{className:"chat-meta"},this.props.secondaryDetail,r.createElement(c,{transitionName:"pop"},s),r.createElement(c,{transitionName:"pop-fast-chat"},t?a:null)))),u)}});e.exports=u},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(977),a=n(1003),s=n(982),c=n(1060),l=n(1118),u=n(1056),d=n(1122),p=n(1053),h=n(1105),f=n(1057),m=n(1062),g=n(1108),v=n(975),y=n(129),E=n(8),b=n(10),S=n(43),M=n(1008),T=n(1088),C=n(14),w=n(999),x=n(197),N=n(134),P=n(131),k=P.HotKeys,D={LAST:"last",INFO:"info"},O=r.createClass({displayName:"Chat",mixins:[v,y],propTypes:{chat:r.PropTypes.instanceOf(o).isRequired,mode:r.PropTypes.oneOf(_.values(D)).isRequired,secondary:r.PropTypes.element,searchText:r.PropTypes.string,noContext:r.PropTypes.bool,mouseDownAsClick:r.PropTypes.bool,onClick:r.PropTypes.func,active:r.PropTypes.object},statics:{Mode:D},getDefaultProps:function(){return{mode:D.LAST}},getInitialState:function(){this.hoverCounter=0;var e=this.props.chat,t=this.props.active;return{formattedTitle:this.async("chat.formattedTitle"),hasUnread:this.async("chat.hasUnread"),isReadOnly:this.async("chat.isReadOnly"),pendingAction:this.async("chat.pendingAction"),active:!!t&&t.value===e,contextMenu:!1}},componentDidMount:function(){this.props.active&&this.addObserver(this.props.active,this.props.chat.id.toString(),this.onActiveChange)},onActiveChange:function(e,t){if("focus"===e){var n=i.findDOMNode(this);N.focus(n),t&&M.scrollIntoViewIfNeeded(n)}this.setState({active:!!e})},contextEnabled:function(){var e=this.props,t=e.chat,n=e.noContext;return!n&&(t.mute.canMute()||t.canArchive()||t.canDelete()||t.canExit())},onMenu:function(e){if(this.state.contextMenu)return void this.setState({contextMenu:!1});var t=this.props.chat,n=[];t.canArchive()&&n.push(r.createElement(l,{key:"archive",onArchive:this.onArchive,chat:t})),t.mute.canMute()&&n.push(r.createElement(c,{key:"mute",onMute:this.onMute,chat:t})),t.canDelete()&&n.push(r.createElement(u,{key:"delete",onDeleteOrExit:this.onDeleteOrExit,chat:t})),t.canMarkUnseen()&&n.push(r.createElement(d,{key:"mark_unread",onMarkUnread:this.onMarkUnread,chat:t})),e.event&&e.event.persist(),this.setState({contextMenu:{menu:n,event:e.event,anchor:e.anchor}})},removeContext:function(){this.setState({contextMenu:!1})},onMute:function(e){b.muteChat(this.props.chat,e,this)},onArchive:function(e){b.archiveChat(this.props.chat,e)},onDeleteOrExit:function(){b.deleteOrExitChat(this.props.chat,this)},onMarkUnread:function(e){b.markChatUnread(this.props.chat,e)},onClick:function(e){_.isFunction(this.props.onClick)&&this.props.onClick(e,this.props.chat)},onMouseDown:function(e){0===e.button&&this.onClick(e)},onEnter:function(e){e.preventDefault(),e.stopPropagation(),k.flashFocus=Date.now(),this.onClick(e)},onDragEnter:function(e){if(this.props.chat.canSend){var t=e.dataTransfer;_.includes(t.types,E.DRAG_TYPE_FILE)&&(0===this.hoverCounter&&this.setState({dragging:!0}),this.hoverCounter+=1)}},onDragLeave:function(e){if(this.props.chat.canSend){var t=e.dataTransfer;_.includes(t.types,E.DRAG_TYPE_FILE)&&(this.hoverCounter-=1,0===this.hoverCounter&&this.setState({dragging:!1}))}},onDrop:function(e){var t=this;if(this.props.chat.canSend){this.setState({dragging:!1});var n=e.dataTransfer;(_.includes(n.types,E.DRAG_TYPE_FILE)||_.includes(n.types,"text/uri-list")||_.includes(n.types,"text/html"))&&T.getFiles(e,0).then(function(e){b.openChat(t.props.chat,void 0,!1),b.attachMediaDrawer(t.props.chat,e)})["catch"](C.MediaDragDropError,function(e){b.openChat(t.props.chat,void 0,!1),b.pasteChatTextInput(t.props.chat,e.src)})}},indicateFocus:function(e){if(!(Date.now()-(k.flashFocus||0)>200)){var t=i.findDOMNode(this.refs.cell);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.onBlur})}},onBlur:function(e){var t=i.findDOMNode(this.refs.cell);t&&(Velocity(t,"stop"),t.style.backgroundColor="")},render:function(){var e=this,t=this.props,n=t.chat,i=t.mode,o=t.secondary,c=t.className;c=S(c,{unread:this.state.hasUnread,active:!!this.state.active,"chat-drag":this.state.dragging});var l=void 0,u=void 0,d=void 0;switch(i){case D.LAST:l=r.createElement(p,{chat:n}),o||(o=r.createElement(h,{chat:n}),u=r.createElement(g,{chat:n})),d={enter:this.onEnter},d[l10n.LR("right","left")]=function(){return e.refs.cell.openContextMenu()};break;case D.INFO:o||(o=n.isGroup?r.createElement(f,{presence:n.presence,groupMetadata:n.groupMetadata,location:"list"}):r.createElement(m,{presence:n.presence,location:"list"})),d={enter:this.onEnter}}var v=r.createElement("div",{className:"chat-avatar"},r.createElement(s,{id:n.id})),y=this.props.mouseDownAsClick,_=void 0;return this.state.contextMenu&&(_=r.createElement(x,{displayName:"ChatContextMenu",escapable:!0,popable:!0,requestDismiss:this.removeContext},r.createElement(w,{contextMenu:this.state.contextMenu}))),r.createElement(k,{handlers:d,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover",onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.onDrop},r.createElement(a,{id:n.id,ref:"cell",className:c,contextEnabled:this.contextEnabled,pendingAction:this.state.pendingAction,contextMenu:!!this.state.contextMenu,image:v,primary:this.state.formattedTitle,searchText:this.props.searchText,primaryDetail:l,secondary:o,secondaryDetail:u,isPSA:n.isPSA,onClick:y?null:this.onClick,onMouseDown:y?this.onMouseDown:null,onContext:this.onMenu}),_)}});e.exports=O},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(6),s=n(34),c=n(133),l=n(132),u=n(197),d=n(134),p=n(102),h=a.createClass({displayName:"ListSearch",mixins:[c],propTypes:{onSearch:a.PropTypes.func.isRequired,placeholder:a.PropTypes.string,searching:a.PropTypes.bool},getInitialState:function(){return{searchText:"",isSearching:!1}},componentWillUnmount:function(){this.onCancel()},componentWillReceiveProps:function(e){this.state.isSearching&&(s.findDOMNode(this).contains(document.activeElement)||this.setState({isSearching:!1}))},onBlur:o["default"].wrap(function(){this.state.searchText||this.onCancel()}),onChange:function(e){var t=this,n=e.target.value;this.setState({searchText:n},function(){t.props.onSearch(n)})},onCancel:function(){this.refs.input.blur(),this.setState({searchText:"",isSearching:!1}),this.props.onSearch("")},onReset:function(e){e.stopPropagation(),this.focus(),this.setState({searchText:""}),this.props.onSearch("")},onSearchOn:function(e){this.setState({isSearching:!0}),this.safeDefer(this.focus)},focus:function(){d.focus(this.refs.input)},isAtBeginning:function(){var e=this.refs.input;return 0===e.selectionStart&&0===e.selectionEnd},isAtEnd:function(){var e=this.refs.input,t=e.value.length;return e.selectionStart===t&&e.selectionEnd===t},render:function(){var e="pane-subheader pane-list-subheader subheader-search";this.state.isSearching&&(e+=" active");var t=null;this.state.isSearching&&(this.props.searching?t=a.createElement("button",{className:"btn-context icon-spinner icon-x-alt",key:"icon-clear-search",onClick:this.onReset},a.createElement(l,{size:20,stroke:5})):_.size(this.state.searchText)&&(t=a.createElement("button",{className:"icon icon-x-alt",key:"icon-clear-search",onClick:this.onReset})));var n=void 0;this.state.isSearching&&(n=a.createElement(u,{displayName:"ListSearch",escapable:!0,requestDismiss:this.onCancel,requestFocus:this.focus}));var r=this.props.placeholder||l10n.t("search_or_start_new_chat"),i=this.state.isSearching?this.onCancel:this.onSearchOn;return a.createElement("div",{className:e},a.createElement("button",{className:"icon icon-search-morph",onMouseDown:i},a.createElement("div",{className:"icon icon-back-blue"}),a.createElement("div",{className:"icon icon-search"})),a.createElement(p,{transitionName:"pop"},t),a.createElement("div",{className:"input-placeholder"},this.state.searchText?null:r),a.createElement("label",{htmlFor:"input-chatlist-search",className:"cont-input-search"},a.createElement("input",{type:"text",ref:"input",className:"input input-search","data-tab":2,dir:"auto",title:r,value:this.state.searchText,onBlur:this.onBlur,onFocus:this.state.isSearching?null:this.onSearchOn,onChange:this.state.isSearching?this.onChange:null})),n)}});e.exports=h},function(e,t,n){"use strict";var r=n(6),i=n(974),o=n(10),a=n(410),s=r.createClass({displayName:"MediaMissingModal",propTypes:{msg:r.PropTypes.instanceOf(i).isRequired},render:function(){var e=void 0,t=void 0;switch(this.props.msg.type){case i.TYPE.VIDEO:e=l10n.t("missing_video_title"),t=l10n.t("missing_video_text");break;case i.TYPE.AUDIO:e=l10n.t("missing_audio_title"),t=l10n.t("missing_audio_text");break;case i.TYPE.IMAGE:e=l10n.t("missing_photo_title"),t=l10n.t("missing_photo_text");break;case i.TYPE.DOCUMENT:e=l10n.t("missing_document_title"),t=l10n.t("missing_document_text")}return r.createElement(a,{title:e,onOK:o.closeModal.bind(o),okText:l10n.t("web_ok")},t)}});e.exports=s},function(e,t,n){"use strict";var r=n(411),i=n(974),o=n(79),a=o.extend({props:{noEarlierMsgs:"boolean",isLoadingEarlierMsgs:"boolean",isLoadingRecentMsgs:"boolean",isLoadingAroundMsgs:"boolean",contextLoaded:"boolean"}}),s=r.extend({model:i,initialize:function(){r.prototype.initialize.call(this),this.msgLoadState=new a({noEarlierMsgs:!1,isLoadingEarlierMsgs:!1,isLoadingRecentMsgs:!1,isLoadingAroundMsgs:!1,contextLoaded:!1})},add:function(){var e=this,t=r.prototype.add.apply(this,arguments),n=Store.Msg.add(t,arguments[1]);return _.isArray(n)?n.forEach(function(t){e.isModel(t)&&(t.msgChunk=e)}):this.isModel(n)&&(n.msgChunk=this),this.trigger("bulk_add",t,arguments[1]),t},replace:function(e){var t=this;this.msgLoadState=e.msgLoadState,this.loadRecentPromise=e.loadRecentPromise,this.loadEarlierPromise=e.loadEarlierPromise,this.loadAroundPromise=e.loadAroundPromise,this.set(e.models,{silent:!0,merge:!1}),e.models.forEach(function(e){t.isModel(e)&&(e.msgChunk=t)}),this.trigger("bulk_add",e.models)}});e.exports=s},function(e,t){"use strict";var n={scrollIntoViewIfNeeded:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=arguments[2];if(_.isFunction(e.scrollIntoViewIfNeeded))return e.scrollIntoViewIfNeeded(t);n=n||e.parentNode;var r=window.getComputedStyle(n,null),i=parseInt(r.getPropertyValue("border-top-width")),o=e.offsetTop-n.offsetTop<n.scrollTop,a=e.offsetTop-n.offsetTop+e.clientHeight-i>n.scrollTop+n.clientHeight,s=o&&!a;return(o||a)&&t&&(n.scrollTop=e.offsetTop-n.offsetTop-n.clientHeight/2-i+e.clientHeight/2),!o&&!a||t||e.scrollIntoView(s),!(o||a)},scrollIntoView:function(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=arguments[2];n=n||e.parentNode;var r=window.getComputedStyle(n,null),i=parseInt(r.getPropertyValue("border-top-width")),o=e.offsetTop-n.offsetTop<n.scrollTop,a=e.offsetTop-n.offsetTop+e.clientHeight-i>n.scrollTop+n.clientHeight,s=o&&!a;return t?n.scrollTop=e.offsetTop-n.offsetTop-n.clientHeight/2-i+e.clientHeight/2:e.scrollIntoView(s),!(o||a)}};e.exports=n},function(e,t,n){"use strict";var r=n(6),i=n(8),o=n(980),a=n(975),s=n(129),c=n(43),l=n(977),u=n(974),d=n(10),p=n(1014),h=n(1006),f=n(1058),m=n(132),g=n(1059),v=n(990),y=r.createClass({displayName:"MediaGallery",mixins:[o,a,s],propTypes:{chat:r.PropTypes.instanceOf(l).isRequired,fullCollection:r.PropTypes.bool},componentWillMount:function(){this.props.chat.mediaMsgs.hasMediaBefore&&this.queryMedia()},componentDidMount:function(){this.addObserver(this.props.chat.mediaMsgs,"add remove reset"),this.addObserver(this.props.chat.mediaMsgs,"query_media_before")},queryMedia:function(e){var t=this.props.chat.mediaMsgs;t.hasMediaBefore&&t.queryMedia(this.props.chat,e)},onScroll:function(e){this.handleScroll(e.target)},handleScroll:_.throttle(function(e){var t=this.props.chat.mediaMsgs;t.hasMediaBefore&&e.scrollTop+i.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&this.queryMedia(_.head(t.models))},100),render:function(){var e=this,t=this.props.chat.mediaMsgs,n=this.props.fullCollection,i=t.map(function(n,i){var o=null;return!e.props.fullCollection&&i>=t.length-6&&i<=t.length-4&&(o="media-canvas-second-row"),r.createElement(E,{msg:n,className:o,key:n.id})});if(i.reverse(),n||(i=_.slice(i,0,6)),t.queryMediaBefore&&(n||i.length<6)){var o=c("more","media-canvas-component",{"media-canvas-second-row":!n&&i.length>=3});i.push(r.createElement("div",{className:o,key:"spinner"},r.createElement(m,{stroke:6,size:24})))}for(var a=0;a<6;a++)i.push(r.createElement("div",{className:"media-canvas-empty",key:"empty"+a}));if(0===t.length&&!t.queryMediaBefore){if(n)return r.createElement(v.MediaMsgs,null);i=[],i.push(r.createElement("div",{className:"media-gallery-no-media media-canvas-component"},r.createElement(f,{className:"textfield-static",dir:"auto"},l10n.t("no_media"))))}var s=c("media-gallery",{"drawer-media-gallery":n});return r.createElement("div",{onScroll:this.onScroll,className:"drawer-body","data-list-scroll-container":!0},r.createElement("div",{className:s},i))}}),E=r.createClass({displayName:"MediaCanvas",mixins:[a],propTypes:{msg:r.PropTypes.instanceOf(u).isRequired,className:r.PropTypes.string},showMediaMissing:function(){d.openModal(r.createElement(h,{msg:this.props.msg}))},launchMediaViewer:function(e){var t=this;e&&e.stopPropagation();var n=void 0,i=this.props.msg.id;this.props.msg.type===u.TYPE.IMAGE&&(n=function(e){return t.isMounted()&&i.equals(e)?t.refs.canvas.refs.img:null}),d.openModalMedia(r.createElement(p,{msg:this.props.msg,getZoomNode:n}),"media-viewer")},onDragStart:function(e){e.nativeEvent.dataTransfer.setData(i.DRAG_TYPE_LOCAL_IMAGE,!0),e.nativeEvent.dataTransfer.setData("text/uri-list",this.props.msg.url)},render:function(){var e=this.props.msg,t=_.noop;t=e.mediaState===u.MEDIA_STATE.ERROR_MISSING?this.showMediaMissing:this.launchMediaViewer;var n=e.type===u.TYPE.IMAGE&&e.url?this.onDragStart:null,i=c("media-canvas-component",this.props.className);return r.createElement(g,{classes:i,onClick:t,onDragStart:n,msg:e,ref:"canvas"})}});e.exports=y},function(e,t,n){"use strict";var r=n(6),i=n(1),o=n(974),a=n(129),s=r.createClass({displayName:"MsgSymbol",mixins:[a],propTypes:{msg:r.PropTypes.instanceOf(o)},componentWillMount:function(){var e=this.props.msg;"ptt"===e.type&&e.ack<4&&this.addObserver(this.props.msg,"change:ack")},getClasses:function(){var e="icon media-icon",t=this.props.msg;switch(t.type){case"location":case"image":case"video":case"audio":case"vcard":case"document":e+=" icon-status-"+(t.isGif?"gif":t.type);break;case"ptt":var n=4===t.ack?"blue":t.isSentByMe?"gray":"green";e+=" icon-status-"+t.type+"-"+n;break;case"unknown":e+=" icon-status-unknown";break;default:i.log("chat:getClasses Invalid msg type.")()}return e},render:function(){return r.createElement("span",{className:this.getClasses()})}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(988),o=n(132),a=r.createClass({displayName:"Pending",render:function(){return r.createElement("div",{className:"media-state-controls"},r.createElement("button",{className:"icon-media icon-media-disabled"},r.createElement(o,{size:50,stroke:3})))}}),s=r.createClass({displayName:"PendingCancel",render:function(){return r.createElement("div",{className:"media-state-controls"},r.createElement("button",{className:"icon-xl icon-media-cancel"},r.createElement(o,{size:50,stroke:3})))}}),c=r.createClass({displayName:"Cancel",render:function(){return r.createElement("div",{className:"media-state-controls"},r.createElement("button",{className:"icon-xl icon-media-download"}))}}),l=r.createClass({displayName:"Download",propTypes:{filesize:r.PropTypes.number.isRequired},render:function(){return this.props.filesize>0?r.createElement("div",{className:"media-state-controls"},r.createElement("button",{className:"btn-meta"},r.createElement("span",{className:"icon-xl icon-media-download-noborder"}),r.createElement(i,null,l10n.filesize(this.props.filesize)))):r.createElement("div",{className:"media-state-controls"},r.createElement("button",{className:"icon-xl icon-media-download"}))}}),u=r.createClass({displayName:"Upload",propTypes:{filesize:r.PropTypes.number.isRequired},render:function(){return this.props.filesize>0?r.createElement("div",{className:"media-state-controls"},r.createElement("button",{className:"btn-meta"},r.createElement("span",{className:"icon-xl icon-media-upload-noborder"}),r.createElement(i,null,l10n.filesize(this.props.filesize)))):r.createElement("div",{className:"media-state-controls"},r.createElement("button",{className:"icon-xl icon-media-upload"}))}}),d=r.createClass({displayName:"Play",render:function(){return r.createElement("div",{className:"media-state-controls"},r.createElement("button",{className:"icon-xl icon-media-play"}))}}),p=r.createClass({displayName:"Missing",render:function(){var e;switch(this.props.msg.type){case"image":e=l10n.t("missing_photo_title");break;case"video":e=l10n.t("missing_video_title");break;case"audio":e=l10n.t("missing_audio_title")}return r.createElement("div",{className:"media-state-controls"},r.createElement("button",{className:"btn-meta missing-text"},e))}});e.exports={Pending:a,Cancel:c,PendingCancel:s,Download:l,Upload:u,Play:d,Missing:p}},function(e,t,n){"use strict";var r=n(6),i=n(102),o=n(416),a=n(43),s=n(197),c=r.createClass({displayName:"MenuBar",propTypes:{children:r.PropTypes.node,a8n:r.PropTypes.string},render:function(){return r.createElement("div",{className:"menu menu-horizontal"},this.props.children)}}),l=r.createClass({displayName:"MenuBarItem",propTypes:{icon:r.PropTypes.string.isRequired,title:r.PropTypes.string.isRequired,children:r.PropTypes.node,transitionName:r.PropTypes.string,onClick:r.PropTypes.func},getDefaultProps:function(){return{transitionName:"dropdown"}},getInitialState:function(){return{active:!1}},onClick:function(e){e.stopPropagation(),this.props.onClick(e)},onOpen:function(e){e.preventDefault(),e.stopPropagation(),this.setState({active:!0})},onClose:function(e){e&&(e.preventDefault(),e.stopPropagation()),this.setState({active:!1})},clickHandler:function(e){this.props.onClick&&this.onClick(e),e.isDefaultPrevented()||(this.state.active?this.onClose(e):this.onOpen(e))},render:function(){var e=this,t=this.props,n=t.children,c=t.icon,l=t.transitionName,u=t.title,d=this.state.active,p=void 0;if(n){var h=void 0;d&&(h=r.createElement(s,{displayName:"MenuBarMenuItem",escapable:!0,popable:!0,requestDismiss:function(){return e.onClose()}},r.Children.only(n))),p=r.createElement(i,{transitionName:l},h)}var f={container:a("menu-item",{active:d}),icon:"icon icon-"+c};return r.createElement("div",{"data-a8n":o.key(this.props.a8n),className:f.container},r.createElement("button",{className:f.icon,onClick:this.clickHandler,title:u}),p)}});e.exports={MenuBar:c,MenuBarItem:l}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(412),o=r(i),a=n(6),s=n(34),c=n(1),l=n(984),u=n(975),d=n(129),p=n(980),h=n(974),f=n(10),m=n(78),g=n(410),v=n(976),y=n(1028),E=n(983),b=n(1001),S=n(1024),M=n(1135),T=n(1146),C=n(1140),w=n(1132),x=n(1139),N=n(1131),P=n(1149),k=n(1068),D=n(1141),O=n(1134),A=n(1136),R=n(1071),I=n(1148),L=n(1138),F=n(1032),U=new(n(1019)),j=n(999),B=n(197),G=n(886),z=n(43),Y=n(101),H=n(8),W=n(102),q={FRONT:"front",MID:"mid",END:"end",SINGLE:"single"},V=a.createClass({displayName:"Wrapper",mixins:[d,u,m,p],propTypes:{msg:a.PropTypes.instanceOf(h).isRequired,position:a.PropTypes.oneOf(_.values(q)),displayType:a.PropTypes.oneOf(_.values(H.DISP_TYPE)),isMsgVisible:a.PropTypes.func,hideMsgInfo:a.PropTypes.bool,selectable:a.PropTypes.bool,selected:a.PropTypes.bool,current:a.PropTypes.bool,onMessageSelect:a.PropTypes.func,tailOverride:a.PropTypes.oneOf(["left","right"]),isFocusedMsg:a.PropTypes.bool,highlight:a.PropTypes.bool,didRenderFocusedMsg:a.PropTypes.func},getDefaultProps:function(){return{displayType:H.DISP_TYPE.CONVERSATION}},getInitialState:function(){return{contextMenu:!1,hover:!1,highlighting:!1}},componentWillReceiveProps:function(e){this.props.isFocusedMsg&&!e.isFocusedMsg&&this.unregCmd("focus_show_msg",this.onFocusShow),!this.props.isFocusedMsg&&e.isFocusedMsg&&this.regCmd("focus_show_msg",this.onFocusShow)},shouldComponentUpdate:function(e,t){return G(this,e,t)},componentWillMount:function(){var e=this,t=this.props.msg;t.mayFail()&&(Y.supportsFeature(Y.F.RESEND_ICON)||t.type===h.TYPE.PTT)&&(this.addObserver(t,"change:isFailed",function(){return e.forceUpdate()}),this.addObserver(t,"change:mediaState",function(){return e.forceUpdate()})),this.props.isFocusedMsg&&this.regCmd("focus_show_msg",this.onFocusShow),t.typeCanChange()&&this.addObserver(t,"change:type",function(){return e.forceUpdate()})},componentWillUnmount:function(){this.quotedMessage&&!Store.Msg.get(this.quotedMessage.id)&&this.quotedMessage["delete"]();var e=this.refs.bubble;e&&Velocity(s.findDOMNode(e),"stop",!0)},onFocusShow:function(e){this.props.msg.id===e&&this.scrollIntoView(!0)},scrollIntoView:function(e){if(this.props.isFocusedMsg){var t=this.props.didRenderFocusedMsg,n=this.props.highlight?this.highlight:null;t&&this.isMounted()&&t(s.findDOMNode(this),n)}},highlight:function(){var e=this.refs.highlightTail,t=this.refs.bubble;if(e&&t){this.setState({highlighting:!0});var n=s.findDOMNode(e),r=s.findDOMNode(t),i=250;Velocity(n,"stop",!0),Velocity(n,{opacity:[1,0]},{duration:i}),Velocity(n,{opacity:[0,1]},{duration:i,delay:i});var o=this.props.msg.isSentByMe?"#dcf8c6":"#ffffff",a=this.props.msg.isSentByMe?"#b3cba1":"#cccccc";Velocity(r,"stop",!0),Velocity(r,{backgroundColor:[a,o]},{duration:i}),Velocity(r,{backgroundColor:[o,a]},{duration:i,delay:i,complete:this.onHighlightComplete})}},onHighlightComplete:function(){this.setState({highlighting:!1})},componentDidUpdate:function(e,t){!e.isFocusedMsg&&this.props.isFocusedMsg&&this.scrollIntoView()},componentDidMount:function(){this.scrollIntoView()},resend:function(){var e=this.props.msg;return e.isMMS&&!Y.supportsFeature(Y.F.MEDIA_RETRY)?void f.openModal(a.createElement(b,{msg:e})):(this.props.msg.resumeRemoteUpload(),void e.resend()["catch"](function(e){c.log("wrapper:resend failure: "+e)()}))},openSingleForwardFlow:function(){return this._openForwardFlow(!1)},openForwardFlow:function(){return this._openForwardFlow(!0)},_openForwardFlow:function(e){var t,n=this.props.msg;if(n.type===h.TYPE.CIPHERTEXT?t=l10n.t("err_unsent_forward_text_decrypting"):n.isUnsentMedia&&(t=l10n.t("err_unsent_forward_text")),t)f.openModal(a.createElement(g,{title:l10n.t("err_unsent_forward_title"),onOK:f.closeModal.bind(f),okText:l10n.t("web_ok")},t));else{if(e&&this.props.displayType===H.DISP_TYPE.CONVERSATION)return void this.onSelectClick();f.openModal(a.createElement(y,{msgs:[this.props.msg]}),"modal-flow")}},openInfoDrawer:function(){f.msgInfoDrawer(this.props.msg)},openContactChat:function(){Store.Chat.find(this.props.msg.author).then(function(e){f.openChat(e)})},mouseEnter:function(){!this.state.hover&&this.contextEnabled()&&this.setState({hover:!0})},mouseLeave:function(){this.state.hover&&this.contextEnabled()&&this.setState({hover:!1})},contextMenu:function(e){e.stopPropagation()},contextEnabled:function(){return!this.props.msg.isNotification},removeContext:function(){this.setState({contextMenu:!1})},onDeleteMessage:function(){var e=this,t=function(){f.closeModal(),e.props.msg.chat.sendDeleteMsgs([e.props.msg])},n=l10n.t("delete_message_confirmation");f.openModal(a.createElement(g,{onOK:t,okText:l10n.t("web_delete"),onCancel:f.closeModal.bind(f),cancelText:l10n.t("web_cancel")},a.createElement(v,{text:n})))},onReplyMessage:function(){this.props.msg.chat.composeQuotedMsg=this.props.msg,f.focusChatTextInput(this.props.msg.chat)},onDownload:function(){F.initDownload(this.props.msg)},onStarMessage:function(){this.props.msg.chat.sendStarMsgs([this.props.msg],!0)},onUnstarMessage:function(){this.props.msg.chat.sendStarMsgs([this.props.msg],!1)},onMenu:function(e){if(e.stopPropagation(),e.preventDefault(),e.isTrusted&&this.state.contextMenu)return void this.setState({contextMenu:!1});var t=this.props.msg,n=[];t.isSentByMe&&Y.supportsFeature(Y.F.MESSAGE_INFO)&&this.props.displayType!==H.DISP_TYPE.MSG_INFO&&n.push(a.createElement(E,{key:"info",action:this.openInfoDrawer},l10n.t("message_info"))),t.canReply()&&n.push(a.createElement(E,{key:"reply",action:this.onReplyMessage},l10n.t("reply"))),t.url&&n.push(a.createElement(E,{key:"download",action:this.onDownload},l10n.t("web_button_download"))),t.canForward()&&n.push(a.createElement(E,{key:"forward",action:this.openForwardFlow},l10n.t("forward_message"))),Y.supportsFeature(Y.F.STARRED)&&(t.star?n.push(a.createElement(E,{key:"star",action:this.onUnstarMessage},l10n.t("unstar_message"))):n.push(a.createElement(E,{key:"star",action:this.onStarMessage},l10n.t("star_message")))),Y.supportsFeature(Y.F.MESSAGE_DELETE)&&n.push(a.createElement(E,{key:"delete",action:this.onDeleteMessage},l10n.t("delete_message"))),t.isGroupMsg&&t.author&&!t.isSentByMe&&n.push(a.createElement(E,{key:"author",action:this.openContactChat},l10n.t("message_author",{author:t.displayName()}))),this.setState({contextMenu:{menu:n,anchor:e.target,classes:"dropdown-compact"}})},contextOpen:function(){var e=this.refs.context;e&&e.click()},contextClose:function(){this.setState({contextMenu:!1})},getMsgComponent:function(){var e=this.props,t=e.msg,n=e.position,r=t.type,i=t.subtype,o=this.props.displayType!==H.DISP_TYPE.STARRED_MSGS&&!!t.quotedMsg||!(n===q.MID||n===q.END),s=void 0;if(Y.supportsFeature(Y.F.REPLIES_IN)){var u=t.quotedMsgObj();u&&(s=a.createElement(R,{msg:u,rootMsg:t,chat:t.chat}),Store.Msg.get(u.id)||(this.quotedMessage=u))}switch(r){case h.TYPE.CIPHERTEXT:return a.createElement(w,{msg:t,displayAuthor:o,ref:"component"});case h.TYPE.CHAT:return a.createElement(T,{msg:t,quotedMsg:s,trusted:t.isTrusted(),ref:"component",senderName:t.senderObj?t.senderObj.name:null,displayAuthor:o});case h.TYPE.IMAGE:return a.createElement(C,{msg:t,quotedMsg:s,ref:"component",isMsgVisible:this.props.isMsgVisible,displayAuthor:o});case h.TYPE.GROUP_NOTIFICATION:case h.TYPE.GP2:case h.TYPE.BROADCAST_NOTIFICATION:case h.TYPE.NOTIFICATION:case h.TYPE.E2E_NOTIFICATION:case h.TYPE.CALL_LOG:var d,p,f,m=t.body;switch(r){case h.TYPE.GP2:case h.TYPE.GROUP_NOTIFICATION:m=l.formatGroupNotification(t);break;case h.TYPE.BROADCAST_NOTIFICATION:m=l.formatBroadcastNotification(i,t.body);break;case h.TYPE.E2E_NOTIFICATION:m=l.formatE2ENotification(t),d=t.subtype,f=t.body,p=t.id.remote;break;case h.TYPE.CALL_LOG:m=l.formatCallLog(t,!0)}return a.createElement(x,{text:m,ref:"component",e2eSubtype:d,participantJid:f,chatId:p});case h.TYPE.AUDIO:case h.TYPE.VIDEO:return t.isGif?a.createElement(A,{msg:t,quotedMsg:s,ref:"component",hover:this.state.hover,isMsgVisible:this.props.isMsgVisible,displayType:this.props.displayType,displayAuthor:o}):a.createElement(N,{msg:t,quotedMsg:s,isMsgVisible:this.props.isMsgVisible,displayAuthor:o,ref:"component"});case h.TYPE.VCARD:return a.createElement(P,{msg:t,quotedMsg:s,displayAuthor:o,ref:"component"});case h.TYPE.LOCATION:return a.createElement(k,{msg:t,quotedMsg:s,displayAuthor:o,ref:"component"});case h.TYPE.PTT:return a.createElement(D,{msg:t,quotedMsg:s,displayAuthor:o,ref:"component"});case h.TYPE.DOCUMENT:return a.createElement(O,{msg:t,quotedMsg:s,trusted:t.isTrusted(),ref:"component",senderName:t.senderObj?t.senderObj.name:null,displayAuthor:o});case h.TYPE.UNKNOWN:return a.createElement(I,{msg:t,displayAuthor:o
});default:return c.log("messageList:render Unknown message type: "+r)(),a.createElement(I,{msg:t,displayAuthor:o})}},onSelectClick:function(){this.props.onMessageSelect(this.props.msg,!this.props.selected)},onDoubleClick:function(e){},render:function(){var e,t=this.props,n=t.msg,r=t.position,i=t.displayType,s=i===H.DISP_TYPE.CONVERSATION;(this.state.hover&&!this.state.highlighting||this.props.current||this.state.contextMenu)&&(e=a.createElement(L,(0,o["default"])({},this.props,{key:"icon-context",ref:"context",onClick:this.onMenu})));var c;n.type===h.TYPE.PTT&&n.isFailed&&n.mediaState===h.MEDIA_STATE.PREPARING?c=a.createElement(M,{onResend:_.noop,errMsg:l10n.t("ptt_failed")}):Y.supportsFeature(Y.F.RESEND_ICON)&&s&&n.isFailed&&n.mediaState!==h.MEDIA_STATE.REMOTE_UPLOADING&&(c=a.createElement(M,{onResend:this.resend,errMsg:l10n.t("resend_message")}));var l=!n.isNotification&&this.props.selectable?a.createElement("div",{className:"msg-select",onClick:this.onSelectClick},a.createElement(S,{onChange:this.onSelectClick,checked:this.props.selected})):null,u=r===q.MID||r===q.END,d=n.type===h.TYPE.CHAT&&U.match(n.body).length,p="message-"+(n.isGif?h.TYPE.IMAGE:n.type),f={wrapper:z("msg",{"msg-continuation":r===q.FRONT||r===q.MID,"msg-group":n.isGroupMsg&&!u,"msg-psa":i!==H.DISP_TYPE.STARRED_MSGS&&n.chat.isPSA,selected:this.props.selected}),container:z("message "+p,{"message-system":n.isNotification,"message-out":!n.isNotification&&n.isSentByMe,"message-in":!n.isNotification&&!n.isSentByMe,hover:this.state.contextMenu||this.state.hover,tail:!(n.chat.isPSA||this.props.tailOverride||r!==q.END&&r!==q.SINGLE),"tail-override-left":"left"===this.props.tailOverride,"tail-override-right":"right"===this.props.tailOverride,"message-chat":n.type===h.TYPE.CHAT&&!n.linkPreview,"message-code":d,"message-placeholder":n.type===h.TYPE.CIPHERTEXT||n.type===h.TYPE.UNKNOWN})},m=this.state.contextMenu?"none":"pop-fast",g=a.createElement("span",{className:"tail-container highlight",ref:"highlightTail"}),v=void 0;this.state.contextMenu&&(v=a.createElement(B,{displayName:"MsgContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},a.createElement(j,{contextMenu:this.state.contextMenu})));var y=void 0;return s&&!this.props.selectable&&(n.isMedia||n.linkPreview)&&(y=a.createElement("div",{className:"icon icon-forward-chat btn-forward-chat",onClick:this.openSingleForwardFlow})),a.createElement("div",{className:f.wrapper,onDoubleClick:this.onDoubleClick},a.createElement(W,{transitionName:"delay-leave"},l),a.createElement("div",{className:f.container,ref:"bubble"},a.createElement("div",{onContextMenu:this.contextMenu,onMouseOver:this.mouseEnter,onMouseEnter:this.mouseEnter,onMouseLeave:this.mouseLeave},a.createElement("span",{className:"tail-container"}),"  ",g,"                      ",c,this.getMsgComponent(),a.createElement(W,{transitionName:m},e)),y),v)}});V.Position=q,e.exports=V},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(8),a=n(974),s=n(10),c=n(130),l=n(980),u=n(129),d=n(1184),p=n(1059),h=n(132),f=n(1),m=n(101),g=n(14),v=n(43),y=n(102),E=r.createClass({displayName:"MediaViewerFlow",mixins:[c,l,u],propTypes:{msg:r.PropTypes.instanceOf(a).isRequired,getZoomNode:r.PropTypes.func},getInitialState:function(){this.zoomIn=!0;var e=this.props.msg;return this.mediaMsgs=e.chat.getMediaMsgs(e),{activeMsg:e,imgZoomed:!1}},componentWillMount:function(){this.regNativeListener(window,"keydown",this.onKeyDown)},componentDidMount:function(){var e=this;this.zoomIn=!1,this.addObserver(this.mediaMsgs,"remove reset",function(t,n,r){if(e.mediaMsgs.indexOf(t)>-1||e.state.activeMsg!==t)return void e.forceUpdate();var i=r.index;0===e.mediaMsgs.length?e.endFlow():e.mediaMsgs.length===i?e.onSelectThumb(e.mediaMsgs.at(i-1)):e.onSelectThumb(e.mediaMsgs.at(i))}),this.addObserver(this.mediaMsgs,"query_media_after"),this.addObserver(this.mediaMsgs,"query_media_before",function(){var t=i.findDOMNode(e.refs.thumbs);t&&(e.prevScrollWidth=t.scrollWidth,e.forceUpdate())}),this.scrollToActive(),Velocity(this.refs.thumbsContainer,{opacity:[1,0],translateY:["0%","100%"]},{duration:300,delay:100,easing:[.1,.82,.25,1]})},componentDidUpdate:function(e,t){if(t.activeMsg!==this.state.activeMsg)this.scrollToActive(!0);else{var n=i.findDOMNode(this.refs.thumbs);if(!n||!this.prevScrollWidth)return;n.scrollLeft+=n.scrollWidth-this.prevScrollWidth,this.prevScrollWidth=null}},onKeyDown:function(e){37===e.keyCode?this.onPrev():39===e.keyCode&&this.onNext()},onScroll:function(e){this.handleScroll(e.target)},handleScroll:_.throttle(function(e){if(this.mediaMsgs.hasMediaBefore&&e.scrollLeft<e.clientWidth){var t=this.mediaMsgs.head();this.mediaMsgs.queryMedia(t.chat,t),this.forceUpdate()}if(this.mediaMsgs.hasMediaAfter&&e.scrollLeft+o.SCROLL_FUDGE>e.scrollWidth-2*e.clientWidth){var n=this.mediaMsgs.last();this.mediaMsgs.queryMedia(n.chat,n,"after"),this.forceUpdate()}},100),onNext:function(e){var t=this;if(e&&e.stopPropagation(),!this.state.imgZoomed){var n=this.state.activeMsg,r=this.mediaMsgs.getAfter(n);return r?void this.onSelectThumb(r):void(m.supportsFeature(m.F.MEDIA_GALLERY)&&this.mediaMsgs.hasMediaAfter&&(this._queryMediaAfter||(this._queryMediaAfter=this.mediaMsgs.queryMedia(n.chat,n,"after").checkpoint(this.rejectOnUnmount()).then(function(e){e.length>0&&t.state.activeMsg===n&&t.onNext()})["catch"](g.Unmount,_.noop)["catch"](function(e){f.error("query media msgs error: ",e)})["finally"](function(){t._queryMediaAfter=null}))))}},onPrev:function(e){var t=this;if(e&&e.stopPropagation(),!this.state.imgZoomed){var n=this.state.activeMsg,r=this.mediaMsgs.getBefore(n);return r?void this.onSelectThumb(r):void(m.supportsFeature(m.F.MEDIA_GALLERY)&&this.mediaMsgs.hasMediaBefore&&(this._queryMediaBefore||(this._queryMediaBefore=this.mediaMsgs.queryMedia(n.chat,n,"before").checkpoint(this.rejectOnUnmount()).then(function(e){e.length>0&&t.state.activeMsg===n&&t.onPrev()})["catch"](g.Unmount,_.noop)["catch"](function(e){f.error("query media msgs error: ",e)})["finally"](function(){t._queryMediaBefore=null}))))}},onImgZoomIn:function(e){this.setState({imgZoomed:e})},endFlow:function(){s.closeModalMedia()},willEndFlow:function(){Velocity(this.refs.thumbsContainer,{opacity:[0,1],translateY:["100%","0%"]},{duration:300,easing:[.1,.82,.25,1]})},onSelectThumb:function(e,t){m.supportsFeature(m.F.MEDIA_GALLERY)&&this.mediaMsgs.loadMoreAroundIfNeeded(e),this.setState({activeMsg:e})},scrollToActive:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],t=this.refs.thumbsContainer,n=i.findDOMNode(this.refs.thumbs),r=i.findDOMNode(this.refs.activeThumb);if(t&&n&&r){var o=r.clientWidth/2-t.clientWidth/2;Velocity(n,"stop");var a=0;e&&(a=300),Velocity(r,"scroll",{duration:a,container:n,offset:o,axis:"x",easing:[.1,.82,.25,1]})}},getThumbs:function(){var e=this,t=this.mediaMsgs.map(function(t){var n=v("media-thumb",{active:t===e.state.activeMsg});return r.createElement(p,{classes:n,msg:t,ref:t===e.state.activeMsg?"activeThumb":null,key:"media-"+t.id.id,onClick:e.onSelectThumb.bind(e,t)})});return t.push(r.createElement("div",{className:"media-thumb-spinner media-thumb",key:"spinner-right"},this.mediaMsgs.queryMediaAfter?r.createElement(h,{stroke:6,size:24}):null)),t.unshift(r.createElement("div",{className:"media-thumb-spinner media-thumb",key:"spinner-left"},this.mediaMsgs.queryMediaBefore?r.createElement(h,{stroke:6,size:24}):null)),t.push(r.createElement("div",{className:"media-thumb-padding",key:"padding-right"})),t.unshift(r.createElement("div",{className:"media-thumb-padding",key:"padding-left"})),t},render:function(){var e=this.mediaMsgs.last(),t=this.mediaMsgs.hasMediaAfter||this.state.activeMsg!==e?this.onNext:null,n=this.mediaMsgs.head(),i=this.mediaMsgs.hasMediaBefore||this.state.activeMsg!==n?this.onPrev:null,o=this.getThumbs(),a=m.supportsFeature(m.F.MEDIA_GALLERY)?this.onScroll:null;return r.createElement("div",{className:this.state.imgZoomed?"img-zoomed-in":null},r.createElement("div",{className:"media-collection media-viewer-thumbs-container",ref:"thumbsContainer"},r.createElement("div",{onScroll:a,style:{width:"100%"},dir:"ltr"},r.createElement(y,{className:"media-viewer-thumbs",ref:"thumbs",transitionName:"thumb-scale"},o))),r.createElement(d,{msg:this.state.activeMsg,onBack:this.endFlow,onExitAnimation:this.willEndFlow,onNext:t,onPrev:i,onImgZoomIn:this.onImgZoomIn,getZoomNode:this.props.getZoomNode,zoomIn:this.zoomIn}))}});e.exports=E},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(6),s=n(1),c=n(421),l=n(423),u=n(200),d=n(79),p=n(45),h=n(10),f=n(101),m=n(14),g=n(413),v=n(64).ActionToast,y=n(64).ActionType,_=d.extend({props:{id:"string",isAdmin:"boolean"},children:{contact:u},initialize:function(){this.contact=Store.Contact.gadd({id:this.id}),this.listenTo(this.contact,"all",this._getEventBubblingHandler("contact"))}}),E=c.extend(l,{model:_,comparator:function(e,t){return u.Comparator(e.contact,t.contact)},initialize:function(){this.listenTo(this,"change:contact.name",this.sort),this.listenTo(h,"locale_change",this.sort)},addParticipant:function(e,t){var n=this;if(this.get(e.id))return h.openToast(a.createElement(g,{id:g.genId(),msg:l10n.t("action_participant_failed_already_added",{participant:e.formattedShortName})})),o["default"].reject(new m.ActionError);if(!this.canAdd())return o["default"].reject(new m.ActionError);var r=p.addParticipant(this.parent.id,e.id),i=new y(l10n.t("action_participant_adding",{participant:e.formattedShortName}));t=t||v.genId();var c=r.then(function(t){return 200===t.status?new y(l10n.t("action_participant_added",{participant:e.formattedShortName})):404===t.status?new y(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new y(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new y(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(r){return s.error("models:groupMetadata:participantCollection:addParticipant dropped")(r),new y(l10n.t("action_participant_add_failed"),l10n.t("action_try_again"),n.addParticipant.bind(n,e,t))});return h.openToast(a.createElement(v,{id:t,initialAction:i,pendingAction:c})),r},removeParticipant:function(e,t){var n=this;if(!this.canRemove(e))return o["default"].reject(new m.ActionError);var r=p.removeParticipant(this.parent.id,e.id),i=new y(l10n.t("action_participant_removing",{participant:e.contact.formattedShortName}));t=t||v.genId();var c=r.then(function(t){return 200===t.status?new y(l10n.t("action_participant_removed",{participant:e.contact.formattedShortName})):404===t.status?new y(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new y(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new y(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(r){return s.error("models:groupMetadata:participantCollection:removeParticipant dropped")(r),new y(l10n.t("action_participant_remove_failed"),l10n.t("action_try_again"),n.removeParticipant.bind(n,e,t))});return h.openToast(a.createElement(v,{id:t,initialAction:i,pendingAction:c})),r},promoteParticipant:function(e,t){var n=this;if(!this.canPromote(e))return o["default"].reject(new m.ActionError);var r=p.promoteParticipant(this.parent.id,e.id),i=new y(l10n.t("action_participant_promoting",{participant:e.contact.formattedShortName}));t=t||v.genId();var c=r.then(function(t){return 200===t.status?new y(l10n.t("action_participant_promoted",{participant:e.contact.formattedShortName})):404===t.status?new y(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new y(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new y(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(r){return s.error("models:groupMetadata:participantCollection:removeParticipant dropped")(r),new y(l10n.t("action_participant_promote_failed"),l10n.t("action_try_again"),n.promoteParticipant.bind(n,e,t))});return h.openToast(a.createElement(v,{id:t,initialAction:i,pendingAction:c})),r},canAdd:function(){return!!f.supportsFeature(f.F.GROUP_ADD_PARTICIPANT)&&!!this.iAmAdmin()},canPromote:function(e){return!!f.supportsFeature(f.F.GROUP_PROMOTE_PARTICIPANT)&&(!!e&&(Store.Conn.me!==e.id&&(!!this.iAmAdmin()&&!e.isAdmin)))},canRemove:function(e){return!!f.supportsFeature(f.F.GROUP_REMOVE_PARTICIPANT)&&(!!e&&(Store.Conn.me!==e.id&&!!this.iAmAdmin()))},canVerifyIdentity:function(e){return!!f.supportsFeature(f.F.QUERY_IDENTITY)&&(!!e&&(Store.Conn.me!==e.id&&!!e.contact.plaintextDisabled))},iAmMember:function(){return 1===this.where({id:Store.Conn.me}).length},iAmAdmin:function(){return 1===this.where({id:Store.Conn.me,isAdmin:!0}).length}}),b=d.extend({Collection:"GroupMetadata",props:{id:"string",creation:"number",owner:"string"},session:{stale:["boolean",!1,!0],trusted:["boolean",!1,!0]},collections:{participants:E},"delete":function(){d.prototype["delete"].call(this),Store.GroupMetadata.remove(this.id),this.participants.invokeMap("delete"),this.participants.stopListening(),this.participants.reset()},canSetSubject:function(){return!!f.supportsFeature(f.F.GROUP_SET_SUBJECT)&&!!this.participants.iAmMember()},initialize:function(){this.listenTo(this.participants,"change:isAdmin change:contact.isMyContact sort remove reset",this.isTrusted),this.listenTo(this,"change:owner",this.isTrusted),this.isTrusted(),this.listenTo(this.participants,"add remove reset",this.onParticipantChange)},isTrusted:function(){if(this.stale)return this.trusted;if(!this.owner)return this.trusted=!1;if(this.owner===Store.Conn.me)return this.trusted=!0;var e=Store.Contact.get(this.owner);if(e&&e.isMyContact)return this.trusted=!0;for(var t=this.participants.models,n=0,r=t.length;n<r;++n){var i=t[n];if(i.isAdmin&&i.id!==Store.Conn.me&&i.contact.isMyContact)return this.trusted=!0}return this.trusted=!1},onParticipantChange:function(){Store.Contact.get(this.id).unset("_capabilities"),Store.GroupMetadata.trigger("group_participant_change",this.id)}});e.exports=b},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(8),s=n(1),c=n(21),l=n(79),u=n(421),d=n(45),p=n(196),h=1500,f=2e3,m=l.extend({props:{id:"string",type:{type:"string",values:["available","unavailable","composing","recording"]},t:{type:"number",allowNull:!0},deny:"boolean"},session:{updateTime:"number",_expireTimerId:0}}),g=u.extend({model:m}),v=l.extend({Collection:"Presence",props:{id:"string"},session:{isOnline:"boolean",stale:["boolean",!1,!0],hasData:["boolean",!1,!1],isSubscribed:["boolean",!1,!1],withholdDisplay:["boolean",!1,!0],forceDisplay:["boolean",!1,!1],chatActive:["boolean",!1,!1],withholdDisplayTimer:"number",forceDisplayTimer:"number"},children:{chatstate:m},collections:{chatstates:g},derived:{isGroup:{fn:function(){return c.isGroup(this.id)}},isUser:{fn:function(){return c.isUser(this.id)}}},initialize:function(){this.isGroup?(this.chatstate.set({id:"",type:"unavailable"}),this.listenTo(this.chatstates,"add change",_.debounce(function(){var e,t=!1;this.chatstates.forEach(function(n){"composing"!==n.type&&"recording"!==n.type||e&&!(e.updateTime<n.updateTime)||(e=n),t=t||"unavailable"!==n.type}),this.set({isOnline:t,chatstate:{id:e?e.id:"",type:e?e.type:"unavailable"}})}))):(this.chatstate.set({id:this.id}),this.listenTo(this.chatstate,"change:type",function(){this.isOnline="unavailable"!==this.chatstate.type})),this.listenTo(this,"change:chatActive",this.onChatActiveChange)},"delete":function(){l.prototype["delete"].call(this),Store.Presence.remove(this.id),this.chatstate["delete"](),this.chatstates.forEach(function(e){e["delete"]()})},handle:function(e){"undefined"==typeof e.type?e.type=this.chatstate.type||"unavailable":"paused"===e.type&&(e.type="available"),this.isGroup&&"available"!==e.type&&(e.updateTime=Date.now());var t;if(this.isGroup){if(e.id=e.participant,e.participant=void 0,!e.id)return;t=this.chatstates.add(e,{merge:!0})}else t=this.chatstate.set(e);t._expireTimerId&&clearTimeout(t._expireTimerId),"composing"===t.type||"recording"===t.type?t._expireTimerId=_.delay(this._expireComposing,a.PRESENCE_COMPOSING_TIMEOUT,t):t._expireTimerId=0;var n=this.forceDisplay||this.isOnline||this.isUser&&!this.chatstate.deny;this.set({hasData:!0,forceDisplay:n})},_expireComposing:function(e){var t=e.type;"composing"===t||"recording"===t?e.type="available":s.error("models:presence:expireComposing "+t)()},reset:function(){this.hasData=!1,this.isGroup?this.chatstates.forEach(function(e){e.type="unavailable"}):this.isUser&&(this.chatstate.unset("t"),this.chatstate.unset("deny")),this.chatstate.set({id:this.isGroup?"":this.id,type:"unavailable",t:void 0,deny:void 0})},isActive:function(){var e=this.chatstate.type;return this.hasData&&("composing"===e||"recording"===e)},getFormattedString:function(){if(!this.hasData)return null;if(this.isGroup){var e=this.chatstate.id;if(!e)return null;var t=Store.Contact.get(e);if(!t)return null;var n=t.formattedShortName;return"composing"===this.chatstate.type?l10n.t("web_conversation_name_is_composing",{participant:n}):l10n.t("web_conversation_name_is_recording",{participant:n})}if(!this.isUser)return null;var r=this.chatstate;switch(r.type){case"available":return l10n.t("web_conversation_contact_online");case"composing":return l10n.t("web_conversation_is_composing");case"recording":return l10n.t("web_conversation_is_recording");case"unavailable":return r.deny||!r.t?null:p.lastSeenStr(r.t)}},onChatActiveChange:function(){var e=this.chatActive;e?(this.hasData?this.withholdDisplay=!1:this.withholdDisplayTimer=_.delay(function(e){e.set({withholdDisplay:!1,withholdDisplayTimer:0})},h,this),this.forceDisplayTimer=_.delay(function(e){e.set({forceDisplay:!0,forceDisplayTimer:0})},f,this)):(this.withholdDisplayTimer&&(clearTimeout(this.withholdDisplayTimer),this.withholdDisplayTimer=0),this.forceDisplayTimer&&(clearTimeout(this.forceDisplayTimer),this.forceDisplayTimer=0))},subscribe:function(){return this.isSubscribed?o["default"].resolve():this.isUser?this.update():this.isGroup?(this.isSubscribed=!0,o["default"].all([this.update(),d.presenceSubscribe(this.id)]).bind(this)["catch"](function(e){return this.isSubscribed=!1,o["default"].reject(e)})):o["default"].resolve()}});e.exports=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(6),s=n(10),c=n(14),l=n(1e3),u=n(1),d={start:function(e){var t=this;if("camera"!==e&&"microphone"!==e)return void u.error("mediaCapture:start incompatible type given")();var n=new o["default"](function(r,i){t.timeout=setTimeout(function(){var t="camera"===e?"guide_desktop_camera_title":"guide_desktop_mic_title",n="camera"===e?"guide_desktop_camera_description":"guide_desktop_mic_description";s.openModal(a.createElement(l,{title:t,desc:n,type:l.TYPE.GUIDE_ALLOW}))},1e3);var o="camera"===e?{video:!0}:{audio:!0};navigator.getUserMedia(o,function(e){s.closeModal(),clearTimeout(t.timeout),r(e)},function(e){var r=_.isString(e)?e:e.name,o=c.GUM[r]||c.GUM.GUMError;clearTimeout(t.timeout),i(new o),n&&!n.isPending()&&s.closeModal()})});return n},stop:function(e){if(_.isFunction(e.stop))e.stop();else for(var t=e.getTracks(),n=0;n<t.length;n++)t[n].stop()}};e.exports=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(53),o=r(i),a=n(44),s=r(a),c=n(52),l=r(c),u=n(199),d=r(u),p=n(198),h=r(p),f=n(996),m=function(e){function t(e,n,r){(0,s["default"])(this,t);var i=(0,d["default"])(this,(0,o["default"])(t).call(this));return i._delimiter=e,i._regex=n,i._group=r,i}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"match",value:function n(e){for(var t=[],n=void 0;n=this._regex.exec(e);){var r=this._delimiter.length,i=2*r+n[this._group].length;if(n[0].length!==i){var o=n[0].length-i;n.index+=o,n[0]=n[0].slice(o)}this._regex.lastIndex--,t.push(n)}return t}},{key:"group",get:function(){return this._group}},{key:"isFormatter",get:function(){return!0}}]),t}(f);e.exports=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(53),o=r(i),a=n(44),s=r(a),c=n(52),l=r(c),u=n(199),d=r(u),p=n(198),h=r(p),f=n(1018),m=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).call(this,"```",/```([\s\S]+?)```/g,1))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"formatResult",get:function(){return!1}}]),t}(f);e.exports=m},function(e,t,n){"use strict";var r=n(430),i={multibyteLength:function(e){return r.ucs2.decode(e).length},multibyteSubstr:function(e,t,n){var i=r.ucs2.decode(e);if("undefined"==typeof n)i=i.slice(t);else{if(n<=0)return"";i=i.slice(t,t+n)}return r.ucs2.encode(i)}};e.exports=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n,r){this.type=e,this.index=t,this.value=r,this.properties=n}function o(e,t,n){e[t]||(e[t]=[]),e[t].push(n)}function a(e){var t={};return e?(e.split(";").forEach(function(e){var n=e.split(/=/);if(1===n.length){var r=n[0];o(t,r.toLowerCase(),!0)}else if(2===n.length){var i=(0,u["default"])(n,2),a=i[0],s=i[1];o(t,a.toLowerCase(),s.toLowerCase())}}),t):t}function s(e){if(e)return e.replace(/^_\$!<([^>]*)>!\$_$/,"$1").replace(/\\,/,",").replace(/\\;/,";").replace(/\\\\/,"\\")}function c(e){var t={};return _.forEach(e,function(e,n){t[n]=_.sortBy(e,function(e){return e.index})}),t}var l=n(417),u=r(l),d=n(0),p=/X-([^;:]+)(?:;[^:]+)*:(.+)/,h={"X-ABLabel":[/X-ABLabel(?:;([^:]+))*:(.+)/,1],ADR:[/ADR(?:;([^:]+))*:;;(.*);(.*);(.*);(.*);(.*)/,5],"X-ABADR":[/X-ABADR(?:;([^:]+))*:(.*)/,1],URL:[/URL(?:;([^:]+))*:(.*)/,1],EMAIL:[/EMAIL(?:;([^:]+))*:(.+)/,1],TEL:[/TEL(?:;([^:]+))*:(.+)/,1]},f={N:[/N(?:;([^:]+))*:([^;]*);([^;]*);([^;]*);([^;]*);(.*)/,5],FN:[/FN(?:;([^:]+))*:(.*)/,1],NICKNAME:[/NICKNAME(?:;([^:]+))*:(.*)/,1],"X-PHONETIC-FIRST-NAME":[/X-PHONETIC-FIRST-NAME(?:;([^:]+))*:(.*)/,1],"X-PHONETIC-LAST-NAME":[/X-PHONETIC-LAST-NAME(?:;([^:]+))*:(.*)/,1],ORG:[/ORG(?:;([^:]+))*:([^;]*)(?:;(.*))*/,2],TITLE:[/TITLE(?:;([^:]+))*:(.*)/,1],TEL:[/TEL(?:;([^:]+))*:(.*)/,1],PHOTO:[/PHOTO(?:;([^:]+))*:(.*)/,1],BDAY:[/BDAY(?:;([^:]+))*:(.*)/,1],URL:[/URL(?:;([^:]+))*:(.+)/,1],EMAIL:[/EMAIL(?:;([^:]+))*:(.+)/,1]},m={getDate:function(e){var t=[/-([^-]*)-([^-]*)-([^-]*)/,/([^-]*)-([^-]*)-([^-]*)/],n=e;return _.forEach(t,function(t){var r=e.match(t);if(r){var i=!r[1].length||"1604"===r[1],o=i?"0000":r[1];return n=d(o+"-"+r[2]+"-"+r[3]).format("l"),i&&(n=n.replace(/[.,-\/\s]*0000[.,-\/\s]*/,"")),!1}}),n},getType:function(e){var t={jabber:l10n.t("vcard_jabber"),"skype-username":l10n.t("vcard_skype"),skype:l10n.t("vcard_skype"),msn:l10n.t("vcard_msn"),aim:l10n.t("vcard_aim"),yahoo:l10n.t("vcard_yahoo"),icq:l10n.t("vcard_icq")},n=e.properties["X-ABLabel"]||t[e.type.toLowerCase()];if(n)return s(n);var r={TEL:[[["cell"],l10n.t("vcard_cell")],[["iphone"],l10n.t("vcard_iphone")],[["main"],l10n.t("vcard_main")],[["home","fax"],l10n.t("vcard_home_fax")],[["work","fax"],l10n.t("vcard_work_fax")],[["home"],l10n.t("vcard_home")],[["work"],l10n.t("vcard_work")],[["pager"],l10n.t("vcard_pager")],[[],l10n.t("vcard_home")]],EMAIL:[[["home"],l10n.t("vcard_home")],[["work"],l10n.t("vcard_work")],[["internet"],l10n.t("vcard_email")]],URL:[[["home"],l10n.t("vcard_home")],[["work"],l10n.t("vcard_work")]],ADR:[[["home"],l10n.t("vcard_home")],[["work"],l10n.t("vcard_work")]]};return n=e.type,_.forEach(r[e.type],function(t){if(t){var r=(0,u["default"])(t,2),i=r[0],o=r[1];if(0===_.difference(i,_.map(e.properties.type,function(e){return e.toLowerCase()})).length)return n=o,!1}}),n},parse:function(e){e=e.replace(/\n^[ \t]/gm,"");var t=e.split(/\n/),n={},r={};if("BEGIN:VCARD"===t[0]&&"VERSION:3.0"===t[1]&&"END:VCARD"===_.last(t)){for(var s=2;s<t.length-1;s++){var l=t[s],d=l.match(/item(\d+)\.(.*)/),m=d?d[2]:l,g=m.match(/([^:;]*)[:;].*/)[1],v=d?h:f,y=g,E=g,b=void 0,S=void 0;if(v[y]){var M=(0,u["default"])(v[y],2),T=M[0],C=M[1],w=m.match(T);w&&(b=a(w[1]),S=1===C?S=w[2]:w.slice(2,2+C))}else{var x=m.match(p);x&&(E="SERVICE",y=x[1],S=x[2],b={})}if(S)if(d){var N=d[1];r[N]?r[N].fields.push(new i(y,null,b,S)):r[N]={type:y,index:s,key:E,properties:b,value:S,fields:[]}}else o(n,E,new i(y,s,b,S))}return _.forEach(_.keys(r),function(e){var t=r[e],a=t.key,s=t.index,c=t.type,l=t.value,u=t.properties,d=t.fields;_.forEach(d,function(e){u[e.type]=e.value}),o(n,a,new i(c,s,u,l))}),c(n)}},vCardSerialize:function(e){return e.map(function(e){return e.line.replace(/(.{75,75})/g,"$1\n ").replace(/\n^-$/gm,"")}).join("\n")},thumbnail:function(e){if(e){e=e.replace(/\n^ /gm,"");var t=e.match(/^PHOTO;(BASE64|ENCODING=b;TYPE=image\/jpeg):(.*)$/m);return t?t[2]:void 0}},getName:function(e){var t=_.filter(e.formattedName.split(e.formattedShortName)),n=t.length?_.trim(t[0]):void 0,r=n?e.formattedShortName:e.formattedName;return this.cleanValue(n)+";"+this.cleanValue(r)+";;;"},cleanValue:function(e){return e?e.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,"):""}};e.exports=m},function(e,t,n){"use strict";var r=n(6),i=n(43),o=n(201).MIMETYPES,a=_.pickBy(o,function(e){return"document"===e.msgType}),s=r.createClass({displayName:"AttachMediaTypeFile",propTypes:{mimeType:r.PropTypes.string,filename:r.PropTypes.string},render:function(){var e=this.props,t=e.mimeType,n=e.filename,o="icon-doc";return a[t]&&(o=i(o,a[t].icon)),r.createElement("div",{className:"media-element-container"},r.createElement("div",{className:"media-element"},r.createElement("div",{className:"media-document"},r.createElement("div",{className:o}),r.createElement("div",{className:"media-document-text"},n))))}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(974),o=n(975),a=n(43),s=r.createClass({displayName:"MsgAck",mixins:[o],propTypes:{msg:r.PropTypes.instanceOf(i)},getInitialState:function(){return{ack:this.async("msg.ack")}},render:function(){var e=this.props.msg.ack,t=a("icon",{"icon-status-time":e<1,"icon-status-check":1===e,"icon-status-dblcheck":2===e,"icon-status-dblcheck-ack":e>2});return r.createElement("span",{className:t})}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(130),o=n(43),a=r.createClass({displayName:"CheckBox",mixins:[i],propTypes:{checked:r.PropTypes.bool.isRequired,onChange:r.PropTypes.func.isRequired,disabled:r.PropTypes.bool},onToggle:function(e){e&&e.stopPropagation(),this.props.onChange()},render:function(){var e=o("checkbox",{checked:this.props.checked,unchecked:!this.props.checked,disabled:this.props.disabled});return r.createElement("div",{className:"checkbox-container",onClick:this.onToggle},r.createElement("div",{className:e,ref:"checkbox"},r.createElement("div",{className:"checkmark"})))}});e.exports=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(6),s=n(1),c=n(983),l=n(1124),u=n(1031),d=n(994),p=n(997),h=n(993),f=n(416),m=n(1120),g=n(132),v=n(410),y=n(197),E=n(999),b=n(10),S=n(8),M=n(43),T=n(102),C=200,w=1.3,x=2,N={GROUP:"group",PROFILE:"profile",NO_EDIT:"no_edit"},P=a.createClass({displayName:"PhotoPicker",propTypes:{startImage:a.PropTypes.string,type:a.PropTypes.oneOf(_.values(N)).isRequired,id:a.PropTypes.string,pending:a.PropTypes.bool,onImageSet:a.PropTypes.func.isRequired},statics:{Type:N},getInitialState:function(){return{img:this.props.startImage,imgCanvas:null,left:0,top:0,isEditing:!1,hover:!1,contextMenu:!1}},componentWillReceiveProps:function(e){this.props.startImage!==e.startImage&&this.setState({img:e.startImage,imgCanvas:null,isEditing:!1,left:0,top:0})},cropImage:function(){if(!this.state.img)return o["default"].reject("Image missing from state");var e=this.state.imgCanvas||this.state.img,t=this.state.scale,n=Math.abs(this.state.left/t),r=Math.abs(this.state.top/t),i=C/t,a=i;i>S.MAX_PIC_SIDE?a=S.MAX_PIC_SIDE:i<S.MIN_PIC_SIDE&&(a=S.MIN_PIC_SIDE);var s;return new o["default"](function(t,o){h.crop(e,n,r,i,i,a,a,h.DATA_URL|h.CANVAS).then(function(e){var t=e.images;return s=t.dataUrl,h.crop(t.canvas,0,0,S.PROF_PIC_THUMB_SIDE,S.PROF_PIC_THUMB_SIDE,h.DATA_URL)}).then(function(e){var n=e.images;t({thumb:n.dataUrl,full:s})})["catch"](o)})},onZoomIn:function(){var e=this.state.scale*w;x<=e||this.setState({scale:e})},onZoomOut:function(){var e=this.state.scale/w;this.state.minScale>=e&&(e=this.state.minScale),this.setState({scale:e})},onCrop:function(){this.props.pending||this.cropImage().bind(this).then(function(e){this.props.onImageSet(e.thumb,e.full)})["catch"](function(){this.setState({img:this.props.startImage,imgCanvas:null,isEditing:!1})})},onDragEnd:function(e,t){this.setState({left:e,top:t})},onUpload:function(e){var t=this.refs.imageInput;return t.click(),!0},removeImage:function(){this.props.onImageSet(),b.closeModal()},onRemove:function(e){var t=this.props.type===N.GROUP?l10n.t("remove_group_icon"):l10n.t("remove_profile_photo");b.openModal(a.createElement(v,{onOK:this.removeImage,okText:l10n.t("remove"),onCancel:b.closeModal.bind(b),cancelText:l10n.t("web_cancel")},t))},onView:function(){var e=this.refs.imageContainer,t=function(t){t(e)};b.openModalMedia(a.createElement(u,{contact:Store.Contact.get(this.props.id),animateBorderRadius:!0,getZoomNode:t}),"profile-viewer")},onImageTake:function(e){this.createAndSetImage(e)},onImagePick:function(e){this.contextClose();var t=e.target.files[0];return!!t&&(this.createAndSetImage(t),void(e.target.value=""))},createAndSetImage:function(e){var t=this;h.rotateAndResize(e,3*S.IMG_MAX_EDGE,3*S.IMG_MAX_EDGE,h.DATA_URL|h.CANVAS).then(function(e){var n=e.width,r=e.height,i=e.images,o=C/Math.min(n,r);t.setState({img:i.dataUrl,imgCanvas:i.canvas,isEditing:!0,scale:o,minScale:o})})["catch"](function(e){s.error("PhotoPicker:createAndSetImage:error "+e)(e)})},onImageClick:function(e){if(this.props.type===N.NO_EDIT&&this.state.img)return void this.onView();if(!this.state.isEditing){e.stopPropagation(),e.preventDefault();var t=[];this.props.id&&this.state.img&&t.push(a.createElement(c,{key:"view",action:this.onView},l10n.t("view_photo"))),navigator.getUserMedia&&t.push(a.createElement(l,{key:"take",onImageTake:this.onImageTake})),t.push(a.createElement(c,{key:"upload",action:this.onUpload},l10n.t("upload_photo"))),this.state.img&&t.push(a.createElement(c,{key:"remove",action:this.onRemove},l10n.t("remove_photo"))),e.persist(),this.setState({contextMenu:{menu:t,event:e}})}},contextClose:function(){this.setState({contextMenu:!1})},onMouseOver:function(e){this.state.hover||this.setState({hover:!0})},onMouseEnter:function(e){this.state.hover||this.setState({hover:!0})},onMouseLeave:function(e){this.state.hover&&this.setState({hover:!1})},onLoad:function(e){var t=e.target.clientWidth,n=e.target.clientHeight;this.setState({imageSize:{width:t,height:n}})},render:function(){var e;if(this.state.img&&this.state.isEditing){var t={width:C,height:C};e=a.createElement(m,{ref:"img",container:t,onStop:this.onDragEnd,scale:this.state.scale},a.createElement("img",{className:"avatar-original",src:this.state.img}))}else this.state.img&&(e=a.createElement(d,{type:d.TYPES.COVER,size:this.state.imageSize},a.createElement(p,{src:this.state.img,crossOrigin:!1,style:{height:"100%",width:"100%"},onLoad:this.onLoad})));var n;(this.props.pending||!this.state.isEditing&&this.state.img&&!this.state.imageSize)&&(n=a.createElement("div",{className:"avatar-spinner-container"},a.createElement(g,{size:50,stroke:3})));var r=null;if(!this.props.pending&&this.props.type!==N.NO_EDIT&&(!this.state.img||this.state.imageSize)&&(!this.state.img||this.state.contextMenu||!this.state.isEditing&&this.state.hover)){var i;switch(this.props.type){case"group":i=this.state.img?l10n.t("change_group_icon"):l10n.t("add_group_icon");break;case"profile":i=this.state.img?l10n.t("change_profile_photo"):l10n.t("add_profile_photo");
}r=a.createElement("div",{className:"avatar-overlay",key:"avatar-overlay"},a.createElement("span",{className:"icon icon-camera-light"}),a.createElement("div",{"data-a8n":f.key("avatar-text"),className:"avatar-overlay-text"},i))}var o,s,c=M("avatar","avatar-l","draggable-container",{"icon-group-default":this.props.type!==N.PROFILE,"icon-user-default":this.props.type===N.PROFILE});this.state.isEditing&&(o=a.createElement("div",{className:"avatar-picker-controls",key:"zoom-controls"},a.createElement("button",{className:"icon icon-plus",onClick:this.onZoomIn}),a.createElement("button",{className:"icon icon-minus",onClick:this.onZoomOut})),s=a.createElement("div",{className:"tip-container tip-avatar-picker",key:"tip-controls"},a.createElement("div",{className:"tip"},a.createElement("div",{className:"tip-body"},l10n.t("adjust_image")),a.createElement("div",{className:"tip-controls"},a.createElement("button",{className:"button",onClick:this.onCrop},l10n.t("done_adjusting"))))));var l=this.props.type===N.NO_EDIT||this.props.pending||!this.state.imageSize&&this.state.img?_.noop:this.onImageClick,u=void 0;return this.state.contextMenu&&(u=a.createElement(y,{displayName:"PhotoPickerContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},a.createElement(E,{contextMenu:this.state.contextMenu}))),a.createElement("div",{className:"avatar-picker"},a.createElement("div",{className:c,onClick:l,onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,ref:"imageContainer",dir:"ltr"},e,a.createElement(T,{transitionName:"fade"},n,r)),a.createElement(T,{transitionName:"fade"},o),a.createElement(T,{transitionName:"slide"},s),a.createElement("input",{ref:"imageInput",type:"file",accept:"image/gif,image/jpeg,image/jpg,image/png",style:{display:"none"},onChange:this.onImagePick}),u)}});e.exports=P},function(e,t,n){"use strict";var r=n(6),i=r.createClass({displayName:"SectionHeader",propTypes:{header:r.PropTypes.string.isRequired},render:function(){return r.createElement("div",{className:"list-title"},this.props.header)}});e.exports=i},function(e,t,n){"use strict";var r=n(6),i=n(976),o=n(1067),a=n(974),s=r.createClass({displayName:"Caption",propTypes:{msg:r.PropTypes.instanceOf(a).isRequired},render:function(){var e=this.props.msg,t=e.mentionMap();return r.createElement("div",{className:"image-caption message-text","data-id":e.id},r.createElement(o,{msg:e}),r.createElement(i,{direction:e.dir,dirMismatch:!(!e.dir||e.rtl===l10n.isRTL()),selectable:!0,text:e.caption,linkify:!0,mention:t,format:!0,wbr:15}))}});e.exports=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(883),s=r(a),c=n(6),l=n(991),u=n(410),d=n(1168),p=n(974),h=n(10),f=n(14),m=n(976),g=c.createClass({displayName:"ForwardMessageFlow",mixins:[l],propTypes:{msgs:c.PropTypes.arrayOf(c.PropTypes.instanceOf(p)).isRequired,onFoward:c.PropTypes.func},getDefaultTransition:function(){var e;return e={},(0,s["default"])(e,l.Dir.PUSH,l.Transition.NONE),(0,s["default"])(e,l.Dir.POP,l.Transition.NONE),e},componentWillMount:function(){var e=this;this.push(c.createElement(d,{onChat:this.confirmForward,selectedTab:this.selectedTab,onSelectTab:function(t){e.selectedTab=t},title:l10n.t("forward_message_to")}))},checkCanSend:function(e){var t={};return o["default"].map(this.props.msgs,function(n){var r=void 0;if(n.isMMS){var i=n.type;r=t[i]?t[i]:t[i]=e.shouldSendEncrypted(i).then(function(){return!0})["catch"](function(){return!1})}else r=!0;return o["default"].props({msg:n,canSend:r})})},confirmForward:function(e){var t,n=!1;e.isGroup?t=l10n.t("confirm_forward_to_group",{chat:e.formattedTitle}):e.isUser&&e.contact.isBlocked()?(t=l10n.t("confirm_unblock_contact_and_forward",{chat:e.formattedTitle}),n=!0):t=l10n.t("confirm_forward_to_contact",{chat:e.formattedTitle}),this.push(c.createElement(u,{onOK:_.partial(this.onForwardConfirmed,e,n),okText:l10n.t("web_ok"),onCancel:this.pop.bind(null,void 0),key:"ConfirmPopup",cancelText:l10n.t("web_cancel")},c.createElement(m,{text:t})))},onForwardConfirmed:function(e,t){var n,r=this,i=Date.now();n=t?e.contact.setBlock(!1):o["default"].resolve(!0),o["default"].all([this.checkCanSend(e),n]).spread(function(t,n){var r=_.map(_.filter(t,{canSend:!0}),"msg"),i=_.map(_.filter(t,{canSend:!1}),"msg");return o["default"].props({undelivered:e.forwardMessages(r),canSend:r,cannotSend:i})}).then(function(t){var n=t.undelivered,o=t.canSend,a=t.cannotSend;(n.length||a.length)&&r.showMediaSendError(e,o,a,n,i)})["catch"](f.ContactBlocked,function(){r.showContactBlocked(e,i)}),this.endFlow(),_.isFunction(this.props.onForward)&&this.props.onForward(this.props.msgs),h.openChat(e)},showContactBlocked:function(e,t){var n=Date.now()-t>1e3&&void 0;h.openModal(c.createElement(u,{key:"contactBlocked",onOK:h.closeModal.bind(h)},l10n.t("web_cannot_send_to_blocked_contact_1",{contact:e.contact.formattedName})),n)},showMediaSendError:function(e,t,n,r,i){var o=t.length-r.length,a=[];if(o){a.push(l10n.t("forwarded_some_messages",{count:o,_plural:o}));var s=void 0,l=n.length+r.length;s=r.length?n.length?e.isUser?l10n.t("cannot_forward_media_missing_and_capability_contact",{count:l,_plural:l,contact:e.formattedTitle}):l10n.t("cannot_forward_media_missing_and_capability_group",{count:l,_plural:l}):l10n.t("cannot_forward_media_missing",{count:l,_plural:l}):e.isUser?l10n.t("cannot_forward_capability_contact",{count:l,_plural:l,contact:e.formattedTitle}):l10n.t("cannot_forward_capability_group",{count:l,_plural:l}),s&&a.push(s)}else{var d=void 0;d=r.length?n.length?e.isUser?l10n.t("cannot_forward_media_missing_and_capability_contact_none",{contact:e.formattedTitle}):l10n.t("cannot_forward_media_missing_and_capability_group_none"):l10n.t("cannot_forward_media_missing_none"):e.isUser?l10n.t("cannot_forward_capability_contact_none",{contact:e.formattedTitle}):l10n.t("cannot_forward_capability_group_none"),d&&a.push(d)}h.openModal(c.createElement(u,{onOK:h.closeModal.bind(h),okText:l10n.t("web_ok")},a.map(function(e,t){return c.createElement("p",{key:t},e)})),!1)},showMediaSendError2:function(e,t,n){var r,i;if(1===e.length){var o=e[0].type;switch(o){case p.TYPE.VIDEO:r=l10n.t("missing_video_title"),i=l10n.t("missing_video_forward_text");break;case p.TYPE.AUDIO:case p.TYPE.PTT:r=l10n.t("missing_audio_title"),i=l10n.t("missing_audio_forward_text");break;case p.TYPE.IMAGE:r=l10n.t("missing_photo_title"),i=l10n.t("missing_photo_forward_text");break;case p.TYPE.DOCUMENT:r=l10n.t("missing_document_title"),i=l10n.t("missing_document_forward_text")}}else r=l10n.t("missing_media_title"),i=l10n.t("missing_media_forward_text",{count:e.length,_plural:e.length});var a=Date.now()-n>1e3&&void 0;h.openModal(c.createElement(u,{title:r,onOK:h.closeModal.bind(h),okText:l10n.t("web_ok")},i),a)}});e.exports=g},function(e,t,n){"use strict";var r=n(6),i=n(1081),o=n(987),a=n(200),s=n(992),c=n(1026),l=n(990),u=n(129),d=n(43),p=r.createClass({displayName:"ContactsModal",mixins:[u],propTypes:{title:r.PropTypes.string.isRequired,contacts:r.PropTypes.arrayOf(r.PropTypes.instanceOf(a)),filter:r.PropTypes.func,onCancel:r.PropTypes.func.isRequired,onSelect:r.PropTypes.func.isRequired},getDefaultProps:function(){return{filter:function(e){return Store.Contact.isFilteredContact(e)}}},getInitialState:function(){return this.selection=new o([],function(e){return e.id}),{searchFilter:void 0}},componentWillMount:function(){this.props.contacts||this.addObserver(Store.Contact,"add remove change:name")},onSelect:function(e,t){var n=t.props.contact;this.props.filter(n)===!0&&this.props.onSelect(n)},onSearch:function(e){this.setState({searchFilter:e})},render:function(){var e=this.props,t=e.title,n=e.onCancel,o=e.filter,a=e.onSelect,u=l10n.accentFold(this.state.searchFilter),p=this.props.contacts||Store.Contact,h=p.filter(function(e){return o(e)&&(!u||u&&e.searchMatch(u))}),f=[];if(h.length){this.selection.init(h.filter(function(e){return o(e)===!0}));for(var m=void 0,g=void 0,v=h.length>10,y=0;y<h.length;y++){m=h[y],v&&m.header!==g&&f.push(r.createElement(c,{key:m.header,header:m.header}));var E=_.isString(o(m)),b=void 0;y<h.length-1&&h[y+1].header!==m.header&&(b="last");var S=void 0;E&&(S=r.createElement("div",{className:"chat-status ellipsify",title:o(m)},o(m)),b=d(b,"member")),f.push(r.createElement(s,{contact:m,active:this.selection,className:b,secondary:S,onClick:E?void 0:_.once(a.bind(null,m)),key:m.id})),g=m.header}}else f=r.createElement(l.SearchContacts,null);return r.createElement(i,{title:t,selection:this.selection,onSearch:this.onSearch,searchPlaceholder:l10n.t("search_contacts"),onSelect:this.onSelect,onCancel:n},f)}});e.exports=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(883),o=r(i),a=n(6),s=n(43),c=a.createClass({displayName:"Modal",propTypes:{type:a.PropTypes.oneOf(["compact","box","tower"]),classes:a.PropTypes.string,title:a.PropTypes.string,children:a.PropTypes.node.isRequired},getDefaultProps:function(){return{classes:"",type:"compact"}},statics:{COMPACT:"compact",BOX:"box",TOWER:"tower"},render:function(){var e=this.props.title?a.createElement("div",{className:"popup-title",dir:"auto"},this.props.title):null,t=s("popup",this.props.classes,(0,o["default"])({},"popup-"+this.props.type,this.props.type!==c.COMPACT));return a.createElement("div",{className:"backdrop"},a.createElement("div",{className:"popup-container"},a.createElement("div",{className:t},a.createElement("div",{className:"popup-body"},e,a.createElement("div",{className:"popup-contents"},this.props.children)))))}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(997),o=n(982),a=n(976),s=n(994),c=n(200),l=n(10),u=n(975),d=n(43),p=n(197),h=500,f=r.createClass({displayName:"PhotoViewerModal",mixins:[u],propTypes:{contact:r.PropTypes.instanceOf(c),imgFull:r.PropTypes.string,animateBorderRadius:r.PropTypes.bool,getZoomNode:r.PropTypes.func.isRequired},getInitialState:function(){return{formattedUser:this.async("contact.formattedUser"),imgFull:this.props.imgFull||this.async("contact.profilePicThumb.imgFull"),style:{visibility:"hidden"}}},onScroll:function(e){Math.abs(e.deltaY)>3&&this.onClose()},onClose:function(){if(!this.closing){this.closing=!0;var e=void 0;if(this.props.getZoomNode(function(t){e=t}),!e)return l.closeModalMedia();var t=this.refs.image,n=t.getBoundingClientRect(),r=e.getBoundingClientRect(),i=r.top-n.top,o=r.left-n.left,a=e.clientWidth/t.clientWidth;Velocity(t,{translateX:[o,0],translateY:[i,0],scale:[a,1]},{duration:200,easing:[.1,.82,.25,1]}).then(function(){l.closeModalMedia()})}},onImageLoad:function(e){var t=this,n=e.target;this.setState({size:{width:n.naturalWidth,height:n.naturalHeight}},function(){t.props.getZoomNode(function(e){var r=n.getBoundingClientRect(),i=e.getBoundingClientRect(),o=i.top-r.top,a=i.left-r.left,s=e.clientWidth/n.clientWidth,c={visibility:"hidden",transform:"translateX("+a+"px) translateY("+o+"px) scale("+s+")",transition:"transform 0s"};t.props.animateBorderRadius&&(c.borderRadius="50%"),t.setState({style:c},function(){var e={transform:"translateX(0px) translateY(0px) scale(1)",transition:"transform "+h+"ms cubic-bezier(.1,.82,.25,1)"};t.props.animateBorderRadius&&(e={transform:"translateX(0px) translateY(0px) scale(1)",borderRadius:"0%",transition:"transform "+h+"ms cubic-bezier(.1,.82,.25,1),\n                                         border-radius "+h+"ms cubic-bezier(.1,.82,.25,1)"}),t.setState({style:e})})})})},render:function(){var e=this.props.contact,t=d("media-viewer","media-viewer-animate"),n=d("media-panel-header",{});return r.createElement(p,{displayName:"PhotoViewer",escapable:!0,requestDismiss:this.onClose},r.createElement("div",{className:t,onWheel:this.onScroll,onClick:this.onClose},r.createElement("div",{className:n},r.createElement("div",{className:"chat media-chat"},r.createElement("div",{className:"chat-avatar"},r.createElement(o,{id:e.id})),r.createElement("div",{className:"chat-body"},r.createElement("div",{className:"chat-main"},r.createElement(a,{text:this.state.formattedUser})))),r.createElement("div",{className:"menu menu-horizontal media-panel-tools"},r.createElement("div",{className:"menu-item"},r.createElement("button",{className:"icon icon-x-viewer",title:l10n.t("web_close"),onClick:this.onClose})))),r.createElement("div",{className:"media-content",dir:"ltr",ref:"container"},r.createElement("div",{className:"media"},r.createElement(s,{type:s.TYPES.SCALE_DOWN,size:this.state.size},r.createElement("div",{className:"profile-viewer",ref:"image",style:this.state.style},r.createElement(i,{src:this.state.imgFull,hasPrivacyChecks:!0,onLoad:this.onImageLoad,className:"profile-viewer-img"})))))))}});e.exports=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(44),s=r(a),c=n(52),l=r(c),u=n(201),d=n(36),p=n(1),h=n(974),f=n(196),m=n(0),g=function(){function e(){(0,s["default"])(this,e)}return(0,l["default"])(e,[{key:"getDefaultName",value:function(e){var t=u.getExtension(e.mimetype);switch(e.type){case h.TYPE.DOCUMENT:return e.caption||e.filename||l10n.t("untitled_document")+t;case h.TYPE.IMAGE:case h.TYPE.VIDEO:case h.TYPE.AUDIO:default:var n=m.unix(e.t).locale("en");return e.filename||"WhatsApp "+_.capitalize(e.type)+" "+(n.format("YYYY-MM-DD")+" at ")+(""+n.format(f.getIs24Hour()?"HH.mm.ss":"h.mm.ss A"))+t}}},{key:"getDownloadData",value:function(e){return e.isGif?this.mp4ToGif(e):o["default"].resolve({url:e.url,name:this.getDefaultName(e)})}},{key:"mp4ToGif",value:function(e){var t=this;return new o["default"](function(e,t){throw new Error("unimplemented")}).then(function(t){return{url:t,name:"WhatsApp-Image-"+m.unix(e.t).format("YYYYMMDD")+".gif"}})["catch"](function(){return{url:e.url,name:t.getDefaultName(e)}})}},{key:"initDownload",value:function(e){d.startDownloading();var t=document.createElement("a");this.getDownloadData(e).then(function(n){t.href=n.url,t.download=n.name,t.target="_blank",t.style.display="none",p.assert(n.url,"no-download-url","download "+e.id+" type "+e.type+" with state "+e.mediaState)(),document.body.appendChild(t),t.click(),document.body.removeChild(t)})}}]),e}();e.exports=new g},function(e,t,n){"use strict";function r(e){try{return L.exec(e)}catch(t){return l.assert(!1,"linkify-regex-error","text size: "+e.length+", error: "+t)(t),null}}function i(e){L.lastIndex=0;for(var t=[],n=void 0;n=r(e);)n=a(n),n&&t.push(n);return t}function o(e){return L.lastIndex=0,a(r(e))}function a(e){if(!e)return null;var t=e[w].length,n=e[0],r=e.index+t;if(e[k]){var i=parseInt(e[k].slice(1),10);if("0"===e[k][1]||!(0<i&&i<65536))return null}var o=c.find([A,O,D],function(t){return e[t]})||0;if(o){var a=[],s=e[o];"_"===s.slice(-1)&&"_"===n[r-1]&&(n=n.slice(0,-1),e[o]=s=s.slice(0,-1));for(var l=0,u=0,d=0;d<s.length;d++){var p=s.charCodeAt(d);p===u?(u=a.pop()||0,0===u&&(l=d)):p in I?(0!==u&&a.push(u),u=I[p]):p in R||0===u&&(l=d)}for(;0!==a.length;)a.pop();l!==s.length-1?(n=c.compact(e.slice(x,o)).join("")+s.slice(0,l+1),L.lastIndex=r+n.length):n=n.slice(t)}else n=n.slice(t);var h=n,f=e[x];return f?f=f.toLowerCase():(f=0===h.toLowerCase().indexOf("irc.")?"irc://":0===h.toLowerCase().indexOf("ftp.")?"ftp://":e[N]?"mailto:":"http://",h=f+h),{href:h,url:n,index:r,input:e.input,scheme:f,username:e[N],domain:e[P],port:e[k],path:e[D],params:e[O],anchor:e[A]}}function s(e){var t=o(e);return t&&t.url===e&&"mailto:"===t.scheme&&t.username&&!t.params&&!t.anchor?t:null}var c=n(30),l=n(1),u="ac|academy|ad|adult|ae|aero|af|ag|agency|ai|al|am|ao|app|ar|as|asia|at|au|audio|az|ba|bank|barclays|bb|bd|be|best|bf|bg|bh|bid|bike|bio|biz|bj|black|blue|bm|bn|bnpparibas|bo|br|bradesco|bs|bt|buzz|bw|by|bz|bzh|ca|cab|cafe|camera|canon|capital|cards|careers|cash|casino|cat|cc|cd|center|cern|cf|cg|ch|chat|church|ci|city|cl|click|cloud|club|cm|cn|co|coach|codes|coffee|com|community|company|cool|coop|cr|cu|cv|cx|cy|cz|date|dating|de|deals|desi|design|dev|digital|direct|directory|dj|dk|do|domains|download|dz|ec|edu|education|ee|eg|email|energy|es|et|eu|eus|events|exchange|expert|farm|fi|finance|fj|flights|fm|fo|football|forsale|fr|fund|futbol|ga|gal|gallery|game|gd|ge|gg|gh|gi|gift|gl|global|gm|gold|google|gop|gov|gp|gq|gr|gratis|gs|gt|guide|guru|gy|help|hiphop|hk|hm|hn|horse|host|hosting|house|how|hr|ht|hu|id|ie|il|im|in|info|ink|int|io|iq|ir|is|istanbul|it|je|jm|jo|jobs|jp|ke|kg|kh|kim|kiwi|kr|krd|kred|kw|kz|la|land|lat|lb|lc|li|life|limited|link|live|lk|lol|london|love|ls|lt|lu|lv|ly|ma|market|marketing|mc|md|me|media|men|menu|mg|mil|mk|ml|mm|mn|mo|mobi|moe|money|moscow|movie|mr|ms|mt|mu|museum|mv|mw|mx|my|mz|na|nagoya|name|nc|net|network|news|nf|ng|ni|ninja|nl|no|np|nu|nyc|nz|office|om|one|onl|online|ooo|org|ovh|pa|paris|party|pe|pf|pg|ph|photo|photography|pics|pink|pk|pl|place|plus|pm|pn|porn|post|pr|press|pro|prod|ps|pt|pub|pw|py|qa|re|red|ren|report|rest|review|reviews|rip|ro|rocks|rs|ru|run|rw|sa|sale|sb|sc|science|scot|sd|se|services|sex|sexy|sg|sh|shiksha|si|singles|site|sk|sm|sn|so|social|software|solutions|space|sr|st|studio|style|su|supply|support|sv|sx|sy|systems|sz|taipei|taxi|tc|team|tech|technology|tf|tg|th|tips|tj|tk|tl|tm|tn|to|today|tokyo|tools|top|town|tr|trade|training|travel|tt|tv|tw|tz|ua|ug|uk|uno|uol|us|uy|uz|va|vc|ve|vg|video|vip|vision|vn|vu|wales|wang|watch|webcam|website|wf|wiki|win|work|works|world|ws|wtf|xyz|ye|yt|za|zm|zone|zw|онлайн|рф",d="(?:http|https)://|mailto:",p="\\w|[^\\s\0-«»‘’“”]|%[0-9a-f][0-9a-f]",h="(?:"+p+")|(?:"+p+")(?:"+p+"|-)*(?:"+p+")",f="(?!_)(?:(?:"+h+")\\.)+(?:"+u+")(?!\\."+h+")",m=":\\d{1,5}",g="+@!.?,(\\[{<«‘“:",v="(?:"+p+"|[^\\s%])",y="/"+v+"*?",_="["+g+"]*(?!"+v+"|#)",E="\\?(?!"+_+")"+v+"*?",b="#"+v+"*?",S="0-9a-z!#$%&'*+/=?^_`{|}~\\-",M="\\b\\w["+S+"]*(?:\\.["+S+"]+)*",T="^|\\W\\.|[^/\\w.]|_",C="("+T+")("+d+")?("+M+"@)?("+f+")(?:(?!"+h+")|(?=_))(?:(?=[^:/?#])|("+m+")?("+y+")?("+E+")?("+b+")?(?="+_+"))",w=1,x=2,N=3,P=4,k=5,D=6,O=7,A=8,R={34:34,39:39,41:40,62:60,93:91,125:123,187:171,8217:8216,8221:8220},I={34:34,39:39,40:41,60:62,91:93,123:125,171:187,8216:8217,8220:8221},L=new RegExp(""+C,"ig");e.exports={findLink:o,findLinks:i,validateEmail:s}},function(e,t,n){"use strict";var r=n(985),i=3;e.exports={minHeight:function(e,t){return{minHeight:e.length>i?i*r.DEFAULT_HEIGHT+t:e.length*r.DEFAULT_HEIGHT+t}}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n){function r(e){return i?i(e):a}x.log("forwardMediaMsg "+e.id)();var i=void 0,a=f(e).then(function(n){return!!n||!e.decryptedMediaBlob&&t.forceDownloadMedia().then(function(){return e.set({url:t.url,clientUrl:t.clientUrl,decryptedMediaBlob:t.decryptedMediaBlob,mediaState:t.mediaState,filehash:t.filehash}),f(e)})}).then(function(t){return t?{avParams:e.avParams(),mediaKey:e.mediaKey}:e.decryptedMediaBlob?o(e.decryptedMediaBlob).then(function(t){return(i=t.reupload)(e.to)}):g["default"].reject(new S.MediaMissing("forward media not on phone"))}).endWithControls("cancel");return e.handleUpload(n,a,r)}function o(e){var t=arguments.length<=1||void 0===arguments[1]?void 0:arguments[1],n=t&&t.isGif,r=t&&t.precomputedDuration,i=t&&t.gifAttribution,o=void 0;return new g["default"](function(t,i){if(o=M.typeFromMimetype(e.type))if(e.size>v.MAX_MEDIA_UPLOAD_SIZE||"image"===o&&e.size>F)i(new S.MediaFileTooLarge(e));else if("document"!==o||C.supportsFeature(C.F.ENC_DOC))if("image"===o)w.rotateAndResize(e,v.IMG_MAX_EDGE,v.IMG_MAX_EDGE,w.BLOB|w.CANVAS).then(function(e){var n=e.width,r=e.height,i=e.images;t({blob:i.blob,h:r,w:n,getThumb:w.rotateAndResize(i.canvas,v.IMG_THUMB_MAX_EDGE,v.IMG_THUMB_MAX_EDGE,w.DATA_URL).then(function(e){var t=e.images;return{url:t.dataUrl}}),mimetype:"image/jpeg"})})["catch"](i);else if("video"===o||"audio"===o)t(N.checkAndRepair(e,!!n).then(function(t){if(!t)return x.error("prepFileForUpload bad video file "+e.type)(e),g["default"].reject(new S.InvalidMediaFileType);var i=t.type;if(e=t.file,n=n||t.isGif,o=M.typeFromMimetype(i),"video"===o)return w.generateVideoThumbAndDuration(e,v.IMG_THUMB_MAX_EDGE,v.IMG_THUMB_MAX_EDGE).then(function(t){var n=t.thumb,r=t.duration;return{blob:e,w:n.fullWidth,h:n.fullHeight,getThumb:g["default"].resolve(n),mimetype:i,getDuration:g["default"].resolve(r)}});var a=void 0===r?M.getAudioDuration(e):g["default"].resolve(r);return{blob:e,getThumb:null,mimetype:i,getDuration:a}}));else if("document"===o)if(e.type)"*"===L.DOC_MIMES||L.DOC_MIMES.indexOf(e.type)>-1?t({blob:e,getThumb:null,mimetype:e.type}):i(new S.InvalidMediaFileType("disallowed mimetype: "+e.type));else{var a=M.blobToArrayBuffer(e).then(function(t){var n,r=T(new Uint8Array(t,0,Math.min(262,e.size)));if(r&&r.mime){if(n="*"===L.DOC_MIMES?r.mime:L.isAllowedDocumentMimetype(r.mime,e.name,!0))return{blob:e,buffer:t,getThumb:null,mimetype:n}}else if(e.name){var i="",o=e.name.split(".");if(o.length>1&&(i=o[o.length-1]),i.length>0&&(n="*"===L.DOC_MIMES?i in L.EXT_TO_MIME?L.EXT_TO_MIME[i]:"application/octet-stream":L.isAllowedDocumentMimetype(L.EXT_TO_MIME[i],e.name,!1)))return{blob:e,buffer:t,getThumb:null,mimetype:n}}return g["default"].reject(new S.InvalidMediaFileType("type: "+e.type+" name: "+e.name))});t(a)}else t({blob:e,getThumb:null,mimetype:e.type});else i(new S.InvalidMediaFileType);else i(new S.InvalidMediaFileType("type: "+e.type))}).then(function(t){var r=t.blob,s=t.buffer,c=t.h,d=t.w,h=t.getThumb,f=t.mimetype,m=t.getDuration,v=s?g["default"].resolve(s):M.blobToArrayBuffer(r),_=M.getHash(v),E=void 0,S=void 0,T=void 0,C=function(t){return p(t,o,f).then(function(i){if(!i)return _.then(function(e){var t=e.hash,n=e.size;return A.requestMediaUpload(o,t,n)}).addCancelControl().then(function(n){var i=n.result,o=n.data;return"duplicate"===i?{avParams:o}:"ok"===i?l(o,r,t,e.name).then(function(e){return{avParams:e}}):void 0});var s=function(){E||(E=y.newB64MediaKey(),S=v.then(function(e){return b.encryptE2EMedia(o,e,E)}),T=S.then(function(e){return M.getHash(e)}).then(function(e){var t=e.hash;return t}));var r=a(t,o,E);return{v:T.then(function(e){var t="video"===o&&n?"gif":o;return A.requestEncryptedMediaUpload(t,e)}).addCancelControl().then(function(t){var n=t.data;return g["default"].all([r,S,T]).addCancelControl().spread(function(t,r,i){return u(n,r,e.name,i,t)})}).then(function(e){return{avParams:e,mediaKey:E}})}}();return"object"==typeof s?s.v:void 0}).endWithControls("cancel")};return{blob:r,height:c,width:d,getThumb:h,getDuration:m||g["default"].resolve(),msgType:o,getFilehash:_.then(function(e){var t=e.hash;return t}),reupload:C,mimetype:f,filename:e.name,isGif:!("video"!==o||!n)||void 0,gifAttribution:i}})}function a(e,t,n){var r=void 0,i=Store.Conn.me;return r=e===i?[i]:R.isUser(e)?[e,i]:Store.GroupMetadata.find(e).then(function(e){return e.participants.map(function(e){return e.id})}),g["default"].resolve(r).then(function(e){var r=E.computeKeys(t,n).refKey;return y.computeRefs(r,e)})}function s(e){var t={};for(var n in e){var r=e[n],i=parseInt(e[n],10);t[n]=i===i&&""+i===r?i:r}return t}function c(e,t){var n=e+"?f=j";return g["default"].loop(function(e,r,i){if(i>4)throw new S.GaveUpRetry("gave up mms upload after "+i+" tries");var o=3e5*(i+1);return k.getResponseIfOnline(n,"POST",t).addRawControl("cancel",function(e,t,n){t(new g["default"].CancellationError),n.control.cancel()}).timeout(o,"postMediaToMMSTimeout").then(function(t){if(!t||200!==t.status){x.log("MediaUpload error: "+(t?t.status:"offline"))();var n=Math.floor(1e3*D.expBackoff(i+1,60,void 0,.1));return g["default"].all([g["default"].delay(n),P.waitForOnline])}x.log("MediaUpload success: 200")(),e(JSON.parse(t.response))})["catch"](g["default"].TimeoutError,_.noop)})}function l(e,t,n,r){var i=new FormData;return i.append("from",R.user(Store.Conn.me)),i.append("to",R.user(n)),i.append("file",t,r),c(e,i).then(s)}function u(e,t,n,r,i){var o=new FormData;return o.append("file",t,n),o.append("hash",r),o.append("refs",i.join("\r\n")),c(e,o).then(s)}function d(e,t,n){var r=new FormData;return r.append("hash",t),r.append("refs",n.join("\r\n")),c(e,r)}function p(e,t){var n=!1;switch(t){case"audio":case"ptt":n=C.supportsFeature(C.F.ENC_AUDIO);break;case"video":n=C.supportsFeature(C.F.ENC_VIDEO);break;case"document":n=C.supportsFeature(C.F.ENC_DOC);break;case"image":n=C.supportsFeature(C.F.ENC_IMAGE)}return n?g["default"].resolve(!0):g["default"].reject(new S.CapabilityUnsupported)}function h(e){return e.uploadhash?g["default"].resolve(e.uploadhash):e.filehash&&!O.isEncryptedMedia(e.clientUrl)?g["default"].resolve({filehash:e.filehash}):I.headRetry(e.clientUrl).then(function(t){if(200!==t.status)throw new S.MediaNeedsReupload;var n=t.getResponseHeader("X-WA-Metadata");return x.assert(n,"wa-metadata-header-missing","HEAD "+e.clientUrl+" got "+t.status)(),_.fromPairs(n.split("; ").map(function(e){return e.split("=",2)}))})}function f(e){return g["default"].all([p(e.to,e.type,e.mimetype),h(e)]).addCancelControl().spread(function(t,n){var r=n.filehash,i=O.isEncryptedMedia(e.clientUrl);return t&&i?(e.uploadhash=r,A.requestEncryptedMediaUpload(e.type,r).then(function(t){var n=t.data;return a(e.to,e.type,e.mediaKey).then(function(e){return d(n,r,e)}).then(function(e){return!!e.url})})):!t&&!i&&(e.set({uploadhash:r,filehash:r}),A.requestMediaUpload(e.type,r,e.size).then(function(e){return"duplicate"===e.result}))})["catch"](S.MediaNeedsReupload,function(){return!1})}var m=n(2),g=r(m),v=n(8),y=n(1089),E=n(202),b=n(1087),S=n(14),M=n(418),T=n(442),C=n(101),w=n(993),x=n(1),N=n(1163),P=n(136),k=n(29),D=n(103),O=n(80),A=n(45),R=n(21),I=n(1096),L=n(201),F=26214400;e.exports={computeRefs:a,prepFileForUpload:o,shouldSendEncrypted:p,forwardMediaMsg:i}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(53),o=r(i),a=n(44),s=r(a),c=n(199),l=r(c),u=n(198),d=r(u),p=n(1018),h=function(e){function t(){return(0,s["default"])(this,t),(0,l["default"])(this,(0,o["default"])(t).call(this,"_",/(?:^|[*_~\s])_((?:[\S])|(?:\S[^\n]*?\S))_(?=_|\W|$)/g,1))}return(0,d["default"])(t,e),t}(p);e.exports=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(53),o=r(i),a=n(44),s=r(a),c=n(52),l=r(c),u=n(199),d=r(u),p=n(198),h=r(p),f=n(996),m=n(1033),g=m.findLinks,v=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"match",value:function(e){return g(e).map(function(e){return{0:e.url,href:e.href,input:e.input,index:e.index}})}}]),t}(f);e.exports=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(53),o=r(i),a=n(44),s=r(a),c=n(52),l=r(c),u=n(199),d=r(u),p=n(198),h=r(p),f=n(996),m=n(1002),g=m.matchAll,v=n(30),y=function(e){function t(e){(0,s["default"])(this,t);var n=(0,d["default"])(this,(0,o["default"])(t).call(this));n._map=e;var r=v.keys(e).map(v.escapeRegExp).join("|");return n._regex=new RegExp("("+r+")","g"),n}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"match",value:function(e){var t=this;return g(this._regex,e,function(e){return e.jid=t._map[e[0]].jid,e})}},{key:"mutate",value:function(e){var t=this._map[e];return"@"+t.display}}]),t}(f);e.exports=y},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(44),o=r(i),a=n(52),s=r(a),c=function(){function e(t){(0,o["default"])(this,e),this.args=t}return(0,s["default"])(e,[{key:"onRoot",value:function(e){return e}},{key:"onMutatorNode",value:function(e,t){return{mutator:e.mutator,children:t}}},{key:"onDelimiter",value:function(e){return e}},{key:"onText",value:function(e){return e}}]),e}();e.exports=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(53),o=r(i),a=n(44),s=r(a),c=n(199),l=r(c),u=n(198),d=r(u),p=n(1018),h=function(e){function t(){return(0,s["default"])(this,t),(0,l["default"])(this,(0,o["default"])(t).call(this,"~",/(?:^|[*_~\s])~((?:[\S])|(?:\S[^\n]*?\S))~(?=_|\W|$)/g,1))}return(0,d["default"])(t,e),t}(p);e.exports=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(53),o=r(i),a=n(44),s=r(a),c=n(199),l=r(c),u=n(198),d=r(u),p=n(1018),h=function(e){function t(){return(0,s["default"])(this,t),(0,l["default"])(this,(0,o["default"])(t).call(this,"*",/(?:^|[*_~\s])\*((?:[\S])|(?:\S[^\n]*?\S))\*(?=_|\W|$)/g,1))}return(0,d["default"])(t,e),t}(p);e.exports=h},function(e,t,n){e.exports={"default":n(1239),__esModule:!0}},,,,,,,,,,,function(e,t,n){"use strict";var r=n(6),i=n(977),o=n(974),a=n(196),s=n(0),c=n(129),l=n(78),u=r.createClass({displayName:"Timestamp",mixins:[c,l],propTypes:{chat:r.PropTypes.instanceOf(i),msg:r.PropTypes.instanceOf(o)},componentWillMount:function(){this.props.chat&&this.addObserver(this.props.chat.msgs,"change:last")},componentDidMount:function(){this.maybeRegMidnight()},componentDidUpdate:function(){this.maybeRegMidnight()},rerender:function(){this.forceUpdate()},maybeRegMidnight:function(){var e=this.timestamp();if(e){this.unregCmd("midnight",this.rerender);var t=s().startOf("day").subtract(7,"day");e>=t.unix()&&this.regCmd("midnight",this.rerender)}},timestamp:function(){if(this.props.msg)return this.props.msg.t;var e=this.props.chat.msgs.last();return e&&e.t},render:function(){var e=this.timestamp();return e?r.createElement("div",{className:"chat-meta"},r.createElement("span",{className:"chat-time"},a.relativeStr(e))):null}});e.exports=u},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(985),a=n(992),s=n(1026),c=n(987),l=n(131),u=l.HotKeys,d=r.createClass({displayName:"ContactList",propTypes:{contacts:r.PropTypes.array.isRequired,exclude:r.PropTypes.array,onClick:r.PropTypes.func,onFocusSearch:r.PropTypes.func},getInitialState:function(){this.selection=new c(this.props.contacts,function(e){return e.id});var e=this.props.exclude;return e&&(e=_.fromPairs(e.map(function(e){return[e.id,!0]}))),{exclude:e}},componentWillReceiveProps:function(e){this.selection.init(e.contacts)},onFocusGain:function(e){e.target===i.findDOMNode(this)&&(this.selection.index<0?this.focusFirst():this.selection.reset())},focusFirst:function(){this.selection.setFirst()},onNextContact:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setNext()},onPrevContact:function(e){e.preventDefault(),e.stopPropagation();var t=this.selection.prev();t>-1?this.selection.setPrev():(this.selection.unset(),this.props.onFocusSearch(e))},render:function(){for(var e,t=this.props.contacts,n=[],i=t.length>10,c=this.state.exclude||{},l="XXX",d=0;d<t.length;d++){var p=t[d];if(e=null,i){var h=p.header;d<t.length-1&&h!==t[d+1].header&&(e="last"),h!==l&&(n.push(r.createElement(s,{key:h,header:h})),l=h)}var f=p.id;n.push(r.createElement(a,{contact:p,active:this.selection,className:e,onClick:this.props.onClick,member:c[f],key:f}))}var m={down:this.onNextContact,up:this.onPrevContact};return r.createElement(u,{handlers:m,onFocus:this.onFocusGain,"data-tab":3},r.createElement(o,{className:"chatlist",data:n,height:72,extraItems:4}))}});e.exports=d},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(12),a=n(78),s=n(130),c=n(133),l=n(10),u=n(54),d=n(974),p=r.createClass({displayName:"AudioTag",mixins:[a,s,c],propTypes:{msg:r.PropTypes.instanceOf(d).isRequired,className:r.PropTypes.string,controls:r.PropTypes.bool,preload:r.PropTypes.string,type:r.PropTypes.string,onClick:r.PropTypes.func,onPlay:r.PropTypes.func,onError:r.PropTypes.func,autoPlay:r.PropTypes.bool},componentDidMount:function(){var e=i.findDOMNode(this);this.regNativeListener(e,"error",this.onPlayerError,!0),this.regNativeListener(e,"playing",this.onPlaying),this.regCmd("mediaPlaying",this.onOtherPlaying),(u.isGecko||u.isSafari)&&(this.props.autoPlay?(this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)):this.props.autoPlay?this.startCheckForSuccess():this.regNativeListener(e,"play",this.startCheckForSuccess))},startCheckForSuccess:function(){this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250);
},clearCheckForSuccess:function(){this.checkForSuccessInterval&&(this.clearSafeInterval(this.checkForSuccessInterval),delete this.checkForSuccessInterval,delete this.checkIteration)},checkForSuccess:function(){if(o.state===o.STATE.CONNECTED){if(this.checkIteration++,this.checkIteration>40)return void this.onPlayerError({target:{src:this.state.src,error:{code:window.MediaError.MEDIA_ERR_NETWORK}}});var e=i.findDOMNode(this),t=e.buffered;t&&t.length&&t.end(0)>0&&this.onPlaying({target:e})}},onPlayerError:function(e){this.clearCheckForSuccess(),this.props.onError(e.target.src)},onOtherPlaying:function(e){e!==this&&i.findDOMNode(this).pause()},onPlaying:function(e){this.clearCheckForSuccess(),l.mediaPlaying(this),this.props.onPlay&&this.props.onPlay(e)},render:function(){return r.createElement("audio",{src:this.props.msg.url,className:this.props.className,onClick:this.props.onClick,controls:this.props.controls,preload:this.props.preload,type:this.props.type,autoPlay:this.props.autoPlay},this.props.children)}});e.exports=p},function(e,t,n){"use strict";var r=n(6),i=n(977),o=n(975),a=n(983),s=r.createClass({displayName:"DeleteMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(i).isRequired,onDeleteOrExit:r.PropTypes.func.isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},render:function(){var e;switch(this.props.chat.kind){case i.KIND.GROUP:e=this.props.chat.isReadOnly?l10n.t("web_delete_group"):l10n.t("web_exit_group");break;case i.KIND.BROADCAST:e=l10n.t("web_delete_list");break;case i.KIND.CHAT:e=l10n.t("delete_chat")}return r.createElement(a,{a8n:"mi-delete",action:this.props.onDeleteOrExit,shortcut:"x"},e)}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(129),o=n(976),a=n(14),s=n(1016),c=n(1015),l=r.createClass({displayName:"GroupSubtitle",mixins:[i],propTypes:{presence:r.PropTypes.instanceOf(s),groupMetadata:r.PropTypes.instanceOf(c),placeholder:r.PropTypes.node,location:r.PropTypes.oneOf(["list","title"])},componentWillMount:function(){Store.GroupMetadata.find(this.props.groupMetadata.id)["catch"](a.WapDrop,_.noop);var e=this.props.groupMetadata.participants;this.addObserver(e,"sort remove reset"),this.addObserver(this.props.presence,"change:chatstate.id change:chatstate.type change:forceDisplay change:withholdDisplay")},getSubtitle:function(){return this.props.groupMetadata.participants.map(function(e){return e.contact.formattedShortNameWithNonBreakingSpaces}).join(", ")},render:function(){var e,t=this.props.presence;return"list"===this.props.location?(e=t.getFormattedString()||this.getSubtitle(),e?r.createElement(o,{ellipsify:!0,titlify:!0,text:e}):null):(e=t.withholdDisplay?this.props.placeholder:t.getFormattedString()||(t.forceDisplay?this.getSubtitle():this.getSubtitle()||this.props.placeholder),e?r.createElement("div",{className:"chat-status ellipsify"},r.createElement(o,{ellipsify:!0,titlify:!0,text:e})):null)}});e.exports=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(414),o=r(i),a=n(6),s=a.createClass({displayName:"IsolatedBlock",propTypes:{Component:a.PropTypes.string.isRequired},getDefaultProps:function(){return{Component:"span"}},render:function(){var e=this.props,t=e.Component,n=e.children,r=(0,o["default"])(e,["Component","children"]);return a.createElement(t,r,"​⁠​",n,"​⁠​")}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(974),o=n(196),a=n(43),s=r.createClass({displayName:"MediaThumb",propTypes:{msg:r.PropTypes.instanceOf(i).isRequired,onClick:r.PropTypes.func,classes:r.PropTypes.string,onDragStart:r.PropTypes.func},getInitialState:function(){var e=this.props.msg;return this.src=e.type===i.TYPE.IMAGE&&e.url?e.url:"data:image/jpeg;base64,"+e.body,{}},render:function(){var e=this.props.msg,t=a("media-canvas",{"attach-media-audio-thumb":e.type===i.TYPE.AUDIO,"media-video-thumb":e.isGif&&!e.body}),n=e.type===i.TYPE.IMAGE?null:e.type===i.TYPE.VIDEO?e.isGif?r.createElement("span",{className:"icon-s icon-msg-gif-light"}):r.createElement("span",{className:"icon-s icon-msg-video-light"}):r.createElement("span",{className:"icon-s icon-msg-audio-light"}),s=o.durationStr(e.duration)&&!e.isGif?r.createElement("span",{className:"media-canvas-duration"},o.durationStr(e.duration)):null,c=e.type===i.TYPE.AUDIO||e.isGif&&!e.body?{}:{backgroundImage:"url("+this.src+")"},l=this.props.onDragStart?r.createElement("div",{className:t,style:c,onClick:this.props.onClick||_.noop,ref:"img",onDragStart:this.props.onDragStart,draggable:!0}):r.createElement("div",{className:t,style:c,onClick:this.props.onClick||_.noop,ref:"img"}),u=n&&e.type!==i.TYPE.AUDIO?r.createElement("div",{className:"shade"}):null;return r.createElement("div",{className:this.props.classes},l,u,n,s)}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(977),o=n(975),a=n(983),s=r.createClass({displayName:"MuteMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(i).isRequired,onMute:r.PropTypes.func.isRequired},getInitialState:function(){return{isMuted:this.async("chat.mute.isMuted")}},render:function(){var e=this.props.onMute.bind(null,!this.state.isMuted);return r.createElement(a,{action:e,shortcut:"m"},this.state.isMuted?l10n.t("web_menuitem_mute_off"):l10n.t("web_menuitem_mute"))}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=r.createClass({displayName:"Tooltip",propTypes:{body:r.PropTypes.node.isRequired,direction:r.PropTypes.oneOf(["top","right","bottom","left"]).isRequired},render:function(){var e="tooltip "+this.props.direction;return r.createElement("div",{className:e},this.props.body)}});e.exports=i},function(e,t,n){"use strict";var r=n(6),i=n(975),o=n(976),a=n(1016),s=r.createClass({displayName:"UserSubtitle",mixins:[i],propTypes:{presence:r.PropTypes.instanceOf(a),placeholder:r.PropTypes.node,location:r.PropTypes.oneOf(["list","title"])},getInitialState:function(){return{hasData:this.async("presence.hasData"),type:this.async("presence.chatstate.type"),deny:this.async("presence.chatstate.deny"),t:this.async("presence.chatstate.t"),forceDisplay:this.async("presence.forceDisplay"),withholdDisplay:this.async("presence.withholdDisplay")}},render:function(){var e,t=this.props.presence;return"list"===this.props.location?(e=t.getFormattedString(),e?r.createElement(o,{ellipsify:!0,titlify:!0,text:e}):null):(e=t.withholdDisplay?this.props.placeholder:t.getFormattedString()||(t.forceDisplay?"":this.props.placeholder),e?r.createElement("div",{className:"chat-status ellipsify"},r.createElement(o,{ellipsify:!0,titlify:!0,text:e})):null)}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(130),a=n(884),s=r.createClass({displayName:"Video",mixins:[o,a],propTypes:{src:r.PropTypes.string.isRequired,onPlay:r.PropTypes.func},componentDidMount:function(){var e=i.findDOMNode(this),t=this;this.regNativeListener(e,"playing",function(n){e.videoHeight&&e.videoWidth||(e.pause(),e.play()),e.videoHeight&&e.videoWidth&&t.props.onPlay(n)})},render:function(){return r.createElement("video",this.props)}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(12),a=n(78),s=n(130),c=n(133),l=n(10),u=n(54),d=n(974),p=n(8),h=r.createClass({displayName:"VideoTag",mixins:[a,s,c],propTypes:{msg:r.PropTypes.instanceOf(d).isRequired,poster:r.PropTypes.string,style:r.PropTypes.object,className:r.PropTypes.string,controls:r.PropTypes.bool,width:r.PropTypes.number,height:r.PropTypes.number,onClick:r.PropTypes.func,onPlay:r.PropTypes.func,onError:r.PropTypes.func,autoPlay:r.PropTypes.bool,loop:r.PropTypes.bool,muted:r.PropTypes.bool,onLoad:r.PropTypes.func,onResize:r.PropTypes.func},componentWillMount:function(){},componentDidMount:function(){var e=i.findDOMNode(this),t=this.props.msg;t.isGif||(this.regNativeListener(e,"playing",this.onPlaying),this.regCmd("mediaPlaying",this.onOtherPlaying)),this.regNativeListener(e,"error",this.onPlayerError,!0),(u.isGecko||u.isSafari)&&(this.props.autoPlay?this.startCheckForSuccess():this.regNativeListener(e,"play",this.startCheckForSuccess))},startCheckForSuccess:function(){this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)},clearCheckForSuccess:function(){this.checkForSuccessInterval&&(this.clearSafeInterval(this.checkForSuccessInterval),delete this.checkForSuccessInterval,delete this.checkIteration)},checkForSuccess:function(){if(o.state===o.STATE.CONNECTED){if(this.checkIteration++,this.checkIteration>240)return void this.onPlayerError({target:{src:this.props.src,error:{code:window.MediaError.MEDIA_ERR_NETWORK}}});var e=i.findDOMNode(this),t=e.buffered;t&&t.length&&t.end(0)>0&&this.onPlaying({target:e})}},onPlayerError:function(e){this.clearCheckForSuccess(),this.props.onError&&this.props.onError(e)},onOtherPlaying:function(e){e!==this&&i.findDOMNode(this).pause()},onPlaying:function(e){this.clearCheckForSuccess(),l.mediaPlaying(this),this.props.onPlay&&this.props.onPlay(e)},render:function(){var e=this.props.msg,t=e.streamable&&!e.url?p.VIDEO_STREAM_URL+"?key="+e.id.toString():e.url;return r.createElement("video",{src:t,poster:this.props.poster,style:this.props.style,width:this.props.width,height:this.props.height,className:this.props.className,onClick:this.props.onClick,controls:this.props.controls,autoPlay:this.props.autoPlay,loop:this.props.loop,muted:this.props.muted,onEnded:this.props.onEnded,onLoadStart:this.props.onLoad},this.props.children)}});e.exports=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(412),o=r(i),a=n(2),s=r(a),c=n(6),l=n(34),u=n(8),d=n(977),p=n(1073),h=n(1072),f=n(78),m=n(133),g=n(975),v=n(129),y=n(10),E=n(410),b=n(14),S=n(418),M=n(80),T=n(1074),C=n(1152),w=n(1071),x=n(1129),N=n(1033),P=n(1),k=n(980),D=n(984),O=n(101),A=n(43),R=n(197),I=n(63),L=n(1117),F=n(135),U=n(131),j=U.HotKeys,B=n(1151),G=function(){return O.supportsFeature(O.F.LINK_PREVIEW)||O.supportsFeature(O.F.SEND_LINK_PREVIEW)&&!1},z=c.createClass({displayName:"ComposeBox",mixins:[f,m,g,k,v],propTypes:{chat:c.PropTypes.instanceOf(d).isRequired,onPageUpDown:c.PropTypes.func.isRequired,onComposeHeightChange:c.PropTypes.func},getInitialState:function(){var e=this.props.chat;return this.text=e.composeContents.text||"",this.selection=e.composeContents.selection,this.omittedURL=e.composeContents.omittedURL,this.pendingLinkPreviewPromises=[],this.preview=this.omittedURL,this.scanForLinks=this.safeDebounce(this._scanForLinks,500),{trusted:this.async("chat.trusted"),hasText:!!this.text,emojiExpanded:!1,recording:!1,linkPreview:null,quotedMsg:e.composeQuotedMsg}},componentWillMount:function(){var e=this.props.chat;e.composeContents={},this.regCmd("focus_chat_text_input_"+this.props.chat.id,this.restoreFocus),this.regCmd("focus_chat_text_input",this.restoreFocus),this.regCmd("paste_chat_text_input_"+this.props.chat.id,this.pasteEmojiInput),this.regCmd("enter_chat_text_input_"+this.props.chat.id,this.onSendText),this.addObserver(e,"change:composeQuotedMsg",this.onQuotedMsgChange)},componentDidMount:function(){this.height=l.findDOMNode(this.refs.composeBlock).clientHeight,G()&&this.scanForLinks()},componentWillUnmount:function(){var e=this.props.chat;e.composeContents.text=this.text,e.composeContents.selection=this.selection,e.composeContents.omittedURL=this.omittedURL},pasteEmojiInput:function(e){this.refs.input&&(this.refs.input.restoreFocus(!0),this.refs.input.replaceSelection(e))},onMaxPasteExceeded:function(){y.openModal(c.createElement(E,{title:l10n.t("message_too_large_title"),onOK:y.closeModal.bind(y),okText:l10n.t("web_ok")},l10n.t("message_too_large_text")))},restoreFocus:function(){this.refs.input&&this.refs.input.restoreFocus()},clearLinkPreview:function(){this.preview=null,this.omitLinkPreview()},cancelPendingLinkPreviews:function(){_.forEach(this.pendingLinkPreviewPromises,function(e){return e.cancel()}),this.pendingLinkPreviewPromises=[]},omitLinkPreview:function(){this.state.linkPreview&&(this.setState({linkPreview:null}),this.omittedURL=this.preview)},omitQuotedPreview:function(e){e!==!0&&(this.props.chat.composeQuotedMsg=null)},_findFirstWebLink:function(){return _.head(N.findLinks(this.text).filter(function(e){var t=e.url;return M.isHttp(t)}))},_scanForLinks:function(){var e=this;if(!this.state.hasText)return void this.clearLinkPreview();var t=this._findFirstWebLink();if(!t)return void this.clearLinkPreview();var n=t.url;if(!this.preview||this.preview!==n){this.preview=n,this.omittedURL=null;var r=d.linkPreview(n).checkpoint(this.rejectOnUnmount()).cancellable();this.pendingLinkPreviewPromises.push(r),r.then(function(t){var n=t.url,r=t.data;e.preview&&e.preview!==n||(r.title||r.description)&&e.setState({linkPreview:r})})["catch"](b.Unmount,_.noop)["catch"](s["default"].CancellationError,_.noop)}},onQuotedMsgChange:function(){var e=this.props.chat,t=!1;(this.state.quotedMsg?!e.composeQuotedMsg:e.composeQuotedMsg)&&(t=!0),t&&!e.composeQuotedMsg?this.setState({quotedMsg:null}):this.setState({quotedMsg:e.composeQuotedMsg})},indicateFocus:function(e){var t=this.refs.container;if(t&&t.activate(),!(Date.now()-(j.flashFocus||0)>200)){var n=l.findDOMNode(this.refs.input_hotkey);Velocity(n,"stop"),Velocity(n,{backgroundColor:["#ffffff","#D9F3FF"],borderColor:["#ffffff","#CBE4EF"]},{duration:1300,easing:[.24,.91,.01,.99]}),this.refs.input.restoreFocus(!1)}},onPageUpDown:function(e){if(this.props.onPageUpDown){e.stopPropagation(),this.props.onPageUpDown(e);var t=this.refs.input;this.safeDefer(function(){t.restoreFocus(!0)})}},handleEmoji:function(e){this.refs.input.replaceSelection(e)},handleGif:function(e,t){var n=F.get(e,F.RESP_TYPE.BLOB).then(function(e){var n=e.response;return n.isGifHackDoNotUse=!0,n.gifAttributionHackDoNotUse=t,n})["catch"](function(e){throw P.error("failed loading gif ("+e+")")(),new b.MediaFileFailedLoad});this.closeEmojiPanel(),y.attachMediaDrawer(this.props.chat,[n])},openEmojiPanel:function(){this.state.emojiExpanded!==!0&&this.setState({emojiExpanded:!0})},closeEmojiPanel:function(){this.state.emojiExpanded!==!1&&this.setState({emojiExpanded:!1})},onPTT:function(e){this.setState({recording:e===B.REC})},preventBlur:function(e){var t=e.target,n=l.findDOMNode(this.refs.input),r=l.findDOMNode(this.refs.container);do if(t===n)return;while(t!==r&&(t=t.parentNode));e.preventDefault(),e.stopPropagation(),this.refs.input.restoreFocus(!1)},onChange:function(e){var t=l.findDOMNode(this.refs.composeBlock),n=t.clientHeight,r=n-this.height;r&&this.props.onComposeHeightChange({input:r}),this.height=n;var i=this.hasText();this.text=e.target.value;var o=this.hasText();if(o!==i&&this.setState({hasText:o}),o?(this.props.chat.presence.subscribe()["catch"](b.WapDrop,_.noop),this.props.chat.markComposing()):this.props.chat.markPaused(),G()){var a=this._findFirstWebLink();(!a&&this.preview||a&&a.url!==this.preview)&&this.clearLinkPreview(),this.scanForLinks()}},_getSendButton:function(){var e=navigator.getUserMedia&&window.AudioContext;if(this.state.hasText||!e)return c.createElement("button",{className:"icon btn-icon icon-send send-container",onClick:this.onSendText,disabled:!this.hasText});var t=this.props.chat;return c.createElement(B,{key:"ptt",chat:t,onStateChange:this.onPTT})},_getPopupPanel:function(){var e=void 0;this.state.linkPreview&&(e=c.createElement(R,{displayName:"ComposeBoxLinkPreview",escapable:!0,requestDismiss:this.clearLinkPreview},c.createElement("div",{className:"compose-popup-panel"},c.createElement(x,(0,o["default"])({onOmit:this.omitLinkPreview},this.state.linkPreview)))));var t=void 0;this.state.quotedMsg&&(t=c.createElement(R,{displayName:"ComposeBoxQuotedMsg",escapable:!0,requestDismiss:this.omitQuotedPreview},c.createElement("div",{className:"compose-popup-panel"},c.createElement(w,{msg:this.state.quotedMsg,onOmit:this.omitQuotedPreview,chat:this.state.quotedMsg.chat}))));var n=null;return this.state.emojiExpanded&&(n=c.createElement(R,{displayName:"ComposeBoxEmojiPanel",escapable:!0,requestDismiss:this.closeEmojiPanel},c.createElement(p,{key:"compose-emoji-panel",ref:"emojiPanel",onEmoji:this.handleEmoji,onGif:u.SHOW_GIF_SEARCH?this.handleGif:void 0,text:this.text}))),c.createElement("div",{className:"compose-box-items-positioning-container"},c.createElement("div",{className:"compose-box-items-overlay-container"},c.createElement(L,{onHeightChange:this.onHeightChange},n,t,e)))},onHeightChange:function(e,t){this.props.onComposeHeightChange({overlay:e},t)},onPaste:function(e){var t=e.clipboardData.items,n=_.filter(t,function(e){var t=S.typeFromMimetype(e.type);return"file"===e.kind&&("image"===t||"video"===t)}).map(function(e){return e.getAsFile()});if(n.length){var r=_.reject(t,{kind:"string",type:"text/html"});if(r.length===n.length)return e.preventDefault(),void y.openDrawerMid(c.createElement(T,{files:n,chat:this.props.chat}),"slide-up",this.context.uim)}},onSelectionChange:function(e){this.selection=e},onMouseDown:function(e){e.defaultPrevented&&this.refs.input.restoreFocus(!1)},onKeyPress:function(e){if("Enter"===e.key&&!e.shiftKey&&!e.ctrlKey)return this.onSendText(),void e.preventDefault()},hasText:function(){return z.hasText=this.text.trim().length>0},onSendText:function(){return!!this.text.length&&(this.props.chat.sendMessage(D.emojify(this.text),this.state.linkPreview,this.props.chat.composeQuotedMsg),this.cancelPendingLinkPreviews(),this.text="",this.selection=void 0,this.hasText(),this.setState({quotedMsg:this.props.chat.composeQuotedMsg=null,linkPreview:null,emojiExpanded:!1,hasText:!1}),void(this.props.chat.composeContents={}))},render:function(){var e=this.props.chat,t=this.state.emojiExpanded?c.createElement("button",{className:"icon icon-hide btn-emoji",onClick:this.closeEmojiPanel}):c.createElement("button",{className:"icon icon-smiley btn-emoji",onClick:this.openEmojiPanel}),n=A("input-container",{disabled:this.state.recording}),r={pagedown:this.onPageUpDown,pageup:this.onPageUpDown},i=l10n.t("type_a_message"),o=O.supportsFeature(O.F.SPAM)?c.createElement(C,{chat:e}):null,a=A("block-compose",{"ptt-open":this.state.recording});return c.createElement(R,{displayName:"ComposeBox",ref:"container",state:R.State.PASSIVE,requestFocus:this.restoreFocus},c.createElement(j,{component:"footer",handlers:r,className:"pane-footer pane-chat-footer",onMouseDown:this.preventBlur,onContextMenu:this.preventBlur},o,c.createElement("div",{className:a,ref:"composeBlock"},t,c.createElement(j,{ref:"input_hotkey",className:n,onFocus:this.indicateFocus},c.createElement(h,{placeholder:i,editable:!this.state.recording,format:!0,ref:"input",value:this.text,spellCheck:!0,selection:this.selection,multiline:!0,maxLength:u.MAX_TXT_MSG_SIZE,maxPaste:u.MAX_TXT_MSG_SIZE,onMaxPasteExceeded:this.onMaxPasteExceeded,onKeyPress:this.onKeyPress,onPaste:this.onPaste,onMouseDown:this.onMouseDown,onChange:this.onChange,onSelectionChange:this.onSelectionChange})),this._getSendButton()),this._getPopupPanel()))}});z.contextTypes={uim:c.PropTypes.instanceOf(I)},e.exports=z},function(e,t,n){"use strict";function r(e,t){var n=[];return n.push(a.createElement(c,{key:"info",action:function(){return s.chatInfoDrawer(e)},shortcut:"i"},l10n.t("web_group_info"))),n.push(a.createElement(c,{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.mute.canMute()&&n.push(a.createElement(l,{key:"mute",onMute:function(t){return s.muteChat(e,t)},chat:e})),e.canClear()&&n.push(a.createElement(c,{key:"clear",shortcut:"e",action:function(){return s.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&n.push(a.createElement(u,{key:"delete",onDeleteOrExit:function(){return s.deleteOrExitChat(e)},chat:e})),n}function i(e,t){var n=[];return n.push(a.createElement(c,{key:"info",action:function(){return s.chatInfoDrawer(e)},shortcut:"i"},l10n.t("web_list_info"))),n.push(a.createElement(c,{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.canClear()&&n.push(a.createElement(c,{key:"clear",shortcut:"e",action:function(){return s.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&n.push(a.createElement(u,{key:"delete",onDeleteOrExit:function(){return s.deleteOrExitChat(e)},chat:e})),n}function o(e,t){var n=[];return e.isPSA||n.push(a.createElement(c,{key:"info",a8n:"mi-contact",action:function(){return s.chatInfoDrawer(e)},shortcut:"i"},l10n.t("web_contact_info"))),n.push(a.createElement(c,{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.mute.canMute()&&n.push(a.createElement(l,{key:"mute",onMute:function(t){return s.muteChat(e,t)},chat:e})),e.canClear()&&n.push(a.createElement(c,{key:"clear",shortcut:"e",action:function(){return s.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&n.push(a.createElement(u,{key:"delete",onDeleteOrExit:function(){return s.deleteOrExitChat(e)},chat:e})),n}var a=n(6),s=n(10),c=n(983),l=n(1060),u=n(1056);e.exports={group:r,contact:o,broadcast:i}},function(e,t,n){"use strict";var r=n(6),i=n(974),o=n(196),a=r.createClass({displayName:"HiddenText",propTypes:{msg:r.PropTypes.instanceOf(i).isRequired},render:function(){var e=this.props.msg,t=e.senderObj.formattedUser,n="["+o.timeStr(e.t)+"]";return r.createElement("span",{className:"message-pre-text"},"⁠⁠",n," ",t,": ⁠⁠⁠")}});e.exports=a},function(e,t,n){"use strict";var r=n(6),i=n(988),o=n(975),a=n(130),s=n(974),c=n(989),l=n(986),u=n(80),d=n(43),p=n(997),h=n(436),f=n(993),m=50,g=["foursquare.com","facebook.com","maps.google.com"],v=r.createClass({displayName:"Location",mixins:[o,a],propTypes:{msg:r.PropTypes.instanceOf(s).isRequired,quotedMsg:r.PropTypes.element,displayAuthor:r.PropTypes.bool},statics:{previewWidth:270,previewHeight:150},getInitialState:function(){var e="",t=!1,n=this.getStaticMapUrl();return f.isCached(n)&&(e=n,t=!0),{src:e,hiResAvail:t}},componentDidMount:function(){this.updateResolution(),this.regNativeListener(window,"dpichange",this.updateResolution)},getClientThumb:function(){return"data:image/jpeg;base64,"+this.async("msg.body")},getStaticMapUrl:function(){var e=this.props.msg,t=v.previewWidth,n=v.previewHeight+m,r=h.currentRes===h.RES.HIGH?2:1,i=u.build("https://maps.googleapis.com/maps/api/staticmap",{markers:"color:red|"+e.lat+", "+e.lng,zoom:14,size:t+"x"+n,scale:r,language:l10n.getLocale(),client:u.GSM_NAME});return u.gsmURL(i,u.GSM_NUMS)},getMapUrl:function(){var e=this.props.msg,t=this.loc();return t&&t.name?["https://maps.google.com/maps/search",encodeURIComponent(t.name),"@"+e.lat+","+e.lng+",17z"].join("/")+"?hl="+l10n.getLocale():u.build("https://maps.google.com/maps",{q:e.lat+","+e.lng,z:17,hl:l10n.getLocale()})},loc:function y(){var y=this.props.msg.get("loc");if(y)return y=y.split("\n"),2===y.length?{name:y[0],addr:y[1]}:{name:y}},getLocationDetails:function(){var e=this.props.msg,t=this.loc(),n=this.props.msg.clientUrl||this.getMapUrl(),o=void 0,a=void 0,s=void 0,c=u.hostname(n),l=_.isEmpty(g.filter(function(e){return c.indexOf(e)>-1}));if(s=l?r.createElement("div",{className:"location-page-host location-caption"},r.createElement(i,null,c)):null,t){o=t.name?r.createElement("a",{href:n,title:t.name,target:"_blank",className:"text-title"},r.createElement(i,null,t.name)):null;var p=d("text-contents",{"location-caption":!s});a=t.addr?r.createElement("div",{title:t.addr,className:p},r.createElement(i,null,t.addr)):null}var h=o&&a?r.createElement("div",{className:"image-caption message-text","data-id":e.id},o,a,s):null;return h},updateResolution:function(){this.setState({src:this.getStaticMapUrl()})},onImgLoaded:function(){this.state.hiResAvail||this.setState({hiResAvail:!0})},render:function(){var e=this.props.msg,t=this.getLocationDetails(),n=t?null:r.createElement("div",{className:"shade"}),i=this.props.displayAuthor&&l.shouldRender(e)?r.createElement(l,{msg:e}):null,o=d("bubble-location",{"bubble-location-caption":t,"bubble-broadcast":t&&e.broadcast,"bubble-star":t&&e.star}),a={background:"url("+this.getClientThumb()+")",backgroundSize:"cover",width:v.previewWidth,height:this.state.hiResAvail?void 0:v.previewHeight},s={height:v.previewHeight},u=d("image-thumb-body",{"image-thumb-location-lores":!this.state.hiResAvail});return r.createElement("div",{className:o},i,this.props.quotedMsg,r.createElement("div",{className:"image-thumb",style:s},r.createElement("a",{href:this.getMapUrl(),target:"_blank"},r.createElement(p,{src:this.state.src,className:u,style:a,hasPrivacyChecks:!1,onLoaded:this.onImgLoaded,noXHR:!0})),n),t,r.createElement(c,{msg:e}))}});e.exports=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(883),o=r(i),a=n(6),s=n(988),c=n(974),l=n(196),u=n(43),d=n(80),p=a.createClass({displayName:"PreviewImage",propTypes:{duration:a.PropTypes.oneOfType([a.PropTypes.string,a.PropTypes.number]),shade:a.PropTypes.bool,thumb:a.PropTypes.string,className:a.PropTypes.string,type:a.PropTypes.oneOf([c.TYPE.AUDIO,c.TYPE.LOCATION,c.TYPE.VIDEO,c.TYPE.PTT,c.TYPE.VCARD]).isRequired},getDefaultProps:function(){return{shade:!0}},getIconClassNames:function(){return this.props.type===c.TYPE.VIDEO?"icon-sm icon-video-inv":this.props.type===c.TYPE.AUDIO?"icon-sm icon-arrow-inv":void 0},getClassNames:function(){return u("preview",this.props.className,(0,o["default"])({"icon-user-default":this.props.type===c.TYPE.VCARD,"icon-user-default-square":this.props.type!==c.TYPE.VCARD},"preview-"+this.props.type+" no-image",!this.props.thumb))},getStyles:function(){var e=this.props.thumb;return e?d.isHttp(e)?{backgroundImage:'url("'+e+'")'}:{backgroundImage:'url("data:image/jpeg;base64,'+e+'")'}:{}},render:function(){var e=l.durationStr(this.props.duration),t=this.props.shade?a.createElement("span",{className:"shade"}):null;return a.createElement("div",{className:this.getClassNames(),style:this.getStyles()},t,a.createElement("span",{className:"meta meta-audio"},a.createElement("span",{className:this.getIconClassNames()}),a.createElement(s,null,e)))}});e.exports=p},function(e,t,n){"use strict";var r=n(6),i=n(1069),o=n(982),a=n(129),s=n(980),c=n(974),l=r.createClass({displayName:"ProfileImage",mixins:[a,s],propTypes:{waid:r.PropTypes.string,thumb:r.PropTypes.string,className:r.PropTypes.string},componentWillMount:function(){var e=this,t=this.props.waid;t&&Store.ProfilePicThumb.find(t).checkpoint(this.rejectOnUnmount()).then(function(t){e.addObserverAndRun(t,"change:img",function(){e.setState({img:t.img})})})["catch"](_.noop)},render:function(){return this.state.img?r.createElement("div",{className:this.props.className},r.createElement(o,{id:this.props.waid,size:o.Size.AUTO})):r.createElement(i,{className:this.props.className,thumb:this.props.thumb,type:c.TYPE.VCARD,shade:!1})}});e.exports=l},function(e,t,n){"use strict";var r=n(6),i=n(10),o=n(988),a=n(974),s=n(977),c=n(984),l=n(986),u=n(1010),d=n(884),p=n(129),h=n(980),f=n(976),m=n(1070),g=n(196),v=n(1021),y=n(975),_=n(43),E=a.TYPE,b=E.CHAT,S=E.IMAGE,M=E.VIDEO,T=E.LOCATION,C=E.DOCUMENT,w=E.VCARD,x=E.AUDIO,N=r.createClass({displayName:"QuotedMsg",mixins:[y,p,d,h],propTypes:{msg:r.PropTypes.instanceOf(a).isRequired,chat:r.PropTypes.instanceOf(s).isRequired,onOmit:r.PropTypes.func,rootMsg:r.PropTypes.instanceOf(a)},getInitialState:function(){return this.props.rootMsg?this.asyncState({clickable:"rootMsg.isQuotedMsgAvailable",mediaState:"msg.mediaState"},{hover:!1}):this.asyncState({mediaState:"msg.mediaState"},{hover:!1})},onClick:function(){if(this.state.clickable){var e=this.props,t=e.chat,n=e.rootMsg,r=e.msg,o=r.id,a=t.getSearchContext(Store.Msg.get(o)||o,n);a&&(a.slideToMsg=!0),i.openChat(t,a,!1),i.focusShowMsg(o)}},onMouseOver:function(e){this.state.clickable&&!this.state.hover&&this.setState({hover:!0})},onMouseEnter:function(e){this.state.clickable&&!this.state.hover&&this.setState({hover:!0})},onMouseLeave:function(e){this.state.hover&&this.setState({hover:!1})},render:function(){var e=this.props.msg,t=this.props.chat.assignedColor(e.sender),n=r.createElement(l,{msg:e,className:"quoted-msg-bubble-ptt-author",displaySelf:e.sender===Store.Conn.me,disableClick:!0}),i=[];e.hasSymbol&&i.push(r.createElement(u,{msg:e,key:"msg-symbol"})),[M,x].indexOf(e.type)>-1&&!e.isGif&&i.push(g.durationStr(e.duration)+" ");var a=void 0,s=null;[S,M,b].indexOf(e.type)>-1?(a=c.msgText(e,!1),s=e.mentionMap()):a=c.msgText(e),i.push(r.createElement(f,{format:!0,mention:s,text:a,direction:"auto",key:"status"}));var d=void 0,p="quoted-msg-image";switch(e.type){case S:case M:case T:case C:if(e.body){var h=e.type===S&&e.url?e.url:"data:image/jpeg;base64,"+e.body;d=r.createElement("div",{style:{backgroundImage:"url("+h+")"},className:p})}break;case b:e.thumbnail&&(d=r.createElement("div",{style:{backgroundImage:'url("data:image/jpeg;base64,'+e.thumbnail+'")'},className:p}));break;case w:d=r.createElement(m,{waid:e.vcardWAid,thumb:e.body&&v.thumbnail(e.body),className:p})}var y=_("quoted-msg",{"quoted-msg-hover":this.state.hover}),E=this.props.onOmit?r.createElement("div",{style:{display:"flex",flex:"0 0 auto"}},d,r.createElement("div",{className:"btn-background"},r.createElement("button",{className:"icon icon-x",onClick:this.props.onOmit}))):d;return r.createElement("div",{className:y,onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onClick},r.createElement("div",{className:"quoted-msg-status"},r.createElement("span",{className:"bg-color-"+t+" quoted-msg-color-bar"}),r.createElement("div",{className:"quoted-msg-info"},r.createElement("div",null,n,r.createElement("div",{className:"chat-status message-text quoted-msg-text"},r.createElement(o,null,i))))),E)}});e.exports=N},function(e,t,n){"use strict";var r=n(6),i=n(78),o=n(130),a=n(133),s=n(415),c=n(1020),l=n(54),u=n(430),d=n(134),p=r.createClass({displayName:"EmojiInput",mixins:[i,o,a],propTypes:{focusOnMount:r.PropTypes.bool,editable:r.PropTypes.bool,format:r.PropTypes.bool,value:r.PropTypes.string,selection:r.PropTypes.object,className:r.PropTypes.string,placeholder:r.PropTypes.string,onKeyPress:r.PropTypes.func,onEnter:r.PropTypes.func,onChange:r.PropTypes.func,onFocus:r.PropTypes.func,onBlur:r.PropTypes.func,onMouseDown:r.PropTypes.func,onSelectionChange:r.PropTypes.func,maxLength:r.PropTypes.number,multiline:r.PropTypes.bool,spellCheck:r.PropTypes.bool,focusOnChange:r.PropTypes.bool},getDefaultProps:function(){return{editable:!0,format:!1,value:"",focusOnChange:!0}},getInitialState:function(){return this.value=this.props.value||"",this.selection=this.props.selection,null},componentWillMount:function(){this.debouncedSaveSelection=this.safeDebounce(this._saveSelection,0)},componentWillReceiveProps:function(e){if(e.value!==this.value&&(this.setNewValue(e.value||"",!1),this.updateDOM(),this.props.focusOnChange&&this.safeDefer(this.restoreFocus.bind(this,!0))),this.props.editable!==e.editable){var t=this.refs.input;t.contentEditable=e.editable,e.editable&&this._disableObjectResize()}},restoreFocus:function(e){if(this.props.editable){var t=this.refs.input;if(d.focus(t),this.selection&&!e)this.restoreSelection(this.selection);else{var n=window.getSelection();n&&(n.selectAllChildren(t),n.collapseToEnd())}this.debouncedSaveSelection()}},componentDidMount:function(){this.props.focusOnMount&&this.safeDefer(this.restoreFocus),this.props.editable&&this._disableObjectResize(),this.refs.input.restoreFocus=this.restoreFocus,this.refs.input.pasteText=this.pasteText},componentWillUnmount:function(){this.refs.input.restoreFocus=null},_disableObjectResize:function(){l.isGecko&&document.execCommand("enableObjectResizing",!1,!1)},limitLength:function(e){var t=this.props.maxLength;if(!t)return e;e=e||"";var n=this.selectionLength(),r=n+t-c.multibyteLength(this.value);return r>0?c.multibyteSubstr(e,0,r):""},onMouseDown:function(e){e.stopPropagation(),this.regNativeListener(window,"mouseup",this.onWindowMouseUp),this.props.onMouseDown&&this.props.onMouseDown(e)},onWindowMouseUp:function(){this.unregNativeListener(window,"mouseup",this.onWindowMouseUp),this.debouncedSaveSelection()},onContextMenu:function(e){e.stopPropagation()},onKeyUp:function(e){
if(l.isTrident&&this.onInput(e),"Backspace"===e.key||"Delete"===e.key){var t=this.refs.input;switch(t.innerHTML){case"\n":case"\r\n":case"<br>":t.innerHTML="",this.setNewValue("",!0,!0)}}this.debouncedSaveSelection()},onKeyPress:function(e){if(l.isTrident&&this.onInput(e),!this.props.onKeyPress||(this.props.onKeyPress(e),!e.defaultPrevented)){this.props.multiline||"Enter"!==e.key||(e.preventDefault(),this.props.onEnter&&this.props.onEnter(e));var t=this.limitLength(u.ucs2.encode([e.charCode]));t.length||e.preventDefault()}},onInput:function(e){var t=this.refs.input;e=_.isBoolean(e)?e:void 0,this.setNewValue(s.NodeToEmoji(t),!0,e)},setNewValue:function(e,t,n){if(e!==this.value||n){if(e&&!this.value){var r=this.refs.placeholder;r&&(r.style.display="none")}else if(this.value&&!e){var i=this.refs.placeholder;i&&(i.style.display="")}this.value=e,t&&this.props.onChange&&this.props.onChange({target:{value:e}}),this.debouncedSaveSelection()}},updateDOM:function(){var e=s.emojiToHTML(_.escape(this.value)),t=this.refs.input;t.innerHTML!==e&&(t.innerHTML=e)},selectionLength:function(){if(!this.props.editable)return 0;var e=this.refs.input;d.focus(e);var t=window.getSelection();if(t.rangeCount){var n=t.getRangeAt(0);return c.multibyteLength(s.NodeToEmoji(n.cloneContents()))}return 0},_saveSelection:function(){var e=this.getSelection();_.isEqual(e,this.prevSelection)||(this.props.onSelectionChange&&this.props.onSelectionChange(e),this.prevSelection=this.selection,this.selection=e)},isCollapsed:function(){if(this.isMounted()){var e=this.refs.input;if(document.activeElement!==e)return null;var t=window.getSelection();return t.isCollapsed}},getCursor:function(){if(!this.isMounted())return-1;var e=this.refs.input;if(document.activeElement!==e)return null;var t=window.getSelection(),n=t.anchorNode,r=t.anchorOffset,i=e.childNodes,o=0;e===n&&(n=i[r]);for(var a=0;a<i.length;a++){var s=i[a];if(s===n)return o+r;s.nodeType===window.Node.ELEMENT_NODE&&s.alt?o+=s.alt.length:s.nodeType===window.Node.TEXT_NODE&&(o+=s.length)}return o},isAtBeginning:function(){return this.isCollapsed()&&0===this.getCursor()},isAtEnd:function(){return this.isCollapsed()&&this.getCursor()===this.value.length},getSelection:function(){if(!this.isMounted())return null;var e=this.refs.input;if(document.activeElement!==e)return null;for(var t=window.getSelection(),n=t.anchorNode,r=t.anchorOffset,i=t.focusNode,o=t.focusOffset,a=e.childNodes,s=-1,c=-1,l=!1,u=!1,d=0;d<a.length;d++){var p=a[d];if(p===n&&(s=d,l=!0),p===i&&(c=d,u=!0),l&&u)break}return{anchor:{index:s,offset:r},focus:{index:c,offset:o}}},restoreSelection:function(e){var t,n,r,i,o,a,s=this.refs.input,c=s.childNodes;e.anchor.index===-1?(t=s,r=e.anchor.offset,o=0):(t=c[e.anchor.index],r=e.anchor.index,o=e.anchor.offset),e.focus.index===-1?(n=s,i=e.focus.offset,a=0):(n=c[e.focus.index],i=e.focus.index,a=e.focus.offset);var u;u=r===i?a>=o?"forward":"reverse":r>i?"reverse":"forward";var d=window.getSelection();if(t&&n)try{var p=document.createRange();return void(l.isTrident?("forward"===u?(p.setStart(t,e.anchor.offset),p.setEnd(n,e.focus.offset)):(p.setStart(n,e.focus.offset),p.setEnd(t,e.anchor.offset)),d.removeAllRanges(),d.addRange(p)):(p.setStart(t,e.anchor.offset),d.removeAllRanges(),d.addRange(p),d.extend(n,e.focus.offset)))}catch(h){d.selectAllChildren(s),d.collapseToEnd()}else d.selectAllChildren(s),d.collapseToEnd()},onCut:function(e){l.isTrident&&this.onInput(e)},onPaste:function(e){if(this.props.onPaste&&this.props.onPaste(e),!e.defaultPrevented){e.preventDefault();var t=l.isTrident?"text":"text/plain",n=e.clipboardData.getData(t);this.pasteText(n)}},pasteText:function(e){e&&(this.props.maxPaste&&e.length>this.props.maxPaste?this.props.onMaxPasteExceeded():this.replaceSelection(e))},replaceSelection:function(e){if(this.props.editable&&(d.focus(this.refs.input),e=this.limitLength(e),0!==e.length)){this.props.multiline||(e=e.replace(/\n+/g," ").replace(/(\r\n)+/g," "));var t=window.getSelection(),n=null;t.getRangeAt&&t.rangeCount&&(n=t.getRangeAt(0),n.deleteContents());var r=this.refs.input,i=r.scrollTop,o=r.scrollHeight,a=s.emojiToHTML(_.escape(e));l.isTrident?n&&this.replaceSelectionTrident(a,t,n):document.execCommand("insertHTML",!1,a),this.onInput(!0),this.debouncedSaveSelection(),this.scrollToCursor(i,o)}},scrollToCursor:function(e,t){var n=this.refs.input,r=n.scrollHeight,i=n.clientHeight;if(!(r<=i)){var o=r-t;this.refs.input.scrollTop=(e||0)+o}},replaceSelectionTrident:function(e,t,n){var r=document.createElement("div");r.innerHTML=e;for(var i,o,a=document.createDocumentFragment();i=r.firstChild;)o=a.appendChild(i);n.insertNode(a),o&&(n=n.cloneRange(),n.setStartAfter(o),n.collapse(!0),t.removeAllRanges(),t.addRange(n))},shouldComponentUpdate:function(){return!1},render:function(){var e=s.emojiToHTML(_.escape(this.value)),t=this.props.className?"input "+this.props.className:"input",n="input-emoji",i=this.props.placeholder&&!this.props.value?r.createElement("div",{className:"input-placeholder",ref:"placeholder"},this.props.placeholder):null;return r.createElement("div",{className:n},i,r.createElement("div",{dangerouslySetInnerHTML:{__html:e},dir:"auto",ref:"input",spellCheck:this.props.spellCheck,"data-tab":this.props.editable?1:null,contentEditable:this.props.editable,className:t,onInput:this.onInput,onPaste:this.onPaste,onCut:this.onCut,onKeyUp:this.onKeyUp,onKeyPress:this.onKeyPress,onMouseDown:this.onMouseDown,onContextMenu:this.onContextMenu,onFocus:this.props.onFocus,onBlur:this.props.onBlur}))}});e.exports=p},function(e,t,n){"use strict";function r(e,t,n){this.key=e,this.css=t,this.title=n,this.className="emoji-"+e}var i=n(6),o=n(15),a=n(129),s=n(130),c=n(133),l=n(78),u=n(415),d=n(1226),p=n(976),h=n(983),f=n(419),m=n(1161),g=n(102),v=n(63),y=n(197),E=n(1125),b={RECENT:new r("RECENT","icon-emoji-recent",function(){return l10n.t("emoji_tab_recent")}),SMILEYS_PEOPLE:new r("SMILEYS_PEOPLE","icon-emoji-people",function(){return l10n.t("emoji_tab_smileys_people")}),ANIMALS_NATURE:new r("ANIMALS_NATURE","icon-emoji-nature",function(){return l10n.t("emoji_tab_animals_nature")}),FOOD_DRINK:new r("FOOD_DRINK","icon-emoji-food",function(){return l10n.t("emoji_tab_food_drink")}),ACTIVITY:new r("ACTIVITY","icon-emoji-activity",function(){return l10n.t("emoji_tab_activity")}),TRAVEL_PLACES:new r("TRAVEL_PLACES","icon-emoji-travel",function(){return l10n.t("emoji_tab_travel_places")}),OBJECTS:new r("OBJECTS","icon-emoji-objects",function(){return l10n.t("emoji_tab_objects")}),SYMBOLS:new r("SYMBOLS","icon-emoji-symbols",function(){return l10n.t("emoji_tab_symbols")}),FLAGS:new r("FLAGS","icon-emoji-flags",function(){return l10n.t("emoji_tab_flags")}),GIFS:new r("GIFS","icon-emoji-gifs",function(){return l10n.t("emoji_tab_gifs")})},S=[b.RECENT,b.SMILEYS_PEOPLE,b.ANIMALS_NATURE,b.FOOD_DRINK,b.ACTIVITY,b.TRAVEL_PLACES,b.OBJECTS,b.SYMBOLS,b.FLAGS],M=S.concat([b.GIFS]),T=[""].concat(u.skinToneVariations),C=i.createClass({displayName:"EmojiPanel",propTypes:{onEmoji:i.PropTypes.func.isRequired,onGif:i.PropTypes.func},getInitialState:function(){var e=S;this.props.onGif&&(e=M);var t=Store.RecentEmoji.length>0?b.RECENT:b.SMILEYS_PEOPLE,n=b[o.getLastEmojiTab()];return n&&e.indexOf(n)>-1&&(t=n),{tabs:e,selected:t}},componentWillUnmount:function(){o.setLastEmojiTab(this.state.selected.key)},onSelectTab:function(e){var t=this.state.tabs,n=t.indexOf(this.state.selected),r=t.indexOf(e),i=r>n?"right":"left";this.setState({selected:e,direction:i})},onEmoji:function(e){this.props.onEmoji(e),Store.RecentEmoji.increment(e)},render:function(){var e=this,t=void 0;t=this.state.selected===b.GIFS?i.createElement(m,{onGif:this.props.onGif}):i.createElement("div",{className:"emoji-panel-body",key:this.state.selected.key},i.createElement(x,{tab:this.state.selected,onEmoji:this.onEmoji}));var n=this.state.tabs,r=n.indexOf(this.state.selected),o=n.map(function(t){return i.createElement("button",{className:"menu-item"+(e.state.selected===t?" active":""),onClick:function(){return e.onSelectTab(t)},key:t.key,title:t.title()},i.createElement("span",{className:"icon "+t.css}))}),a=l10n.isRTL()?-1:1,s={width:100/o.length+"%",transform:"translateX("+100*r*a+"%)"},c="right"===this.state.direction?"slide-forward":"slide-back";return i.createElement("div",{className:"emoji-panel k"},i.createElement("div",{className:"menu-tabs menu-tabs-emoji emoji-panel-header","data-active-tab":this.state.selected.key},i.createElement("div",{style:s,className:"menu-tabs-marker"}),o),i.createElement(g,{transitionName:c},t))}});e.exports=C;var w=function(e,t,n){for(var r=arguments.length,i=Array(r>3?r-3:0),o=3;o<r;o++)i[o-3]=arguments[o];return function(r){return r&&(r.preventDefault(),r.stopPropagation()),t&&(n?t.call.apply(t,[e,r].concat(i)):t.apply(e,i))}},x=i.createClass({displayName:"EmojiTab",mixins:[a,c,s,l],propTypes:{tab:i.PropTypes.oneOf(S).isRequired,onEmoji:i.PropTypes.func.isRequired},getInitialState:function(){var e={skinTonePicker:!1};return this.props.tab===b.RECENT&&(e.recent=Store.RecentEmoji.models.map(function(e){return u.emojiMap[e["char"]]}),e.variants={}),e},componentDidMount:function(){var e=this;this.addObserver(Store.EmojiVariant,"add remove change:variant",function(){return e.forceUpdate()})},onEmoji:function(e){this.props.onEmoji(e)},setEmojiVariant:function(e,t){if(this.onEmoji(t),Store.EmojiVariant.setVariant(e,t),this.state.recent){var n=this.state.variants;n[e]=t,this.setState({variants:n})}},onContextMenu:function(e,t,n){this.clearPickerTimer(),e&&(e.preventDefault(),e.stopPropagation());var r=this.setEmojiVariant,o=u.skinToneEmojis[t],a=T.map(function(e,n){var a=u.variantToUnicode(o,e);return i.createElement(h,{key:a,action:_.partial(r,t,a)},i.createElement(p,{text:a,emojiSize:p.EMOJI_SIZE.LARGE}))});this.setState({skinTonePicker:{menu:a,anchor:n||e.target,type:f.Type.PICKER,menuDirection:{x:f.Direction.X.RIGHT,y:f.Direction.Y.TOP}}})},closeSkinTonePicker:function(){this.setState({skinTonePicker:!1})},clearPickerTimer:function(){this.pickerTimer&&(this.unregNativeListener(window,"mouseup",this.clearPickerTimer,!0),this.clearSafeTimeout(this.pickerTimer),this.pickerTimer=null)},eatClick:function(e){e.preventDefault(),e.stopPropagation(),this.unregCmd("window_click",this.eatClick)},startPickerTimer:function(e,t){var n=this;this.clearPickerTimer();var r=e.target;this.pickerTimer=this.safeDelay(function(){n.regCmd("window_click",n.eatClick),n.onContextMenu(null,t,r)},250),this.regNativeListener(window,"mouseup",this.clearPickerTimer,!0)},getEmoji:function(){var e=this,t=this.onContextMenu,n=this.startPickerTimer,r=this.onEmoji,o=this.state,a=o.recent,s=o.variants,c=a?this.state.recent:d[this.props.tab.key];return c.map(function(o){var c=u.codeToEmoji[o],l=void 0,d=void 0,p=void 0;if(u.skinToneEmojis[c]){p=w(e,t,!0,c),l=w(e,n,!0,c);var h;a?(h=s[c],h?(o=u.emojiMap[h],d=w(e,r,!1,h)):d=w(e,r,!1,c)):(h=Store.EmojiVariant.getVariant(c),h?(o=u.emojiMap[h],d=w(e,r,!1,h)):d=p)}else l=w(),d=w(e,r,!1,c);return i.createElement("span",{key:c,onClick:d,onContextMenu:p,onMouseDown:l,className:"emojik emoji"+o})})},render:function(){var e=void 0;return this.state.skinTonePicker&&(e=i.createElement(y,{displayName:"SkinTonePicker",popable:!0,escapable:!0,requestDismiss:this.closeSkinTonePicker},i.createElement(E,{tooltip:this.state.skinTonePicker}))),i.createElement("div",{className:this.props.tab.className},this.getEmoji(),e)}});x.contextTypes={uim:i.PropTypes.instanceOf(v)}},function(e,t,n){"use strict";var r=n(6),i=n(991),o=n(1077),a=n(977),s=n(10),c=n(54),l=r.createClass({displayName:"AttachMediaFlow",mixins:[i],propTypes:{files:r.PropTypes.array,state:r.PropTypes.string,chat:r.PropTypes.instanceOf(a).isRequired},componentWillMount:function(){s.closeContextMenu(),s.closeTooltip(),this.push(r.createElement(o,{chat:this.props.chat,files:this.props.files,state:this.props.state,onBack:this.endFlow,onSendMedia:_.once(this.sendMedia),onDropText:_.once(this.setText)}))},componentWillUnmount:function(){var e=this;c.isGecko?_.defer(function(){return s.focusChatTextInput(e.props.chat)}):s.focusChatTextInput(this.props.chat)},sendMedia:function(e){var t=this.props.chat;_.delay(function(){t.sendMedia2(e,t.composeQuotedMsg),t.composeQuotedMsg=null},300),this.endFlow()},setText:function(e){var t=this.props.chat;_.delay(function(){s.pasteChatTextInput(t,e)},300),this.endFlow()}});e.exports=l},function(e,t,n){"use strict";var r=n(6),i=n(991),o=n(977),a=n(1083),s=n(1182),c=n(101),l=n(1177),u=n(1171),d=n(1166),p=r.createClass({displayName:"InfoFlow",mixins:[i],propTypes:{chat:r.PropTypes.instanceOf(o).isRequired},componentWillMount:function(){var e=c.supportsFeature(c.F.STARRED)&&c.supportsFeature(c.F.FULL_TEXT_SEARCH),t=e?this.onStarred:null,n=c.supportsFeature(c.F.MEDIA_GALLERY)?this.onMediaGallery:null,i=null;this.props.chat.isGroup?i=r.createElement(l,{chat:this.props.chat,onVerification:this.onVerification,onStarred:t,onMediaGallery:n,onClose:this._pop}):this.props.chat.isBroadcast?i=r.createElement(d,{chat:this.props.chat,onStarred:t,onMediaGallery:n,onClose:this._pop}):this.props.chat.isUser&&(i=r.createElement(u,{contact:this.props.chat.contact,onVerification:this.onVerification,onStarred:t,onMediaGallery:n,onClose:this._pop})),this.push(i)},onStarred:function(){var e=r.createElement(a,{type:this.props.type,chat:this.props.chat,onClose:this._pop});this.push(e)},onMediaGallery:function(){var e=r.createElement(s,{chat:this.props.chat,onBack:this._pop});this.push(e)},_pop:function(){this.pop()}});e.exports=p},function(e,t,n){"use strict";var r=n(81),i=50,o=75,a={getInitialState:function(){var e=this;this._setState=this.setState,this.setState=function(t,n,r){_.assign(e.getBatchRenderState(),t),_.isUndefined(n)&&_.isUndefined(r)?e._debounceSetState.forceRun():_.isUndefined(r)?e._debounceSetState.debounce(n):e._debounceSetState.debounceAndCap(n,r)}},componentWillMount:function(){var e=this;this._debounceSetState=new r(function(){e._setState(e._batchRenderMixinState),e._batchRenderMixinState={}})},componentWillUnmount:function(){this._debounceSetState.cancel()},getBatchRenderState:function(){return this._batchRenderMixinState||(this._batchRenderMixinState={}),this._batchRenderMixinState}};a.DD=o,a.CD=i,e.exports=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(417),o=r(i),a=n(2),s=r(a),c=n(6),l=n(34),u=n(14),d=n(130),p=n(133),h=n(980),f=n(8),m=n(10),g=n(1035),v=n(1088),y=n(43),E=n(418),b=n(998),S=n(131),M=S.HotKeys,T=n(978),C=n(981),w=n(979),x=n(1022),N=n(1102),P=n(1100),k=n(1103),D=n(1101),O=n(1225),A=n(977),R=n(134),I=n(132),L=n(413),F=n(102),U=n(984),j=n(201),B=_.pickBy(j.MIMETYPES,function(e){return"document"===e.msgType}),G=function(e){return 150+15*e},z=400,Y="image",H="video",W="document",q="audio",V={ACTIVE:"active",PROCESSING:"processing",INVALID:"invalid"},K=1,X=c.createClass({displayName:"AttachMediaDrawer",mixins:[d,p,h],propTypes:{chat:c.PropTypes.instanceOf(A),files:c.PropTypes.array,state:c.PropTypes.oneOf(_.values(V)),onBack:c.PropTypes.func.isRequired,onSendMedia:c.PropTypes.func.isRequired,onDropText:c.PropTypes.func.isRequired},statics:{STATE:V},getDefaultProps:function(){return{state:V.PROCESSING,reason:null,isDragging:!1}},getInitialState:function(){return{state:this.props.state,activeIndex:-1,media:[]}},componentWillMount:function(){this.regNativeListener(window,"keydown",this.onKeyDown),this.regNativeListener(window,"drop",this.onWindowDrop)},componentDidMount:function(){if(this.props.files){var e=this;this.safeDelay(function(){e.initialize()},300)}},componentWillUnmount:function(){this.state.media&&this.state.media.forEach(function(e){var t=e.preview;window.URL.revokeObjectURL(t)})},componentDidUpdate:function(e,t){this.state.state!==V.INVALID&&this.state.reason&&this.setState({reason:null}),t.state!==V.ACTIVE&&this.state.state===V.ACTIVE&&this.refs.emojiInput?this.refs.emojiInput.restoreFocus():!l.findDOMNode(this).contains(document.activeElement)&&this.refs.sendButton&&R.focus(this.refs.sendButton)},ignoreInvalidMedia:function(e,t){var n=this.state.media.concat(e),r=_.reject(n,function(e){return e instanceof Error}),i=n.length-r.length;if(i>0){var o="drop"===t?l10n.t("invalid_partial_dropped_media_files",{number:i,_plural:i}):l10n.t("invalid_partial_selected_media_files",{number:i,_plural:i});m.openToast(c.createElement(L,{msg:o,id:L.genId()}))}return r},initialize:function(){var e=this,t=this.props.files;t=t.slice(0,Math.min(t.length,f.MAX_FILES)),this.processFiles(t).checkpoint(this.rejectOnUnmount()).then(function(n){var r=e.props.files.length-t.length;e.showIgnoredToast(r);var i=e.ignoreInvalidMedia(n,"change"),o=e.state.media.length;e.setState({prevIndex:void 0,activeIndex:Math.min(o,Math.min(i.length-1,9)),media:i,state:V.ACTIVE})})["catch"](u.Unmount,_.noop)["catch"](u.MediaFileError,u.MediaFileTooLarge,function(t){e.setState({state:V.INVALID,activeIndex:-1,reason:t,prevIndex:void 0})})},processFiles:function(e){this.setState({state:V.PROCESSING});var t=this.props.chat;return s["default"].map(e,function(e){var n=e.isGifHackDoNotUse?{isGif:!0,gifAttribution:e.gifAttributionHackDoNotUse}:void 0;return s["default"].resolve().then(function(){var n=E.typeFromMimetype(e.type);if(n===W)return t.shouldSendEncrypted("document")}).then(function(){return g.prepFileForUpload(e,n)}).then(function(e){return O.enrich(e)}).then(function(t){var n=K++,r=window.URL.createObjectURL(t.blob);return t.getThumb?t.getThumb.then(function(e){var i=e.url;return{media:t,uniqKey:n,url:i,preview:r}}):{media:t,uniqKey:n,url:"",name:e.name,preview:r}})["catch"](u.InvalidMediaFileType,function(e){return e})["catch"](u.MediaFileTooLarge,function(e){throw e})})},showIgnoredToast:function(e){if(e){var t=l10n.t("too_many_files_uploaded",{number:e,_plural:e,max:f.MAX_FILES});m.openToast(c.createElement(L,{msg:t,id:L.genId()}))}},onDragStart:function(e){this.blockDrop=!0},onDragEnd:function(e){this.blockDrop=!1},onDragOver:function(e){this.state.isDragging||this.blockDrop||this.setState({isDragging:!0})},onWindowDrop:function(e){_.isEmpty(this.props.files)&&_.isEmpty(this.state.media)&&this.props.onBack()},onDrop:function(e){this.blockDrop||(this.setState({isDragging:!1}),this.onFilePick(e))},onDragLeave:function(e){this.state.media.length||this.props.onBack(),this.setState({isDragging:!1})},onKeyDown:function(e){if(this.state.state!==V.INVALID&&!e.repeat)if(37===e.keyCode){var t=this.state.media[this.state.activeIndex],n=this.refs.emojiInput&&this.refs.emojiInput.refs.inputLine;(t&&!t.media.caption||n&&n.isAtBeginning())&&this.onPrev()}else if(39===e.keyCode){var r=this.state.media[this.state.activeIndex],i=this.refs.emojiInput&&this.refs.emojiInput.refs.inputLine;(r&&!r.media.caption||i&&i.isAtEnd())&&this.onNext()}},onNext:function(){this.state.activeIndex+1<this.state.media.length&&this.setState({prevIndex:this.state.activeIndex,activeIndex:this.state.activeIndex+1,state:V.ACTIVE})},onPrev:function(){this.state.activeIndex>0&&this.setState({prevIndex:this.state.activeIndex,activeIndex:this.state.activeIndex-1,state:V.ACTIVE})},onSelectThumb:function(e,t){e!==this.state.activeIndex&&this.setState({prevIndex:this.state.activeIndex,activeIndex:e,state:V.ACTIVE})},onSend:function(e){this.props.onSendMedia(_.map(this.state.media,function(e){var t=e.media;return t.caption=U.emojify(_.trim(t.caption)),t})),e&&e.preventDefault()},onAddFileClick:function(e){var t=this.refs.input;t.click()},onFilePick:function(e){var t=this,n=e.type,r=e.target.files||e.dataTransfer.files,i=!!e.dataTransfer&&(e.dataTransfer.getData("text/uri-list")||e.dataTransfer.getData("text/html")),o=0===r.length&&i,a=o?1:r.length;v.getFiles(e,this.state.media.length).then(this.processFiles).checkpoint(this.rejectOnUnmount()).then(function(e){if(a+t.state.media.length>f.MAX_FILES){var r=a-e.length;t.showIgnoredToast(r)}var i=t.ignoreInvalidMedia(e,n),o=t.state.media.length;t.setState({prevIndex:void 0,activeIndex:Math.min(o,Math.min(i.length-1,9)),media:i,state:V.ACTIVE})})["catch"](u.Unmount,_.noop)["catch"](u.MediaDragDropError,function(e){if(t.state.media.length)throw e;t.props.onDropText(e.src)})["catch"](u.MediaFileError,u.MediaFileTooLarge,function(e){t.setState({state:V.INVALID,activeIndex:-1,reason:e,prevIndex:void 0})}),e.target.value=""},onRemoveThumb:function(e,t){t.stopPropagation(),t.preventDefault();var n=this.state.media,r=n.splice(e,1),i=(0,o["default"])(r,1),a=i[0];window.URL.revokeObjectURL(a.preview);var s=this.state.activeIndex;s>=e&&(s=Math.max(--s,0)),this.setState({prevIndex:void 0,activeIndex:n.length?s:-1,media:n})},onCaptionChange:function(e){var t=this.state.media;t[this.state.activeIndex].media.caption=e.target.value,this.setState({media:t})},getFileType:function(e){var t=e.type;return t.match(/^image\/.*/)?Y:t.match(/^video\/.*/)?H:t.match(/^audio\/.*/)?q:W},render:function(){var e,t,r,i,o=this,a=0,s="media-scale",l=this.state.activeIndex;if(this.state.state===V.PROCESSING)e=c.createElement(I,{key:"processing"});else if(this.state.state===V.ACTIVE&&l>-1){var d=this.state.media[l];switch(d.media.msgType){case Y:case H:var p=void 0;d.media.width&&d.media.height&&(p={width:d.media.width,height:d.media.height}),e=c.createElement(N,{mimeType:d.media.mimetype,url:d.preview,isGif:!!d.media.isGif,size:p}),t=c.createElement("div",{className:"media-caption"},c.createElement(b,{ref:"emojiInput",editable:!0,value:this.state.media[l].media.caption,placeholder:l10n.t("add_a_caption"),maxLength:f.MAX_CAPTION_LENGTH,showRemaining:!0,onEnter:this.onSend,onChange:this.onCaptionChange,supportsEmoji:!0}));break;case q:e=c.createElement(P,{mimeType:d.media.mimetype,url:d.preview});break;case W:switch(j.previewType(d.media.mimetype)){case"pdf":e=c.createElement(k,{preview:d.media.documentPreview,mimeType:d.media.mimetype,filename:d.name});break;case"msoffice":e=c.createElement(D,{preview:d.media.documentPreview,mimeType:d.media.mimetype,filename:d.name});break;default:e=c.createElement(x,{mimeType:d.media.mimetype,filename:d.name})}}e=c.createElement("div",{className:"media-body-container",key:this.state.media[l].key},e,t),_.isNumber(this.state.prevIndex)&&this.state.prevIndex!==l&&(s=this.state.prevIndex<l?"media-slide-forward":"media-slide-back")}else if(this.state.state===V.INVALID){var h,m=this.state.reason;if(m instanceof u.MediaFileTooLarge)switch(this.getFileType(m.file)){case Y:h=l10n.t("image_too_big",{maxSize:f.MAX_MEDIA_UPLOAD_SIZE/1024/1024+"MB"});break;case H:h=l10n.t("video_too_big",{maxSize:f.MAX_MEDIA_UPLOAD_SIZE/1024/1024+"MB"});break;case q:h=l10n.t("audio_too_big",{maxSize:f.MAX_MEDIA_UPLOAD_SIZE/1024/1024+"MB"});break;case W:h=l10n.t("document_too_big",{maxSize:f.MAX_MEDIA_UPLOAD_SIZE/1024/1024+"MB"})}else m instanceof u.MediaFileFailedLoad&&(h=l10n.t("media_failed_load"));h=h||l10n.t("invalid_media_files"),e=c.createElement("div",{className:"invalid-media-container",key:"pending"},c.createElement("div",{className:"invalid-media"},h))}this.state.media.length>0&&(r=this.state.media.map(function(e,t){var r="media-thumb stagger-delay";t===o.state.activeIndex&&(r+=" active");var i=Math.max(o.state.media.length-o.state.activeIndex-1,1),a=G(t)/i*Math.max(0,t-o.state.activeIndex)+"ms",s=void 0,l=void 0,u=void 0;switch(e.media.msgType){case Y:u={backgroundImage:"url("+e.preview+")"},s=c.createElement("div",{className:"media-thumb-body",style:u});break;case H:u={backgroundImage:"url("+e.url+")"},s=c.createElement("div",{className:"media-thumb-body",style:u});break;case q:s=c.createElement("div",{className:"attach-media-audio-thumb"});break;case W:var d=n(1);if(d.log("media is",e)(),e.media.documentPreview&&e.media.documentPreview.thumbUrl){var p={backgroundImage:"url("+e.media.documentPreview.thumbUrl+")"};B[e.media.mimetype]&&(l=B[e.media.mimetype].icon),l=y(l,"icon-doc","icon-doc-thumb-filetype"),s=c.createElement("div",{className:"media-thumb-body",style:p},c.createElement("div",{className:l}));break}B[e.media.mimetype]&&(l=B[e.media.mimetype].icon);default:l=y(l,"icon-doc"),s=c.createElement("div",{className:"media-thumb-body"},c.createElement("div",{className:l}))}return c.createElement("div",{className:r,key:"media-"+e.uniqKey,onClick:o.onSelectThumb.bind(null,t),staggerDelay:a},c.createElement("span",{className:"btn-delete icon icon-x-alt-light",onClick:o.onRemoveThumb.bind(null,t)}),s)}),a=1===this.state.media.length?z:z+G(this.state.media.length),i=c.createElement("div",{className:"drawer-controls",tabIndex:"-1",ref:"sendButton",onKeyPress:function(e){return e.preventDefault()}},c.createElement("button",{className:"btn btn-round btn-l",onClick:this.onSend},c.createElement("span",{className:"icon icon-send-light"}))));var g=this.state.isDragging?c.createElement("div",{key:"container",className:"drag-drop"},c.createElement("div",{className:"stitching"},l10n.t("drag_media_here"))):null,v=this.state.media.length<f.MAX_FILES?c.createElement("div",{key:"media-more",className:"media-thumb btn-add-media",onClick:this.onAddFileClick},c.createElement("button",{className:"btn-fill"},c.createElement("span",{className:"icon icon-add-alt"}),l10n.t("add_media"))):null,E={enter:this.onSend};return c.createElement(T,{key:"attach-image-modal",ref:"container",position:"right",id:"media",variant:"noheader",onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave},c.createElement(C,{title:l10n.t("web_preview_msg"),type:C.Type.OFFSET,onCancel:this.props.onBack}),c.createElement(w,{onDragStart:this.onDragStart,onDragEnd:this.onDragEnd},g,c.createElement("div",{className:"media-body"},c.createElement(F,{transitionName:s},e)),c.createElement(F,{transitionName:"thumb-scale",className:"media-collection"},r,v),c.createElement(M,{handlers:E},c.createElement(F,{transitionName:"btn",delay:a},i)),c.createElement("input",{ref:"input",type:"file",accept:f.IMAGE_MIMES+","+f.VIDEO_MIMES,style:{display:"none"},onChange:this.onFilePick,multiple:!0})))}});e.exports=X},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(1),a=n(1063),s=n(994),c=n(133),l=n(130),u=n(978),d=n(981),p=n(979),h=n(43),f=n(998),m=n(8),g=n(984),v=n(1017),y=n(102),E={ANIMATING:"animating",LOADING:"loading",RECORDING:"active",SENDING:"sending"},b=r.createClass({displayName:"CaptureDrawer",mixins:[l,c],propTypes:{noContainer:r.PropTypes.bool,stream:r.PropTypes.object.isRequired,caption:r.PropTypes.bool,onBack:r.PropTypes.func.isRequired,onSend:r.PropTypes.func.isRequired},statics:{State:E},getInitialState:function(){return{state:E.ANIMATING,img:void 0,url:void 0}},componentDidMount:function(){this.safeDelay(function(){this.setState({state:E.LOADING,url:window.URL.createObjectURL(this.props.stream)})},300)},componentWillUnmount:function(){if(this.state.url){var e=this.props.stream;v.stop(e),window.URL.revokeObjectURL(this.state.url)}},onCapture:function(e){var t=document.createElement("canvas");if(this.refs.video){var n=i.findDOMNode(this.refs.video);t.height=n.videoHeight,t.width=n.videoWidth;var r=t.getContext("2d");r.translate(t.width,0),r.scale(-1,1),r.drawImage(n,0,0,n.videoWidth,n.videoHeight);var o=t.toDataURL("image/jpeg");this.setState({state:E.SENDING,img:o})}},onVideoLoaded:function(e){this.setState({state:E.RECORDING,videoSize:{width:e.target.videoWidth,height:e.target.videoHeight}})},onRetake:function(e){this.setState({state:E.RECORDING,caption:void 0})},onSend:function(e){this.props.onSend({file:window.dataURLtoBlob(this.state.img),caption:g.emojify(_.trim(this.state.caption))})},onCaptionChange:function(e){this.setState({caption:e.target.value})},render:function(){var e,t,n,i;switch(this.state.state){case E.ANIMATING:break;case E.LOADING:case E.RECORDING:var c=h("capture-video media-viewer-img webcam",{"capture-video-inactive":this.state.state===E.LOADING});n=r.createElement("div",{key:"webcam"},r.createElement(s,{type:s.TYPES.CONTAIN,size:this.state.videoSize},r.createElement(a,{className:c,autoPlay:!0,ref:"video",onPlay:this.onVideoLoaded,src:this.state.url}))),e=r.createElement("div",{className:"drawer-controls fade",key:"btn-capture"},r.createElement("button",{className:"btn btn-round btn-l",onClick:this.onCapture},r.createElement("span",{className:"icon icon-camera-light"})));break;case E.SENDING:n=r.createElement("div",{key:"snapshot"},r.createElement(s,{type:s.TYPES.CONTAIN,size:this.state.videoSize},r.createElement("img",{className:"capture-image snapshot",src:this.state.img})));var l=this.props.noContainer?"icon icon-checkmark-light-l":"icon icon-send-light";e=r.createElement("div",{className:"drawer-controls btn-send",key:"btn-send"},r.createElement("button",{className:"btn btn-round btn-l",onClick:this.onSend},r.createElement("span",{className:l}))),t=r.createElement("div",{className:"drawer-header-action",onClick:this.onRetake},r.createElement("span",{className:"icon icon-refresh-light"}),l10n.t("retake")),i=r.createElement(f,{ref:"emojiInput",editable:!0,value:this.state.caption,maxLength:m.MAX_CAPTION_LENGTH,showRemaining:!0,placeholder:l10n.t("add_a_caption"),onEnter:this.onSend,onChange:this.onCaptionChange,supportsEmoji:!0,focusOnMount:!0});break;default:o.log("captureDrawer:render Unhandled video capture state "+this.state.state)()}var g=void 0;g=this.props.caption?r.createElement("div",{className:"capture-footer"},r.createElement(y,{transitionName:"media-caption",className:"media-caption"},i),r.createElement(y,{transitionName:"pop_delay"},e)):r.createElement("div",{className:"capture-footer"},r.createElement(y,{transitionName:"pop_delay"},e));var v=this.props.noContainer?d.Type.POPUP:d.Type.OFFSET;return r.createElement(u,{key:"attach-capture-modal",position:"right",id:"capture",variant:"noheader",noContainer:this.props.noContainer},r.createElement(d,{title:l10n.t("take_photo"),type:v,onCancel:this.props.onBack},t),r.createElement(p,null,r.createElement("div",{className:"media-body"},r.createElement("div",{className:"media-body-container"},r.createElement(y,{transitionName:"capture"},n))),g))}});e.exports=b},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(196),a=n(978),s=n(979),c=n(1008),l=n(975),u=n(129),d=n(78),p=n(980),h=n(1076),f=n(130),m=n(1005),g=n(990),v=n(984),y=n(54),E=n(132),b=n(985),S=n(10),M=n(101),T=n(1020),C=n(14),w=n(987),x=n(8),N=n(974),P=n(977),k=n(1023),D=n(1010),O=n(1003),A=n(976),R=n(1223),I=n(134),L=n(884),F=n(43),U=n(131),j=U.HotKeys,B=2,G=100,z=r.createClass({displayName:"ChatSearch",mixins:[u,d,L,p,h],propTypes:{chat:r.PropTypes.instanceOf(P)},getInitialState:function(){var e=this;return this.ftsResultPage=0,this.fts=_.debounce(function(){e.pending=!1,e.setState({ftsLoading:!0},h.DD);var t=_.trim(e.state.searchText||"");T.multibyteLength(t)<B||(e._ftsPromise&&e._ftsPromise.cancel(),e._ftsPromise=e.props.chat.fts(t,++e.ftsResultPage,G).checkpoint(e.rejectOnUnmount()).then(function(n){if(t===_.trim(e.state.searchText)){var r=e.ftsResultPage>1?e.state.ftsResult.concat(n.messages):n.messages;e.setState({ftsResult:r,searching:!1},h.DD),M.supportsFeature(M.F.FTS_PAGINATION)&&!n.eof||(e.ftsResultPage=0,e.setState({ftsLoading:!1},h.DD))}})["catch"](C.Unmount,_.noop)["catch"](function(){e.pending||e.setState({searching:!1,ftsLoading:!1},h.DD)}))},750),this.selection=new w([],function(e){return e.id.toString()}),{searchText:"",searching:!1,ftsResult:[],ftsLoading:!1}},componentDidMount:function(){this.onFocusSearch()},componentDidUpdate:function(){this.shouldFTSSearch(this.refs.panel)&&(this.fts(),this.pending=!0)},componentWillUnmount:function(){this.fts.cancel(),this._ftsPromise&&this._ftsPromise.cancel()},fullTextSearch:function(e){var t=_.trim(e);T.multibyteLength(t)>=B&&M.supportsFeature(M.F.FULL_TEXT_SEARCH)?(this.fts(),this.pending=!0,this.state.searching||this.setState({searching:!0},h.DD)):(this.fts.cancel(),this._ftsPromise&&this._ftsPromise.cancel(),this.ftsResultPage=0,this.pending=!1,(this.state.searching||this.state.ftsLoading)&&this.setState({searching:!1,ftsLoading:!1},h.DD))},shouldFTSSearch:function(e){var t=this.state.ftsResult;if(!t||0===t.length||0===this.ftsResultPage||this.pending)return!1;
var n=_.last(e.children);return e.scrollHeight<e.clientHeight+n.scrollHeight},onSearch:function(e){if(this.isMounted()){if(!e)return void this.onStopSearch();var t=this.state.searchText;if(e!==t){var n={searchText:e};this.fullTextSearch(e),t&&0===e.indexOf(t)?this.ftsResultPage=0:n.ftsResult=[],this.setState({searchText:e}),this.setState(n,h.DD)}}},onStopSearch:function(){this.fts.cancel(),this._ftsPromise&&this._ftsPromise.cancel(),this.ftsResultPage=0,this.pending=!1,this.setState({searchText:"",ftsResult:[],ftsLoading:!1,searching:!1})},onFocusList:function(e){e.repeat||this.refs.msglist&&this.refs.search.isAtEnd()&&(e.preventDefault(),e.stopPropagation(),j.flashFocus=Date.now(),this.refs.msglist.focusFirst())},onOpenFirst:function(e){e.preventDefault();var t=_.head(this.state.ftsResult);if(t){var n=t.chat,r=n.getSearchContext(t);S.openChat(n,r,!0),S.focusShowMsg(r.msg.id),this.onClose()}},onFocusSearch:function(e){j.flashFocus=Date.now(),I.focus(this.refs.search)},onClose:function(){S.closeDrawerRight()},indicateFocus:function(e){if(!(Date.now()-(j.flashFocus||0)>200)){var t=i.findDOMNode(this.refs.input_hotkey);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},onScroll:function(e){this.handleScroll(e.target)},handleScroll:_.throttle(function(e){e.scrollTop+x.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&this.ftsResultPage>0&&!this.pending&&(this.fts(),this.pending=!0)},100),getEmptyChatlistState:function(e){if(e.length)return null;var t=_.trim(this.state.searchText||"");return T.multibyteLength(t)>=B?this.state.searching?r.createElement(g.SearchingMessages,null):r.createElement(g.SearchMessages,null):g.BeforeSearchMessages(this.props.chat.name)},render:function(){var e=this.state.ftsResult,t=this.getEmptyChatlistState(e);if(!t){var n=this.state.searchText?_.trim(this.state.searchText):null;t=r.createElement(Y,{ref:"msglist",isSearching:!!this.state.searchText,searchText:n,ftsResult:e,selection:this.selection,onFocusSearch:this.onFocusSearch})}var i={down:this.onFocusList,enter:this.onOpenFirst},o=this.state.ftsLoading&&e.length?r.createElement("div",{className:"more",style:{alignSelf:"center"}},r.createElement(E,{stroke:6,size:24})):null;return r.createElement(a,{key:"search-modal",id:"search",variant:"panel",onCancel:this.onClose},r.createElement("header",{className:"pane-header"},r.createElement("div",{className:"header-close"},r.createElement("button",{onClick:this.onClose},r.createElement("span",{className:"icon icon-x"}))),r.createElement("div",{className:"header-body"},r.createElement("div",{className:"header-main"},r.createElement("div",{className:"header-title"},l10n.t("search_msgs"))))),r.createElement(s,null,r.createElement(j,{handlers:i,onFocus:this.indicateFocus,ref:"input_hotkey",className:"search-container"},r.createElement(m,{ref:"search",onSearch:this.onSearch,placeholder:l10n.t("search"),searching:this.state.searching})),r.createElement("div",{ref:"panel",className:"pane-body pane-list-body",onScroll:this.onScroll,id:"pane-side","data-list-scroll-container":!0},t,o)))}}),Y=r.createClass({displayName:"MsgList",mixins:[u,d,f],propTypes:{isSearching:r.PropTypes.bool,searchText:r.PropTypes.string,ftsResult:r.PropTypes.array,onClick:r.PropTypes.func,selection:r.PropTypes.instanceOf(w),onFocusSearch:r.PropTypes.func},getDefaultProps:function(){return{chats:[]}},getInitialState:function(){return this._listPointerEvents=!0,{}},componentWillMount:function(){this.props.selection.init(this.getSelection())},onListPointerEventsOff:function(){this._listPointerEvents=!1},onListPointerEventsOn:function(){this._listPointerEvents=!0},onClick:function(e,t,n){var r=this;e.preventDefault(),e.stopPropagation(),Store.Chat.find(t.id).then(function(e){r.props.isSearching&&r.props.onClick&&r.props.onClick(),2===R.column&&S.closeDrawerRight(),S.openChat(e,n,!0),n&&S.focusShowMsg(n.msg.id)})},getSelection:function(){return this.props.ftsResult||[]},getList:function(){var e=this;return this.props.ftsResult.map(function(t){return r.createElement(H,{msg:t,searchText:e.props.searchText,onClick:e.onClick,active:e.props.selection,key:t.id.toString()})})},restoreFocus:function(){this.props.selection.reset()},onFocusGain:function(e){e.target===i.findDOMNode(this)&&this._listPointerEvents&&(this.props.selection.index<0?this.focusFirst():this.props.selection.reset())},focusFirst:function(){this.props.selection.setFirst()},onNextChat:function(e,t,n){e&&(e.preventDefault(),e.stopPropagation());var r=this.props.selection.next();this.props.selection.index!==r&&this.props.selection.setNext()},onPrevChat:function(e,t,n){e&&(e.stopPropagation(),e.preventDefault());var r=this.props.selection.prev();r>-1?(this.props.selection.setPrev(),this.focusComposer=n):t||this.props.onFocusSearch()},render:function(){var e=this,t={down:function(t){return e.onNextChat(t)},up:function(t){return e.onPrevChat(t)}};return r.createElement(j,{handlers:t,onFocus:this.onFocusGain,"data-tab":3},r.createElement(b,{className:"chatlist",data:this.getList(),height:72,animate:!0,extraItems:4,onPointerEventsOff:this.onListPointerEventsOff,onPointerEventsOn:this.onListPointerEventsOn}))}}),H=r.createClass({displayName:"Message",mixins:[l,u],propTypes:{msg:r.PropTypes.instanceOf(N).isRequired,searchText:r.PropTypes.string,mouseDownAsClick:r.PropTypes.bool,onClick:r.PropTypes.func,active:r.PropTypes.object},getInitialState:function(){var e=this.props,t=e.msg,n=e.active,r={formattedTitle:this.async("msg.chat.formattedTitle"),active:!!n&&n.value===t};return t.sender&&t.isGroupMsg&&!t.isNotification&&(t.isSentByMe?r.formattedShortName=t.senderObj.formattedShortName:r.formattedShortName=this.async("msg.senderObj.formattedShortName")),r},componentWillMount:function(){this.props.active&&this.addObserver(this.props.active,this.props.msg.id.toString(),this.onActiveChange)},onActiveChange:function(e,t){if("focus"===e){var n=i.findDOMNode(this);I.focus(n),t&&c.scrollIntoViewIfNeeded(n)}this.setState({active:!!e})},onClick:function(e){if(_.isFunction(this.props.onClick)){var t=this.props.msg,n=t.chat,r=n.getSearchContext(t);r.msg=t,this.props.onClick(e,n,r)}},onMouseDown:function(e){0===e.button&&this.onClick(e)},onEnter:function(e){e.preventDefault(),e.stopPropagation(),j.flashFocus=Date.now(),this.onClick(e)},indicateFocus:function(e){if(!(Date.now()-(j.flashFocus||0)>200)){var t=i.findDOMNode(this.refs.cell);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.onBlur})}},onBlur:function(e){var t=i.findDOMNode(this.refs.cell);t&&(Velocity(t,"stop"),t.style.backgroundColor="")},contextEnabled:function(){return!1},render:function(){var e=this.props.msg,t=r.createElement("span",{className:"chat-time-title"},o.relativeStr(e.t)),n=[];if(e.isSentByMe&&n.push(r.createElement(k,{msg:e,key:"symbol"})),!e.isSentByMe&&e.isGroupMsg&&!e.isNotification){var i=F("chat-status-name",{number:!e.senderObj.name});n.push(r.createElement(A,{text:this.state.formattedShortName,direction:"auto",classes:i,key:"author"})),n.push(r.createElement("span",{className:"chat-status-divider",key:"divider"},":"))}e.hasSymbol&&n.push(r.createElement(D,{msg:e,key:"msg-symbol"})),n.push(r.createElement(A,{direction:e.dir,ellipsify:!0,highlight:this.props.searchText?[this.props.searchText]:null,text:v.msgText(e),key:"status"}));var a="chat-status";y.isGecko&&(a+=" ellipsify");var s=l10n.embedDir(v.msgText(e),e.rtl),c=r.createElement("div",{className:a,title:s},n),l={enter:this.onEnter},u=F("message",{active:!!this.state.active}),d=this.props.mouseDownAsClick;return r.createElement(j,{handlers:l,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover"},r.createElement(O,{id:e.id+"",ref:"cell",contextEnabled:this.contextEnabled,className:u,primaryDetail:t,secondary:c,onClick:d?null:this.onClick,onMouseDown:d?this.onMouseDown:null,onContext:this.onMenu}))}});e.exports=z},function(e,t,n){"use strict";var r=n(6),i=n(43),o=r.createClass({displayName:"DrawerListItem",propTypes:{onClick:r.PropTypes.func,iconClass:r.PropTypes.string,className:r.PropTypes.string},render:function(){var e=this.props,t=e.onClick,n=e.iconClass,o=e.className,a=e.children,s=void 0;return n&&(s=r.createElement("div",{className:"chat-avatar"},r.createElement("div",{className:"avatar"},r.createElement("span",{className:i("icon",n)})))),r.createElement("div",{className:i("chat",o),"data-ignore-capture":"any"},r.createElement("div",{className:"chat-cell",onClick:t},s,r.createElement("div",{className:"chat-body"},r.createElement("div",{className:"chat-main"},r.createElement("div",{className:"chat-title"},r.createElement("span",{className:"emojitext ellipsify",dir:"auto"},a))))))}});e.exports=o},function(e,t,n){"use strict";var r=n(6),i=n(978),o=n(981),a=n(979),s=n(131),c=s.HotKeys,l=n(1005),u=n(985),d=n(1030),p=n(987),h=n(134),f={LIST:"list",SEARCH:"search"},m=r.createClass({displayName:"ListModal",propTypes:{title:r.PropTypes.string.isRequired,selection:r.PropTypes.instanceOf(p),onSearch:r.PropTypes.func,searchPlaceholder:r.PropTypes.string,onCancel:r.PropTypes.func.isRequired,onSelect:r.PropTypes.func},onNext:function(e){e.preventDefault(),e.stopPropagation();var t=this.props.selection;t&&t.setNext()},onPrev:function(e){var t=this.props.selection;if(t){e.preventDefault(),e.stopPropagation();var n=t.prev();n>-1?t.setPrev():(t.unset(),c.flashFocus=Date.now(),h.focus(this.refs[f.SEARCH]))}},onFocusList:function(e){this.refs[f.LIST]&&(e.preventDefault(),e.stopPropagation(),c.flashFocus=Date.now(),this.props.selection.setFirst())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.head(this.props.children);t&&this.props.onSelect(e,t)},onSearch:function(e){this.props.onSearch(e)},render:function(){var e=this.props,t=e.title,n=e.onCancel,s=e.onSearch,p=e.searchPlaceholder,h=e.children,m={down:this.onFocusList,enter:this.onSelectFirst},g={down:this.onNext,up:this.onPrev},v=void 0;s&&(v=r.createElement(c,{handlers:m},r.createElement(l,{ref:f.SEARCH,onSearch:this.onSearch,placeholder:p||l10n.t("search")})));var y=void 0;return y=h&&h.length?r.createElement(c,{handlers:g},r.createElement(u,{className:"chatlist",ref:f.LIST,data:h,height:72,extraItems:4})):h,r.createElement(d,{type:d.TOWER},r.createElement(i,{key:"contact-modal",onCancel:n,position:"right"},r.createElement(o,{title:t,type:o.Type.POPUP,onCancel:n}),v,r.createElement(a,{"data-list-scroll-container":!0},y)))}});e.exports=m},function(e,t,n){"use strict";var r=n(6),i=n(978),o=n(981),a=n(995),s=n(979),c=n(1025),l=n(410),u=n(10),d=n(975),p=n(129),h=n(980),f=n(998),m=n(8),g=n(984),v=r.createClass({displayName:"ProfileDrawer",mixins:[d,p,h],propTypes:{id:r.PropTypes.string.isRequired,onClose:r.PropTypes.func},getInitialState:function(){return this.asyncState({status:"id.Status.status",imgFull:"id.ProfilePicThumb.imgFull"},{pushname:Store.Conn.pushname,status:l10n.t("contact_status_loading"),pendingPushname:!1,pendingStatus:!1,pendingPhoto:!1})},componentWillMount:function(){var e=this;this.addObserver(Store.Conn,"change:pushname",function(){e.setState({pushname:Store.Conn.pushname})})},validateStatus:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return!!e.trim()},onSetStatusError:function(){u.openModal(r.createElement(l,{onOK:u.closeModal.bind(u),okText:l10n.t("web_ok")},l10n.t("action_status_empty")))},onSetStatus:function(e){if(Store.Status.canSetMyStatus()){var t=Store.Status.get(this.props.id).status,n=g.emojify(this.state.status);if(n===t)return this.setState({status:n});this.setState({pendingStatus:!0}),Store.Status.setMyStatus(g.emojify(this.state.status)).bind(this)["finally"](function(){this.isMounted()&&this.setState({status:Store.Status.get(this.props.id).status,pendingStatus:!1})})}},onBack:function(){this.props.onClose?this.props.onClose():u.closeDrawerLeft()},onStatusChange:function(e){this.setState({status:e.target.value})},onCancelStatus:function(){this.setState({status:Store.Status.get(this.props.id).status})},validatePushname:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return!!e.trim()},onSetPushname:function(e){var t=this;if(Store.Conn.canSetMyPushname()){var n=Store.Conn.pushname,r=g.emojify(this.state.pushname);if(r===n)return this.setState({pushname:r});this.setState({pendingPushname:!0}),Store.Conn.updatePushname(g.emojify(this.state.pushname)).checkpoint(this.rejectOnUnmount())["finally"](function(){t.setState({pendingPushname:!1})})}},onSetPushnameError:function(){u.openModal(r.createElement(l,{onOK:u.closeModal.bind(u),okText:l10n.t("web_ok")},l10n.t("action_pushname_empty")))},onPushnameChange:function(e){this.setState({pushname:e.target.value})},onCancelPushname:function(){this.setState({pushname:Store.Conn.pushname})},onImageSet:function(e,t){var n=Store.ProfilePicThumb.get(this.props.id);this.setState({pendingPhoto:!0});var r;r=e&&t?n.setPicture(e,t):n.deletePicture(),r.bind(this).then(function(){this.isMounted()&&this.setState({pendingPhoto:!1})})},render:function(){var e=Store.ProfilePicThumb.get(this.props.id),t=e.canSet()||e.canDelete()?c.Type.PROFILE:c.Type.NO_EDIT,n=r.createElement(c,{type:t,id:this.props.id,pending:this.state.pendingPhoto,startImage:this.state.imgFull,onImageSet:this.onImageSet});return r.createElement(i,{onCancel:this.onBack,id:"profile"},r.createElement(o,{a8n:"drawer-title-profile",title:l10n.t("menuitem_profile_status"),onBack:this.onBack,type:o.Type.LARGE}),r.createElement(s,{editable:!0},r.createElement("div",{className:"drawer-section drawer-scale drawer-section-photo"},n),r.createElement(a,{a8n:"col-main-profile",title:l10n.t("pushname"),classes:"animate-enter1 with-input"},r.createElement(f,{value:this.state.pushname,editable:Store.Conn.canSetMyPushname(),pending:this.state.pendingPushname,showRemaining:!0,validate:this.validatePushname,maxLength:m.MAX_PUSHNAME_LENGTH,onChange:this.onPushnameChange,onSave:this.onSetPushname,onError:this.onSetPushnameError,onCancel:this.onCancelPushname,supportsEmoji:!0,lockable:!0,lowProfile:!0})),r.createElement("div",{className:"hint drawer-section-hint animate-enter1"},l10n.t("pushname_description")),r.createElement(a,{a8n:"col-main-profile",title:l10n.t("web_status"),classes:"animate-enter1 with-input"},r.createElement(f,{value:this.state.status,editable:Store.Status.canSetMyStatus(),pending:this.state.pendingStatus,showRemaining:!0,validate:this.validateStatus,maxLength:m.MAX_STATUS_LENGTH,onChange:this.onStatusChange,onSave:this.onSetStatus,onError:this.onSetStatusError,onCancel:this.onCancelStatus,supportsEmoji:!0,lockable:!0,lowProfile:!0}))))}});e.exports=v},function(e,t,n){"use strict";function r(e){return e.scrollTop+c.SCROLL_FUDGE>e.scrollHeight-e.clientHeight}function i(e,t,n){for(var r=n;r<e.length;r++)if(e[r]===t){_.pullAt(e,r);break}}function o(e,t,n){e.splice(n,0,t)}var a=n(6),s=n(34),c=n(8),l=n(10),u=n(978),d=n(990),p=n(981),h=n(979),f=n(129),m=n(980),g=n(102),v=n(1143),y=n(987),E=n(1095),b=n(132),S=n(14),M=n(101),T=n(1),C=n(974),w=n(134),x=n(130),N=n(977),P=n(1012),k=P.MenuBarItem,D=n(983),O=n(419),A=n(1192),R=n(131),I=R.HotKeys,L=a.createClass({displayName:"StarredDrawer",mixins:[f,m,x],propTypes:{chat:a.PropTypes.instanceOf(N),onClose:a.PropTypes.func},getInitialState:function(){if(this.handleScroll=_.throttle(this._handleScroll,100),this.props.chat){var e=this.props.chat.id;Store.StarredMsg.syncState[e]||(Store.StarredMsg.syncState[e]=Store.StarredMsg.syncState[Store.StarredMsg.ALL])}return this.msgListInfo={visibleMsgs:{}},{cursor:new E(Store.StarredMsg,(void 0),c.RENDOR_CURSOR.STARRED_DRAWER).loadAfter(c.MSG_PRELOAD_THRESHOLD),msgs:[]}},componentWillMount:function(){this.currSelection=new y([],function(e){return e.id.toString()}),this.activeSelection=new y([],function(e){return e.id.toString()}),this.checkSyncState(Store.StarredMsg.SYNC_STATES.NONE)&&this.loadEarlierMsgs()},componentDidMount:function(){var e=this;this.focus(),this.regNativeListener(window,"resize",this.updateMsgListInfo),this.checkSyncState(Store.StarredMsg.SYNC_STATES.READY)?this.initObservers():this.addObserverOnce(Store.StarredMsg,"sync",this.initObservers),this.addObserver(Store.StarredMsg,"reset",function(){e.setState(e.getInitialState()),e.loadEarlierMsgs()})},componentWillUnmount:function(){this._firstSyncComplete&&this._firstSyncComplete.cancel(),this.handleScroll.cancel()},componentDidUpdate:function(){this.updateMsgListInfo()},initObservers:function(){var e=this,t=this.props.chat;this.addObserverAndRun(Store.StarredMsg,"reset sync",function(){var n=t?Store.StarredMsg.filter(function(t){return t.chat.id===e.props.chat.id}):Store.StarredMsg.filter(function(e){return!0});e.initSelectionObjects(n),e.setState({msgs:n})}),this.addObserver(Store.StarredMsg,"add",function(t){e.handleStarChange(t,o)}),this.addObserver(Store.StarredMsg,"remove",function(t){e.handleStarChange(t,i)}),this.onFocusGain()},handleStarChange:function(e,t){var n=this.props.chat,r=this.state.msgs;if(!n||n.id===e.chat.id){var i=_.sortedIndexBy(r,e,function(e){return-1*e.t});t(r,e,i),this.initSelectionObjects(r),this.setState({msgs:r})}},initSelectionObjects:function(e){this.currSelection.init(e,!0),this.activeSelection.init(e)},loadEarlierMsgs:function(){var e=this,t=this.state.cursor,n=this.props.chat?this.props.chat.id:Store.StarredMsg.ALL,r=n===Store.StarredMsg.ALL?void 0:n;if(t.end<this.state.msgs.length)this.setState({cursor:t.loadAfter()});else{if(Store.StarredMsg.isSynced(n))return;var i=void 0;i=M.supportsFeature(M.F.STARRED_PAGINATION)?Store.StarredMsg.sync(!0,r):Store.StarredMsg.sync(!1),i.checkpoint(this.rejectOnUnmount()).then(function(){t.end<e.state.msgs.length&&e.setState({cursor:t.loadAfter()})})["catch"](S.Unmount,_.noop)["catch"](function(e){T.log("StarredDrawer:loadEarlierMsgs failed")(),T.log(e)()})}},onClose:function(){this.props.onClose?this.props.onClose():l.closeDrawerLeft()},focus:function(){w.focus(s.findDOMNode(this.refs.body))},onFocusGain:function(e){var t=e?e.target:document.activeElement;t===s.findDOMNode(this.refs.body)&&(this.currSelection.index<0?this.currSelection.setFirst():this.currSelection.reset())},onNextMsg:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=this.currSelection.next();this.currSelection.index!==t&&this.currSelection.setNext()},onPrevMsg:function(e){e&&(e.stopPropagation(),e.preventDefault());var t=this.currSelection.prev();t>-1&&this.currSelection.setPrev()},onScroll:function(e){this.handleScroll(e.target)},_handleScroll:function(e){this.updateMsgListInfo(),r(e)&&this.loadEarlierMsgs()},selectMsg:function(e){this.currSelection.setVal(e),this.activeSelection.setVal(e),l.openChat(e.chat,e.chat.getSearchContext(e),!1),l.focusShowMsg(e.id)},getMsgs:function(){var e=this.state.cursor,t=this.props.chat?this.props.chat.id:Store.StarredMsg.ALL,n=void 0,r=Store.StarredMsg.loadMarker[t],i=r?this.state.msgs.indexOf(Store.StarredMsg.get(r)):-1,o=i<0||Store.StarredMsg.isSynced(t)?e.end:Math.min(e.end,i+1);return n=this.state.msgs.slice(e.start,o),this.length=n.length,n},checkSyncState:function(e){var t=this.props.chat,n=t?t.id:Store.StarredMsg.ALL;return Store.StarredMsg.syncState[n]===e},getMsgVisibility:function(e){if(!e)return c.VISIBILITY.BELOW;var t=s.findDOMNode(this.refs.scrollContainer),n=t.previousSibling.clientHeight,r=t.scrollTop+n,i=r+t.clientHeight,o=s.findDOMNode(e);return o.offsetTop+o.clientHeight<=r?c.VISIBILITY.ABOVE:o.offsetTop>=i?c.VISIBILITY.BELOW:c.VISIBILITY.VISIBLE},isMsgVisible:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];return!!this.msgListInfo.visibleMsgs[e.toString()]&&(!!t||this.getMsgComponent(e))},getMsgComponent:function(e){var t=this.refs[e.toString()];if(t){var n=t.refs.wrapper;if(n)return n.refs.component}},updateMsgListInfo:_.throttle(function(){for(var e=this.getMsgs(),t={},n=0,r=this.length-1;n<r;){var i=Math.floor((n+r)/2),o=this.refs[e[i].id.toString()];this.getMsgVisibility(o)===c.VISIBILITY.ABOVE?n=i+1:r=i}for(var a=n;a<e.length;a++){var s=this.refs[e[a].id.toString()];if(this.getMsgVisibility(s)!==c.VISIBILITY.VISIBLE)break;t[e[a].id.toString()]=!0}this.pauseHiddenGifs(this.msgListInfo.visibleMsgs,t),this.msgListInfo.visibleMsgs=t},100),pauseHiddenGifs:function(e,t){for(var n in e)if(!t[n]){var r=Store.StarredMsg.get(n);if(r&&r.isGif){var i=this.getMsgComponent(n);i&&i.pause()}}},render:function(){var e=this,t=this.getMsgs(),n=this.state.cursor,r=this.props.chat||null,i=this.props.chat?this.props.chat.id:Store.StarredMsg.ALL,o=void 0,s=void 0;if(s=Store.StarredMsg.isSynced(i)&&n.end>=this.state.msgs.length?null:this.checkSyncState(Store.StarredMsg.SYNC_STATES.SYNCING)?a.createElement("div",{className:"more"},a.createElement("div",{className:"btn-more",title:l10n.t("loading_messages")},a.createElement(b,{stroke:6,size:24}))):a.createElement("div",{className:"more"},a.createElement("div",{className:"btn-more",title:l10n.t("load_earlier_messages"),onClick:this.loadEarlierMsgs},a.createElement("span",{className:"icon icon-refresh"}))),t.length>0){var c=t.map(function(t){var n=t.type===C.TYPE.IMAGE||t.type===C.TYPE.VIDEO||t.type===C.TYPE.AUDIO;return a.createElement(v,{key:t.id,ref:t.id.toString(),msg:t,isMsgVisible:n?e.isMsgVisible:_.noop,currSelection:e.currSelection,activeSelection:e.activeSelection,onSelectMsg:e.selectMsg})});o=a.createElement(g,{transitionName:"slide"},c)}else Store.StarredMsg.isSynced(i)?o=a.createElement(d.StarredMsgs,null):this.checkSyncState(Store.StarredMsg.SYNC_STATES.SYNCING)&&(o=a.createElement(d.Loading,null),s=null);var l={down:this.onNextMsg,up:this.onPrevMsg},f=t.length||this.checkSyncState(Store.StarredMsg.SYNC_STATES.SYNCED),m=M.supportsFeature(M.F.UNSTAR_ALL)?a.createElement(k,{a8n:"starred-menu",icon:"menu-white",title:l10n.t("menutitle_menu"),disabled:!f},a.createElement(F,{chat:r,msgs:this.state.msgs})):null;return a.createElement(u,{id:"starred",onCancel:this.onClose},a.createElement(I,{className:"drawer",handlers:l,onFocus:this.onFocusGain,"data-tab":2,ref:"body"},a.createElement(p,{title:l10n.t("starred_flow_title"),onBack:this.onClose,type:p.Type.LARGE,menu:m}),a.createElement(h,{onScroll:this.onScroll,ref:"scrollContainer"},o,s)))}});e.exports=L;var F=a.createClass({displayName:"StarredHeaderDropdown",propTypes:{chat:a.PropTypes.instanceOf(N),msgs:a.PropTypes.array},sendUnstarAll:function(){l.openModal(a.createElement(A,{msgs:this.props.msgs,chat:this.props.chat}))},render:function(){return a.createElement(O,{type:O.Type.DROPDOWN_MENU,flipOnRTL:!0,key:"StarredDrawerHeader",direction:{x:O.Direction.X.LEFT}},a.createElement(D,{a8n:"mi-unstar-all menu-item",action:this.sendUnstarAll},l10n.t("unstar_all")))}})},function(e,t,n){"use strict";var r=n(55),i={dataTypes:{msgKey:{set:function(e){if(e instanceof r)return{val:e,type:"msgKey"}},compare:function(e,t,n){return e instanceof r&&e.equals(t)}}}};e.exports=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(6),s=n(1),c=n(21),l=n(79),u=n(45),d=n(10),p=n(101),h=n(14),f=n(64).ActionToast,m=n(64).ActionType,g=n(0),v=n(137),y=l.extend({props:{id:"string",expiration:{type:"number","default":0}},session:{_unmuteTimer:"string",promises:{type:"object","default":function(){return{}}}},derived:{isMuted:{deps:["expiration"],fn:function(){return!!this.expiration}}},initialize:function(){this.expiration&&this.mute(this.expiration)},setMute:function(e,t){(e||this.expiration)&&e!==this.expiration&&(e?this.mute(e,t):this.unmute(t))},mute:function E(e,t,n){var r=this;if(!_.isNumber(e))return s.log("models:Mute:mute called with invalid expiration "+e)(),o["default"].reject(new h.ActionError);e=Math.round(e),e>2e9&&s.log("models:Mute:mute called with wrong units?"+this.id+" exp:"+e)();var E=function(){this.isMuted&&this._clearUnmuteTimer();var t=e-g().unix();s.log("models:Mute:mute "+this.id+" duration:"+t)(),this._unmuteTimer=v.setTimeout(this.unmute.bind(this),1e3*e),this.set({expiration:e})}.bind(this),i=c.isGroup(this.id);if(t){if(this.promises.mute)return this.promises.mute;this.promises.mute=u.sendConversationMute(this.id,e,this.expiration);var l=new m(i?l10n.t("action_group_muting"):l10n.t("action_chat_muting"));n=n||f.genId();var p=this.promises.mute["catch"](function(o){s.error("models:Mute:mute dropped")(o);var a=i?l10n.t("action_group_mute_failed"):l10n.t("action_chat_mute_failed");throw new m(a,l10n.t("action_try_again"),r.mute.bind(r,e,t,n))}).then(function(e){if(200===e.status){var o=i?l10n.t("action_group_muted"):l10n.t("action_chat_muted");return new m(o,l10n.t("action_undo"),r.unmute.bind(r,t,n))}if(e.status>=400)throw new m(i?l10n.t("action_group_mute_failed"):l10n.t("action_chat_mute_failed"))});return d.openToast(a.createElement(f,{id:n,initialAction:l,pendingAction:p})),this.promises.mute.then(function(e){200!==e.status||e._duplicate||E()})["finally"](function(){r.promises.mute=null})}return E(),o["default"].resolve()},canMute:function(){return p.supportsFeature(p.F.MUTE)&&c.isGroup(this.id)||p.supportsFeature(p.F.MUTE_1_1)&&c.isUser(this.id)},_clearUnmuteTimer:function(){v.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer"),this.expiration=0},unmute:function b(e,t){var n=this,b=function(){s.log("models:Mute:unmute "+this.id)(),this._clearUnmuteTimer()}.bind(this),r=c.isGroup(this.id);if(e){if(this.promises.unmute)return this.promises.unmute;this.promises.unmute=u.sendConversationMute(this.id,!1,this.expiration);var i=new m(r?l10n.t("action_group_unmuting"):l10n.t("action_chat_unmuting"));t=t||f.genId();var l=this.promises.unmute["catch"](function(i){s.error("models:Mute:unmute dropped")(i);var a=r?l10n.t("action_group_unmute_failed"):l10n.t("action_chat_unmute_failed");return o["default"].reject(new m(a,l10n.t("action_try_again"),n.unmute.bind(n,e,t)))}).then(function(e){if(200===e.status)return new m(r?l10n.t("action_group_unmuted"):l10n.t("action_chat_unmuted"));if(e.status>=400)throw new m(r?l10n.t("action_group_unmute_failed"):l10n.t("action_chat_unmute_failed"))});return d.openToast(a.createElement(f,{id:t,initialAction:i,pendingAction:l})),this.promises.unmute.then(function(e){200!==e.status||e._duplicate||b()})["finally"](function(){n.promises.unmute=null})}return b(),o["default"].resolve()},"delete":function(){l.prototype["delete"].call(this),this._clearUnmuteTimer()}});e.exports=y},function(e,t,n){"use strict";function r(){if(!o){var e=n(1254),t=e.length/2;o=new Int32Array(t),a=new Int32Array(t);for(var r=0,i=0;r<t;r++,i+=2)o[r]=e[i]+(0===r?0:o[r-1]),a[r]=e[i+1]}}function i(e){r();for(var t=0;t<e.length;t++){var n=0|e.charCodeAt(t);if(55296<=n&&n<56320){if(++t===e.length)break;var i=e.charCodeAt(t);if(!(56320<=i&&i<57344))continue;n=65536+((1023&n)<<10|1023&i)}else if(56320<=n&&n<57344)continue;if(!(n<o[0])){for(var s=0|o.length,c=0,l=s-1|0;c<l;){var u=l+c>>1;if(o[u]>n)l=u-1|0;else{if(o[u+1]>n){l=u;break}c=u+1|0}}var d=a[l],p=o[l]+Math.abs(d)|0;if(n<p)return d<0?"rtl":"ltr"}}}var o,a;e.exports={dir:i}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){return(0,u["default"])(_.pick(e,["message","filename","lineno","colno"]))}function o(e,t,n,r){if(!e)throw new f.MediaEncryptionError('decrypt async, missing "type"');if(!t)throw new f.MediaEncryptionError('decrypt async, missing "buffer"');if(!n)throw new f.MediaEncryptionError('decrypt async, missing "mediaKey"');var o=new m.WebcCryptoMedia({webcCryptoType:m.WEBC_CRYPTO_TYPE_CODE.DECRYPT});return p.supportsWebCrypto().then(function(a){return a?(o.webcCryptoLibrary=m.WEBC_CRYPTO_LIBRARY_CODE.WEBCRYPTO,d.decryptE2EMediaWithWebCrypto(e,t,n,r)):(o.webcCryptoLibrary=m.WEBC_CRYPTO_LIBRARY_CODE.CRYPTOJS,new c["default"](function(i,o){var a=new h;a.onmessage=i,a.onerror=o,a.postMessage({command:"decrypt-e2e-media",type:e,buffer:t,mediaKey:n,mimetype:r})})["catch"](function(e){throw new Error(i(e))}).then(function(e){return e.data}))}).then(function(e){return o.webcCryptoFileSize=t.byteLength,o.markWebcCryptoElapsedT(),o.commit(),e})}function a(e,t,n){if(!e)throw new f.MediaEncryptionError('encrypt async, missing "type"');if(!t)throw new f.MediaEncryptionError('encrypt async, missing "buffer"');if(!n)throw new f.MediaEncryptionError('encrypt async, missing "mediaKey"');var r=new m.WebcCryptoMedia({webcCryptoType:m.WEBC_CRYPTO_TYPE_CODE.ENCRYPT});return p.supportsWebCrypto().then(function(o){return o?(r.webcCryptoLibrary=m.WEBC_CRYPTO_LIBRARY_CODE.WEBCRYPTO,d.encryptE2EMediaWithWebCrypto(e,t,n)):(r.webcCryptoLibrary=m.WEBC_CRYPTO_LIBRARY_CODE.CRYPTOJS,new c["default"](function(r,i){var o=new h;o.onmessage=r,o.onerror=i,o.postMessage({command:"encrypt-e2e-media",type:e,buffer:t,mediaKey:n})})["catch"](function(e){throw new Error(i(e))}).then(function(e){return e.data}))}).then(function(e){return r.webcCryptoFileSize=e.size,r.markWebcCryptoElapsedT(),r.commit(),e})}var s=n(2),c=r(s),l=n(18),u=r(l),d=n(202),p=n(207),h=n(1255),f=n(14),m=n(56);e.exports={decryptE2EMedia:o,encryptE2EMedia:a}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(993),s=n(14),c=n(8),l={getFiles:function(e,t){for(var n=[],r=e.target.files||e.dataTransfer.files,i=r.length+t>c.MAX_FILES?Math.max(c.MAX_FILES-t,0):r.length,l=0;l<i;l++)n.push(r[l]);if(r.length||t>=c.MAX_FILES)return o["default"].resolve(n);if(e.dataTransfer.getData("text/uri-list"))return a.urlToFile(e.dataTransfer.getData("text/uri-list")).then(function(e){return[e]});if(e.dataTransfer.getData("text/html")){var u=new DOMParser,d=u.parseFromString(e.dataTransfer.getData("text/html"),"text/html");if(d.createNodeIterator(d.childNodes[0],NodeFilter.SHOW_TEXT).nextNode()){if(e.dataTransfer.getData("text/plain")&&!t)return o["default"].reject(new s.MediaDragDropError("dropped html has text nodes",e.dataTransfer.getData("text/plain")))}else{var p=d.getElementsByTagName("img");if(p.length)return a.urlToFile(p[0].src).then(function(e){return[e]})}}return o["default"].resolve(n)}};e.exports=l},function(e,t,n){"use strict";function r(e){return CryptoJS.lib.WordArray.create(new Uint8Array(e))}var i=n(202),o=n(13),a=n(14),s=n(31),c=n(1),l=n(1096),u=n(21),d={ackE2EMedia:function(e,t,n){if(t&&n&&e){var a=u.userToLegacy(Store.Conn.me),d=o.build(a).readBuffer(),p=CryptoJS.lib.WordArray.create(d),h=r(i.computeKeys(e,t).refKey),f=CryptoJS.HmacSHA256(p,h);f.sigBytes=20,f.clamp();var m=s.urlSafe(f.toString(CryptoJS.enc.Base64)),g=n+"?ack="+m;return c.log("crypto:ack:"+g)(),l.postRetry(g)}},computeRefs:function(e,t){if(!e||!t||t.filter(function(e){return!u.isUser}).length>0)throw new a.MediaEncryptionError("computeRefs error: "+!!e+","+(t&&t.join()));var n=r(e);return t.map(function(e){var t=CryptoJS.HmacSHA256(CryptoJS.enc.Utf8.parse(u.userToLegacy(e)),n);return t.sigBytes=20,t.clamp(),s.urlSafe(t.toString(CryptoJS.enc.Base64))})},newB64MediaKey:function(){var e=new Uint8Array(32);return window.crypto.getRandomValues(e),s.encode(e)}};e.exports=d},function(e,t){"use strict";var n={boundHeightWidth:function(e,t,n,r){return t=t||r,e=e||n,t>e?t>r&&(e*=r/t,t=r):e>n&&(t*=n/e,e=n),{width:Math.max(t,1),height:Math.max(e,1)}}};e.exports=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=arguments.length<=1||void 0===arguments[1]||arguments[1],n=void 0;return new u["default"](function(r,i){n=new Image,t&&0!==e.indexOf("data:")&&n.setAttribute("crossOrigin","anonymous"),n.onload=r,n.onabort=function(){i(new Error("loadImage onabort"))},n.onerror=function(){i(new Error("loadImage onerror"))},n.src=e})["return"](n)}function o(e){return i(e).then(function(t){return t.naturalWidth>0?{img:t,fullWidth:t.naturalWidth,fullHeight:t.naturalHeight}:u["default"].reject(new d.MediaLoadError("image loaded with zero width",e))})["catch"](function(){return u["default"].reject(new d.MediaLoadError("unable to render image",e))})}function a(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],n=void 0,r=void 0,i=++y,o=new u["default"](function(o,a){
h.log("MediaLoad:video called (#"+i+") for "+e.name)(),n=document.createElement("video"),n.volume=0,n.autoplay=!0,t?(n.onloadedmetadata=function(){h.log("MediaLoad:video.onloadedmetadata #"+i)()},n.onloadeddata=function(){h.log("MediaLoad:video.onloadeddata #"+i)()},n.onprogress=function(){h.log("MediaLoad:video.onprogress #"+i)()}):(n.onloadedmetadata=o,n.onloadeddata=o,n.onprogress=o),n.onplay=o,n.onerror=function(){h.error("MediaLoad:video.onerror #"+i)(),a(new d.MediaLoadError("unable to play video",r))},n.src=r=window.URL.createObjectURL(e),n.load()});return setTimeout(function(){o.isPending()&&(h.error('unable to load video "'+e.name+'" ('+e.size+" bytes)")(),++v%3===0&&h.assert(!1,"dead-video","had "+v+" silent videos")())},8e3),o.then(function(){if(h.log("MediaLoad:video #"+i+" successful")(),n.pause(),n.videoWidth>0)return{video:n,fullWidth:n.videoWidth,fullHeight:n.videoHeight};throw new d.MediaLoadError("video loaded with zero width",r)})["finally"](function(){n&&(n.onloadedmetadata=null,n.onloadeddata=null,n.onplay=null,n.onerror=null),r&&window.URL.revokeObjectURL(r)})}function s(e){var t=void 0;return new u["default"](function(n,r){t=document.createElement("audio"),t.volume=0,t.autoplay=!0,t.onplay=function(e){t.pause(),n({audio:t})},t.onerror=function(){r(new d.MediaLoadError("unable to play audio",e))},t.src=e})["finally"](function(){t&&(t.onplay=t.onerror=null)})}function c(e,t){var n=t.indexOf(p.MIMETYPE_OGG)>-1;if(n&&!g){if(e.size<=m){var r=new f(e);return r.generateBlob()}throw new d.MediaLoadError("media-load:transcode blob too large",e.size)}return u["default"].resolve(e)}var l=n(2),u=r(l),d=n(14),p=n(8),h=n(1),f=n(1234),m=3e5,g=(new Audio).canPlayType("audio/ogg"),v=0,y=0;e.exports={loadImage:i,image:o,video:a,audio:s,transcode:c}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(53),o=r(i),a=n(44),s=r(a),c=n(52),l=r(c),u=n(199),d=r(u),p=n(198),h=r(p),f=n(415),m=n(996),g=n(1002),v=g.matchAll,y=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"match",value:function(e){return v(f.emojiRegex(),e)}},{key:"alwaysApply",get:function(){return!0}}]),t}(m);e.exports=y},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(53),o=r(i),a=n(44),s=r(a),c=n(52),l=r(c),u=n(199),d=r(u),p=n(198),h=r(p),f=n(996),m=n(1002),g=m.matchAll,v=n(30),y=function(e){function t(e){(0,s["default"])(this,t);var n=(0,d["default"])(this,(0,o["default"])(t).call(this)),r=e.map(v.escapeRegExp);return n._regex=new RegExp("("+r.join("|")+")","ig"),n}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"match",value:function(e){return g(this._regex,e)}}]),t}(f);e.exports=y},function(e,t){"use strict";var n=0,r=1,i=2,o=function(e,t){for(var n=[],r=0;r<t.length;++r){var i=t[r],o=i.match(e);if(o&&o.length){for(var a=i.group,s=0;s<o.length;++s){var c=o[s],l=c[0],u=c.index;if(c.idx=r,c.end=u+l.length-1,a){var d=c[a];c.gindex=u+l.indexOf(d),c.gend=c.gindex+d.length-1}else c.gindex=u,c.gend=c.end}n.push(o)}}if(!n.length)return n;if(1===n.length)return n[0].reverse();for(var p=[],h=0;h<n.length;++h)p[h]=n[h].length-1;for(var f=[],m=0;n.length>1;){for(var g=0,v=-1;g<n.length;++g)n[g][p[g]].index>v&&(m=g,v=n[g][p[g]].index);f.push(n[m][p[m]]),--p[m]<0&&(n.splice(m,1),p.splice(m,1))}return f.push.apply(f,n[0].slice(0,p[0]+1).reverse()),f},a=function(e,t){if(1===e.length)return e;for(var n=[],r=void 0;r=e.pop();){var i=e.length;if(!i&&n.push(r))break;for(var o=r,a=o.end,s=o.gend,c=o.idx,l=t[c],u=l.alwaysApply,d=l.formatResult,p=l.mutates,h=!0,f=i-1;f>=0;--f){var m=e[f];if(m.index>a)break;if(m.end>s){if(c<m.idx&&e.splice(f,1))continue;h=!1;break}if(!p||!e.splice(f,1)){var g=t[m.idx];if(!u&&!g.formatResult){h=!1;break}d||g.alwaysApply||!e.splice(f,1)}}h&&n.push(r)}return n},s=function(e,t){for(var o=e[0].input,a={children:[]},s=0,l=a,u=void 0,d=0;d<e.length;++d){for(var p=e[d],h=p.index,f=p.gindex;l.parent&&h>(u=l.match.gend);){if(s<=u&&l.children.push({type:n,value:o.substring(s,u+1)}),s=l.match.end+1,l.mutator.isFragment){var m=l.parent.children;m.pop(),m.push.apply(m,l.children)}l.mutator.isFormatter&&u!==l.match.end&&l.parent.children.push({type:r,value:o.substring(u+1,s)}),l=l.parent}s<h&&l.children.push({type:n,value:o.substring(s,h)});var g=t[p.idx],v=g.mutates,y=g.isFormatter;s=f,y&&h!==f&&l.children.push({type:r,value:o.substring(h,f)});var _={children:[],match:p,mutator:g,parent:l,type:i};if(v){var E=p[g.group],b=g.mutate(E,p);if(E!==b){var S=c(b,t);_.children=S.children,s=p.gend+1}}l.children.push(_),l=_}do{var M=l.match,T=M.end,C=M.gend;if(s<=C&&l.children.push({type:n,value:o.substring(s,C+1)}),s=T+1,l.mutator.isFragment){var w=l.parent.children;w.pop(),w.push.apply(w,l.children)}l.mutator.isFormatter&&C!==T&&l.parent.children.push({type:r,value:o.substring(C+1,s)})}while((l=l.parent)&&l.parent);return s!==o.length&&l.children.push({type:n,value:o.substring(s)}),a},c=function(e,t){var r=o(e,t);return r.length?s(a(r,t),t):{children:[{type:n,value:e}]}},l=function u(e,t){var o=e.children,a=e.type,s=e.value;if(a===r)return t.onDelimiter(s);if(a===n)return t.onText(s);var c=o.map(function(e){return u(e,t)}).filter(function(e){return!!e});return a===i?t.onMutatorNode(e,c):t.onRoot(c)};e.exports={parse:c,serialize:l}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n){var r=e.models;if(n===E.BEFORE){var i=function(){var e=0;return{v:{hasNext:function(){return t>=e},next:function(){return r[t--]}}}}();if("object"==typeof i)return i.v}else{if(n!==E.AFTER)throw new Error("RendorCursor:invalid direction");var o=function(){var e=r.length-1;return{v:{hasNext:function(){return t<=e},next:function(){return r[t++]}}}}();if("object"==typeof o)return o.v}}function o(e,t,n){for(var r=arguments.length<=3||void 0===arguments[3]?1:arguments[3],o=C*r,a=i(e,t,n),s=0,l=0,u=void 0;a.hasNext();){var d=a.next(),p=c(d),h=2*d.isNotification+d.isSentByMe,f=h&&h===u?b:S;if(s+=p+f,l++,s>o)break;u=h}return l}function a(e,t,n){for(var r=arguments.length<=3||void 0===arguments[3]?1:arguments[3],o=C*r,a=i(e,t,n),s=0,l=0,u=void 0;a.hasNext();){var d=a.next(),p=c(d),h=d.author||(d.isSentByMe?Store.Conn.me:void 0),f=h&&!d.isSentByMe&&h!==u?M:0,m=h&&h===u?b:S;if(s+=p+f+m,l++,s>o)break;u=h}return l}function s(e,t,n){for(var r=arguments.length<=3||void 0===arguments[3]?1:arguments[3],o=C*r,a=i(e,t,n),s=0,l=0;a.hasNext();){var u=a.next(),d=c(u);if(s+=d+T,l++,s>o)break}return l}function c(e){var t=0;switch(e.quotedMsg&&(t+=54),e.caption&&(t+=31),e.type){case m.TYPE.NOTIFICATION:case m.TYPE.GROUP_NOTIFICATION:case m.TYPE.GP2:case m.TYPE.BROADCAST_NOTIFICATION:case m.TYPE.E2E_NOTIFICATION:case m.TYPE.CALL_LOG:case m.TYPE.CIPHERTEXT:case m.TYPE.CHAT:e.linkPreview&&(t+=53);var n=y(e.body).length;return t+19*_.ceil(n/100)+13;case m.TYPE.IMAGE:return t+e.fullWidth&&e.fullHeight?Math.floor(Math.min(330/e.fullWidth*e.fullHeight,330)):330;case m.TYPE.VIDEO:case m.TYPE.AUDIO:return e.isGif?t+137:t+166;case m.TYPE.LOCATION:return t+v.previewHeight;case m.TYPE.PTT:return t+67;case m.TYPE.VCARD:return t+74;case m.TYPE.DOCUMENT:return t+188;case m.TYPE.UNKNOWN:default:return t}}function l(e){switch(e){case g.RENDOR_CURSOR.CONVERSATION:case g.RENDOR_CURSOR.GROUP_CONVERSATION:return g.RENDOR_CURSOR.RECENT_AT_BOTTOM;case g.RENDOR_CURSOR.STARRED_DRAWER:return g.RENDOR_CURSOR.RECENT_AT_TOP;default:return g.RENDOR_CURSOR.RECENT_AT_BOTTOM}}function u(e){switch(e){case g.RENDOR_CURSOR.CONVERSATION:return o;case g.RENDOR_CURSOR.GROUP_CONVERSATION:return a;case g.RENDOR_CURSOR.STARRED_DRAWER:return s;default:return o}}var d=n(44),p=r(d),h=n(52),f=r(h),m=n(974),g=n(8),v=n(1068),y=n(1123),E={BEFORE:"before",AFTER:"after"},b=2,S=12,M=19,T=65,C=window.innerHeight,w=_.debounce(function(e){C=window.innerHeight},500);window.addEventListener("resize",w);var x=function(){function e(t,n,r){var i=this;(0,p["default"])(this,e);var o=u(r);this.msgCollection=t,this.type=r,this.dir=l(r),this.cursorSize=function(e,t){if(e===E.BEFORE)return o(i.msgCollection,i.start-1,e,t);if(e===E.AFTER)return o(i.msgCollection,i.end,e,t);throw new Error("RendorCursor:invalid direction")},this.init(n)}return(0,f["default"])(e,[{key:"init",value:function(e){return this.before=0,this.after=0,this.setKey(e),this.loadBefore(void 0,1),this.loadAfter(void 0,1),this}},{key:"setKey",value:function(e){return this.msgKey=e,this.updatePrev(),e||(this.before+=this.after),this}},{key:"onRemove",value:function(e){e.id===this.prevKey?this.updatePrev():e.id===this.msgKey&&this.focusBefore()}},{key:"updatePrev",value:function(){this.prevKey=this.index>0?this.msgCollection.models[this.index-1].id:void 0}},{key:"focusBefore",value:function(){this.msgKey=this.prevKey,this.updatePrev()}},{key:"loadBefore",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?2:arguments[1],n=e||this.cursorSize(E.BEFORE,t);return this.before+=n,this}},{key:"loadAfter",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?2:arguments[1],n=e||this.cursorSize(E.AFTER,t);return this.after+=n,this}},{key:"index",get:function(){if(this.msgKey){var e=this.msgCollection.get(this.msgKey),t=this.msgCollection.indexOf(e);if(t!==-1)return t}return this.dir===g.RENDOR_CURSOR.RECENT_AT_TOP?0:this.msgCollection.length-1}},{key:"start",get:function(){return Math.max(this.index-this.before,0)}},{key:"end",get:function(){return Math.min(this.index+this.after+1,this.msgCollection.length)}}]),e}();e.exports=x},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return s(function(){return p.get(e,t)})}function o(e){return s(function(){return p.head(e)})}function a(e,t){return s(function(){return p.post(e,t)})}function s(e){return d.loopOnError(f.ShouldLoop,function(t){var n;return n=u.state===u.STATE.CONNECTED?l["default"].delay(Math.floor(1e3*h.expBackoff(t,60,void 0,.1))):d.waitForBBEvent(u,"change:state",_.matches({state:u.STATE.CONNECTED})),n.then(function(){return e().then(function(e){if(e.status>=500)throw new f.ShouldLoop;return e})["catch"](function(){throw new f.ShouldLoop})})})}var c=n(2),l=r(c),u=n(12),d=n(29),p=n(135),h=n(103),f=n(14);e.exports={headRetry:o,getRetry:i,postRetry:a}},function(e,t,n){e.exports=function(){return new Worker(n.p+"b25a5072816123111083.worker.js")}},,function(e,t,n){"use strict";var r=n(6),i=n(10),o=n(78),a=n(63),s=r.createClass({displayName:"ActionListener",mixins:[o],componentWillMount:function(){this.regCmd("mute_chat",this.onMute),this.regCmd("delete_or_exit_chat",this.onDeleteOrExit),this.regCmd("archive_chat",this.onArchive),this.regCmd("clear_chat_msgs",this.onClear),this.regCmd("mark_chat_unread",this.onMarkUnread)},onMute:function c(e,t){if(t){var o=n(1185),c=function(t){e.pendingAction++,e.mute.mute(t,!0)["finally"](function(){e.pendingAction--})};i.openModal(r.createElement(o,{chat:e,onMute:c}),"modal",this.context.uim)}else e.pendingAction++,e.mute.unmute(!0)["finally"](function(){e.pendingAction--})},onDeleteOrExit:function(e){var t=n(1173),o=function(t){e.pendingAction++,t["finally"](function(){e.pendingAction--})};i.openModal(r.createElement(t,{chat:e,onDeleteOrExit:o}),"modal",this.context.uim)},onClear:function(e){var t=n(1169);i.openModal(r.createElement(t,{chat:e}),"modal",this.context.uim)},onArchive:function(e,t){e.pendingAction++,e.setArchive(t)["catch"](_.noop)["finally"](function(){e.pendingAction--})},onMarkUnread:function(e,t){e.pendingAction++,e.markUnread(t)["finally"](function(){e.pendingAction--})},render:function(){return null}});s.contextTypes={uim:r.PropTypes.instanceOf(a)},e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(201).MIMETYPES,o=_.pickBy(i,function(e){return"audio"===e.msgType}),a=r.createClass({displayName:"AttachMediaTypeAudio",propTypes:{mimeType:r.PropTypes.oneOf(_.keys(o)).isRequired,url:r.PropTypes.string.isRequired},render:function(){var e=this.props,t=e.mimeType,n=e.url;return r.createElement("div",{className:"media-element-container"},r.createElement("div",{className:"media-element"},r.createElement("audio",{controls:!0,type:t,src:n})))}});e.exports=a},function(e,t,n){"use strict";var r=n(6),i=n(994),o=n(1022),a=r.createClass({displayName:"AttachMediaTypeDoc",propTypes:{preview:r.PropTypes.object,mimeType:r.PropTypes.string,filename:r.PropTypes.string},render:function(){var e=this.props.preview;return e?r.createElement("div",{className:"media-element-pdf-container"},r.createElement("div",{className:"media-element-pdf-preview"},r.createElement(i,{type:i.TYPES.SCALE_DOWN,size:{width:e.width,height:e.height}},r.createElement("img",{src:e.url,className:"media-viewer-img"})))):r.createElement(o,{mimeType:this.props.mimeType,filename:this.props.filename})}});e.exports=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(412),o=r(i),a=n(6),s=n(994),c=n(201).MIMETYPES,l=_.pickBy(c,function(e){return"image"===e.msgType||"video"===e.msgType}),u=a.createClass({displayName:"AttachMediaTypeMedia",propTypes:{mimeType:a.PropTypes.oneOf(_.keys(l)).isRequired,url:a.PropTypes.string.isRequired,isGif:a.PropTypes.bool,size:a.PropTypes.shape({width:a.PropTypes.number,height:a.PropTypes.number})},render:function(){var e=this.props,t=e.mimeType,n=e.url,r=e.size,i=void 0;if("image"===l[t].msgType)i=a.createElement("img",{src:n,className:"media-viewer-img"});else if("video"===l[t].msgType){var c=this.props.isGif?{loop:!0,autoPlay:!0,muted:!1,controls:!1}:{};i=a.createElement("video",(0,o["default"])({controls:!0,className:"media-viewer-img",type:t},c,{src:n}))}else"audio"===l[t].msgType&&(i=a.createElement("audio",{controls:!0,className:"media-viewer-audio",type:t,src:n}));return a.createElement("div",{className:"media-element-container"},a.createElement("div",{className:"media-element"},a.createElement(s,{type:s.TYPES.SCALE_DOWN,size:r},i)))}});e.exports=u},function(e,t,n){"use strict";var r=n(6),i=n(994),o=n(1022),a=r.createClass({displayName:"AttachMediaTypePdf",propTypes:{preview:r.PropTypes.object,mimeType:r.PropTypes.string,filename:r.PropTypes.string},componentWillUnmount:function(){},render:function(){var e=this.props.preview;if(e){var t=l10n.t("attach_document_pdf_total_pages",{count:e.pdfPages,_plural:e.pdfPages});return r.createElement("div",{className:"media-element-pdf-container"},r.createElement("div",{className:"media-element-pdf-preview"},r.createElement(i,{type:i.TYPES.SCALE_DOWN,size:{width:e.width,height:e.height}},r.createElement("img",{src:e.url,className:"media-viewer-img"}))),r.createElement("div",{className:"media-element-pdf-caption"},t))}return r.createElement(o,{mimeType:this.props.mimeType,filename:this.props.filename})}});e.exports=a},function(e,t,n){"use strict";var r=n(6),i=n(1),o=n(54),a=n(210),s=n(12),c=n(138),l=n(65),u=n(206),d=n(56),p=n(81),h=n(0),f=n(29),m=n(129),g=n(78),v=n(133),y=n(8),E=n(10),b=n(43),S=n(102),M=n(1e3),T=r.createClass({displayName:"ButterBar",mixins:[m,g],getInitialState:function(){var e=this;this._showNotifyTimer=new p(this.showPrompt),this._showBatteryTimer=new p(function(){return e.batteryUpdate()});var t=u.battery<y.BATTERY_LOW_THRESHOLD_1?u.battery<y.BATTERY_LOW_THRESHOLD_2?2:1:0;return{lowBatteryWarning:u.plugged?0:t,notifyPermission:window.Notification&&window.Notification.permission,showNotify:!1}},componentWillMount:function(){this.addObserver(l,"change:displayInfo"),this.addObserver(l,"change:needsUpdate"),this.addObserver(l,"change:needsManualDownload"),this.addObserver(u,"change:plugged",this.batteryUpdate),this.addObserver(u,"change:battery",this.batteryUpdate)},componentWillUnmount:function(){this._showNotifyTimer.cancel(),this._showBatteryTimer.cancel()},onReload:function(){a.restart()},onClickManualDownload:function(){},batteryUpdate:function(e){var t=this.state.lowBatteryWarning;u.plugged||u.battery>y.BATTERY_LOW_THRESHOLD_1?0!==t&&this.setState({lowBatteryWarning:0}):u.battery<=y.BATTERY_LOW_THRESHOLD_2?t!==-2&&(e?this._showBatteryTimer.onOrBefore(y.BATTERY_DELAY):2!==t&&this.setState({lowBatteryWarning:2})):t>-1&&u.battery<=y.BATTERY_LOW_THRESHOLD_1&&(e?this._showBatteryTimer.onOrBefore(y.BATTERY_DELAY):1!==t&&this.setState({lowBatteryWarning:1}))},dismissLowBatteryWarning:function(){var e=this.state.lowBatteryWarning;e>0&&this.setState({lowBatteryWarning:-e})},showPrompt:function(e){this.setState({showNotify:e})},guideConfirm:function(){E.closeModal()},guideLearnMore:function(){switch(o.browser){case y.BROWSER_TYPE.CHROME:return window.open("https://www.whatsapp.com/faq/web/28080004","_blank");case y.BROWSER_TYPE.FIREFOX:return window.open("https://www.whatsapp.com/faq/web/28080006","_blank");case y.BROWSER_TYPE.SAFARI:return window.open("https://www.whatsapp.com/faq/web/28080008","_blank");case y.BROWSER_TYPE.OPERA:return window.open("https://www.whatsapp.com/faq/web/28080007","_blank");default:return window.open("https://www.whatsapp.com/faq/web/28080004","_blank")}},requestPermissions:function(){E.openModal(r.createElement(M,{title:"guide_desktop_notifications_title",desc:"guide_desktop_notifications_description",onConfirm:this.guideConfirm,onCancel:this.guideLearnMore,type:M.TYPE.GUIDE_ALLOW}));var e=this;window.Notification.requestPermission(function(t){E.closeModal(),e.setState({notifyPermission:t})})},render:function(){var e=null;switch(l.displayInfo){case l.INFO.OFFLINE:e=r.createElement(x,{key:"bbar"});break;case l.INFO.OPENING:case l.INFO.CONNECTING:e=r.createElement(N,{key:"bbar"});break;case l.INFO.NORMAL:break;case l.INFO.RESUMING:case l.INFO.TIMEOUT:var t=function(){window.open("http://www.whatsapp.com/faq/web/28080002")},n=r.createElement("span",null,l10n.t("make_sure_phone_active_internet_connection")," ",r.createElement("span",{className:"action",onClick:t},l10n.t("learn_more")));e=r.createElement(C,{type:"phone",key:"bbar",title:l10n.t("phone_not_connected"),text:n})}if(!e&&this.state.lowBatteryWarning>0&&(e=r.createElement(C,{type:"battery",key:"bbar",title:l10n.t("phone_battery_low"),text:l10n.t("charge_phone_description"),dismissable:!0,onDismiss:this.dismissLowBatteryWarning})),!e&&l.needsUpdate&&(e=r.createElement(C,{type:"update",key:"bbar",title:l10n.t("update_available"),text:l10n.t("click_to_update_whatsapp_web"),action:this.onReload})),l.needsManualDownload&&(e=r.createElement(C,{type:"update",key:"bbar",title:l10n.t("desktop_client_update_available"),text:l10n.t("click_to_download_desktop_client"),action:this.onClickManualDownload})),e)this.state.showNotify&&this._showNotifyTimer.onOrBefore(0,!1);else if(this.state.showNotify){if(window.Notification&&this.state.notifyPermission===y.PERMISSION_DEFAULT){var i=r.createElement("span",{className:"action",onClick:this.requestPermissions},l10n.t("enable_desktop_notifications"));e=r.createElement(C,{type:"notification",key:"bbar",title:l10n.t("get_notified_of_new_messages"),text:i})}}else this._showNotifyTimer.onOrBefore(y.NOTIFICATION_PROMPT_DELAY,!0);return r.createElement("div",{className:"butterbar-container"},r.createElement(S,{transitionName:"butterbar"},e))}}),C=r.createClass({displayName:"BB",propTypes:{type:r.PropTypes.oneOf(["computer","phone","notification","battery","update"]),title:r.PropTypes.node.isRequired,text:r.PropTypes.node,dismissable:r.PropTypes.bool,onDismiss:r.PropTypes.func,action:r.PropTypes.func},onClick:function(){this.props.action&&this.props.action()},render:function(){var e,t;switch(this.props.type){case"computer":case"phone":case"notification":case"battery":case"update":e="butterbar-"+this.props.type,t="icon-alert-"+this.props.type;break;default:i.log("butterbar:render invalid type")()}var n=b("butterbar",e,{action:this.props.action}),o=b("icon","icon-alert",t),a=this.props.dismissable?r.createElement("div",{className:"butterbar-controls"},r.createElement("button",{className:"icon icon-x-light",onClick:this.props.onDismiss})):null,s=this.props.text?r.createElement("div",{className:"butterbar-text"},this.props.text):null;return r.createElement("div",{className:"butterbar-wrapper"},r.createElement("div",{className:n,onClick:this.onClick},r.createElement("div",{className:"butterbar-icon"},r.createElement("span",{className:o})),r.createElement("div",{className:"butterbar-body"},r.createElement("div",{className:"butterbar-title"},this.props.title),s),a))}}),w=3e3,x=r.createClass({displayName:"Offline",mixins:[v],getInitialState:function(){return{allowReconnect:!0}},reconnect:function(){var e=c.numSocketsAttempted+1;s.poke(),f.waitForBBEvent(l,"change:displayInfo",function(){return l.displayInfo===l.INFO.NORMAL}).then(function(){new d.WebcManualWebsocketAttempt({webcManualWebsocketAttemptSuccessful:c.numSocketsAttempted===e}).commit()}),this.setState({allowReconnect:!1}),this.reconnectTimeout=this.safeDelay(this.resetReconnectTimeout,w)},resetReconnectTimeout:function(){this.clearSafeTimeout(this.reconnectTimeout),delete this.reconnectTimeout,this.setState({allowReconnect:!0})},render:function(){var e,t;return this.state.allowReconnect?(e=r.createElement("span",null,l10n.t("make_sure_computer_active_internet_connection")+" ",r.createElement("span",{className:"action",onClick:this.reconnect},l10n.t("reconnect"))),t=l10n.t("computer_not_connected")):(e=null,t=l10n.t("connecting_to_whatsapp_or_phone")),r.createElement(C,{type:"computer",title:t,text:e})}}),N=r.createClass({displayName:"Resume",mixins:[m],getInitialState:function(){return{takingTooLong:!1,didShowSubtitle:!1}},componentWillMount:function(){this._timeoutTimer=new p(this.timedOut),this._intervalTimer=new p(this.onInterval),this.addObserver(s,"change:state",this.onProgress),this.addObserver(s,"change:retryTimestamp",this.onProgress)},componentDidMount:function(){this._timeoutTimer.onOrBefore(3e3)},componentWillUnmount:function(){this._timeoutTimer.cancel(),this._intervalTimer.cancel()},timedOut:function(){this._intervalTimer.onOrAfter(1e3),this.setState({takingTooLong:!0,didShowSubtitle:!0})},onProgress:function(){this._intervalTimer.cancel(),this._timeoutTimer.onOrBefore(3e3),this.setState({takingTooLong:!1})},onInterval:function(){this._intervalTimer.onOrAfter(1e3),this.setState({now:Date.now()})},retry:function(e){s.poke(),this.onProgress()},render:function(){var e,t;if(l.displayInfo===l.INFO.OPENING)e=l10n.t("connecting_to_whatsapp");else{if(l.displayInfo!==l.INFO.CONNECTING)return null;e=l10n.t("connecting_to_whatsapp_or_phone")}if(this.state.takingTooLong){var n=s.retryTimestamp-Date.now();if(n<1)n=l10n.t("retrying"),_.defer(function(){return s.poke()});else if(n<6e4){var i=Math.ceil(n/1e3);n=l10n.t("retrying_in_some_seconds",{number:i,_plural:i})}else n=l10n.t("retrying_in",{duration:h.duration(n).humanize()});t=r.createElement("span",null,n," ",r.createElement("span",{className:"action",onClick:this.retry},l10n.t("retry_now")))}else t=this.state.didShowSubtitle?r.createElement("span",null,l10n.t("retrying")):null;return r.createElement(C,{type:"computer",title:e,text:t})}});e.exports=T},function(e,t,n){"use strict";var r=n(6),i=n(977),o=n(976),a=n(1109),s=n(129),c=r.createClass({displayName:"ChatstateInfo",mixins:[s],propTypes:{chat:r.PropTypes.instanceOf(i)},componentWillMount:function(){var e=this.props.chat;this.addObserver(e.msgs,"change:last"),this.addObserver(e.presence,"change:chatstate.id change:chatstate.type change:withholdDisplay")},render:function(){var e=this.props.chat,t=e.presence;if(t.isActive()){var n=t.getFormattedString();if(n)return r.createElement("div",{className:"chat-status typing ellipsify",dir:"auto"},r.createElement(o,{ellipsify:!0,titlify:!0,text:n}))}var i=e.msgs.last();return i?r.createElement(a,{key:i.id,msg:i}):r.createElement("div",{className:"chat-status"})}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(196),o=r.createClass({displayName:"ContactMsgInfoCell",propTypes:{title:r.PropTypes.string.isRequired,icon:r.PropTypes.node.isRequired,t:r.PropTypes.number},render:function(){var e=this.props,t=e.title,n=e.t,o=e.icon,a=n?i.relativeDateAndTimeStr(n):"-",s={cursor:"auto"};return r.createElement("div",{className:"contact chat",style:s},r.createElement("div",{className:"chat-body"},r.createElement("div",{className:"chat-main"},r.createElement("div",{className:"chat-title"},r.createElement("span",{className:"ellipsify",dir:"auto"},o,t))),r.createElement("div",{className:"chat-secondary"},r.createElement("div",{className:"chat-status ellipsify"},r.createElement("span",{className:"ellipsify",dir:"auto"},a)))))}});e.exports=o},function(e,t,n){"use strict";var r=n(6),i=n(1003),o=n(982),a=n(196),s=n(975),c=r.createClass({displayName:"GroupMsgInfoCell",mixins:[s],propTypes:{participant:r.PropTypes.instanceOf(Object).isRequired},getInitialState:function(){return{formattedName:this.async("participant.contact.formattedName")}},render:function(){var e=this.props.participant,t=r.createElement("div",{className:"chat-avatar"},r.createElement(o,{id:e.id})),n={cursor:"auto"};return r.createElement(i,{id:e.id,contextEnabled:function(){return!1},image:t,primary:this.state.formattedName,secondary:a.relativeDateAndTimeStr(e.t),style:n})}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(975),o=n(102),a=r.createClass({displayName:"Icons",mixins:[i],propTypes:{chat:r.PropTypes.object.isRequired},getInitialState:function(){return{isMuted:this.async("chat.mute.isMuted"),unreadCount:this.async("chat.unreadCount"),archive:this.async("chat.archive")}},render:function(){var e=this.props.chat,t=this.state.isMuted?r.createElement("span",{className:"icon icon-meta icon-muted",key:"icon-muted"}):null,n=0!==e.unreadCount?r.createElement("span",{className:"icon-meta unread-count",key:"icon-unread"},e.unreadCount>0?l10n.n(this.state.unreadCount):r.createElement("span",null," ")):null,i=this.state.archive?r.createElement("span",{className:"icon-meta chat-marker chat-marker-archived",key:"icon-archived"},l10n.t("chat_archived")):null;return r.createElement(o,{transitionName:"pop"},t,i,n)}});e.exports=a},function(e,t,n){"use strict";var r=n(6),i=n(974),o=n(54),a=n(984),s=n(1023),c=n(1010),l=n(976),u=n(975),d=n(43),p=r.createClass({displayName:"LastMsg",mixins:[u],propTypes:{msg:r.PropTypes.instanceOf(i).isRequired},getInitialState:function(){var e=this.props.msg,t={};return e.sender&&(t.formattedShortName=this.async("msg.senderObj.formattedShortName")),e.type===i.TYPE.PTT&&(t.duration=this.async("msg.duration")),e.typeCanChange()&&(t.hasSymbol=this.async("msg.hasSymbol")),t},render:function(){var e=this.props.msg,t=[];if(e.isSentByMe&&t.push(r.createElement(s,{msg:e,key:"symbol"})),!e.isSentByMe&&e.isGroupMsg&&!e.isNotification){var n=d("chat-status-name",{number:!e.senderObj.name});t.push(r.createElement(l,{text:this.state.formattedShortName,direction:"auto",classes:n,key:"author"})),t.push(r.createElement("span",{className:"chat-status-divider",key:"divider"},":"))}e.hasSymbol&&t.push(r.createElement(c,{msg:e,key:"msg-symbol"})),t.push(r.createElement(l,{direction:e.dir,ellipsify:!0,text:a.msgText(e),key:"status"}));var i="chat-status";o.isGecko&&(i+=" ellipsify");var u=l10n.embedDir(a.msgText(e),e.rtl);return r.createElement("div",{className:i,title:u},t)}});e.exports=p},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(975),a=n(1003),s=n(976),c=n(1053),l=n(1010),u=n(974),d=n(43),p=n(1008),h=n(129),f=n(54),m=n(984),g=n(1023),v=n(134),y=n(131),E=y.HotKeys,b=r.createClass({displayName:"Message",mixins:[o,h],propTypes:{msg:r.PropTypes.instanceOf(u).isRequired,searchText:r.PropTypes.string,mouseDownAsClick:r.PropTypes.bool,onClick:r.PropTypes.func,active:r.PropTypes.object},getInitialState:function(){var e=this.props,t=e.msg,n=e.active,r={formattedTitle:this.async("msg.chat.formattedTitle"),active:!!n&&n.value===t};return t.sender&&t.isGroupMsg&&!t.isNotification&&(t.isSentByMe?r.formattedShortName=t.senderObj.formattedShortName:r.formattedShortName=this.async("msg.senderObj.formattedShortName")),r},componentWillMount:function(){this.props.active&&this.addObserver(this.props.active,this.props.msg.id.toString(),this.onActiveChange)},onActiveChange:function(e){if("focus"===e){var t=i.findDOMNode(this);v.focus(t),p.scrollIntoViewIfNeeded(t)}this.setState({active:!!e})},onClick:function(e){if(_.isFunction(this.props.onClick)){var t=this.props.msg,n=t.chat,r=n.getSearchContext(t);r.msg=t,this.props.onClick(e,n,r)}},onMouseDown:function(e){0===e.button&&this.onClick(e)},onEnter:function(e){e.preventDefault(),e.stopPropagation(),E.flashFocus=Date.now(),this.onClick(e)},indicateFocus:function(e){if(!(Date.now()-(E.flashFocus||0)>200)){var t=i.findDOMNode(this.refs.cell);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.onBlur})}},onBlur:function(e){var t=i.findDOMNode(this.refs.cell);t&&(Velocity(t,"stop"),t.style.backgroundColor="")},contextEnabled:function(){return!1},render:function(){var e=this.props.msg,t=r.createElement(c,{msg:e}),n=[];if(e.isSentByMe&&n.push(r.createElement(g,{msg:e,key:"symbol"})),!e.isSentByMe&&e.isGroupMsg&&!e.isNotification){var i=d("chat-status-name",{number:!e.senderObj.name});n.push(r.createElement(s,{text:this.state.formattedShortName,direction:"auto",classes:i,key:"author"})),n.push(r.createElement("span",{className:"chat-status-divider",key:"divider"},":"))}e.hasSymbol&&n.push(r.createElement(l,{msg:e,key:"msg-symbol"}));var o=this.props.searchText?_.uniq(_.compact(_.split(_.toLower(this.props.searchText)," "))):null;n.push(r.createElement(s,{direction:e.dir,ellipsify:!0,highlight:o,text:m.msgText(e),key:"status"}));var u="chat-status";f.isGecko&&(u+=" ellipsify");var p=l10n.embedDir(m.msgText(e),e.rtl),h=r.createElement("div",{className:u,title:p},n),v={enter:this.onEnter},y=d("message",{active:!!this.state.active}),b=this.props.mouseDownAsClick;return r.createElement(E,{handlers:v,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover"},r.createElement(a,{id:e.id+"",ref:"cell",contextEnabled:this.contextEnabled,className:y,primary:e.chat.formattedTitle,primaryDetail:t,secondary:h,onClick:b?null:this.onClick,onMouseDown:b?this.onMouseDown:null,onContext:this.onMenu}))}});e.exports=b},function(e,t,n){"use strict";var r=n(6),i=n(424),o=n(976),a=n(975),s=r.createClass({displayName:"Status",mixins:[a],propTypes:{status:r.PropTypes.instanceOf(i)},getInitialState:function(){return{status:this.async("status.status")}},render:function(){return _.isUndefined(this.state.status)?r.createElement("div",{className:"muted"},l10n.t("contact_status_loading")):r.createElement("div",{className:"chat-status ellipsify",title:this.state.status},r.createElement(o,{direction:"auto",ellipsify:!0,text:this.state.status}))}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(10),o=n(78),a=n(977),s=n(63),c=r.createClass({displayName:"ChatActionListener",mixins:[o],componentWillMount:function(){this.regCmd("chat_info_drawer",this.onChatInfoDrawer),this.regCmd("msg_info_drawer",this.onMsgInfoDrawer),this.regCmd("chat_search",this.onChatSearch),this.regCmd("attach_media_drawer",this.onAttachMediaDrawer),this.regCmd("verification_drawer",this.onVerificationDrawer)},onChatInfoDrawer:function(e){var t=n(1075);i.openDrawerRight(r.createElement(t,{chat:e}),"slide-left",this.context.uim)},onVerificationDrawer:function(e){var t=n(1193);i.openDrawerRight(r.createElement(t,{contact:Store.Contact.get(e),isFirstLevel:!0}),"slide-left",this.context.uim)},onMsgInfoDrawer:function(e){if(e.chat.kind===a.KIND.CHAT){var t=n(1172);i.openDrawerRight(r.createElement(t,{msg:e}),"slide-left",this.context.uim)}else{var o=n(1179);i.openDrawerRight(r.createElement(o,{msg:e}),"slide-left",this.context.uim)}},onAttachMediaDrawer:function(e,t){var o=n(1074),a=n(1077),s=t?a.STATE.PROCESSING:a.STATE.ACTIVE;i.openDrawerMid(r.createElement(o,{chat:e,files:t,state:s}),"slide-up",this.context.uim)},onChatSearch:function(e){var t=n(1079);i.openDrawerRight(r.createElement(t,{chat:e}),"slide-left",this.context.uim)},render:function(){
return null}});c.contextTypes={uim:r.PropTypes.instanceOf(s)},e.exports=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(420),o=r(i),a=n(6),s=n(34),c=n(985),l=n(10),u=n(1026),d=n(129),p=n(78),h=n(130),f=n(987),m=n(197),g=n(1004),v=n(977),y=n(992),E=n(1110),b=n(101),S=n(131),M=S.HotKeys,T=a.createClass({displayName:"Chatlist",mixins:[d,p,h],propTypes:{isSearching:a.PropTypes.bool,searchText:a.PropTypes.string,chats:a.PropTypes.array,contacts:a.PropTypes.array,ftsResult:a.PropTypes.array,onClick:a.PropTypes.func,selection:a.PropTypes.instanceOf(f),onFocusSearch:a.PropTypes.func},getDefaultProps:function(){return{chats:[]}},getInitialState:function(){var e=this;return this._listPointerEvents=!0,this.debouncedOpenSelected=_.debounce(function(){e.openSelected(e.focusComposer),e.focusComposer=!1},200),{}},componentWillMount:function(){this.props.selection.init(this.getSelection())},componentWillUnmount:function(){var e=this.getSelection(),t=this.props.selection.getVal();t&&t.isState&&!this.props.isSearching&&!e.length&&l.clearChat(t)},componentDidMount:function(){this.regCmd("focus_chat_list",this.restoreFocus),this.regCmd("focus_next_chat",this.onNextChat.bind(this,null,!0)),this.regCmd("focus_prev_chat",this.onPrevChat.bind(this,null,!0)),this.regCmd("open_chat",this.updateSelected)},componentDidUpdate:function(){var e=this.props.selection.getVal();this.props.selection.init(this.getSelection(),!this.props.isSearching),e!==this.props.selection.getVal()&&this.debouncedOpenSelected()},onListPointerEventsOff:function(){this._listPointerEvents=!1},onListPointerEventsOn:function(){this._listPointerEvents=!0},updateSelected:function(e){this.debouncedOpenSelected.cancel(),this.props.selection.setVal(e,!1)},openSelected:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],t=this.props.selection.getVal();t&&t instanceof v&&l.openChat(t,!1,e,!1)},onClick:function(e,t,n){var r=this;e.preventDefault(),e.stopPropagation(),Store.Chat.find(t.id).then(function(e){r.props.isSearching&&r.props.onClick&&r.props.onClick(),l.openChat(e,n,!0),n&&l.focusShowMsg(n.msg.id)})},getSelection:function(){return[].concat((0,o["default"])(this.props.chats),(0,o["default"])(this.props.contacts),(0,o["default"])(this.getFTSStarred()),(0,o["default"])(this.getFTSMessages()))},getFTSStarred:function(){return _.filter(this.props.ftsResult,{star:!0})},getFTSMessages:function(){return _.filter(this.props.ftsResult,{star:!1})},getList:function(){for(var e=this.props,t=e.chats,n=e.contacts,r=[],i=0;i<t.length;i++){var o=t[i];o&&(this.props.isSearching&&0===i&&r.push(a.createElement(u,{key:"chat-header",header:l10n.t("web_chats")})),r.push(a.createElement(g,{chat:o,mode:g.Mode.LAST,searchText:this.props.searchText,onClick:this.onClick,mouseDownAsClick:!0,active:this.props.selection,key:o.id})))}for(var s=0;s<n.length;s++){var c=n[s];c&&(0===s&&r.push(a.createElement(u,{key:"contact-header",header:l10n.t("web_contacts")})),r.push(a.createElement(y,{contact:c,active:this.props.selection,searchText:this.props.searchText,onClick:this.onClick,mouseDownAsClick:!0,key:c.id})))}if(b.supportsFeature(b.F.FULL_TEXT_SEARCH)){for(var l=this.getFTSStarred(),d=0;d<l.length;d++){var p=l[d];0===d&&r.push(a.createElement(u,{key:"fts-header-starred",header:l10n.t("web_starred_messages")})),r.push(a.createElement(E,{msg:p,searchText:this.props.searchText,onClick:this.onClick,active:this.props.selection,key:p.id.toString()}))}for(var h=this.getFTSMessages(),f=0;f<h.length;f++){var m=h[f];0===f&&r.push(a.createElement(u,{key:"fts-header-messages",header:l10n.t("web_messages")})),r.push(a.createElement(E,{msg:m,searchText:this.props.searchText,onClick:this.onClick,active:this.props.selection,key:m.id.toString()}))}}return r},restoreFocus:function(){this.props.selection.reset()},onFocusGain:function(e){var t=this.refs.uie;t&&t.activate(),e.target===s.findDOMNode(this)&&this._listPointerEvents&&(this.props.selection.index<0?this.focusFirst():this.props.selection.reset())},focusFirst:function(){this.props.selection.setFirst(),this.debouncedOpenSelected()},onNextChat:function(e,t,n){e&&(e.preventDefault(),e.stopPropagation());var r=this.props.selection.next();this.props.selection.index!==r&&(this.props.selection.setNext(),this.focusComposer=n,this.debouncedOpenSelected())},onPrevChat:function(e,t,n){e&&(e.stopPropagation(),e.preventDefault());var r=this.props.selection.prev();r>-1?(this.props.selection.setPrev(),this.focusComposer=n,this.debouncedOpenSelected()):t||(this.debouncedOpenSelected.cancel(),this.openSelected(),this.props.onFocusSearch())},render:function(){var e=this,t={down:function(t){return e.onNextChat(t)},up:function(t){return e.onPrevChat(t)}};return a.createElement(m,{displayName:"Chatlist",ref:"uie",state:m.State.PASSIVE,requestFocus:function(){return e.props.selection.reset(!1)}},a.createElement(M,{handlers:t,onFocus:this.onFocusGain,"data-tab":3},a.createElement(c,{className:"chatlist",data:this.getList(),height:72,animate:!0,extraItems:4,onPointerEventsOff:this.onListPointerEventsOff,onPointerEventsOn:this.onListPointerEventsOn})))}});e.exports=T},function(e,t,n){"use strict";var r=n(6),i=n(12),o=n(1082),a=n(410),s=n(1158),c=n(1159),l=n(1160),u=n(1164),d=n(1083),p=n(15),h=n(419),f=n(983),m=n(982),g=n(10),v=n(975),y=n(1012),_=y.MenuBarItem,E=y.MenuBar,b=n(101),S=n(413),M=n(43),T=n(102),C="global_mute",w=r.createClass({displayName:"ChatlistHeader",mixins:[v],getDefaultProps:function(){return{muteId:C}},getInitialState:function(){return Store.Mute.globalMute(),{isMuted:this.async("muteId.Mute.isMuted")}},componentWillUnmount:function(){},onMouseDown:function(){},onDrag:function(e){this.didDrag=!0},onClickCapture:function(e){},onNewChat:function(e){e.preventDefault(),g.openDrawerLeft(r.createElement(s,null))},onProfile:function(){g.openDrawerLeft(r.createElement(o,{id:Store.Conn.me}))},onUnmute:function(){Store.Mute.globalMute().unmute(),g.openToast(r.createElement(S,{msg:l10n.t("global_unmuted"),id:S.genId()}))},render:function(){var e=null;this.state.isMuted&&(e=r.createElement(_,{icon:"dnd",title:l10n.t("global_unmute"),onClick:this.onUnmute,key:"btn-dnd"}));var t=M("pane-list-user",{});return r.createElement("header",{className:"pane-header pane-list-header",onMouseDown:this.onMouseDown,onClickCapture:this.onClickCapture},r.createElement("div",{className:t},r.createElement(m,{id:Store.Conn.me,size:40,onClick:this.onProfile})),r.createElement("div",{className:"pane-list-controls"},r.createElement(E,{key:"chatlist-header"},r.createElement(T,{transitionName:"btn"},e,r.createElement(_,{a8n:"menu-bar-chat",icon:"chat",title:l10n.t("web_menuitem_new"),onClick:this.onNewChat}),r.createElement(_,{a8n:"menu-bar-menu",icon:"menu",title:l10n.t("menutitle_menu")},r.createElement(x,null))))))}});e.exports=w;var x=r.createClass({displayName:"ChatlistHeaderDropdown",getInitialState:function(){return{rememberMe:p.getRememberMe()}},onCreateGroup:function(){g.openDrawerLeft(r.createElement(c,null))},onProfile:function(){g.openDrawerLeft(r.createElement(o,{id:Store.Conn.me}))},onDisconnect:function(){var e=Store.Msg.some(function(e){return 0===e.ack&&e.local&&e.isSentByMe});return e?void g.openModal(r.createElement(a,{title:l10n.t("confirm_logout"),onOK:function(){return i.logout()},okText:l10n.t("menuitem_logout"),onCancel:function(){return g.closeModal()},cancelText:l10n.t("web_cancel")},l10n.t("some_of_your_messages_are_still_sending"))):i.logout()},onArchived:function(){g.openDrawerLeft(r.createElement(u,null))},onSettings:function(){g.openDrawerLeft(r.createElement(l,null))},onStarred:function(){g.openDrawerLeft(r.createElement(d,null))},render:function(){var e=b.supportsFeature(b.F.GROUP_CREATE)?r.createElement(f,{a8n:"mi-new-group menu-item",action:this.onCreateGroup,shortcut:"g"},l10n.t("web_menuitem_groupchat")):null,t=b.supportsFeature(b.F.STARRED)&&b.supportsFeature(b.F.FULL_TEXT_SEARCH)?r.createElement(f,{a8n:"mi-starred menu-item",action:this.onStarred},l10n.t("menuitem_starred")):null;return r.createElement(h,{type:h.Type.DROPDOWN_MENU,flipOnRTL:!0,key:"ChatlistHeader",direction:{x:h.Direction.X.LEFT}},e,r.createElement(f,{a8n:"mi-profile-status menu-item",action:this.onProfile},l10n.t("menuitem_profile_status")),r.createElement(f,{a8n:"mi-archived menu-item",action:this.onArchived},l10n.t("menuitem_archived")),t,r.createElement(f,{action:this.onSettings},l10n.t("menuitem_settings")),r.createElement(f,{a8n:"mi-logout menu-item",action:this.onDisconnect,shortcut:"q"},l10n.t("menuitem_logout")))}})},function(e,t,n){"use strict";var r=n(6),i=n(992),o=n(131),a=o.HotKeys,s=n(987),c=r.createClass({displayName:"ParticipantList",propTypes:{contacts:r.PropTypes.array.isRequired,onDelete:r.PropTypes.func.isRequired,onFocusSearch:r.PropTypes.func.isRequired},getInitialState:function(){return this.selection=new s(this.props.contacts,function(e){return e.id}),null},componentWillReceiveProps:function(e){this.selection.init(e.contacts,!0)},focusLast:function(){_.size(this.props.contacts)&&this.selection.setLast()},focusPrev:function(e){e.preventDefault(),e.stopPropagation();var t=this.selection.prev();t>-1&&this.selection.setPrev()},focusNext:function(e){e.preventDefault(),e.stopPropagation();var t=this.selection.next();this.selection.index===t?(this.selection.unset(),this.props.onFocusSearch(e)):this.selection.setNext()},deleteContact:function(e){e.preventDefault(),e.stopPropagation();var t=_.find(this.props.contacts,this.selection.getVal());this.props.onDelete(e,t)},onParticipantClick:function(e,t){this.selection.setVal(t)},render:function(){var e=this,t=this.props.contacts;if(!t)return null;var n=_.size(this.props.contacts)?_.map(this.props.contacts,function(t){return r.createElement(i,{contact:t,active:e.selection,onDelete:e.props.onDelete,onClick:e.onParticipantClick,type:i.Type.SMALL,key:t.id})}):null,o={up:this.focusPrev,down:this.focusNext,backspace:this.deleteContact};o[l10n.LR("left","right")]=this.focusPrev,o[l10n.LR("right","left")]=this.focusNext;var s=r.createElement("ul",{ref:"list"},n);return r.createElement(a,{handlers:o},s)}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(129),a=n(78),s=n(980),c=n(1076),l=n(1114),u=n(1005),d=n(1113),p=n(990),h=n(132),f=n(1104),m=n(10),g=n(101),v=n(1020),y=n(14),E=n(987),b=n(8),S=n(134),M=n(884),T=n(131),C=T.HotKeys,w=2,x=100,N=r.createClass({displayName:"ChatlistPanel",mixins:[o,a,M,s,c],getInitialState:function(){var e=this;return this.ftsResultPage=0,this.fts=_.debounce(function(){e.pending=!1,e.setState({ftsLoading:!0},c.DD);var t=_.trim(e.searchText||"");v.multibyteLength(t)<w||(e._ftsPromise&&e._ftsPromise.cancel(),e._ftsPromise=Store.Msg.search(t,++e.ftsResultPage,x).checkpoint(e.rejectOnUnmount()).then(function(n){if(t===_.trim(e.searchText)){var r=e.ftsResultPage>1?e.state.ftsResult.concat(n.messages):n.messages;e.setState({ftsResult:r,searching:!1},c.DD),g.supportsFeature(g.F.FTS_PAGINATION)&&!n.eof||(e.ftsResultPage=0,e.setState({ftsLoading:!1},c.DD))}})["catch"](y.Unmount,_.noop)["catch"](function(){e.pending||e.setState({searching:!1,ftsLoading:!1},c.DD)}))},750),this.selection=new E([],function(e){return e.id.toString()}),this.throttledFilteredChats=_.throttle(function(t){var n=e.getFilteredChats(t);e.setState({chats:n},c.DD,c.CD)},450,{leading:!1,trailing:!0}),this.throttledFilteredContacts=_.throttle(function(t){var n=e.getFilteredContacts(t);e.setState({contacts:n},c.DD,c.CD)},450,{leading:!1,trailing:!0}),this.searchText="",{searching:!1,ftsResult:[],ftsLoading:!1,chats:this.getFilteredChats(),contacts:this.getFilteredContacts()}},componentWillMount:function(){var e=this;this.addObserver(Store.Chat,"sort remove change:archive",function(){e.searchText||(e.throttledFilteredChats.cancel(),e.throttledFilteredContacts.cancel(),e.setState({chats:e.getFilteredChats(),contacts:e.getFilteredContacts()}))})},componentDidMount:function(){this.regCmd("focus_chat_search",this.onFocusSearch)},componentDidUpdate:function(){this.shouldFTSSearch(this.refs.panel)&&(this.fts(),this.pending=!0)},componentWillUnmount:function(){this.fts.cancel(),this._ftsPromise&&this._ftsPromise.cancel(),this.throttledFilteredChats.cancel(),this.throttledFilteredContacts.cancel()},getFilteredContacts:function(e,t){if(!e)return[];e=l10n.accentFold(_.trim(e));var n=Store.Contact.getFilteredContacts();return n.filter(function(n){var r=n.searchMatch(e);if(!r)return!1;var i=Store.Chat.get(n.id);return!(!t&&i&&!i.isNewlyCreated())})},getFilteredChats:function(e){return e=_.trim(e),e?(e=l10n.accentFold(e),Store.Chat.filter(function(t){return t.contact.searchMatch(e)&&!t.isNewlyCreated()})):Store.Chat.filter(function(e){return!e.archive&&!e.isNewlyCreated()})},fullTextSearch:function(e){var t=_.trim(e);v.multibyteLength(t)>=w&&g.supportsFeature(g.F.FULL_TEXT_SEARCH)?(this.fts(),this.pending=!0,this.state.searching||this.setState({searching:!0},c.DD)):(this.fts.cancel(),this._ftsPromise&&this._ftsPromise.cancel(),this.ftsResultPage=0,this.pending=!1,(this.state.searching||this.state.ftsLoading)&&this.setState({searching:!1,ftsLoading:!1},c.DD))},shouldFTSSearch:function(e){var t=this.state.ftsResult;if(!t||0===t.length||0===this.ftsResultPage||this.pending)return!1;var n=_.last(e.children);return e.scrollHeight<e.clientHeight+n.scrollHeight},onSearch:function(e){if(!e)return void this.onStopSearch();var t=this.searchText;if(e!==t){var n={searchText:e};this.fullTextSearch(e),this.throttledFilteredChats(e),this.throttledFilteredContacts(e),t&&0===e.indexOf(t)?this.ftsResultPage=0:n.ftsResult=[],this.searchText=e,this.setState(n,c.DD)}},onStopSearch:function(){this.fts.cancel(),this._ftsPromise&&this._ftsPromise.cancel(),this.searchText="",this.refs.search&&this.refs.search.setState({searchText:this.searchText}),this.ftsResultPage=0,this.throttledFilteredChats.cancel(),this.throttledFilteredContacts.cancel(),this.pending=!1,this.setState({ftsResult:[],ftsLoading:!1,chats:this.getFilteredChats(),contacts:this.getFilteredContacts(),searching:!1})},onFocusList:function(e){e.repeat||this.refs.chatlist&&this.refs.search.isAtEnd()&&(e.preventDefault(),e.stopPropagation(),C.flashFocus=Date.now(),this.refs.chatlist.focusFirst())},onOpenFirst:function(e){var t=this;e.preventDefault();var n=_.head(this.getFilteredChats(this.searchText))||_.head(this.getFilteredContacts(this.searchText));n&&Store.Chat.find(n.id).then(function(e){t.onStopSearch(),C.flashFocus=Date.now(),m.openChat(e),m.focusChatTextInput(e)})},onFocusSearch:function(e){var t=this;m.existsDrawerLeft(function(e){e||(C.flashFocus=Date.now(),S.focus(t.refs.search))})},indicateFocus:function(e){if(!(Date.now()-(C.flashFocus||0)>200)){var t=i.findDOMNode(this.refs.input_hotkey);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},onScroll:function(e){this.handleScroll(e.target)},handleScroll:_.throttle(function(e){e.scrollTop+b.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&this.ftsResultPage>0&&!this.pending&&(this.fts(),this.pending=!0)},100),getEmptyChatlistState:function(e,t,n){return e.length||t.length||n.length?null:this.searchText?this.state.searching?r.createElement(p.Searching,null):r.createElement(p.Search,null):Store.Chat.some(function(e){return!e.isNewlyCreated()})?r.createElement(p.AllArchived,null):r.createElement(p.ListChats,null)},render:function(){var e=this.state,t=e.chats,n=e.contacts,i=this.state.ftsResult,o=this.getEmptyChatlistState(t,n,i);if(!o){var a=this.searchText?_.trim(this.searchText):null;o=r.createElement(d,{ref:"chatlist",chats:t,contacts:n,isSearching:!!this.searchText,searchText:a,ftsResult:i,selection:this.selection,onFocusSearch:this.onFocusSearch,onClick:this.onStopSearch})}var s={down:this.onFocusList,enter:this.onOpenFirst},c=this.state.ftsLoading&&i.length?r.createElement("div",{className:"more",style:{alignSelf:"center"}},r.createElement(h,{stroke:6,size:24})):null;return r.createElement("div",{id:"side",className:"pane pane-list pane-one"},r.createElement(l,{key:"ChatHeader"}),r.createElement(f,{key:"ButterBar"}),r.createElement(C,{handlers:s,onFocus:this.indicateFocus,ref:"input_hotkey",className:"search-container"},r.createElement(u,{ref:"search",onSearch:this.onSearch,searching:this.state.searching})),r.createElement("div",{ref:"panel",className:"pane-body pane-list-body",onScroll:this.onScroll,id:"pane-side","data-list-scroll-container":!0},o,c))}});e.exports=N},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(420),o=r(i),a=n(2),s=r(a),c=n(53),l=r(c),u=n(44),d=r(u),p=n(52),h=r(p),f=n(199),m=r(f),g=n(198),v=r(g),y=n(417),_=r(y),E=n(6),b=n(34),S=n(394),M={duration:300,easing:[.1,.82,.25,1]},T=function(e,t){return e.map(function(e,n){return[t[n]===e,n]}).filter(function(e){var t=(0,_["default"])(e,1),n=t[0];return!n}).map(function(e){var t=(0,_["default"])(e,2),n=t[1];return n})},C=function(e,t){return T(e,t).filter(function(n){return e[n]&&!t[n]})},w=function(e,t){return T(e,t).filter(function(n){return!e[n]&&t[n]})},x=function(e){function t(){var e,n,r,i;(0,d["default"])(this,t);for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=r=(0,m["default"])(this,(e=(0,l["default"])(t)).call.apply(e,[this].concat(a))),r.containerHeight=0,r.childAnimations=[],r.state={children:r.props.children},r.pendingRemoval=[],i=n,(0,m["default"])(r,i)}return(0,v["default"])(t,e),(0,h["default"])(t,[{key:"getHeightChange",value:function(e,t){var n=this;return e.reduce(function(e,r){if(r<t)return e;var i=n.refs["animation-child-"+r];return i?e+b.findDOMNode(i).clientHeight:e},0)}},{key:"animateElement",value:function(e,t,n,r){var i=this;this.childAnimations[e]||(this.childAnimations[e]=s["default"].resolve()),this.childAnimations[e].cancel();var o=n>0?[0,n]:[-n,0];return this.childAnimations[e]=this.childAnimations[e].then(function(){return S(t,{translateY:o},M)}).then(function(){return i.childAnimations[e]=s["default"].resolve()}).cancellable()["catch"](s["default"].CancellationError,function(){S(t,"finish",!0),t.style.transform=""}).then(function(){n>=0||(r.indexOf(e)===-1?t.style.transform="":t.style.opacity="0")}),this.childAnimations[e]}},{key:"transitionAffected",value:function(e,t){if(!e)return s["default"].resolve();for(var n=[],r=e.slice(-1),i=(0,_["default"])(r,1),o=i[0],a=0;a<=o;++a){var c=this.refs["animation-child-"+a];c&&n.push(this.animateElement(a,b.findDOMNode(c),(t?1:-1)*this.getHeightChange(e,a),e))}return s["default"].all(n)}},{key:"notifyHeightChange",value:function(e,t){e.length&&this.props.onHeightChange&&this.props.onHeightChange((t?1:-1)*this.getHeightChange(e,0))}},{key:"componentWillReceiveProps",value:function(e){var t,n=this,r=e.children,i=C(this.state.children,r);if(!i.length)return this.setState({children:r});var a=i.filter(function(e){return n.pendingRemoval.indexOf(e)===-1});a.length&&((t=this.pendingRemoval).push.apply(t,(0,o["default"])(a)),this.notifyHeightChange(i,!1),this.transitionAffected(i,!1).then(function(){n.pendingRemoval=n.pendingRemoval.filter(function(e){return a.indexOf(e)===-1}),n.setState({children:r})}))}},{key:"componentDidUpdate",value:function(e,t){var n=t.children,r=w(n,this.state.children);r.length&&(this.notifyHeightChange(r,!0),this.transitionAffected(r,!0))}},{key:"componentDidMount",value:function(){var e=this,t=this.state.children.reduce(function(t,n,r){var i=e.refs["animation-child-"+r];if(!i)return t;var o=b.findDOMNode(i);return o.style.transform="translateY(0)",t+o.clientHeight},0);this.props.onHeightChange(t,!0)}},{key:"render",value:function(){var e=this.state.children,t=E.Children.map(e,function(e,t){return e?E.cloneElement(e,{ref:"animation-child-"+t}):e});return E.createElement("div",null,t)}}]),t}(E.Component);e.exports=x},function(e,t,n){"use strict";var r=n(6),i=n(977),o=n(975),a=n(983),s=r.createClass({displayName:"ArchiveMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(i).isRequired,onArchive:r.PropTypes.func.isRequired},getInitialState:function(){return{archive:this.async("chat.archive")}},render:function(){var e=this.props.onArchive.bind(null,!this.state.archive);return r.createElement(a,{a8n:"mi-archive",action:e,shortcut:"a",key:"ArchiveMenuItem"},this.state.archive?l10n.t("unarchive_chat"):l10n.t("archive_chat"))}});e.exports=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(412),o=r(i),a=n(414),s=r(a),c=n(6),l=n(132),u=n(43),d=function(e){var t=e.className,n=e.children,r=(0,s["default"])(e,["className","children"]),i=u("doc-state",t);return c.createElement("div",(0,o["default"])({className:i},r),n)},p=function(e){var t=e.onClick;return c.createElement(d,{onClick:t||_.noop},c.createElement("span",{className:"icon doc-state-icon icon-audio-download"}))},h=function(){return c.createElement(d,null,c.createElement(l,{stroke:3,size:32}))},f=function(){return c.createElement(d,null,c.createElement("span",{className:"icon doc-state-icon icon-audio-cancel-noborder"},c.createElement(l,{stroke:3,size:32})))},m=function(){return c.createElement(d,null,c.createElement("span",{className:"icon doc-state-icon icon-audio-upload"}))};e.exports={Download:p,Pending:h,PendingCancel:f,Upload:m}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(883),o=r(i),a=n(6),s=n(34),c=n(130),l=n(203),u=a.createClass({displayName:"Draggable",mixins:[c],propTypes:{children:a.PropTypes.node.isRequired,start:a.PropTypes.shape({x:a.PropTypes.number,y:a.PropTypes.number}),scale:a.PropTypes.number,container:a.PropTypes.shape({width:a.PropTypes.number.isRequired,height:a.PropTypes.number.isRequired}),onStart:a.PropTypes.func,onDrag:a.PropTypes.func,onStop:a.PropTypes.func},getInitialState:function(){return{dragging:!1,x:0,y:0,offsetX:0,offsetY:0}},componentDidMount:function(){this.updateContainer()},componentWillReceiveProps:function(e){e.scale!==this.props.scale||e.container.width!==this.props.container.width||e.container.height!==this.props.container.height?this.updateContainer(e,!0):this.updateContainer(e)},updateContainer:function(e,t){e=e||this.props;var n=e.container;if(n&&this.refs.draggable){var r,i=s.findDOMNode(this.refs.draggable),o=this.state.x,a=this.state.y,c=i.width*e.scale,l=i.height*e.scale;this.props.scale!==e.scale&&this.state.center?(r=this.state.center,o=n.width/2-r.x*c,a=n.height/2-r.y*l):r={x:(n.width/2-o)/c,y:(n.height/2-a)/l},o>0?o=0:o+c<n.width&&(o=n.width-c),a>0?a=0:a+l<n.height&&(a=n.height-l),this.setState({width:c,height:l,x:o,y:a,center:r}),this.props.onStop&&t&&e.onStop(o,a)}},handleMouseDown:function(e){e.preventDefault(),this.setState({dragging:!0,offsetX:e.clientX-this.state.x,offsetY:e.clientY-this.state.y}),this.regNativeListener(window,"mousemove",this.handleMouseMove),this.regNativeListener(window,"mouseup",this.handleMouseUp),this.props.onStart&&this.props.onStart()},handleMouseUp:function(e){this.unregisterListeners(),this.setState({dragging:!1}),this.props.onStop&&this.props.onStop(this.state.x,this.state.y)},handleMouseMove:function(e){if(this.state.dragging){var t=e.clientX-this.state.offsetX,n=e.clientY-this.state.offsetY,r=this.props.container;r&&((t>0||t+this.state.width<r.width)&&(t=this.state.x),(n>0||n+this.state.height<r.height)&&(n=this.state.y)),this.setState({x:t,y:n}),this.props.onDrag&&this.props.onDrag(t,n)}},render:function(){var e=this.props.scale?" scale("+this.props.scale+")":"",t=(0,o["default"])({},l.prefix("transform"),"translate("+this.state.x+"px, "+this.state.y+"px)"+e);this.state.dragging||(t[l.prefix("transition")]="transform 200ms");var n="draggable";return this.state.dragging&&(n+=" dragging"),a.cloneElement(a.Children.only(this.props.children),{style:t,draggable:!0,ref:"draggable",className:n,onMouseDown:this.handleMouseDown})}});e.exports=u},function(e,t,n){"use strict";var r=n(6),i=n(8),o=i.ONE_BY_ONE_TRANS_GIF,a=n(415),s=a.emojiMap,c=n(43);e.exports=function(e){var t=e.emoji,n=e.size,i=void 0===n?"small":n,a=e.className,l=s[t];if(!l)return null;var u="small"===i?"emoji":"emojik";return r.createElement("img",{alt:t,draggable:!1,src:o,className:c(u,"emoji"+l,a)})}},function(e,t,n){"use strict";var r=n(6),i=n(977),o=n(975),a=n(983),s=r.createClass({displayName:"MarkUnreadMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(i).isRequired,onMarkUnread:r.PropTypes.func.isRequired},getInitialState:function(){return{unreadCount:this.async("chat.unreadCount")}},render:function(){var e=this.props.onMarkUnread.bind(null,!this.state.unreadCount);return r.createElement(a,{action:e,shortcut:"r",key:"MarkUnreadMenuItem"},this.state.unreadCount?l10n.t("mark_read_chat"):l10n.t("mark_unread_chat"))}});e.exports=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(420),o=r(i),a=n(417),s=r(a),c=n(46),l=r(c),u=function(e){for(var t={edges:{}},n=t,r=0;r<e.length;++r){for(var i=e[r],o=0;o<i.length;++o){var a=i[o];n.edges[a]||(n.edges[a]={edges:{}}),n=n.edges[a],o===i.length-1&&(n.idx=r)}n=t}return t},d=(0,l["default"])(n(437)),p=u(d),h=function(e,t){for(var n=[],r=e.length,i=t,o=0,a=void 0;(a=o)<r;){var s=i.edges[e[o++]];if(s){i=s;for(var c=i.idx;(i=i.edges[e[o]])&&++o;)void 0!==i.idx&&(c=i.idx);void 0===c?o=a+1:n.push([a,o-1]),i=t}}return n},f=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var o=e.charCodeAt(n++);if(56320===(64512&o)){t.push(e.substr(n-2,n-1));continue}--n}t.push(e[n-1])}return t};e.exports=function(e){if(!e||!e.length)return[];for(var t=[],n=0,r=h(e,p),i=0;i<r.length;++i){var a=(0,s["default"])(r[i],2),c=a[0],l=a[1];c!==n&&t.push.apply(t,(0,o["default"])(f(e.substring(n,c)))),t.push(e.slice(c,l+1)),n=l+1}return n<e.length&&t.push.apply(t,(0,o["default"])(f(e.substr(n)))),t}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(6),s=n(14),c=n(10),l=n(983),u=n(1167),d=n(1e3),p=a.createClass({displayName:"TakePhotoMenuItem",propTypes:{onImageTake:a.PropTypes.func.isRequired},onCapture:function(){var e=this,t=new o["default"](function(n,r){navigator.getUserMedia({video:!0},function(r){c.closeModal(),n(r),t.isPending()||c.openModal(a.createElement(u,{stream:r,onSend:e.props.onImageTake}))},function(e){var n=_.isString(e)?e:e.name,i=s.GUM[n]||s.GUM.GUMError;r(new i),t&&!t.isPending()&&c.closeModal()})}).bind(this).timeout(1500,"waitForGUMTakePhotoTimeout").then(function(e){c.openModal(a.createElement(u,{stream:e,onSend:this.props.onImageTake}))})["catch"](o["default"].TimeoutError,function(e){c.openModal(a.createElement(d,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_description",type:d.TYPE.GUIDE_ALLOW}))})["catch"](s.GUM.PermissionDeniedError,function(){c.openModal(a.createElement(d,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:d.TYPE.GUIDE_UNBLOCK}))})["catch"](s.GUM.GUMError,function(){c.openModal(a.createElement(d,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:d.TYPE.GUIDE_NONE}))})},render:function(){return a.createElement(l,{action:this.onCapture},l10n.t("take_photo"))}});e.exports=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(412),o=r(i),a=n(414),s=r(a),c=n(6),l=n(10),u=n(63),d=c.createClass({displayName:"UIETooltip",propTypes:{tooltip:c.PropTypes.object.isRequired},componentDidMount:function(){var e=this,t=this.props.tooltip,n=t.menu,r=(0,s["default"])(t,["menu"]);l.openTooltip(n,(0,o["default"])({},r),this.context.uim,function(t){return e.element=t})},componentWillUnmount:function(){l.closeTooltip(this.context.uim)},getElement:function(){return this.element},render:function(){return null}});d.contextTypes={uim:c.PropTypes.instanceOf(u)},e.exports=d},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(78),a=n(130),s=n(129),c=n(133),l=n(1153),u=n(1162),d=n(14),p=n(8),h=n(65),f=n(10),m=void 0,g=r.createClass({displayName:"Conversation",mixins:[o,a,s,c],getInitialState:function(){return{chat:void 0,msgCollection:void 0,focusCtx:void 0}},componentWillMount:function(){this.regCmd("open_chat",this.handleOpenChat),this.regCmd("clear_chat",this.handleClearChat),this.regNativeListener(window,"focus",this.windowGainedFocus),this.regNativeListener(window,"blur",this.windowLostFocus)},componentDidMount:function(){var e=this.safeDebounce(this.windowResized,100);this.regNativeListener(window,"resize",e),e()},windowResized:function(){m=i.findDOMNode(this).clientHeight},shouldComponentUpdate:function(e,t){return t!==this.state||e.animate!==this.props.animate},componentDidUpdate:function(e,t){var n=this.state.chat,r=t.chat;n&&r!==n&&(this.addObserver(n,"change:cmc:merge",this.msgCollectionChanged),r&&this.removeObserver(r,"change:cmc:merge"))},msgCollectionChanged:function(e,t,n){var r=this.state.msgCollection;r!==e&&r!==t||this.setState({msgCollection:n})},windowGainedFocus:function(){h.markAvailable();var e=this.state.conversation;e&&e.isUser&&e.presence.subscribe()["catch"](d.WapDrop,_.noop)},windowLostFocus:function(){h.markUnavailable(p.SEND_UNAVAILABLE_WAIT)},handleClearChat:function(e){this.state.chat===e&&this.setState({chat:void 0,msgCollection:void 0,focusCtx:void 0})},handleOpenChat:function(e,t,n,r,i){if(r||this.state.chat!==e||t&&this.state.msgCollection!==t.collection||!t&&this.state.msgCollection!==this.state.chat.msgs||t&&this.state.focusCtx&&this.state.focusCtx.msg!==t.msg){f.setUiBusy(!0);var o=function(){n&&f.focusChatTextInput(e),f.setUiBusy(!1)},a=void 0;this.state.chat===e&&i&&(a=this.state.uniqueKey?this.state.uniqueKey+1:1),this.setState({chat:e,uniqueKey:a,msgCollection:t?t.collection:e.msgs,focusCtx:i?void 0:t?t:void 0},o)}else n&&this.state.chat===e&&f.focusChatTextInput(e)},render:function(){var e=this.state,t=e.chat,n=e.uniqueKey;if(t){var i=n?t.id+":"+n:t.id;return r.createElement(l,{key:i,chat:t,msgCollection:this.state.msgCollection,height:m,focusCtx:this.state.focusCtx})}return r.createElement(u,{animate:this.props.animate})}});e.exports=g},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(6),s=n(8),c=n(201),l=n(975),u=n(980),d=n(1066),p=n(977),h=n(1057),f=n(1062),m=n(982),g=n(976),v=n(1157),y=n(1075),E=n(1079),b=n(10),S=n(1e3),M=n(410),T=n(14),C=n(1012),w=C.MenuBar,x=C.MenuBarItem,N=n(419),P=n(983),k=n(1061),D=n(1017),O=n(1029),A=n(63),R=a.createClass({displayName:"ConversationHeader",mixins:[l,u],propTypes:{chat:a.PropTypes.instanceOf(p).isRequired,onSelectMessages:a.PropTypes.func.isRequired,canAttach:a.PropTypes.bool.isRequired},statics:{ATTACH_MEDIA_ACTIVE:"attach_media_active",GROUP_CHAT_ACTIVE:"group_chat_active"},getInitialState:function(){return this.asyncState({img:"chat.ProfilePicThumb.img",formattedTitle:"chat.formattedTitle"},{activeDropdown:void 0})},onMouseDown:function(e){},onDrag:function(e){this.didDrag=!0},onClickCapture:function(e){},onClick:function(){var e=this.props.chat;!e.isPSA&&(e.isUser||e.isBroadcast||e.isGroup)&&b.openDrawerRight(a.createElement(y,{chat:e}),"slide-left",this.context.uim)},checkForDrawerMid:function(e){b.existsDrawerMid(function(t){t&&e.preventDefault()})},onChatSearch:function(e){e.preventDefault(),b.openDrawerRight(a.createElement(E,{chat:this.props.chat}),"slide-left",this.context.uim)},onCaptureClick:function(){var e=this,t=this.props.chat,n=D.start("camera");o["default"].race([n,this.rejectOnUnmount()]).bind(this).checkpoint(this.rejectOnUnmount()).then(function(n){b.openDrawerMid(a.createElement(v,{chat:t,stream:n}),"slide-up",e.context.uim)})["catch"](T.Unmount,function(){n.then(function(e){return D.stop(e)})["catch"](_.noop)})["catch"](T.GUM.PermissionDeniedError,function(){b.openModal(a.createElement(S,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:S.TYPE.GUIDE_UNBLOCK}))})["catch"](T.GUM.GUMError,function(){b.openModal(a.createElement(S,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",
type:S.TYPE.GUIDE_NONE}))})},render:function(){var e,t,r=this.props.chat;r.isUser?(e=a.createElement(U,{chat:r,onSelectMessages:this.props.onSelectMessages}),t=a.createElement(f,{presence:r.presence,placeholder:l10n.t("click_here_for_user_info"),location:"title"})):r.isBroadcast?(e=a.createElement(F,{chat:r,onSelectMessages:this.props.onSelectMessages}),t=null):r.isGroup&&(e=a.createElement(L,{chat:r,onSelectMessages:this.props.onSelectMessages}),t=a.createElement(h,{presence:r.presence,groupMetadata:r.groupMetadata,placeholder:l10n.t("click_here_for_group_info"),location:"title"}));var i=n(101),o=i.supportsFeature(i.F.FTS_IN_CONV)?a.createElement(x,{a8n:"search-button",icon:"search-alt",title:l10n.t("search"),onClick:this.onChatSearch}):null,s=this.props.canAttach?a.createElement(x,{a8n:"conversation-clip",icon:"clip",title:l10n.t("menutitle_attach"),transitionName:"menu",onClick:this.checkForDrawerMid},a.createElement(I,{chat:r,onCaptureClick:this.onCaptureClick})):null,c="chat-avatar",l="chat-body",u="chat-title",d=null;return r.isPSA&&(c+=" chat-psa",l+=" chat-psa",u+=" chat-title-psa",d=a.createElement("span",{className:"icon-psa-verified"}),t=null),a.createElement("header",{className:"pane-header pane-chat-header",onClickCapture:this.onClickCapture,onMouseDown:this.onMouseDown},a.createElement("div",{className:c,onClick:this.onClick},a.createElement(m,{id:r.id,size:40})),a.createElement("div",{className:l,onClick:this.onClick},a.createElement("div",{className:"chat-main"},a.createElement("h2",{className:u,dir:"auto"},a.createElement(g,{text:this.state.formattedTitle,titlify:!0,ellipsify:!0}),d)),t),a.createElement("div",{className:"pane-chat-controls"},a.createElement(w,{key:"conversation-header"},o,s,a.createElement(x,{a8n:"conversation-menu",icon:"menu",title:l10n.t("menutitle_menu"),onClick:this.checkForDrawerMid},e))))}});R.contextTypes={uim:a.PropTypes.instanceOf(A)};var I=a.createClass({displayName:"AttachMenuDropdown",mixins:[u],propTypes:{chat:a.PropTypes.instanceOf(p).isRequired},getInitialState:function(){return{canSendDocument:void 0}},componentWillMount:function(){var e=this;this.props.chat.shouldSendEncrypted("document").checkpoint(this.rejectOnUnmount()).then(function(t){e.setState({canSendDocument:t})})["catch"](T.CapabilityError,function(){e.setState({canSendDocument:!1})})["catch"](T.Unmount,_.noop)},onDocumentPick:function(e){if(e){e.stopPropagation();var t=_.toArray(e.target.files);t.length&&(e.target.value="",this.state.canSendDocument===!1?this.showCantSendDocument():b.attachMediaDrawer(this.props.chat,t))}},onMediaPick:function(e){if(e){e.stopPropagation();var t=_.toArray(e.target.files);t.length&&(e.target.value="",b.attachMediaDrawer(this.props.chat,t))}},onMediaClick:function(e){e.preventDefault(),this.refs.mediaPicker.triggerInput()},onDocumentClick:function(e){e.preventDefault(),this.state.canSendDocument===!1?this.showCantSendDocument():this.refs.docPicker.triggerInput()},confirmContactSend:function(e){var t=this,n=void 0;n=this.props.chat.isUser?l10n.t("confirm_contact_send_chat",{name:e.formattedName,chat:this.props.chat.formattedTitle}):this.props.chat.isGroup?l10n.t("confirm_contact_send_group",{name:e.formattedName,chat:this.props.chat.formattedTitle}):l10n.t("confirm_contact_send_broadcast",{name:e.formattedName}),b.openModal(a.createElement(M,{key:"contact_confirm",onOK:function(){return t.sendContact(e)},onCancel:function(){return b.closeModal()}},n))},sendContact:function(e){this.props.chat.sendContact(e),b.closeModal()},onContactClick:function(e){e.preventDefault(),b.openModal(a.createElement(O,{key:"contacts",title:l10n.t("send_contact"),filter:Store.Contact.isFilteredContact,onCancel:function(){return b.closeModal()},onSelect:this.confirmContactSend}))},showCantSendDocument:function(e){var t;if(e instanceof T.InvalidMediaFileType)t=l10n.t("cannot_send_document_type_unsupported");else if(e instanceof T.MediaFileTooLarge)t=l10n.t("document_too_big",{maxSize:s.MAX_MEDIA_UPLOAD_SIZE/1024/1024+"MB"});else{var n=this.props.chat;t=n.isUser?l10n.t("cannot_send_document_to_contact_unsupported",{contact:n.formattedTitle}):l10n.t("cannot_send_document_to_group_unsupported",{group:n.formattedTitle})}b.openModal(a.createElement(M,{key:"doc_cant_send",onOK:b.closeModal.bind(b)},a.createElement(g,{text:t})))},onCaptureClick:function(){this.props.onCaptureClick()},render:function(){var e=a.createElement(k,{direction:"left",body:l10n.t("attach_capture")}),t=navigator.getUserMedia?a.createElement(P,{tooltip:e,action:this.onCaptureClick},a.createElement("button",{className:"menu-icons-item"},a.createElement("div",{className:"icon-xl icon-camera"}))):null,r=void 0,i=n(101);if(i.supportsFeature(i.F.ENC_DOC)){var o=a.createElement(k,{direction:"left",body:l10n.t("attach_document")});r=a.createElement(P,{tooltip:o,ref:"docPicker",action:this.onDocumentClick,filePickerMimes:c.DOC_MIMES,onFilePick:this.onDocumentPick},a.createElement("button",{className:"menu-icons-item"},a.createElement("div",{className:"icon-xl icon-document"})))}var l=a.createElement(k,{direction:"left",body:l10n.t("attach_media")}),u=a.createElement(P,{tooltip:l,ref:"mediaPicker",filePickerMimes:[s.IMAGE_MIMES,s.VIDEO_MIMES].join(","),action:this.onMediaClick,onFilePick:this.onMediaPick},a.createElement("button",{className:"menu-icons-item"},a.createElement("div",{className:"icon-xl icon-image"}))),d=a.createElement(k,{direction:"left",body:l10n.t("attach_vcard")}),p=a.createElement(P,{tooltip:d,action:this.onContactClick},a.createElement("button",{className:"menu-icons-item"},a.createElement("div",{className:"icon-xl icon-contact"})));return a.createElement("div",null,a.createElement(N,{type:N.Type.MENU,key:"AttachMenuDropdown"},u,t,r,p))}}),L=a.createClass({displayName:"GroupMenuDropdown",mixins:[l],propTypes:{chat:a.PropTypes.instanceOf(p).isRequired,onSelectMessages:a.PropTypes.func.isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},render:function(){var e=d.group(this.props.chat,this.props.onSelectMessages);return a.createElement(N,{type:N.Type.DROPDOWN_MENU,key:"GroupMenuDropdown",flipOnRTL:!0,direction:{x:N.Direction.X.LEFT}},e)}}),F=a.createClass({displayName:"BroadcastMenuDropdown",propTypes:{chat:a.PropTypes.instanceOf(p).isRequired,onSelectMessages:a.PropTypes.func.isRequired},render:function(){var e=d.broadcast(this.props.chat,this.props.onSelectMessages);return a.createElement(N,{type:N.Type.DROPDOWN_MENU,key:"BroadcastMenuDropdown",flipOnRTL:!0,direction:{x:N.Direction.X.LEFT}},e)}}),U=a.createClass({displayName:"ContactMenuDropdown",propTypes:{chat:a.PropTypes.instanceOf(p).isRequired,onSelectMessages:a.PropTypes.func.isRequired},render:function(){var e=d.contact(this.props.chat,this.props.onSelectMessages);return a.createElement(N,{type:N.Type.DROPDOWN_MENU,key:"ContactMenuDropdown",flipOnRTL:!0,direction:{x:N.Direction.X.LEFT}},e)}});e.exports=R},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(883),o=r(i),a=n(6),s=n(34),c=n(8),l=n(975),u=n(129),d=n(78),p=n(133),h=n(980),f=n(1150),m=n(1130),g=n(10),v=n(977),y=n(1007),E=n(130),b=n(418),S=n(43),M=n(1066),T=n(81),C=n(1095),w=n(974),x=n(1145),N=n(102),P=n(1),k=n(196),D=n(999),O=n(197),A=n(208),R=n(134),I=n(413),L=n(14),F=3e3,U=8.5,j=f.UpdateType,B=f.UpdateTypePriority,G=a.createClass({displayName:"ConversationMsgs",mixins:[l,d,u,E,p,h],propTypes:{chat:a.PropTypes.instanceOf(v).isRequired,msgCollection:a.PropTypes.instanceOf(y).isRequired,selectable:a.PropTypes.bool,onMessageSelect:a.PropTypes.func.isRequired,onSelectMessages:a.PropTypes.func.isRequired,focusCtx:a.PropTypes.object,selectedMessages:a.PropTypes.objectOf(a.PropTypes.instanceOf(w))},getInitialState:function(){var e=this.props,t=e.focusCtx,n=e.chat,r=e.msgCollection;this.updateType=j.DEFAULT,this.rerender=this.safeDebounce(this._rerender,100),this.handleScroll=_.throttle(this._handleScroll,100),this.msgListInfo={visibleMsgs:{},dateMarker:void 0};var i=t||this.getUnreadFocusCtx(),o=i&&i.msg,a=o&&o.id;return{msgListKey:0,cursor:new C(r,a,this.props.chat.isGroup?c.RENDOR_CURSOR.GROUP_CONVERSATION:c.RENDOR_CURSOR.CONVERSATION),unreadCount:n.pendingSeenCount?0:n.unreadCount,isNearBottom:!0,newUnread:0,focusCtx:i,contextMenu:!1}},componentWillMount:function(){var e=this;this._hideStickyDateMarkerTimer=new T(function(){return e.hideFloatingMarker()})},componentDidMount:function(){var e=this,t=this.refs.messageList;!this._scrollInfo&&t&&t.scrollBottom(this.refs.scrollContainer,!0);var n=this.props,r=n.chat,i=n.msgCollection;if(this.regCmd("open_chat",this.onOpenChat),this.regCmd("compose_height_change",this.composeHeightChange),this.attachMsgCollectionObservers(this.props,void 0),this.regNativeListener(window,"focus",this.windowGainedFocus),this.regNativeListener(window,"blur",this.windowLostFocus),this.regNativeListener(window,"resize",_.throttle(function(){e.updateMsgListInfo(),e.updateFloatingDateMarker()},100)),this.addObserver(r,"change:trusted"),r.isGroup?this.addObserver(r.groupMetadata.participants,"change:contact.name change:contact.isMyContact",this.rerender):r.isUser&&this.addObserver(r.contact,"change:isMyContact",this.rerender),this.addObserver(i,"change:star",this.rerender),this.addObserver(r,"change:quotedMsg",this.onQuotedMsgChange),!this.props.focusCtx){var o=s.findDOMNode(this.refs.scrollContainer);0===o.scrollTop&&this.loadEarlierMsgs()}this.updateMsgListInfo(),this.updateFloatingDateMarker(),r.sendSeen();var a=void 0,c=void 0,l=void 0;this.regCmd("panes_will_change",function(t){if(e.msgListInfo&&e.msgListInfo.visibleMsgOrder.length&&e.refs.messageList){var n=_.last(e.msgListInfo.visibleMsgOrder).toString();l=s.findDOMNode(e.refs.messageList.refs[n]),c=s.findDOMNode(e.refs.scrollContainer),a=e.getMsgBottom(c,l)}}),this.regCmd("panes_did_change",function(t){c&&l&&!_.isUndefined(a)&&(e.setMsgBottom(c,l,a),l=void 0,c=void 0,a=void 0)})},getMsgBottom:function(e,t){var n=e.scrollTop,r=e.scrollHeight,i=e.clientHeight,o=r-(n+i);return r-(t.offsetTop+t.clientHeight+o)},setMsgBottom:function(e,t,n){var r=t.offsetTop,i=t.clientHeight,o=r+i+n-e.clientHeight;this.setScrollTop(e,o)},_rerender:function(){var e=this,t=s.findDOMNode(this.refs.scrollContainer),n=t.scrollTop;this.setState({msgListKey:this.state.msgListKey+1},function(){e.setScrollTop(t,n)})},componentDidUpdate:function(e,t){if(this.updateType=j.DEFAULT,this.updateMsgListInfo(),t.msgListKey===this.state.msgListKey){var n=e.chat===this.props.chat;this.updateFloatingDateMarker(n)}},attachMsgCollectionObservers:function(e,t){var n=this,r=e.chat,i=e.msgCollection,o=e.focusCtx;this.props.msgCollection&&(this.removeObserver(this.props.chat,"change:unreadCount"),this.removeObserver(this.props.msgCollection,"change:last"),this.removeObserver(this.props.msgCollection,"remove",this.onMsgDelete),this.removeObserver(this.props.chat.msgs,"change:last")),i===r.msgs&&this.addObserver(r,"change:unreadCount",this.onUnreadCount),this.addObserver(r.msgs,"change:last",this.onLastMsgChanged),this.addObserver(i,"remove",this.onMsgDelete),this.state.cursor.msgCollection=i;var s=o||this.getUnreadFocusCtx();this.setState({focusCtx:s});var c=function(){return s.key&&(s.msg=Store.Msg.get(s.key)),s.msg?(n.setUpdateType(j.KEEP_SCROLL_BOTTOM),void n.setState({cursor:n.state.cursor.init(s.msg.id)},function(){if(n._scrollInfo&&n.isMounted()){var e=n._scrollInfo.msgNode,t=n.refs.scrollContainer;if(!e||!t.contains(e))return;var r=(e.clientHeight-t.clientHeight)/2,i=s.slideToMsg?300:0;Velocity(t,"stop"),Velocity(e,"stop"),Velocity(e,"scroll",{duration:i,container:t,offset:r,easing:[.1,.82,.25,1]}).then(function(){n.isMounted()&&n._scrollInfo.flashFn&&n._scrollInfo.flashFn()})}})):g.openChat(n.props.chat,void 0,!1,!0,!0)};s&&i.loadAroundPromise?i.loadAroundPromise.checkpoint(this.rejectOnUnmount()).then(c)["catch"](L.Unmount,_.noop)["catch"](L.E404,function(){g.openToast(a.createElement(I,{msg:A.t("message_query_404"),id:I.genId()})),c()})["catch"](c):s&&c()},isMostRecentCMC:function(){return this.props.chat.msgs===this.props.msgCollection},componentWillReceiveProps:function(e){this.attachMsgCollectionObservers(e,this.props.focusCtx)},componentWillUnmount:function(){this._hideStickyDateMarkerTimer.cancel(),this.handleScroll.cancel(),this.maybeSendSeen()&&(this.props.chat.markedUnread=!1)},loadEarlierMsgs:function(){var e=this,t=this.props,n=t.chat,r=t.msgCollection,i=this.state.cursor;if(i.start>0)this.setUpdateType(j.KEEP_SCROLL_BOTTOM),this.setState({cursor:i.loadBefore()});else{if(r.msgLoadState.noEarlierMsgs||r.msgLoadState.isLoadingEarlierMsgs||r.msgLoadState.isLoadingAroundMsgs)return;n.loadEarlierMsgs(r).checkpoint(this.rejectOnUnmount()).then(function(){e.setUpdateType(j.KEEP_SCROLL_BOTTOM),e.setState({cursor:i.loadBefore()})})["catch"](L.Unmount,_.noop)["catch"](function(e){P.log("ConversationMsgs:loadEarlierMsgs failed")(),P.log(e)()})}},loadRecentMsgs:function(){var e=this,t=this.props,n=t.chat,r=t.msgCollection,i=this.state.cursor;if(i.end<r.length)this.setUpdateType(j.KEEP_SCROLL_TOP),this.setState({cursor:i.loadAfter()});else{if(r.msgLoadState.isLoadingRecentMsgs||r.msgLoadState.isLoadingAroundMsgs)return;n.loadRecentMsgs(r).checkpoint(this.rejectOnUnmount()).then(function(){e.setUpdateType(j.KEEP_SCROLL_TOP),e.setState({cursor:i.loadAfter()})})["catch"](L.Unmount,_.noop)["catch"](function(e){P.log("ConversationMsgs:loadRecentMsgs failed")(),P.log(e)()})}},composeHeightChange:function(e){var t=this,n=s.findDOMNode(this.refs.scrollContainer);if(e){if(e<0&&n.scrollTop===n.scrollHeight-n.clientHeight)return;this.setScrollTop(n,n.scrollTop+e)}else{var r=n.scrollHeight-(n.scrollTop+n.clientHeight);Velocity(n,{tween:18},{progress:function(){t.setScrollTop(n,n.scrollHeight-r-n.clientHeight)},duration:300},[.1,.82,.25,1])}},getScrollBottom:function(){var e=s.findDOMNode(this.refs.scrollContainer);return e.scrollHeight-(e.scrollTop+e.clientHeight)},setScrollBottom:function(e){var t=s.findDOMNode(this.refs.scrollContainer);this.setScrollTop(t,t.scrollHeight-e-t.clientHeight)},onStickyDateMarkerUpdated:function(e){var t=this.refs.stickyDateMarker;t&&t.updateDateMarkerText(e)},hideFloatingMarker:function(){var e=this.refs.stickyDateMarker;e&&e.hideStickyDateMarker(!0)},setScrollTop:function(e,t){this.programmaticScroll=Date.now(),e.scrollTop=t},updateFloatingDateMarker:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],t=this.msgListInfo.dateMarker;if(this.isMounted()&&void 0!==t){var n=e||Date.now()-(this.programmaticScroll||0)<200;if(!n){var r=this.refs.stickyDateMarker;r&&r.hideStickyDateMarker(!1)}if(this.refs.messageList){var i=this.refs.messageList.refs;if(t===-1)this.onStickyDateMarkerUpdated();else if(i){var o=i["dateMarker_"+t];if(o){var a=o.props.timestamp,s=k.relativeDateStr(a).toUpperCase();this.onStickyDateMarkerUpdated(s)}}if(i&&t!==this.dateMarkerIdx){var c=i["dateMarker_"+this.dateMarkerIdx],l=i["dateMarker_"+t];c&&c.hide(!1),l&&l.hide(!0),this.dateMarkerIdx=t}n||this._hideStickyDateMarkerTimer.debounce(F)}}},setUpdateType:function(e){B[e]>=B[this.updateType]&&(this.updateType=e)},nearBottom:function(e){return e=e||s.findDOMNode(this.refs.scrollContainer),e.scrollTop+c.SCROLL_FUDGE>e.scrollHeight-e.clientHeight},getUnreadFocusCtx:function(){var e,t=this.props,n=t.chat,r=t.msgCollection,i=t.focusCtx;if((!i||this.isMostRecentCMC())&&n.unreadCount){var a=(e={},(0,o["default"])(e,w.TYPE.CHAT,w.TYPE.CHAT),(0,o["default"])(e,w.TYPE.IMAGE,w.TYPE.IMAGE),(0,o["default"])(e,w.TYPE.VIDEO,w.TYPE.VIDEO),(0,o["default"])(e,w.TYPE.AUDIO,w.TYPE.AUDIO),(0,o["default"])(e,w.TYPE.VCARD,w.TYPE.VCARD),(0,o["default"])(e,w.TYPE.LOCATION,w.TYPE.LOCATION),(0,o["default"])(e,w.TYPE.PTT,w.TYPE.PTT),e),s=_(r.toArray()).filter(function(e){return!!a[e.type]}).reverse().take(n.unreadCount).value();if(s.length===n.unreadCount)return s=_.last(s),{msg:s,isUnreadDivider:!0,highlightMsg:!1}}},getMsgs:function(){var e=this.props.msgCollection,t=this.state.cursor;return e.toArray().slice(t.start,t.end)},updateMsgListInfo:function(){var e=this.refs.messageList;if(e){for(var t=e.props.msgs,n=e.refs,r={},i=[],o=0,a=t.length-1;o<a;){var l=Math.floor((o+a)/2),u=n[t[l].id.toString()];e.getMsgVisibility(u)===c.VISIBILITY.ABOVE?o=l+1:a=l}for(var d=o;d<t.length;d++){var p=n[t[d].id.toString()];if(e.getMsgVisibility(p)!==c.VISIBILITY.VISIBLE)break;r[t[d].id.toString()]=!0,i.push(t[d].id)}var h=_.pickBy(n,function(e,t){return _.startsWith(t,"dateMarker_")}),f=s.findDOMNode(this.refs.scrollContainer).scrollTop,m=n.dateMarker_0?s.findDOMNode(n.dateMarker_0).offsetTop:void 0;if(o=0,a=_.size(h)-1,_.size(h)&&m<=f+U)for(;o<a;){var g=Math.ceil((o+a)/2),v=s.findDOMNode(n["dateMarker_"+g]);if(!v)return;v.offsetTop>f+U?a=g-1:o=g}else o=-1;this.msgListInfo.dateMarker=o,this.pauseHiddenGifs(this.msgListInfo.visibleMsgs,r),this.msgListInfo.visibleMsgs=r,this.msgListInfo.visibleMsgOrder=i}},isMsgVisible:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];return!!this.msgListInfo.visibleMsgs[e.toString()]&&(!!t||this.getMsgComponent(e))},getMsgComponent:function(e){var t=this.refs.messageList;if(t){var n=t.refs[e.toString()];if(n)return n.refs.component}},pauseHiddenGifs:function(e,t){for(var n in e)if(!t[n]){var r=this.props.msgCollection.get(n);if(r&&r.isGif){var i=this.getMsgComponent(n);i&&i.pause()}}},onScroll:function(e){this.handleScroll(e.target,this.props.chat,this.nearBottom,this)},_handleScroll:function(e,t,n){this.updateMsgListInfo(),0===e.scrollTop&&this.loadEarlierMsgs();var r=this.state,i=r.isNearBottom,o=r.cursor,a=n(e);a?(this.maybeSendSeen(!0),this.isMostRecentCMC()&&i!==a&&(this.setUpdateType(j.NONE),this.setState({isNearBottom:a,newUnread:0})),(o.end<this.props.msgCollection.length||!this.isMostRecentCMC())&&this.loadRecentMsgs()):i!==a&&(this.setUpdateType(j.NONE),this.setState({isNearBottom:a})),this.updateFloatingDateMarker()},windowGainedFocus:function(){var e=this.props.chat;!this.clearUnreadTimer&&e.isDirty()&&(this.clearUnreadTimer=this.safeDelay(function(){delete this.clearUnreadTimer,this.maybeSendSeen()},c.CLEAR_CHAT_DIRTY_WAIT))},windowLostFocus:function(){if(this.state.unreadCount&&this.isMostRecentCMC()){var e=this.props.chat;0===e.unreadCount&&(this.setUpdateType(j.KEEP_SCROLL_BOTTOM),this.setState({unreadCount:0,focusCtx:void 0,cursor:this.state.cursor.setKey()})),e.markedUnread=!1}},maybeSendSeen:function(e,t){var n=this.props,r=n.chat,i=n.msgCollection,o=this.state.cursor;if(r.isDirty()&&this.isMostRecentCMC()&&o.end>=i.length&&(_.isUndefined(t)&&(t=document.hasFocus()),t&&(_.isUndefined(e)&&(e=this.nearBottom()),e)))return r.sendSeen(),!0},onOpenChat:function(e){e.id===this.props.chat.id&&this.isMostRecentCMC()&&!this.props.focusCtx&&this.scrollToBottom()},jumpToBottom:function(){this.isMostRecentCMC()&&this.state.cursor.end>=this.props.msgCollection.length?this.scrollToBottom():g.openChat(this.props.chat,void 0,!0,!0,!0)},scrollToBottom:function(){var e=s.findDOMNode(this.refs.scrollContainer);e&&this.setScrollTop(e,e.scrollHeight)},onLastMsgChanged:function(){var e=this.props.msgCollection,t=this.state,n=t.cursor,r=t.focusCtx,i=e.last();if(!this.isMostRecentCMC())return void(i&&i.isSentByMe&&this.jumpToBottom());var o={},a=document.hasFocus(),s=this.nearBottom();this.setUpdateType(s?j.SCROLL_BOTTOM:j.KEEP_SCROLL_TOP),a&&s?(this.setUpdateType(j.SCROLL_BOTTOM),o.unreadCount=0,o.focusCtx=void 0,o.cursor=n.setKey()):i&&i.isSentByMe&&(this.setUpdateType(j.SCROLL_BOTTOM),this.state.unreadCount&&(o.unreadCount=0,o.focusCtx=void 0,o.cursor=n.setKey()),this.jumpToBottom()),this.isMostRecentCMC()&&(r&&!o.hasOwnProperty("focusCtx")?o.cursor=n.loadAfter(1):o.cursor=n.loadBefore(1)),_.isEmpty(o)||this.setState(o)},onUnreadCount:function(){var e=this.props.chat,t=this.nearBottom(),n=document.hasFocus();this.maybeSendSeen(t,n);var r={};if(e.unreadCount&&!e.pendingSeenCount){r.unreadCount=e.unreadCount;var i=this.getUnreadFocusCtx();i&&(r.focusCtx=i)}t&&1===r.unreadCount&&0===this.state.unreadCount&&this.setUpdateType(j.SCROLL_BOTTOM),(!t&&this.isMostRecentCMC()||!e.pendingSeenCount&&this.state.newUnread!==e.unreadCount)&&(r.newUnread=e.unreadCount),_.isEmpty(r)||this.setState(r)},onMsgDelete:function(e,t,n){this.state.cursor.onRemove(e),this.setState({})},onPageUpDown:function(e){R.focus(s.findDOMNode(this.refs.scrollContainer))},onKeyPress:function(e){e.metaKey||e.ctrlKey||(e.preventDefault(),"Enter"!==e.key||e.shiftKey?g.pasteChatTextInput(this.props.chat,String.fromCharCode(e.charCode)):g.enterChatTextInput(this.props.chat))},onContextMenu:function(e){var t,n=this.props.chat,r=this.props.onSelectMessages;if(n.isUser)t=M.contact(n,r);else if(n.isGroup)t=M.group(n,r);else{if(!n.isBroadcast)return;t=M.broadcast(n,r)}e.preventDefault(),e.stopPropagation(),e.persist(),this.setState({contextMenu:{menu:t,event:e}})},contextClose:function(){this.setState({contextMenu:!1})},onPaste:function(e){e.preventDefault();var t=e.clipboardData.items,n=_.filter(t,function(e){var t=b.typeFromMimetype(e.type);return"file"===e.kind&&("image"===t||"video"===t)}).map(function(e){return e.getAsFile()});return n.length?void(t.length===n.length&&g.attachMediaDrawer(this.props.chat,n)):void g.pasteChatTextInput(this.props.chat,e.clipboardData.getData("text/plain"))},scrollToMsg:function(e,t){this._scrollInfo={msgNode:e,flashFn:t}},render:function(){var e=this.props,t=e.chat,n=e.msgCollection,r=e.selectable,i=e.onMessageSelect,o=this.state.focusCtx,s=S("pane-chat-msgs pane-chat-body lastTabIndex",{selectable:r}),c=this.isMostRecentCMC(),l=!!o,u=a.createElement(f,{key:"ml-"+t.id+"-"+this.state.msgListKey,ref:"messageList",updateType:this.updateType,unreadCount:this.state.unreadCount,selectable:r,onMessageSelect:i,msgs:this.getMsgs(),focusedMsgCtx:o,didRenderFocusedMsg:this.scrollToMsg,selectedMessages:this.props.selectedMessages,isMsgVisible:this.isMsgVisible}),d=a.createElement(m,{direction:"around",isMostRecentCMC:c,loadMoreMsgs:_.noop,msgCollection:n}),p=void 0;(this.state.cursor.start>0||!n.msgLoadState.noEarlierMsgs)&&(p=a.createElement(m,{direction:"earlier",isMostRecentCMC:c,loadMoreMsgs:this.loadEarlierMsgs,msgCollection:n}));var h=void 0;(this.state.cursor.end<n.length||!c)&&(h=a.createElement(m,{direction:"recent",isMostRecentCMC:c,loadMoreMsgs:this.loadRecentMsgs,msgCollection:n})),l&&n.msgLoadState.isLoadingAroundMsgs?(h=void 0,p=void 0,u=void 0):d=void 0;var g=void 0,v=void 0,y=this.state,E=y.isNearBottom,b=y.newUnread;E||(b&&t.unreadCount&&(v=a.createElement("span",{className:"icon-meta unread-count",key:"icon-unread"},A.n(this.state.newUnread))),g=a.createElement("div",{className:"incoming-msgs",onClick:this.jumpToBottom},a.createElement(N,{transitionName:"pop"},v),a.createElement("span",{className:"icon icon-down"})));var M=void 0;return this.state.contextMenu&&(M=a.createElement(O,{displayName:"ConversationContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},a.createElement(D,{contextMenu:this.state.contextMenu}))),a.createElement("div",null,a.createElement(x,{ref:"stickyDateMarker"}),a.createElement(N,{transitionName:"pop"},g),a.createElement("div",{className:s,ref:"scrollContainer",onScroll:this.onScroll,onKeyPress:this.onKeyPress,onContextMenu:r?null:this.onContextMenu,onPaste:this.onPaste,tabIndex:"0"},a.createElement("div",{className:"pane-chat-empty"}),d,p,u,h),M)}});e.exports=G},function(e,t,n){"use strict";var r=n(6),i=r.createClass({displayName:"LinkPreview",propTypes:{title:r.PropTypes.string,description:r.PropTypes.string,canonicalUrl:r.PropTypes.string,thumbnail:r.PropTypes.string,onOmit:r.PropTypes.func},render:function(){var e=this.props,t=e.title,n=e.description,i=e.canonicalUrl,o=e.thumbnail,a=o?r.createElement("img",{className:"link-preview-media",src:"data:image/jpeg;base64,"+o}):null,s=this.props.onOmit?r.createElement("div",{className:"btn-background"},r.createElement("button",{className:"icon icon-x",onClick:this.props.onOmit})):null;return r.createElement("div",{className:"message-in link-preview-compose"},r.createElement("div",{className:"link-preview-container"},a,r.createElement("div",{className:"link-preview-body"},r.createElement("div",{className:"link-preview-title",title:t},t),r.createElement("div",{className:"link-preview-description",title:n},n),r.createElement("div",{className:"link-preview-source ellipsify"},i))),s)}});e.exports=i},function(e,t,n){"use strict";var r=n(6),i=n(132),o=n(129),a=n(1007),s=r.createClass({displayName:"LoadMoreMessages",mixins:[o],propTypes:{direction:r.PropTypes.oneOf(["recent","earlier","around"]).isRequired,isMostRecentCMC:r.PropTypes.bool.isRequired,loadMoreMsgs:r.PropTypes.func.isRequired,msgCollection:r.PropTypes.instanceOf(a).isRequired},getInitialState:function(){return this.props.msgCollection.msgLoadState.toJSON()},componentWillMount:function(){this.attachObservers()},componentWillReceiveProps:function(e){this.attachObservers(e)},attachObservers:function(e){var t=this,n=this.props.msgCollection.msgLoadState;e&&(this.removeObserver(n,"change"),n=e.msgCollection.msgLoadState),this.addObserver(n,"change",function(){t.setState(n.toJSON())})},loadMoreMsgs:function(e){"earlier"===this.props.direction&&this.state.isLoadingEarlierMsgs||"recent"===this.props.direction&&this.state.isLoadingRecentMsgs||"around"===this.props.direction&&this.state.isLoadingAroundMsgs||this.props.loadMoreMsgs()},render:function(){var e=this.props.direction;if("earlier"===e&&this.state.isLoadingEarlierMsgs||"recent"===e&&this.state.isLoadingRecentMsgs||"around"===e&&this.state.isLoadingAroundMsgs)return r.createElement("div",{className:"more"},r.createElement("div",{className:"btn-more",title:l10n.t("loading_messages")},r.createElement(i,{stroke:6,size:24})));var t;return t="earlier"===e?l10n.t("load_earlier_messages"):"recent"===e?l10n.t("load_recent_messages"):l10n.t("loading_messages"),r.createElement("div",{className:"more"},r.createElement("div",{className:"btn-more",title:t,onClick:this.loadMoreMsgs},r.createElement("span",{className:"icon icon-refresh"})))}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(974),o=n(975),a=n(130),s=n(1011),c=n(1027),l=n(989),u=n(986),d=n(10),p=n(1014),h=n(1006),f=n(1001),m=n(101),g=n(196),v=r.createClass({displayName:"AudioVideo",mixins:[o,a],propTypes:{msg:r.PropTypes.instanceOf(i).isRequired,quotedMsg:r.PropTypes.element,isMsgVisible:r.PropTypes.func,displayAuthor:r.PropTypes.bool},getInitialState:function(){return{mediaState:this.async("msg.mediaState")}},showMediaMissing:function(){d.openModal(r.createElement(h,{msg:this.props.msg}))},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){m.supportsFeature(m.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():d.openModal(r.createElement(f,{msg:this.props.msg}))},getZoomNode:function(e){var t=this.props.isMsgVisible(e);if(t&&t.getImgNode)return t.getImgNode()},launchMediaViewer:function(e){this.props.msg.downloadMedia(),e&&e.stopPropagation(),d.openModalMedia(r.createElement(p,{msg:this.props.msg,getZoomNode:this.props.isMsgVisible?this.getZoomNode:_.noop}),"media-viewer")},stopEvent:function(e){e.stopPropagation()},render:function(){var e=this.props.msg,t=e.caption&&e.type!==i.TYPE.VIDEO||e.type===i.TYPE.AUDIO?null:r.createElement("div",{className:"shade"}),n=e.caption?r.createElement(c,{msg:e}):null,o="bubble-image bubble-video";e.caption&&(o+=" bubble-image-caption");var a=null,d=_.noop;switch(e.mediaState){case i.MEDIA_STATE.RESOLVED:case i.MEDIA_STATE.INIT:a=r.createElement(s.Play,null),d=this.launchMediaViewer;break;case i.MEDIA_STATE.NEED_POKE:a=r.createElement(s.Download,{filesize:e.size}),d=this.downloadMedia;break;case i.MEDIA_STATE.UPLOADING:a=r.createElement(s.PendingCancel,null),d=this.cancelUpload;break;case i.MEDIA_STATE.NEED_UPLOAD:a=r.createElement(s.Upload,{filesize:e.size}),d=this.resumeUpload;break;case i.MEDIA_STATE.REMOTE_NEED_UPLOAD:a=r.createElement(s.Upload,{filesize:e.size}),d=this.resumeRemoteUpload;break;case i.MEDIA_STATE.ERROR_MISSING:d=this.showMediaMissing;break;default:a=r.createElement(s.Pending,null)}var p=g.durationStr(e.duration)||null;p&&(p=r.createElement("span",{className:"message-duration"},e.type===i.TYPE.VIDEO?r.createElement("span",{className:"icon-s icon-msg-video-light"}):r.createElement("span",{className:"icon-s icon-msg-audio-light"}),p));var h;if(e.type===i.TYPE.VIDEO){var f="data:image/jpeg;base64,"+e.body,m={backgroundImage:'url("'+f+'")'};h=r.createElement("div",{className:"image-thumb-body",style:m})}else e.type===i.TYPE.AUDIO&&(h=r.createElement("div",{className:"image-audio"}));var v=this.props.displayAuthor&&u.shouldRender(e)?r.createElement(u,{msg:e}):null;return r.createElement("div",{onClick:this.stopEvent},r.createElement("div",{className:o},v,this.props.quotedMsg,r.createElement("div",{className:"image-thumb",onClick:d},a,h,t,p),n,r.createElement(l,{msg:this.props.msg})))}});e.exports=v},function(e,t,n){"use strict";var r=n(974),i=n(6),o=n(989),a=n(986),s=n(80),c=n(43),l=i.createClass({displayName:"Ciphertext",propTypes:{msg:i.PropTypes.instanceOf(r).isRequired,displayAuthor:i.PropTypes.bool},onLearnMore:function(){var e="https://www.whatsapp.com/faq/general/26000015/";e=s.build(e,{lg:l10n.getLocale()}),window.open(e,"_blank")},render:function(){var e=this.props.msg,t=this.props.displayAuthor&&a.shouldRender(e),n=t?i.createElement(a,{msg:e}):null,r=c("bubble bubble-placeholder",{"has-author":t}),s="message-text";return i.createElement("div",{className:r},n,i.createElement("div",{className:"icon icon-ciphertext placeholder-icon"}),i.createElement("div",{className:s},i.createElement("span",null,i.createElement("span",{className:"placeholder-msg"},l10n.t("placeholder_msg")),i.createElement("span",{className:"placeholder-learn-more",onClick:this.onLearnMore},l10n.t("learn_more")))),i.createElement(o,{msg:e}))}});e.exports=l},function(e,t,n){"use strict";var r=n(6),i=n(988),o=n(976),a=n(78),s=n(43),c=n(196),l=n(0),u=r.createClass({displayName:"DateMarker",mixins:[a],propTypes:{timestamp:r.PropTypes.number.isRequired},getInitialState:function(){return{hide:!1}},componentDidMount:function(){this.maybeRegMidnight()},componentDidUpdate:function(){this.maybeRegMidnight()},hide:function(e){this.state.hide!==e&&this.setState({hide:e})},rerender:function(){this.forceUpdate()},maybeRegMidnight:function(){this.unregCmd("midnight",this.rerender);var e=l().startOf("day").subtract(7,"day");this.props.timestamp>=e.unix()&&this.regCmd("midnight",this.rerender)},render:function(){var e=c.relativeDateStr(this.props.timestamp).toUpperCase(),t=s("message-system-body",{"date-marker-floating":this.state.hide});return r.createElement("div",{className:"msg"},r.createElement("div",{className:"message message-system"},r.createElement("span",{className:t},r.createElement(i,null,r.createElement(o,{direction:"auto",text:e})))))}});e.exports=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(6),s=n(975),c=n(986),l=n(989),u=n(974),d=n(976),p=n(43),h=n(1006),f=n(1001),m=n(1119),g=n(101),v=n(10),y=n(201).MIMETYPES,E=n(1032),b=n(413),S=_.pickBy(y,function(e){return"document"===e.msgType}),M=a.createClass({displayName:"Doc",mixins:[s],propTypes:{msg:a.PropTypes.instanceOf(u).isRequired,quotedMsg:a.PropTypes.element,displayAuthor:a.PropTypes.bool},getInitialState:function(){return{mediaState:this.async("msg.mediaState")}},showMediaMissing:function(){v.openModal(a.createElement(h,{msg:this.props.msg}))},downloadMedia:function(e){var t=this;e&&e.stopPropagation(),this.downloadToBlob().then(function(){E.initDownload(t.props.msg)})},downloadToBlob:function(){return this.props.msg.mediaState===u.MEDIA_STATE.RESOLVED?o["default"].resolve():this.props.msg.forceDownloadMedia().then(this.displayToast)["catch"](_.noop)},
displayToast:function(){if(this.props.msg.mediaState!==u.MEDIA_STATE.RESOLVED)return o["default"].reject(this.props.msg.mediaState);var e=this.props.msg,t=e.caption||e.filename||l10n.t("untitled_document"),n={actionText:l10n.t("open_downloaded_document"),onAction:this.openDownloadedFile};return v.openToast(a.createElement(b,{msg:l10n.t("document_downloaded",{name:t}),id:b.genId(),action:n})),o["default"].resolve()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){g.supportsFeature(g.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():v.openModal(a.createElement(f,{msg:this.props.msg}))},openDownloadedFile:function(){this.props.msg.url&&window.open(this.props.msg.url,"_blank")},render:function(){var e,t=this.props,n=t.msg,r=t.displayAuthor,i=p("bubble","bubble-doc",{"bubble-broadcast":n.broadcast,"bubble-star":n.star}),o=r&&c.shouldRender(n)?a.createElement(c,{msg:n}):null;n.pageCount>0&&(e=a.createElement("span",{className:"document-meta-value"},l10n.t("web_conversations_most_recent_document",{count:n.pageCount,_plural:n.pageCount})));var s,h=n.size>0?a.createElement("span",{className:"document-meta-value"},l10n.filesize(n.size)):null,f="icon-doc";_.has(S,n.mimetype)&&(s=a.createElement("span",{className:"document-meta-value"},S[n.mimetype].ext),f=p(f,S[n.mimetype].icon));var g=n.body?a.createElement("div",{className:"document-thumb",style:{backgroundImage:"url(data:image/jpeg;base64,"+n.body+")"}}):null,v=n.caption||n.filename||l10n.t("untitled_document"),y=null,E=_.noop;switch(n.mediaState){case u.MEDIA_STATE.RESOLVED:y=a.createElement(m.Download,{onClick:this.downloadMedia}),E=this.openDownloadedFile;break;case u.MEDIA_STATE.FETCHING:y=a.createElement(m.PendingCancel,null),E=this.cancelDownload;break;case u.MEDIA_STATE.NEED_POKE:case u.MEDIA_STATE.INIT:y=a.createElement(m.Download,{onClick:this.downloadMedia}),E=this.downloadToBlob;break;case u.MEDIA_STATE.UPLOADING:y=a.createElement(m.PendingCancel,null),E=this.cancelUpload;break;case u.MEDIA_STATE.NEED_UPLOAD:y=a.createElement(m.Upload,null),E=this.resumeUpload;break;case u.MEDIA_STATE.REMOTE_NEED_UPLOAD:y=a.createElement(m.Upload,null),E=this.resumeRemoteUpload;break;case u.MEDIA_STATE.ERROR_MISSING:E=this.showMediaMissing;break;default:y=a.createElement(m.Pending,null)}return a.createElement("div",{className:i},o,this.props.quotedMsg,a.createElement("div",{className:"document-container",onClick:E,title:l10n.t("web_download_document",{name:v})},g,a.createElement("div",{className:"document-body"},a.createElement("div",{className:"document-icon"},a.createElement("div",{className:f})),a.createElement("div",{className:"document-text"},a.createElement(d,{text:v,ellipsify:!0,selectable:!1,dirMismatch:n.rtl!==l10n.isRTL(),direction:"auto"})),y)),a.createElement("div",{className:"document-meta"},e,s,h),a.createElement(l,{msg:n}))}});e.exports=M},function(e,t,n){"use strict";var r=n(6),i=n(1061),o=n(131),a=o.HotKeys,s=r.createClass({displayName:"FailedMsgIcon",propTypes:{onResend:r.PropTypes.func.isRequired,errMsg:r.PropTypes.string.isRequired},getInitialState:function(){return{hover:!1}},onMouseEnter:function(){this.setState({hover:!0})},onMouseLeave:function(){this.setState({hover:!1})},render:function(){var e=r.createElement("span",null,this.props.errMsg),t=this.state.hover?r.createElement(i,{direction:"left",body:e}):null;return r.createElement(a,{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,style:{"float":"right"},className:"icon-error-container"},r.createElement("button",{className:"error",onClick:this.props.onResend},r.createElement("span",{className:"icon icon-error"})),t)}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(975),a=n(133),s=n(986),c=n(1027),l=n(43),u=n(10),d=n(410),p=n(1001),h=n(1011),f=n(1014),m=n(989),g=n(974),v=n(1064),y=n(101),E=n(8),b=2.4,S=330,M=S/b,T=3,C=6,w=r.createClass({displayName:"Gif",mixins:[o,a],propTypes:{msg:r.PropTypes.instanceOf(g).isRequired,quotedMsg:r.PropTypes.element,hover:r.PropTypes.bool,isMsgVisible:r.PropTypes.func,displayType:r.PropTypes.oneOf(_.values(E.DISP_TYPE)),displayAuthor:r.PropTypes.bool},getInitialState:function(){return this.playCount=0,{mediaState:this.async("msg.mediaState"),playing:!1}},componentDidMount:function(){this.props.msg.downloadMedia()},pause:function(){this.playCount=0,this._pause()},play:function(e){if(this.props.msg.mediaState===g.MEDIA_STATE.RESOLVED&&this.refs.player){e&&e.stopPropagation(),this.setState({playing:!0}),_.isUndefined(this.duration)&&(this.duration=i.findDOMNode(this.refs.player).duration);var t=Math.ceil(C/this.duration);this.playCount=Math.max(t,T),this._play()}},_pause:function(){if(this.setState({playing:!1}),this.refs.player){var e=i.findDOMNode(this.refs.player);e&&(e.currentTime=0,e.paused||e.pause())}},_play:function(){if(this.refs.player){if(!this.playCount)return this.pause();this.playCount-=1;var e=i.findDOMNode(this.refs.player);e&&e.paused&&e.play()}},getStyle:function(){var e=this.props.msg,t=e.width||1,n=e.height||1,r=void 0,i=void 0,o=this.aspect(t,n);o?o<1/b?(i=S,r=M):o<1?(i=S,r=t*i/n):o<b?(r=S,i=n*r/t):(r=S,i=M):(i="100%",r=S);var a=e.url?e.fullWidth||e.width:t,s=e.url?e.fullHeight||e.height:n;return o?a/s>r/i?(a=a*i/s,s=i):(s=s*r/a,a=r):(a=S,s="100%"),{bubbleWidth:r,bubbleHeight:i,contentWidth:a,contentHeight:s}},aspect:function(e,t){if(e&&t)return e/t},showMediaMissing:function(){u.openModal(r.createElement(d,{title:l10n.t("missing_photo_title"),onOK:u.closeModal.bind(u),okText:l10n.t("web_ok")},l10n.t("missing_photo_text")))},getZoomNode:function(e){var t=this.props.isMsgVisible(e);if(t&&t.getImgNode)return t.getImgNode()},launchMediaViewer:function(e){e&&e.stopPropagation(),u.openModalMedia(r.createElement(f,{msg:this.props.msg,getZoomNode:this.props.isMsgVisible?this.getZoomNode:_.noop}),"media-viewer")},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){y.supportsFeature(y.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():u.openModal(r.createElement(p,{msg:this.props.msg}))},onDragStart:function(e){e.nativeEvent.dataTransfer.setData(E.DRAG_TYPE_LOCAL_IMAGE,!0)},stopEvent:function(e){e.stopPropagation()},getImgNode:function(){if(this.refs.player)return i.findDOMNode(this.refs.player)},render:function(){var e=this.props.msg,t=e.caption?r.createElement(c,{msg:e}):null,n=t?null:r.createElement("div",{className:"shade"}),i="data:image/jpeg;base64,"+e.body,o=null,a=_.noop,u=null,d=null,p=this.getStyle(),f=p.bubbleWidth,y=p.bubbleHeight,E=p.contentWidth,b=p.contentHeight,S={width:f,height:y};switch(e.mediaState){case g.MEDIA_STATE.RESOLVED:this.state.playing||(d=r.createElement("span",{className:"image-gif-control",onClick:this.play},r.createElement("button",{className:"icon icon-media-gif"}))),u=r.createElement(v,{msg:e,poster:i,ref:"player",className:"image-thumb-body",width:E,height:b,onEnded:this._play,muted:!0},l10n.t("video_playback_not_supported")),a=this.launchMediaViewer;break;case g.MEDIA_STATE.INIT:a=this.launchMediaViewer;break;case g.MEDIA_STATE.FETCHING:o=r.createElement(h.PendingCancel,null),a=this.cancelDownload;break;case g.MEDIA_STATE.NEED_POKE:o=r.createElement(h.Download,{filesize:e.size}),a=this.downloadMedia;break;case g.MEDIA_STATE.UPLOADING:o=r.createElement(h.PendingCancel,null),a=this.cancelUpload;break;case g.MEDIA_STATE.NEED_UPLOAD:o=r.createElement(h.Upload,{filesize:e.size}),a=this.resumeUpload;break;case g.MEDIA_STATE.REMOTE_NEED_UPLOAD:o=r.createElement(h.Upload,{filesize:e.size}),a=this.resumeRemoteUpload;break;case g.MEDIA_STATE.ERROR_MISSING:a=this.showMediaMissing;break;default:o=r.createElement(h.Pending,null)}u||(u=r.createElement("div",{className:"image-thumb-body image-thumb-gif",style:{backgroundImage:"url("+i+")"}}));var M=l("bubble-image",{"bubble-image-caption":e.caption,"bubble-broadcast":e.caption&&e.broadcast,"bubble-star":e.caption&&e.star}),T=this.props.displayAuthor&&s.shouldRender(e)?r.createElement(s,{msg:e}):null;return r.createElement("div",{className:M,onClick:this.stopEvent,style:{width:S.width,maxWidth:"100%"}},T,this.props.quotedMsg,r.createElement("div",{className:"image-thumb",onClick:a,style:S},d,o,u,n),t,r.createElement(m,{msg:this.props.msg}))}});e.exports=w},function(e,t,n){"use strict";var r=n(6),i=n(974),o=n(80),a=n(884),s=n(43),c={LINK:"link",GROUP_INVITE:"group_invite"},l=r.createClass({displayName:"LinkPreview",mixins:[a],propTypes:{msg:r.PropTypes.instanceOf(i).isRequired,type:r.PropTypes.oneOf(_.values(c)).isRequired},getDefaultProps:function(){return{type:c.LINK}},render:function(){var e=this.props,t=e.msg,n=e.type,i=void 0;if(t.thumbnail){var a=s({"link-preview-media":n===c.LINK,"group-invite-preview":n===c.GROUP_INVITE});i=r.createElement("img",{className:a,src:"data:image/jpeg;base64,"+t.thumbnail})}var l=t.title?r.createElement("div",{className:"link-preview-title",title:t.title},t.title):null,u=t.description?r.createElement("div",{className:"link-preview-description",title:t.description},t.description):null,d=s("link-preview-body",{nothumb:!i}),p=n===c.LINK?r.createElement("div",{className:"link-preview-source ellipsify"},o.hostname(t.canonicalUrl||t.matchedText)):null,h=function(e){var n=document.createElement("a");n.href=t.matchedText,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)};return r.createElement("div",{className:"link-preview-container",onClick:h},i,r.createElement("div",{className:d},l,u,p))}});l.Type=c,e.exports=l},function(e,t,n){"use strict";var r=n(6),i=n(974),o=n(43),a={FRONT:"front",MID:"mid",END:"end",SINGLE:"single"},s=r.createClass({displayName:"Menu",propTypes:{msg:r.PropTypes.instanceOf(i).isRequired,position:r.PropTypes.oneOf(_.values(a)).isRequired,onClick:r.PropTypes.func,isFocusedMsg:r.PropTypes.bool},click:function(){this.refs.context.click()},render:function(){var e=this.props,t=e.msg,n=e.position,s=e.onClick,c=t.isMedia,l=t.isSentByMe,u=t.isGroupMsg,d=t.type,p=!!t.quotedMsg,h=l?"context-out":"context-in",f=t.type===i.TYPE.DOCUMENT&&!t.body,m=t.type===i.TYPE.DOCUMENT&&t.body,g=d===i.TYPE.LOCATION;c=c||m||g||p;var v;u&&(v=!l&&(n===a.FRONT||n===a.SINGLE),c=c&&!v);var y=d===i.TYPE.CHAT&&t.matchedText&&t.matchedText.length&&t.body.indexOf(t.matchedText)>-1&&!v&&t.isTrusted(),_=o("js-context-icon",c?"context-icon-media":"context-icon"),E=o(h,{context:!(c||y),"context-media":c,"context-media-document":m,"context-ptt":d===i.TYPE.PTT&&!p,"context-ptt-author":d===i.TYPE.PTT&&v&&!p,"context-special":(y||f)&&!v&&!p,"context-doc":f&&!v&&!p});return r.createElement("div",{className:E},r.createElement("div",{className:_,ref:"context",onClick:s}))}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(988),o=n(976),a=n(884),s=n(10),c=n(1176),l=r.createClass({displayName:"Notification",mixins:[a],propTypes:{text:r.PropTypes.string.isRequired,e2eSubtype:r.PropTypes.string,participantJid:r.PropTypes.string,chatId:r.PropTypes.string},onSecurityClick:function(){s.openModal(r.createElement(c,{e2eSubtype:this.props.e2eSubtype,jid:this.props.participantJid,chatId:this.props.chatId}))},render:function(){var e=r.createElement(i,null,r.createElement(o,{direction:"auto",text:this.props.text})),t=!!this.props.e2eSubtype,n=t?r.createElement("button",{className:"message-system-e2e",onClick:this.onSecurityClick},e):r.createElement("span",{className:"message-system-body"},e);return n}});e.exports=l},function(e,t,n){"use strict";var r=n(6),i=n(975),o=n(986),a=n(1027),s=n(43),c=n(10),l=n(1006),u=n(1001),d=n(1011),p=n(1014),h=n(989),f=n(974),m=n(130),g=n(101),v=n(8),y=r.createClass({displayName:"Picture",mixins:[i,m],propTypes:{msg:r.PropTypes.instanceOf(f).isRequired,quotedMsg:r.PropTypes.element,isMsgVisible:r.PropTypes.func,displayAuthor:r.PropTypes.bool},defaultWidth:330,getInitialState:function(){return{mediaState:this.async("msg.mediaState")}},componentDidMount:function(){this.props.msg.downloadMedia()},getImgStyle:function(e,t,n){var r=this.getHeight(t,n),i=this.aspect(this.defaultWidth,r);return e<0||this.isPortrait(i)?{width:this.defaultWidth}:{height:"100%"}},getStyle:function(e,t,n){var r=void 0;return r=void 0!==n?n>0?e:t:t?t:this.getHeight(1,1),{width:this.defaultWidth+"px",height:r}},getHeight:function(e,t){if(e&&t){var n,r=this.defaultWidth,i=this.aspect(e,t),o=this.isPortrait(i);return o?n=r:i&&(i>2.4?n=r/2.4:e&&t&&(n=t*(r/e))),Math.round(n)}},isPortrait:function(e){return e?e<=1:null},aspect:function(e,t){if(e&&t)return e/t},showMediaMissing:function(){c.openModal(r.createElement(l,{msg:this.props.msg}))},getZoomNode:function(e){var t=this.props.isMsgVisible(e);if(t&&t.getImgNode)return t.getImgNode()},launchMediaViewer:function(e){e&&e.stopPropagation(),c.openModalMedia(r.createElement(p,{msg:this.props.msg,getZoomNode:this.props.isMsgVisible?this.getZoomNode:_.noop}),"media-viewer")},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){g.supportsFeature(g.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():c.openModal(r.createElement(u,{msg:this.props.msg}))},onDragStart:function(e){e.nativeEvent.dataTransfer.setData(v.DRAG_TYPE_LOCAL_IMAGE,!0)},stopEvent:function(e){e.stopPropagation()},getImgNode:function(){return this.refs.img},render:function(){var e=this.props.msg,t=e.caption?null:r.createElement("div",{className:"shade"}),n=e.caption?r.createElement(a,{msg:e}):null,i=e.url||"data:image/jpeg;base64,"+e.body,c=null,l=_.noop;switch(e.mediaState){case f.MEDIA_STATE.RESOLVED:l=this.launchMediaViewer;break;case f.MEDIA_STATE.FETCHING:c=r.createElement(d.PendingCancel,null),l=this.cancelDownload;break;case f.MEDIA_STATE.NEED_POKE:c=r.createElement(d.Download,{filesize:e.size}),l=this.downloadMedia;break;case f.MEDIA_STATE.UPLOADING:c=r.createElement(d.PendingCancel,null),l=this.cancelUpload;break;case f.MEDIA_STATE.NEED_UPLOAD:c=r.createElement(d.Upload,{filesize:e.size}),l=this.resumeUpload;break;case f.MEDIA_STATE.REMOTE_NEED_UPLOAD:c=r.createElement(d.Upload,{filesize:e.size}),l=this.resumeRemoteUpload;break;case f.MEDIA_STATE.ERROR_MISSING:l=this.showMediaMissing;break;default:c=r.createElement(d.Pending,null)}var u=s("bubble-image",{"bubble-image-caption":e.caption,"bubble-broadcast":e.caption&&e.broadcast,"bubble-star":e.caption&&e.star}),p=s("image-thumb-body",{"image-thumb-lores":i!==e.url}),m=this.props.displayAuthor&&o.shouldRender(e)?r.createElement(o,{msg:e}):null,g=this.getHeight(e.fullWidth,e.fullHeight),v=this.getHeight(e.width,e.height),y=g&&v?v-g:void 0,E=this.getStyle(g,v,y),b={};return y>0&&(b.marginBottom=y+"px"),r.createElement("div",{className:u,onClick:this.stopEvent,style:b},m,this.props.quotedMsg,r.createElement("div",{className:"image-thumb",onClick:l,style:E},c,r.createElement("img",{src:i,onDragStart:this.onDragStart,className:p,style:this.getImgStyle(y,e.fullWidth||e.width||1,e.fullHeight||e.height||1),ref:"img"}),t),n,r.createElement(h,{msg:this.props.msg}))}});e.exports=y},function(e,t,n){"use strict";var r=n(6),i=n(8),o=n(974),a=n(975),s=n(989),c=n(986),l=n(1069),u=n(1142),d=n(1001),p=n(10),h=n(101),f=n(1006),m=n(132),g=r.createClass({displayName:"PTT",mixins:[a],propTypes:{msg:r.PropTypes.instanceOf(o).isRequired,quotedMsg:r.PropTypes.element,displayAuthor:r.PropTypes.bool},getInitialState:function(){return this.asyncState({mediaState:"msg.mediaState",img:"msg.sender.ProfilePicThumb.img",ack:"msg.ack"},{currentTime:0,playing:!1,autoPlay:!1})},componentDidMount:function(){this.props.msg.downloadMedia()},showMediaMissing:function(){p.openModal(r.createElement(f,{msg:this.props.msg}))},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){h.supportsFeature(h.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():p.openModal(r.createElement(d,{msg:this.props.msg}))},handleTimeUpdate:function(e){this.setState({currentTime:e})},handlePlayingUpdate:function(e){this.setState({autoPlay:!1,playing:e})},loader:function(e,t,n){return n=n?r.createElement(m,{stroke:3,size:38}):null,r.createElement("div",{className:"audio"},r.createElement("div",{className:"audio-controls"},r.createElement("button",{className:"btn-audio "+(t?"icon "+t:""),onClick:e},n)),r.createElement("div",{className:"audio-body"},r.createElement("input",{type:"range",className:"audio-track",min:0,max:100,value:0,disabled:"disabled"})))},getStatusClass:function(e){return e+=" audio-state-default",this.state.ack===i.ACK_PLAYED&&(e+=" audio-state-played"),e},render:function(){var e=this.props.msg,t=this.getStatusClass("bubble bubble-attach bubble-audio"),n="audio-status icon ";n+=this.state.ack===i.ACK_PLAYED?e.isSentByMe?"icon-ptt-out-blue":"icon-ptt-in-blue":e.isSentByMe?"icon-ptt-out-gray":"icon-ptt-in-green";var a,d=r.createElement("span",{className:n,key:"status"}),p=this.state.playing?this.state.currentTime:e.duration,h=r.createElement(l,{key:"image",className:this.props.quotedMsg?"quoted-msg-bubble-ptt":null,thumb:this.state.img,type:e.type,shade:!1,duration:p}),f=e.isSentByMe?[h,d]:null,m=e.isSentByMe?null:[h,d],g=e.isSentByMe?"text no-author":"text";switch(e.mediaState){case o.MEDIA_STATE.RESOLVED:a=r.createElement(u,{msg:e,autoPlay:this.state.autoPlay,onPlayingUpdate:this.handlePlayingUpdate,onTimeUpdate:this.handleTimeUpdate});break;case o.MEDIA_STATE.NEED_POKE:a=this.loader(this.downloadMedia,"icon-audio-download");break;case o.MEDIA_STATE.NEED_UPLOAD:a=this.loader(this.resumeUpload,"icon-audio-upload");break;case o.MEDIA_STATE.REMOTE_NEED_UPLOAD:a=this.loader(this.resumeRemoteUpload,"icon-audio-upload");break;case o.MEDIA_STATE.ERROR_MISSING:a=this.loader(this.showMediaMissing,"icon-audio-play");break;default:a=this.loader(null,null,!0)}var v=this.props.displayAuthor&&c.shouldRender(e)?r.createElement(c,{msg:e,className:this.props.quotedMsg?"quoted-msg-bubble-ptt-author":null}):null;return r.createElement("div",{className:t},this.props.quotedMsg?v:null,this.props.quotedMsg,r.createElement("div",{className:"wrapper"},f,r.createElement("div",{className:"contents"},this.props.quotedMsg?null:v,r.createElement("div",{className:g},a)),m,r.createElement(s,{msg:e})))}});e.exports=g},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(8),a=n(974),s=n(130),c=n(1055),l=r.createClass({displayName:"PTTPlayer",mixins:[s],propTypes:{msg:r.PropTypes.instanceOf(a).isRequired,autoPlay:r.PropTypes.bool.isRequired,onPlayingUpdate:r.PropTypes.func.isRequired,onTimeUpdate:r.PropTypes.func.isRequired},playing:!1,dragging:!1,getInitialState:function(){return{progress:0}},onPlayClick:function(){var e=i.findDOMNode(this.refs.audio);this.playing?e.pause():e.play()},onPlaying:function(){this.playing=!0;var e=this.props.msg;!e.get("isSentByMe")&&e.get("ack")<o.ACK_PLAYED&&e.sendPlayed(),this.props.onPlayingUpdate&&this.props.onPlayingUpdate(this.playing)},onPause:function(){this.playing=!1,this.props.onPlayingUpdate&&this.props.onPlayingUpdate(this.playing)},onEnded:function(){var e=i.findDOMNode(this.refs.audio);e.currentTime=0,e.load()},onTimeUpdate:function(){var e=i.findDOMNode(this.refs.audio),t=0;_.isFinite(e.duration)&&(t=Math.round(100*Math.min(1,e.currentTime/e.duration)),this.props.onTimeUpdate&&this.props.onTimeUpdate(e.currentTime)),this.setState({progress:t})},componentDidMount:function(){var e=i.findDOMNode(this.refs.audio);this.regNativeListener(e,"playing",this.onPlaying),this.regNativeListener(e,"pause",this.onPause),this.regNativeListener(e,"ended",this.onEnded),this.regNativeListener(e,"timeupdate",this.onTimeUpdate),this.regNativeListener(e,"durationchange",this.onTimeUpdate),this.regNativeListener(e,"progress",this.onTimeUpdate)},onDrag:function(e){var t=i.findDOMNode(this.refs.audio),n=e.target.value;this.setState({progress:n}),t.duration&&(t.currentTime=t.duration/100*n)},onPlayerError:function(e){},render:function(){var e="btn-audio icon ";e+=this.playing?"icon-audio-pause":"icon-audio-play";var t={width:this.state.progress-this.state.progress/100*3+"%"};return r.createElement("div",{className:"audio"},r.createElement("div",{className:"audio-controls"},r.createElement("button",{ref:"play_pause",className:e,onClick:this.onPlayClick})),r.createElement("div",{className:"audio-body"},r.createElement("div",{className:"audio-track-container"},r.createElement("span",{className:"audio-progress",style:t}),r.createElement("input",{type:"range",className:"audio-track",value:this.state.progress,onChange:this.onDrag,min:"0",max:"100"}))),r.createElement(c,{ref:"audio",msg:this.props.msg,preload:"auto",onError:this.onPlayerError,autoPlay:this.props.autoPlay}))}});e.exports=l},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(974),a=n(129),s=n(1013),c=n(43),l=n(196),u=n(976),d=n(1008),p=n(982),h=n(21),f=n(134),m=n(8),g=n(131),v=g.HotKeys,y=r.createClass({displayName:"StarredMsg",mixins:[a],propTypes:{msg:r.PropTypes.instanceOf(o).isRequired,isMsgVisible:r.PropTypes.func,currSelection:r.PropTypes.object,activeSelection:r.PropTypes.object,onSelectMsg:r.PropTypes.func.isRequired},getInitialState:function(){var e=this.props.currSelection,t=this.props.activeSelection,n=this.props.msg;return{hover:!1,current:!!e&&e.value===n,active:!!t&&t.value===n,focus:!1}},componentWillMount:function(){var e=this,t=this.props.msg,n=this.props.currSelection;n&&this.addObserver(n,t.id.toString(),function(t){var n="focus"===t;if(n){var r=i.findDOMNode(e);f.focus(r),d.scrollIntoViewIfNeeded(r)}e.setState({current:n})});var r=this.props.activeSelection;r&&this.addObserver(r,t.id.toString(),this.onActiveChange)},onActiveChange:function(e){if("focus"===e){var t=i.findDOMNode(this);f.focus(t),d.scrollIntoViewIfNeeded(t)}this.setState({active:!!e})},mouseOver:function(){this.state.hover||this.setState({hover:!0})},mouseEnter:function(){this.state.hover||this.setState({hover:!0})},mouseLeave:function(){this.state.hover&&this.setState({hover:!1})},onEnter:function(e){e.stopPropagation(),e.preventDefault(),this.props.onSelectMsg(this.props.msg)},openContextMenu:function(e){this.refs.wrapper.contextOpen()},onFocus:function(e){this.setState({focus:!0}),this.indicateFocus(e)},onBlur:function(e){this.finishFocusIndication(e),this.setState({focus:!1})},indicateFocus:function(e){if(!(Date.now()-(v.flashFocus||0)>200)){var t=this.refs.row,n=this.state.active?"#d6d7d8":"#e2e3e3";Velocity(t,"stop"),Velocity(t,{backgroundColor:[n,"#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.finishFocusIndication})}},finishFocusIndication:function(e){var t=this.refs.row;t&&(Velocity(t,"stop"),t.style.backgroundColor="")},render:function(){var e=this,t=this.props.msg,n=t.senderObj.formattedName,i=t.chat.isUser?Store.Contact.get(t.to).formattedName?Store.Contact.get(t.to).formattedName:h.formattedUser(t.to):t.chat.formattedTitle,a=c("starred-msg-wrapper",{"starred-msg-resize":t.type===o.TYPE.PTT||t.type===o.TYPE.IMAGE||t.type===o.TYPE.LOCATION||t.type===o.TYPE.VCARD,hover:this.state.hover,current:this.state.current&&this.state.focus,active:this.state.active}),d={enter:this.onEnter};return d[l10n.LR("right","left")]=this.openContextMenu,r.createElement(v,{handlers:d,onFocus:this.onFocus,onBlur:this.onBlur},r.createElement("div",{ref:"row",className:a,onClick:function(){return e.props.onSelectMsg(t)},onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,onMouseLeave:this.state.hover?this.mouseLeave:null},r.createElement("div",{className:"starred-msg-title"},r.createElement("div",{className:"starred-title-main"},r.createElement(p,{id:t.senderObj.id,size:26}),r.createElement(u,{classes:"starred-msg-author",text:n,direction:"auto",ellipsify:!0,titlify:!0}),r.createElement("span",{className:"starred-title-divider"}),r.createElement(u,{classes:"starred-msg-chat",text:i,direction:"auto",ellipsify:!0,titlify:!0})),r.createElement("div",{className:"starred-title-meta"},l.relativeStr(t.t)),r.createElement("div",{className:"icon icon-chevron-right-alt"})),r.createElement(s,{msg:t,key:t.id,ref:"wrapper",current:this.state.current,displayType:m.DISP_TYPE.STARRED_MSGS,isMsgVisible:this.props.isMsgVisible,position:s.Position.END,tailOverride:"left"})))}});e.exports=y},function(e,t,n){"use strict";var r=n(6),i=n(974),o=n(975),a=r.createClass({displayName:"Status",mixins:[o],propTypes:{msg:r.PropTypes.instanceOf(i).isRequired},getInitialState:function(){var e=this.props.msg;return{ack:e.ack<3?this.async("msg.ack"):e.ack}},getStatus:function(){var e=this.props.msg,t="icon",n=e.ack;return t+=n<1?" icon-msg-time":1===n?" icon-msg-check":2===n?" icon-msg-dblcheck":" icon-msg-dblcheck-ack",(e.isMedia&&!e.caption||e.type===i.TYPE.LOCATION&&!e.get("loc"))&&(t+="-light"),t},render:function(){return r.createElement("span",{onClick:this.openInfoDrawer,className:this.getStatus()})}});e.exports=a},function(e,t,n){"use strict";var r=n(6),i=n(988),o=n(976),a=n(102),s=r.createClass({displayName:"StickyDateMarker",proptypes:{},getInitialState:function(){return{date:null,hide:!1}},updateDateMarkerText:function(e){this.setState({date:e})},hideStickyDateMarker:function(e){this.state.hide!==e&&this.setState({hide:e})},render:function(){var e=void 0;return this.state.date&&!this.state.hide&&(e=r.createElement("div",{className:"msg sticky-date-marker-floating-container"},r.createElement("div",{className:"sticky-date-marker-floating-wrapper"},r.createElement("span",{className:"message-system-body"},r.createElement(i,null,r.createElement(o,{direction:"auto",text:this.state.date})))))),r.createElement(a,{transitionName:"slide-down-date"},e)}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(986),o=n(989),a=n(1137),s=n(1067),c=n(974),l=n(976),u=n(43),d=n(884),p=n(425),h=n(208),f=r.createClass({displayName:"Text",mixins:[d],propTypes:{msg:r.PropTypes.instanceOf(c).isRequired,quotedMsg:r.PropTypes.element,senderName:r.PropTypes.string,displayAuthor:r.PropTypes.bool,trusted:r.PropTypes.bool},render:function(){var e=this.props,t=e.msg,n=e.displayAuthor,c=e.trusted,d=n&&i.shouldRender(t),f=u("bubble","bubble-text",{"bubble-broadcast":t.broadcast,"bubble-star":t.star,"has-author":d}),m=d?r.createElement(i,{msg:t,className:this.props.quotedMsg?"text-author-quoted-msg":null}):null,g=void 0,v=void 0;if(c&&t.linkPreview){var y=p.parseInviteLink(t.matchedText);if(y){g=r.createElement(a,{msg:t,type:a.Type.GROUP_INVITE});var _=function(e){var n=document.createElement("a");n.href=t.matchedText,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)},E=t.isSentByMe?h.t("group_invite_view"):h.t("group_invite_join");v=r.createElement("div",{className:"bubble-actions"},r.createElement("div",{className:"bubble-btn",onClick:_,title:E},E))}else g=r.createElement(a,{msg:t})}var b=u("message-text",{"heart-animation":1===t.body.length&&"❤"===t.body}),S=t.mentionMap();return r.createElement("div",{className:f},m,this.props.quotedMsg,r.createElement("div",{className:b,"data-id":t.id},g,r.createElement(s,{msg:t}),r.createElement(l,{text:t.body,selectable:!0,dirMismatch:t.rtl!==h.isRTL(),direction:t.dir,linkify:c,mention:S,format:!0,wbr:15})),r.createElement(o,{msg:t}),v)}});e.exports=f},function(e,t,n){"use strict";var r=n(6),i=n(988),o=r.createClass({displayName:"Unread",propTypes:{count:r.PropTypes.number.isRequired},render:function(){var e=l10n.t("unread_message_count",{count:l10n.n(this.props.count),_plural:this.props.count});return r.createElement("span",{className:"msg-unread-body"},r.createElement(i,null,e))}});e.exports=o},function(e,t,n){"use strict";var r=n(974),i=n(6),o=n(989),a=n(986),s=n(43),c=i.createClass({displayName:"UnsupportedMsg",propTypes:{msg:i.PropTypes.instanceOf(r).isRequired,displayAuthor:i.PropTypes.bool},render:function(){var e=this.props.msg,t=this.props.displayAuthor&&a.shouldRender(e),n=t?i.createElement(a,{msg:e}):null,r=s("bubble bubble-placeholder",{"has-author":t}),c="message-text";return i.createElement("div",{className:r},n,i.createElement("div",{className:"icon icon-unknown placeholder-icon"}),i.createElement("div",{className:c},i.createElement("span",null,i.createElement("span",{className:"placeholder-msg"},l10n.t("unsupported_msg")))),i.createElement(o,{msg:e}))}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(986),o=n(989),a=n(974),s=n(43),c=n(10),l=n(1021),u=n(976),d=n(1070),p=n(129),h=n(1155),f=r.createClass({displayName:"Vcard",mixins:[p],propTypes:{msg:r.PropTypes.instanceOf(a).isRequired,quotedMsg:r.PropTypes.element,displayAuthor:r.PropTypes.bool},openContactChat:function(){var e=this.props.msg.vcardWAid;Store.Chat.find(e).then(function(e){c.openChat(e)})},addContactToGroup:function(){Store.Contact.find(this.props.msg.vcardWAid).then(function(e){c.openModal(r.createElement(h,{contact:e}),"modal-flow")})},render:function(){var e=this.props.msg,t=void 0;this.props.quotedMsg&&(t="quoted-msg-bubble-vcard");var n=r.createElement(d,{className:"preview "+t,thumb:l.thumbnail(e.body),waid:e.vcardWAid}),a=e.isSentByMe?n:null,c=e.isSentByMe?null:n,p=e.author?"text":"text no-author",h=s(["bubble","bubble-attach","bubble-contact"],{"bubble-attach-caption":!!e.caption}),f=void 0;e.vcardWAid&&(f=r.createElement("div",{className:"bubble-actions"},r.createElement("div",{className:"bubble-btn",onClick:this.openContactChat,title:l10n.t("message_author",{author:e.subtype})},l10n.t("message")),r.createElement("div",{className:"bubble-btn",onClick:this.addContactToGroup,title:l10n.t("add_contact_to_group")},l10n.t("add_contact_to_group"))));var m=this.props.displayAuthor&&i.shouldRender(e)?r.createElement(i,{msg:e}):null,g=_.noop;return r.createElement("div",null,r.createElement("div",{className:h},m,this.props.quotedMsg,r.createElement("div",{className:"wrapper"},a,r.createElement("div",{className:"contents",style:{cursor:"pointer"},onClick:g},r.createElement("div",{className:p},r.createElement(o,{msg:e,contextMenu:this.contextMenu})),r.createElement(u,{text:e.subtype,element:"div",classes:"button button-contact",selectable:!0,dirMismatch:e.rtl!==l10n.isRTL(),direction:e.dir,wbr:15})),c),f))}});e.exports=f},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(974),a=n(1133),s=n(1147),c=n(1013),l=n(78),u=n(43),d=n(196),p=n(1224),h=n(8),f={KEEP_SCROLL_BOTTOM:"keep_scroll_bottom",KEEP_SCROLL_TOP:"keep_scroll_top",SCROLL_BOTTOM:"scroll_bottom",NONE:"none",DEFAULT:"default"},m={};m[f.KEEP_SCROLL_BOTTOM]=2,m[f.KEEP_SCROLL_TOP]=2,m[f.SCROLL_BOTTOM]=2,m[f.NONE]=1,m[f.DEFAULT]=0;var g=r.createClass({displayName:"MessageList",mixins:[l],propTypes:{msgs:r.PropTypes.arrayOf(r.PropTypes.instanceOf(o)).isRequired,udpateType:r.PropTypes.oneOf(_.values(f)),unreadCount:r.PropTypes.number,selectable:r.PropTypes.bool,onMessageSelect:r.PropTypes.func.isRequired,focusedMsgCtx:r.PropTypes.object,didRenderFocusedMsg:r.PropTypes.func,selectedMessages:r.PropTypes.objectOf(r.PropTypes.instanceOf(o))},shouldComponentUpdate:function(e){return e.updateType!==f.NONE},scrollBottom:function(e,t){(t||this.shouldScrollBottom!==!1&&!this.props.focusedMsgCtx)&&(e.scrollTop=e.scrollHeight)},componentWillUpdate:function(e,t){var n=i.findDOMNode(this).parentNode,r=e.updateType;r===f.KEEP_SCROLL_BOTTOM?this.shouldRestoreScroll=n.scrollHeight-n.scrollTop-n.clientHeight:r===f.KEEP_SCROLL_TOP&&(this.shouldRestoreScroll=n.scrollTop)},componentDidUpdate:function(e,t){var n=i.findDOMNode(this).parentNode;this.props.updateType===f.SCROLL_BOTTOM?n.scrollTop=n.scrollHeight:_.isUndefined(this.shouldRestoreScroll)||(this.props.updateType===f.KEEP_SCROLL_BOTTOM?n.scrollTop=n.scrollHeight-this.shouldRestoreScroll-n.clientHeight:n.scrollTop=this.shouldRestoreScroll,
this.shouldRestoreScroll=void 0)},onCopy:function(e){var t=window.getSelection();e.clipboardData.setData("text/plain",p.asPlainText(t)),e.stopPropagation(),e.preventDefault()},getMsgVisibility:function(e){var t=i.findDOMNode(this).parentNode,n=t.scrollTop,r=n+t.clientHeight,o=i.findDOMNode(e);return o.offsetTop+o.clientHeight<=n?h.VISIBILITY.ABOVE:o.offsetTop>=r?h.VISIBILITY.BELOW:h.VISIBILITY.VISIBLE},render:function(){var e,t,n=[],i=this.props.msgs,l=this.props,p=l.focusedMsgCtx,f=l.unreadCount,m=l.selectedMessages,g=!1,v=void 0,y=0;for(t=0;t<i.length;t++)if(e=i[t]){var E=d.dayOfMsg(e);0!==t&&v===E||(n.push(r.createElement(a,{ref:"dateMarker_"+y,key:"msg-"+e.id+"-date",timestamp:e.t})),g=!1,y+=1),v=E,f>0&&p&&p.isUnreadDivider&&p.msg===e&&(n.push(r.createElement("div",{className:"msg-unread",key:"msg-unread"},r.createElement(s,{count:f}))),g=!1);var b=_.matches({from:e.from,startOfDay:e.startOfDay}),S=_.matches({author:e.author,startOfDay:e.startOfDay}),M=e.isGroupMsg?S:b,T=c.Position.SINGLE,C=i[t+1];(C&&f&&p&&p.isUnreadDivider&&p.msg===C||C&&C.isNotification||C&&E!==d.dayOfMsg(C))&&(C=!1),e.isNotification?T=c.Position.SINGLE:M(C)&&!M(g)?T=c.Position.FRONT:M(g)&&M(C)?T=c.Position.MID:M(g)&&!M(C)&&(T=c.Position.END);var w=p&&p.msg===e,x=w&&p.highlightMsg,N=m&&e.id in m,P=e.type===o.TYPE.IMAGE||e.type===o.TYPE.VIDEO||e.type===o.TYPE.AUDIO;n.push(r.createElement(c,{key:"msg-"+e.id,ref:e.id.toString(),msg:e,displayType:h.DISP_TYPE.CONVERSATION,isMsgVisible:P?this.props.isMsgVisible:_.noop,selectable:this.props.selectable,selected:N,onMessageSelect:this.props.onMessageSelect,position:T,isFocusedMsg:w,highlight:x,didRenderFocusedMsg:this.props.didRenderFocusedMsg})),g=!e.isNotification&&e}var k=u("message-list",{selectable:this.props.selectable});return r.createElement("div",{className:k,onCopy:this.onCopy},n)}});g.UpdateType=f,g.UpdateTypePriority=m,e.exports=g},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(6),s=n(1),c=n(10),l=n(977),u=n(980),d=n(130),p=n(133),h=n(14),f=n(1e3),m=n(1017),g=n(1235),v=n(0),y=n(197),E=n(102),b=a.createClass({displayName:"PTT",mixins:[p,d,u],propTypes:{chat:a.PropTypes.instanceOf(l),onStateChange:a.PropTypes.func.isRequired},statics:{READY:"ready",DELAY:"delay",REC:"recording",PROCESSSING:"processsing",GUM_TIMEOUT:"ptt_gum_timeout",PERMISSION_DENIED:"permission_denied",NOT_SUPPORTED_ERROR:"not_supported_error",MANDATORY_UNSATISFIED_ERROR:"mandatory_unsatisfied_error",CANCEL:"cancel",SEND:"send"},getInitialState:function(){return{state:b.READY,active:void 0,elapsedTime:0,startTime:0}},componentDidMount:function(){this.regNativeListener(window,"blur",this.cancelRecording)},isRecording:function(){var e=this.state.state;return e===b.REC||e===b.DELAY||e===b.PROCESSSING},cancelRecording:function(){this.isRecording()&&(this.state.state!==b.READY&&this.props.onStateChange(b.READY),this.safeIsMounted()&&this.setState({state:b.READY,active:void 0,elapsedTime:0,startTime:0}),this.clearSafeInterval(this.elapsedTimeInterval),delete this.elapsedTimeInterval,this.recorder&&this.recorder.stop(),this.props.chat.markPaused())},startInterval:function(){var e=this;this.elapsedTimeInterval=this.safeInterval(function(){e.setState({elapsedTime:e.state.elapsedTime+1})},1e3),this.setState({elapsedTime:0,startTime:Date.now()})},cancelPTTTimer:function(){this.pttTimer&&(this.clearSafeTimeout(this.pttTimer),delete this.pttTimer)},onPTTReady:function(){delete this.pttTimer,this.state.state===b.DELAY&&this.setState({state:b.REC})},onMouseOverSend:function(){this.setState({active:b.SEND})},onMouseOutSend:function(){this.setState({active:void 0})},onMouseOverCancel:function(){this.setState({active:b.CANCEL})},onMouseOutCancel:function(){this.setState({active:void 0})},onMouseUpCancel:function(){this.state.elapsedTime<1||(this.cancelPTTTimer(),this.cancelRecording())},onMouseUpSend:function(){var e=this;if(!(this.state.elapsedTime<1)){this.cancelPTTTimer();var t=this.props.chat;if(this.state.state===b.REC){this.setState({state:b.PROCESSSING}),this.props.onStateChange(b.READY);var n=t.regCancellablePromise(new o["default"](function(t,n){e.recorder.addEventListener("dataAvailable",function(e){t(e.detail)})}));t.sendPTT(n,~~this.recorder.duration,t.composeQuotedMsg),t.composeQuotedMsg=null,n["catch"](o["default"].CancellationError,_.noop)["finally"](function(t){e.recorder.removeEventListener("dataAvailable"),e.cancelRecording()}),this.recorder.stop()}else this.cancelRecording(),s.log("ptt:onMouseUpSend duration too short")()}},onMouseDown:function(){var e=this;if(this.state.state===b.READY){var t=m.start("microphone");o["default"].race([t,this.rejectOnUnmount()]).checkpoint(this.rejectOnUnmount()).then(function(t){e.recorder=new g({bitRate:16e3,encoderSampleRate:16e3,encoderApplication:2048}),e.recorder.initStream(t),e.recorder.start(),e.props.chat.presence.update()["catch"](h.WapDrop,_.noop),e.props.chat.markRecording(),e.setState({state:b.DELAY}),e.props.onStateChange(b.REC),e.pttTimer=e.safeDelay(e.onPTTReady,1500),e.startInterval()})["catch"](h.Unmount,function(){t.then(function(e){return m.stop(e)})["catch"](_.noop)})["catch"](h.GUM.PermissionDeniedError,function(){c.openModal(a.createElement(f,{title:"guide_desktop_mic_title",desc:"guide_desktop_mic_fail_description",type:f.TYPE.GUIDE_UNBLOCK}))})["catch"](h.GUM.GUMError,function(){c.openModal(a.createElement(f,{title:"guide_desktop_mic_missing_title",desc:"guide_desktop_mic_missing_description",type:f.TYPE.GUIDE_NONE}))})["catch"](function(t){e.recorder&&e.recorder.stop(),s.error("PTT Recording Error")(t)})}},render:function(){var e="btn-close btn-border ptt-close";this.state.active===b.CANCEL&&(e+=" is-hover");var t="btn-border ptt-send";this.state.active===b.SEND&&(t+=" is-hover");var n=void 0;this.state.state!==b.DELAY&&this.state.state!==b.REC||(n=a.createElement(y,{displayName:"PTT",popable:!0,escapable:!0,requestDismiss:this.cancelRecording},a.createElement("div",{className:"ptt-recording",key:"recording"},a.createElement("button",{className:e,onMouseOver:this.onMouseOverCancel,onMouseOut:this.onMouseOutCancel,onMouseUp:this.onMouseUpCancel},a.createElement("span",{className:"icon icon-round-x btn-state-default"}),a.createElement("span",{className:"icon icon-round-x-inv btn-state-hover"})),a.createElement("div",{className:"ptt-counter"},v.unix(this.state.elapsedTime).format("m:ss")),a.createElement("button",{className:t,onMouseOver:this.onMouseOverSend,onMouseOut:this.onMouseOutSend,onMouseUp:this.onMouseUpSend},a.createElement("span",{className:"icon icon-round-send btn-state-default"}),a.createElement("span",{className:"icon icon-round-send-inv btn-state-hover"})))));var r=this.state.state===b.READY||this.state.state===b.PROCESSSING?a.createElement("button",{className:"icon btn-icon icon-ptt",onMouseDown:this.onMouseDown,disabled:this.state.state===b.PROCESSSING,key:"button"}):null,i="ptt-container";return n&&(i+=" active"),a.createElement("div",{className:i},a.createElement(E,{transitionName:"ptt"},n||r))}});e.exports=b},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(6),s=n(977),c=n(410),l=n(10),u=n(129),d=n(29),p=a.createClass({displayName:"Spam",mixins:[u],propTypes:{chat:a.PropTypes.instanceOf(s).isRequired},componentWillMount:function(){this.addObserver(Store.Blocklist,"add remove reset"),this.addObserver(this.props.chat,"change:trusted")},confirmReportGroupSpam:function(){l.openModal(a.createElement(c,{onOK:this.reportGroupSpam,okText:l10n.t("report_group_spam"),onCancel:l.closeModal.bind(l),cancelText:l10n.t("web_cancel")},l10n.t("report_group_spam_ack")))},reportGroupSpam:function(){var e=this.props.chat,t=e.sendSpamReport(!0);if(!e.isReadOnly){var n=e.sendExit(),r=d.waitForBBEvent(e.msgs,"change:last",function(e){return e.isGroupLeave()});t=o["default"].all([t,n,r])}t.then(function(){return e.sendDelete()})["catch"](_.noop),l.closeModal()},confirmReportSpam:function(){l.openModal(a.createElement(c,{onOK:this.reportSpam,okText:l10n.t("report_spam"),onCancel:l.closeModal.bind(l),cancelText:l10n.t("web_cancel")},l10n.t("report_spam_ack")))},reportSpam:function(){var e=this.props.chat;e.sendSpamReport().then(function(){return e.contact.setBlock(!0)}).then(function(){return e.sendDelete()})["catch"](_.noop),l.closeModal()},notSpam:function(){this.props.chat.sendNotSpam(!0)["catch"](_.noop)},confirmBlock:function(){l.openModal(a.createElement(c,{onOK:this.block,okText:l10n.t("block"),onCancel:l.closeModal.bind(l),cancelText:l10n.t("web_cancel")},l10n.t("block_ack")))},block:function(){this.props.chat.contact.setBlock(!0)["catch"](_.noop),l.closeModal()},confirmUnblock:function(){l.openModal(a.createElement(c,{okText:l10n.t("unblock_button"),onOK:this.unblock,cancelText:l10n.t("web_cancel"),onCancel:l.closeModal.bind(l)},l10n.t("unblock_confirmation",{contact:this.props.chat.contact.formattedName})))},unblock:function(){this.props.chat.contact.setBlock(!1)["catch"](_.noop),l.closeModal()},render:function(){var e=this.props.chat;if(e.isPSA||e.isNewlyCreated()||e.trusted)return null;var t,n=[];if(e.isGroup)t=l10n.t("group_admin_not_a_contact"),n.push(a.createElement("button",{className:"spam-button btn-plain",key:"report_spam",onClick:this.confirmReportGroupSpam},l10n.t("report_group_spam")));else{t=l10n.t("sender_not_a_contact"),n.push(a.createElement("button",{className:"spam-button btn-plain",key:"report_spam",onClick:this.confirmReportSpam},l10n.t("report_spam")));var r=Store.Blocklist.get(e.id);r?n.push(a.createElement("button",{onClick:this.confirmUnblock,key:"unblock",className:"spam-button btn-plain"},l10n.t("unblock_button"))):n.push(a.createElement("button",{onClick:this.confirmBlock,key:"block",className:"spam-button btn-plain"},l10n.t("block")))}return n.push(a.createElement("button",{onClick:this.notSpam,key:"not_spam",className:"spam-button btn-plain"},l10n.t("not_spam"))),a.createElement("div",{className:"spam"},a.createElement("div",{className:"spam-text"},t),a.createElement("div",{className:"spam-controls"},n))}});e.exports=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(6),s=n(34),c=n(129),l=n(977),u=n(1007),d=n(1127),p=n(1128),h=n(1065),f=n(1219),m=n(10),g=n(56),v=n(102),y=n(975),E=n(8),b=n(1112),S=n(197),M=a.createClass({displayName:"ConversationPanel",mixins:[c,y],propTypes:{chat:a.PropTypes.instanceOf(l).isRequired,msgCollection:a.PropTypes.instanceOf(u).isRequired,focusCtx:a.PropTypes.object},getInitialState:function(){var e=this.props.chat;return this.fillerHeight=e.fillerHeight||0,{canCompose:e.canSend,selectable:!1,selectedMessages:{},wallpaperColor:this.async("chat.ChatPreference.wallpaperColor")}},componentWillMount:function(){var e=this.props.chat;e.fillerHeight=null,this.addObserver(e,"change:canSend",this.onComposeState),this.openEvent=new g.WebcChatOpen({webcUnreadCount:e.unreadCount})},componentDidMount:function(){var e=this.props.chat;e.set({active:!0,viewed:!0}),this.openEvent&&(this.openEvent.markWebcChatOpenT(),this.openEvent.commit(),delete this.openEvent),this.addObserver(Store.ChatPreference,"wallpaper_color_preview",this.onWallpaperColorPreview)},componentWillUnmount:function(){this.props.chat.set("active",!1)},onComposeState:function(){var e=this.props.chat.canSend;this.state.canCompose!==e&&this.setState({canCompose:e})},onComposeHeightChange:function(e,t){var n=this,r=e.input,i=e.overlay,a=s.findDOMNode(this.refs.msgPanel);if(a&&this.refs.msgs){var c=this.refs.msgs.getScrollBottom();if(_.isNumber(r))return void this.refs.msgs.composeHeightChange(r);if(t)return this.fillerHeight=i,void(this.refs.filler&&(this.refs.filler.style.height=this.fillerHeight+"px",this.refs.msgs.setScrollBottom(c)));this.fillerHeight+=i,i<0&&(this.refs.filler&&(this.refs.filler.style.height=this.fillerHeight+"px"),this.refs.msgs&&this.refs.msgs.setScrollBottom(c)),this.msgPanelAnimation||(this.msgPanelAnimation=o["default"].resolve()),this.msgPanelAnimation.cancel(),this.msgPanelAnimation=this.msgPanelAnimation.then(function(){return Velocity(a,{translateY:i>0?[-i,0]:[0,i]},{duration:300,easing:[.1,.82,.25,1]})}).then(function(){return n.msgPanelAnimation=null}).cancellable()["catch"](o["default"].CancellationError,function(){Velocity(a,"finish",!0),a.style.transform=""}).then(function(){n.isMounted()&&(i>0&&n.refs.filler&&(n.refs.filler.style.height=n.fillerHeight+"px"),a.style.transform="",n.refs.msgs&&i>0&&n.refs.msgs.setScrollBottom(c))})}},onWallpaperColorPreview:function(e){e?this.state.wallpaperColor!==e&&this.setState({wallpaperColor:e}):this.setState({wallpaperColor:Store.ChatPreference.get("defaultPreference").wallpaperColor})},onSelectMessages:function(){this.state.selectable||this.setState({selectable:!0})},onCancelSelection:function(){this.state.selectable&&this.setState({selectable:!1,selectedMessages:{}})},onMessageSelect:function(e,t){this.onSelectMessages();var n=_.clone(this.state.selectedMessages);t?n[e.id]=e:delete n[e.id],this.setState({selectedMessages:n})},onPageUpDown:function(e){this.refs.msgs.onPageUpDown(e)},onDragStart:function(e){this.state.canCompose&&(this.blockDrop=!0)},onDragEnd:function(e){this.state.canCompose&&(this.blockDrop=!1)},onDragEnter:function(e){this.state.canCompose&&!this.blockDrop&&(_.includes(e.dataTransfer.types,"Files")||_.includes(e.dataTransfer.types,"text/uri-list")||_.includes(e.dataTransfer.types,"text/html"))&&(m.attachMediaDrawer(this.props.chat),e.stopPropagation(),e.preventDefault())},render:function(){var e,t,n,r=this.props,i=r.chat,o=r.msgCollection,s=r.focusCtx;if(this.state.selectable)t=a.createElement(S,{displayName:"MultiSelect",escapable:!0,requestDismiss:this.onCancelSelection},a.createElement(f,{chat:i,selectedMessages:_.values(this.state.selectedMessages),onCancel:this.onCancelSelection})),e=a.createElement("footer",{className:"pane-footer pane-chat-footer"}),n=a.createElement("div",{ref:"filler",className:"compose-filler"});else if(this.state.canCompose)e=a.createElement(h,{chat:i,onComposeHeightChange:this.onComposeHeightChange,onPageUpDown:this.onPageUpDown}),n=a.createElement("div",{ref:"filler",style:{height:this.fillerHeight+"px"},className:"compose-filler"});else{var c;c=i.isGroup?l10n.t("web_cannot_send_not_a_group_participant"):i.isPSA?l10n.t("web_psa_title"):l10n.t("web_cannot_send_to_blocked_contact_1",{contact:i.contact.formattedName}),e=a.createElement("footer",{className:"pane-footer pane-chat-footer"},a.createElement("div",{className:"block-message"},c))}var l={},u={};return this.state.wallpaperColor!==E.DEFAULT_CHAT_WALLPAPER&&(l.background=this.state.wallpaperColor,l.transition="background 0.3s ease",u.display="none"),a.createElement(S,{displayName:"ConversationPanel",state:S.State.INACTIVE,requestFocus:this.requestFocus},a.createElement("div",{id:"main",className:"pane pane-chat pane-two",onDragStart:this.onDragStart,onDragEnd:this.onDragEnd,onDragOver:this.onDragOver,onDragEnter:this.onDragEnter},a.createElement("div",{className:"pane-chat-tile",style:u}),a.createElement(d,{chat:i,canAttach:this.state.canCompose,onSelectMessages:this.onSelectMessages}),a.createElement("div",{className:"pane-body pane-chat-tile-container",ref:"msgPanel",style:l},a.createElement(p,{ref:"msgs",chat:i,selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,msgCollection:o,onSelectMessages:this.onSelectMessages,focusCtx:s,selectedMessages:this.state.selectedMessages})),n,e,a.createElement(v,{transitionName:"slide-up"},t),a.createElement(b,null)))}});e.exports=M},function(e,t,n){"use strict";var r=n(6),i=n(102),o=n(78),a=n(197),s=n(43),c=n(886),l=n(63),u={LEFT:"drawer-left",MID:"slide-up",RIGHT:"slide-left",NONE:"none"},d={LEFT:"left",MID:"mid",RIGHT:"right"},p=function(e){return u[e.toUpperCase()]},h=r.createClass({displayName:"DrawerManager",mixins:[o],propTypes:{direction:r.PropTypes.oneOf(_.values(d)),onDrawerIn:r.PropTypes.func,onDrawerOut:r.PropTypes.func,onDrawerAnimationComplete:r.PropTypes.func},getChildContext:function(){var e=this.state.uim||this.context.uim;return{uim:e}},getInitialState:function(){return{drawer:void 0,transition:p(this.props.direction),uim:void 0}},componentWillMount:function(){this.regCmd("open_drawer_"+this.props.direction,this.openFlow),this.regCmd("exists_drawer_"+this.props.direction,this.existsFlow),this.regCmd("close_drawer_"+this.props.direction,this.closeFlow)},shouldComponentUpdate:function(e,t){return c(this,e,t)},openFlow:function(e){var t=arguments.length<=1||void 0===arguments[1]?p(this.props.direction):arguments[1],n=arguments[2];this.state.drawer?t=u.NONE:this.props.onDrawerIn&&this.props.onDrawerIn(),this.setState({drawer:e,transition:t,uim:n})},existsFlow:function(e){e(!!this.state.drawer)},closeFlow:function(){this.state.drawer&&(this.props.onDrawerOut&&this.props.onDrawerOut(),this.setState({drawer:void 0}))},render:function(){var e=this.props,t=e.onDrawerAnimationComplete,n=e.direction,o=this.state,c=o.drawer,l=o.transition;c&&(c=r.createElement(a,{displayName:"Drawer"+_.upperFirst(n),escapable:!0,requestDismiss:this.closeFlow},c));var u=s("pane",{"pane-one":n===d.LEFT,"pane-two":n===d.MID,"pane-three":n===d.RIGHT});return r.createElement(i,{transitionName:l,className:u,onAnimationComplete:t},c)}});h.contextTypes={uim:r.PropTypes.instanceOf(l)},h.childContextTypes={uim:r.PropTypes.instanceOf(l)},h.Dir=d,h.Transition=u,e.exports=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(883),o=r(i),a=n(6),s=n(991),c=n(410),l=n(200),u=n(976),d=n(10),p=n(1180),h=a.createClass({displayName:"AddContactToGroupFlow",mixins:[s],propTypes:{contact:a.PropTypes.instanceOf(l).isRequired},getDefaultTransition:function(){var e;return e={},(0,o["default"])(e,s.Dir.PUSH,s.Transition.NONE),(0,o["default"])(e,s.Dir.POP,s.Transition.NONE),e},filter:function(e){var t=e.groupMetadata;return!(!e.isGroup||e.isGroup&&!t.participants.iAmMember())&&(t.participants.get(this.props.contact.id)?l10n.t("already_added_to_group"):!!t.participants.iAmAdmin()||l10n.t("chat_not_an_admin"))},componentWillMount:function(){this.push(a.createElement(p,{chats:Store.Chat.filter(function(e){return e.isGroup}),filter:this.filter,onCancel:this.pop,onGroup:this.confirmAddToGroup}))},confirmAddToGroup:function(e){this.push(a.createElement(c,{onOK:this.addToGroup.bind(null,e),okText:l10n.t("add_group_participant"),onCancel:this.pop,cancelText:l10n.t("web_cancel")},a.createElement(u,{text:l10n.t("confirm_add_group_participant",{participant:this.props.contact.formattedName,subject:e.contact.name})})))},addToGroup:function(e){e.groupMetadata.participants.addParticipant(this.props.contact).then(function(){d.openChat(e)})["catch"](_.noop),this.endFlow()}});e.exports=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(883),o=r(i),a=n(6),s=n(991),c=n(410),l=n(1029),u=n(977),d=n(10),p=n(976),h=a.createClass({displayName:"AddGroupParticipantFlow",mixins:[s],propTypes:{chat:a.PropTypes.instanceOf(u).isRequired},getDefaultTransition:function(){var e;return e={},(0,o["default"])(e,s.Dir.PUSH,s.Transition.NONE),(0,o["default"])(e,s.Dir.POP,s.Transition.NONE),e},componentWillMount:function(){this.push(a.createElement(l,{title:l10n.t("add_group_participant"),filter:this.contactFilter,onCancel:this._pop,onSelect:this.confirmAddParticipant}))},contactFilter:function(e){var t=this.props.chat.groupMetadata;return!!Store.Contact.isFilteredContact(e)&&(!t.participants.get(e.id)||l10n.t("already_added_to_group"))},confirmAddParticipant:function(e){var t=this.onAddParticipant.bind(this,e),n=l10n.t("confirm_add_group_participant",{participant:e.formattedName,subject:this.props.chat.contact.name});this.push(a.createElement(c,{onOK:t,okText:l10n.t("add_group_participant"),onCancel:this._pop,cancelText:l10n.t("web_cancel")},a.createElement(p,{text:n})))},_pop:function(){this.pop()},onAddParticipant:function(e){this.props.chat.groupMetadata.participants.addParticipant(e)["catch"](_.noop),d.closeModal()}});e.exports=h},function(e,t,n){"use strict";var r=n(6),i=n(991),o=n(1078),a=n(977),s=n(1035),c=r.createClass({displayName:"CaptureFlow",mixins:[i],propTypes:{chat:r.PropTypes.instanceOf(a).isRequired,stream:r.PropTypes.object.isRequired},componentWillMount:function(){this.push(r.createElement(o,{onBack:this.endFlow,caption:!0,onSend:this.sendMedia,stream:this.props.stream}))},sendMedia:function(e){var t=e.file,n=e.caption,r=this.props.chat;s.prepFileForUpload(t).then(function(e){n&&(e.caption=n),r.sendMedia2([e],r.composeQuotedMsg),r.composeQuotedMsg=null}),this.endFlow()}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(991),o=n(1170),a=n(10),s=r.createClass({displayName:"NewChatFlow",mixins:[i],componentWillMount:function(){this.push(r.createElement(o,{title:l10n.t("new_chat_flow_title"),onBack:this.endFlow,onClick:this.onClick}))},onClick:function(e,t){Store.Chat.find(t.id).then(a.openChat.bind(a)),this.endFlow()}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(991),o=n(1186),a=n(1187),s=r.createClass({displayName:"NewGroupFlow",mixins:[i],componentWillMount:function(){this.push(r.createElement(o,{onBack:this.endFlow,onContinue:this.groupParticipants}))},groupParticipants:function(e,t,n){this.push(r.createElement(a,{subject:e,thumb:t,full:n,onBack:this.participantsBack,onContinue:_.once(this.createGroup)}))},createGroup:function(e,t,n,r){Store.Chat.createGroup(e,t,n,r),this.endFlow()},participantsBack:function(e,t,n){this.pop()}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(991),o=n(1190),a=n(1165),s=n(1082),c=n(1188),l=n(1181),u=n(1194),d=n(22),p=r.createClass({displayName:"SettingsFlow",mixins:[i],componentWillMount:function(){this.push(r.createElement(o,{profileId:Store.Conn.me,onWallpaper:this.showWallpaperDrawer,onBlocked:this.showBlockedDrawer,onProfile:this.showProfileDrawer,onNotifications:this.showNotifications,onHelp:this.showHelp,onClose:this._pop}))},showWallpaperDrawer:function(){this.push(r.createElement(u,{onClose:this._pop}))},showBlockedDrawer:function(){this.push(r.createElement(a,{onClose:this._pop}))},showProfileDrawer:function(){this.push(r.createElement(s,{id:Store.Conn.me,onClose:this._pop}))},showNotifications:function(){this.push(r.createElement(c,{onClose:this._pop}))},showHelp:function(){d.upload("help-page-opened"),this.push(r.createElement(l,{onClose:this._pop}))},_pop:function(){this.pop()}});e.exports=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n,r){this.gifId=e,this.url=t,this.nonVideoUrl=n,this.width=r,this.widthStr=r+"px",this.ratioStr=Math.ceil(100*T/r)+"%"}function o(e){var t=void 0;return t=e?b.request("https://api.giphy.com/v1/gifs/search","GET",{q:e,api_key:S,limit:100,rating:"pg-13"},"json"):b.request("https://api.giphy.com/v1/gifs/trending","GET",{api_key:S,limit:100,rating:"pg-13"},"json"),t["catch"](function(){return null}).then(function(e){return e&&e.status<300&&a(e.response)})}function a(e){if(!e||!_.isArray(e.data))return[];for(var t=e.data,n=[],r=0;r<t.length;r++){var o=t[r];if(o&&o.images){var a=o.images.fixed_height,s=o.images.fixed_width,c=void 0,l=void 0;if(s&&s.mp4){var u=parseInt(s.height,10);u===u&&u<M&&(c=s,l=M*T/u)}if(a&&a.mp4){var d=parseInt(s.width,10);d===d&&d<M&&(c=a,l=d*T/M)}c&&n.push(new i(o.id,c.mp4,E.troublesWithLotsOfVideos?c.webp||c.gif:void 0,Math.round(l)))}}return n}function s(e,t){this.gif=e,this.index=t,this.width=e.width}function c(e,t){for(var n=[],r=.9*t,i=e.map(function(e,t){return new s(e,t)}),o=null,a=.05;a<1&&i.length;a+=.05){i.sort(function(e,t){return t.width-e.width});for(var c=(1+a)*t,l=[],u=[],d=0;d<i.length;d++){for(var p=i[d],h=!1,f=Math.min(c-p.width,r),m=0;!h&&m<l.length;m++)l[m]<f&&(l[m]+=p.width+C,u[m].push(p),h=!0);h||(l.push(p.width),u.push([p]))}if(1===u.length){i=[];var g=t-l[0]-C;o={gifs:u[0],blankStr:g>0?g+"px":void 0}}else{i=[];for(var v=0;v<u.length;v++)l[v]>r?n.push(u[v]):i.push.apply(i,u[v])}}n.forEach(function(e){return e.sort(function(e,t){return e.index-t.index})}),n.sort(function(e,t){return e[0].index-t[0].index});var y=n.map(function(e){return{gifs:e,blankStr:void 0}});return o&&y.push(o),y.forEach(function(e){e.gifs=e.gifs.map(function(e){return e.gif})}),y}var l=n(2),u=r(l),d=n(6),p=n(14),h=n(974),f=n(136),m=n(81),g=n(980),v=n(29),y=n(1237),E=n(54),b=n(135),S="3o85xmWDYKgihhIKSA",M=200,T=150,C=6,w=new y(o,{maxCached:6,maxAge:36e4,shouldCache:function(e){return!(!e||!e.length)}}),x=d.createClass({displayName:"GifPreview",mixins:[g],propTypes:{gif:d.PropTypes.instanceOf(i).isRequired,onSend:d.PropTypes.func.isRequired},getInitialState:function(){return this._videoRef=null,{animate:!1,show:!1}},setVideoRef:function(e){this._videoRef=e,this.synchronizeVideo()},synchronizeVideo:function(){var e=this._videoRef;null!==e&&(this.state.animate?e.paused&&e.play():e.paused||(e.pause(),e.currentTime=0))},setShouldAnimate:function(e){this.state.animate===e&&this.state.show||this.setState({animate:e,show:!0},this.synchronizeVideo)},handleClick:function(){this.props.onSend(this.props.gif.url,h.GIF_ATTRIBUTION.GIPHY)},render:function(){var e=this.props.gif,t=null;return this.state.show&&(t=e.nonVideoUrl?d.createElement("img",{className:"gif-search-gif",onClick:this.handleClick,src:e.nonVideoUrl}):d.createElement("video",{className:"gif-search-gif",onClick:this.handleClick,controls:!1,autoPlay:this.state.animate,loop:!0,muted:!0,ref:this.setVideoRef,src:e.url})),d.createElement("div",{className:"gif-search-gif-wrapper",style:{flexBasis:e.widthStr}},d.createElement("div",{style:{width:e.widthStr}},d.createElement("div",{style:{paddingBottom:e.ratioStr}},t)))}}),N=d.createClass({displayName:"GifSearch",mixins:[g],propTypes:{onGif:d.PropTypes.func.isRequired},getInitialState:function(){return this._scrollTop=0,this._animatingRow=null,this._containerDom=null,{searchText:"",gifRows:[],width:0}},shouldComponentUpdate:function(e,t){return e.onGif!==this.props.onGif||t.gifRows!==this.state.gifRows},componentWillMount:function(){var e=this;this._searchTimer=new m(this.searchGiphy),this._animateTimer=new m(this.animateGif),this._onlineRestarter=u["default"].loop(function(){return v.waitForBBEvent(f,"change:online",function(){return f.online}).then(function(){return e.scheduleQuery()})}).cancellable(),this._onlineRestarter["catch"](u["default"].CancellationError,_.noop),this.searchGiphy()},componentWillUnmount:function(){this._animateTimer.cancel(),this._searchTimer.cancel(),this._onlineRestarter.cancel()},scheduleQuery:function(){this._searchTimer.debounceAndCap(200,2e3)},onSearchInput:function(e){this._searchText=e.target.value.trim(),this.scheduleQuery()},onScroll:function(e){this._scrollTop=e.currentTarget.scrollTop,this._animateTimer.debounce(200)},setGifAnimating:function(e,t){var n=this.refs[e];n&&n.setShouldAnimate(t)},animateGif:function(){var e=this,t=this._animatingRow,n=Math.round(this._scrollTop/(T+C)),r=this.state.gifRows[n];if(r&&r.gifs.length&&r!==t){if(this._animatingRow=r,t)for(var i=0;i<t.gifs.length;i++)this.setGifAnimating(t.gifs[i].gifId,!1);for(var o=0;o<r.gifs.length;o++)this.setGifAnimating(r.gifs[o].gifId,!0)}[n+1,n-1].forEach(function(t){if(e.state.gifRows[t])for(var n=e.state.gifRows[t].gifs,r=0;r<n.length;r++)e.setGifAnimating(n[r].gifId,!1)})},searchGiphy:function(){var e=this,t=w.getOrRun(this._searchText);t=t.then(),this._pendingQuery=t,t.checkpoint(this.rejectOnUnmount()).then(function(n){if(t===e._pendingQuery&&(e._pendingQuery=null,n)){var r=e._containerDom.clientWidth;r-=2*C,e._resetScroll=!0,e._animateTimer.debounce(0),e.setState({gifRows:c(n,r),width:r})}})["catch"](p.Unmount,u["default"].CancellationError,_.noop)},render:function(){function e(e){c=e,null!==e&&e.focus()}function t(e){e.target!==c&&(e.preventDefault(),c.focus()),e.stopPropagation()}var n=this,r=this.props.onGif,i=this.state.gifRows;this._gifPreviews={};var o=i.map(function(e,t){var n=e.gifs.map(function(e,t){return d.createElement(x,{key:e.gifId,ref:e.gifId,gif:e,display:!0,onSend:r})}),i=null;return e.blankStr&&(i=d.createElement("div",{className:"gif-search-blank",style:{flexBasis:e.blankStr}})),d.createElement("div",{key:t,className:"gif-search-row"},n,i)}),a=!!this._resetScroll,s=function(e){n._containerDom=e,null!==e&&a&&(a=!1,e.scrollTop=0)},c=null;return d.createElement("div",{className:"gif-search-container",ref:s,onScroll:this.onScroll,onMouseDown:t,onContextMenu:t},d.createElement("div",{className:"gif-search-row"},d.createElement("label",{className:"gif-search-row-input"},d.createElement("div",{className:"input-container"},d.createElement("input",{className:"input input-search",type:"text",dir:"auto",title:l10n.t("search_gifs"),placeholder:l10n.t("search_gifs"),ref:e,onMouseDown:function(e){e.stopPropagation()},onChange:this.onSearchInput})))),o)}});e.exports=N},function(e,t,n){"use strict";var r=n(6),i=n(416),o=r.createClass({displayName:"IntroPanel",componentDidMount:function(){var e=this.refs.image,t=this.refs.text;this.props.animate?(Velocity(e,{scale:[1,0],opacity:[1,0]},{delay:1340,duration:180,easing:[.05,1.02,0,1.01]}),Velocity(t,{translateY:[0,80],opacity:[1,0]},{delay:1300,duration:140,easing:[.05,1.02,0,1.01]})):(e.style.opacity=1,t.style.opacity=1)},render:function(){return r.createElement("div",{className:"pane pane-intro pane-two"},r.createElement("div",{className:"intro-body"},r.createElement("div",{ref:"image",className:"intro-image"}),r.createElement("div",{ref:"text",className:"intro-text-container"},r.createElement("h1",{"data-a8n":i.key("intro-title"),className:"intro-title"},l10n.t("intro_title")),r.createElement("div",{"data-a8n":i.key("intro-text"),className:"intro-text"},l10n.t("intro_connection")))))}});e.exports=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var n=void 0,r=void 0;return new a["default"](function(i,o){s.info("MediaAnalyzer:checkAndRepair sending file to worker")(),r=new l.WebcMediaAnalyzed,n=new c,n.onmessage=function(e){switch(e.data.type){case"log":s.info("(via Milan) "+e.data.msg)();break;case"result":i({success:!0,result:e.data.result});break;case"parsingError":i({success:!1,error:e.data.error});break;case"error":s.warn("Milan error stack: "+e.data.stack)(),o(e.data.error)}},n.onerror=function(e){o("worker.onerror = "+e)},n.postMessage({file:e,asGif:t})}).then(function(e){var t=e.success,n=e.result,r=e.error;return t?(s.log("MediaAnalyzer:checkAndRepair approved file")(),n):void s.log("MediaAnalyzer:checkAndRepair rejected file ("+r+")")()})["catch"](function(e){s.assert(!1,"media-detection-error","MediaAnalyzer:checkAndRepair got error! "+e)()})["finally"](function(t){if(n&&n.terminate(),r){var i=void 0;if(e.name){var o=e.name.split(".");o.length>1&&(i=o[o.length-1])}r.set({webcMediaSupported:!!t,webcMediaExtensions:i}),r.markWebcMediaAnalyzeT(),r.commit()}})}var o=n(2),a=r(o),s=n(1),c=n(1256),l=n(56);e.exports={checkAndRepair:i}},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(10),a=n(978),s=n(981),c=n(979),l=n(985),u=n(990),d=n(1004),p=n(129),h=n(987),f=n(134),m=n(131),g=m.HotKeys,v=r.createClass({displayName:"ArchivedDrawer",mixins:[p],getInitialState:function(){this.selection=new h([],function(e){return e.id})},componentDidMount:function(){this.addObserver(Store.Chat,"change:archive add remove"),this.refs.list&&f.focus(i.findDOMNode(this.refs.list))},onClick:function(e,t){o.openChat(t),this.onClose()},onClose:function(){o.closeDrawerLeft()},getList:function(){return Store.Chat.filter("archive")},onNextChat:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setNext()},onPrevChat:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setPrev()},render:function(){var e=this,t=void 0,n=this.getList();if(this.selection.init(n,!0),n.length>0){var i=n.map(function(t){return r.createElement(d,{chat:t,mode:d.Mode.LAST,key:t.id,active:e.selection,onClick:e.onClick})}),o={down:this.onNextChat,up:this.onPrevChat
};t=r.createElement(g,{handlers:o,ref:"list",className:"drawer-section-main chatlist","data-list-scroll-container":!0},r.createElement(l,{data:i,height:l.DEFAULT_HEIGHT,extraItems:4}))}else t=r.createElement(u.Archived,null);return r.createElement(a,{id:"blocked",onCancel:this.onClose},r.createElement(s,{title:l10n.t("archived_flow_title"),onBack:this.onClose,type:s.Type.LARGE}),r.createElement(c,null,t))}});e.exports=v},function(e,t,n){"use strict";var r=n(6),i=n(10),o=n(978),a=n(981),s=n(979),c=n(985),l=n(990),u=n(992),d=n(410),p=n(129),h=n(1029),f=r.createClass({displayName:"BlockedDrawer",mixins:[p],propTypes:{onClose:r.PropTypes.func},componentWillMount:function(){this.addObserver(Store.Blocklist,"add remove")},onBlockConfirm:function(e){e.setBlock(!0)["catch"](_.noop),i.closeModal()},onBlock:function(e){var t=function(e){return!!Store.Contact.isFilteredContact(e)&&(!Store.Blocklist.get(e.id)||l10n.t("participant_already_blocked"))};i.openModal(r.createElement(h,{title:l10n.t("add_blocked_title"),filter:t,onCancel:i.closeModal.bind(i),onSelect:_.once(this.onBlockConfirm)}))},onUnblockConfirm:function(e){e.setBlock(!1)["catch"](_.noop),i.closeModal()},onUnblockCancel:function(){i.closeModal()},onUnblock:function(e,t){i.openModal(r.createElement(d,{okText:l10n.t("unblock_button"),onOK:this.onUnblockConfirm.bind(this,t),cancelText:l10n.t("web_cancel"),onCancel:this.onUnblockCancel},l10n.t("unblock_confirmation",{contact:t.formattedName})))},render:function(){var e=this,t=void 0,n=void 0;if(Store.Blocklist.length>0){var i=Store.Blocklist.map(function(t){return r.createElement(u,{contact:t.contact,key:t.contact.id,onClick:e.onUnblock,onDelete:e.onUnblock})});t=r.createElement("div",{className:"drawer-section-main chatlist","data-list-scroll-container":!0},r.createElement(c,{data:i,height:c.DEFAULT_HEIGHT,extraItems:4})),n=r.createElement("div",{className:"hint"},l10n.t("add_blocked_description"))}else t=r.createElement(l.Blocked,null);return r.createElement(o,{id:"blocked",onCancel:this.props.onClose},r.createElement(a,{title:l10n.t("blocked_flow_title"),onBack:this.props.onClose,type:a.Type.LARGE}),r.createElement(s,null,r.createElement("div",{className:"list-action",onClick:this.onBlock},r.createElement("div",{className:"list-action-icon"},r.createElement("span",{className:"icon icon-add-user"})),r.createElement("div",{className:"list-action-body"},l10n.t("add_blocked_title"))),t,n))}});e.exports=f},function(e,t,n){"use strict";var r=n(6),i=n(975),o=n(129),a=n(10),s=n(977),c=n(196),l=n(1031),u=n(985),d=n(992),p=n(978),h=n(979),f=n(995),m=n(982),g=n(1034),v=n(1009),y=r.createClass({displayName:"BroadcastInfoDrawer",mixins:[i,o],propTypes:{chat:r.PropTypes.instanceOf(s).isRequired},getInitialState:function(){return{everyoneEncrypted:this.async("chat.contact.plaintextDisabled")}},componentWillMount:function(){var e=this.props.chat.groupMetadata;this.addObserver(e.participants,"add remove sort reset")},onParticipantClick:function(e,t){Store.Conn.me!==t.id&&Store.Chat.find(t.id).then(function(e){a.openChat(e)})},onClose:function(){this.props.onClose?this.props.onClose():a.closeDrawerRight()},onDelete:function(){a.deleteOrExitChat(this.props.chat)},onViewPicture:function(e){var t=e.target,n=function(e){e(t)};a.openModalMedia(r.createElement(l,{contact:this.props.chat.contact,animateBorderRadius:!0,getZoomNode:n}),"profile-viewer")},render:function(){var e=this.props.chat,t=e.groupMetadata,n=this.onParticipantClick,i=t.participants.map(function(e){var t=Store.Contact.get(e.id)||Store.Contact.add({id:e.id});return r.createElement(d,{contact:t,admin:!!e.isAdmin,onClick:n,key:e.id})}),o=24,a=g.minHeight(i,o),s=null;if(this.props.onMediaGallery){var l=r.createElement("span",{className:"icon icon-chevron-right-alt"});s=r.createElement(f,{title:l10n.t("media"),titleOnClick:this.props.onMediaGallery,subtitle:l,classes:"animate-enter2",noContainer:!0},r.createElement(v,{chat:e}))}var y,_=null,E=i.length?r.createElement(f,{classes:"animate-enter1",title:l10n.t("web_recipients_title"),subtitle:l10n.n(i.length),style:a,expands:!0,"data-list-scroll-container":!0},r.createElement(u,{data:i,height:72,extraItems:4})):null;e.canDelete()&&(y=r.createElement(f,{classes:"animate-enter3 drawer-section-action"},r.createElement("div",{onClick:this.onDelete,className:"btn btn-danger"},l10n.t("web_delete_list"))));var b;e.groupMetadata.creation?(b=c.timeStr(e.groupMetadata.creation),b=r.createElement("div",{className:"header-secondary"},l10n.t("web_group_creation_time",{when:b}))):b=null;var S=null;return r.createElement(p,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},r.createElement("header",{className:"pane-header"},r.createElement("div",{className:"header-close"},r.createElement("button",{onClick:this.onClose},r.createElement("span",{className:"icon icon-x"}))),r.createElement("div",{className:"header-body"},r.createElement("div",{className:"header-main"},r.createElement("div",{className:"header-title"},l10n.t("broadcast_list_info")),b))),r.createElement(h,{expands:!!i.length,editable:!0},r.createElement(f,{classes:"drawer-scale drawer-section-photo"},r.createElement(m,{id:e.id,size:m.Size.LARGE,onClick:this.onViewPicture})),s,_,S,E,y))}});e.exports=y},function(e,t,n){"use strict";var r=n(6),i=n(1030),o=n(1078),a=n(10),s=r.createClass({displayName:"CaptureModal",propTypes:{onSend:r.PropTypes.func.isRequired,stream:r.PropTypes.object.isRequired},onCancel:function(){a.closeModal()},onSend:function(e){this.props.onSend(e.file),this.onCancel()},render:function(){return r.createElement(i,{type:i.BOX},r.createElement(o,{onBack:this.onCancel,caption:!1,onSend:this.onSend,stream:this.props.stream,noContainer:!0}))}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(1030),a=n(10),s=n(978),c=n(981),l=n(979),u=n(102),d=n(1005),p=n(1004),h=n(992),f=n(985),m=n(990),g=n(987),v=n(134),y=n(131),E=y.HotKeys,b=n(43),S={RECENT:"recent",GROUPS:"groups",CONTACTS:"contacts"},M=r.createClass({displayName:"ChatModal",propTypes:{title:r.PropTypes.string,onChat:r.PropTypes.func.isRequired,selectedTab:r.PropTypes.oneOf(_.values(S)),onSelectTab:r.PropTypes.func},getInitialState:function(){return{searchText:"",selected:this.props.selectedTab||S.RECENT}},componentWillMount:function(){this.selection=new g(this.getData(),function(e){return e.id})},onSelectTab:function(e){var t=this,n=_.values(S).indexOf(this.state.selected),r=_.values(S).indexOf(e),i=r>n?"right":"left";this.tabSelected=!0,this.setState({searchText:"",selected:e,direction:i},function(){delete t.tabSelected}),this.props.onSelectTab&&this.props.onSelectTab(e)},getFilteredChats:function(){var e=this.state.searchText;return e?(e=l10n.accentFold(e),Store.Chat.filter(function(t){return t.canSend&&!t.isNewlyCreated()&&t.contact.searchMatch(e)})):Store.Chat.filter(function(e){return e.canSend&&!e.isNewlyCreated()})},getFilteredGroups:function(){var e=this.state.searchText;return e?(e=l10n.accentFold(e),Store.Chat.filter(function(t){return t.isGroup&&t.canSend&&!t.isNewlyCreated()&&t.contact.searchMatch(e)})):Store.Chat.filter(function(e){return e.isGroup&&e.canSend&&!e.isNewlyCreated()})},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},getData:function(){switch(this.state.selected){case S.CONTACTS:return this.getFilteredContacts();case S.GROUPS:return this.getFilteredGroups();case S.RECENT:return this.getFilteredChats()}},getList:function(){var e,t=this;switch(this.state.selected){case S.CONTACTS:e=this.getFilteredContacts(),e=e.map(function(e){return r.createElement(h,{active:t.selection,contact:e,onClick:t.forwardToContact,secondary:e.isBlocked()?l10n.t("confirm_unblock_contact_and_forward_text"):null,key:e.id})});break;case S.GROUPS:e=this.getFilteredGroups(),e=e.map(function(e){return r.createElement(p,{active:t.selection,chat:e,mode:p.Mode.INFO,noContext:!0,onClick:t.forwardToChat,key:e.id})});break;case S.RECENT:e=this.getFilteredChats(),e=e.map(function(e){return e.isGroup?r.createElement(p,{active:t.selection,chat:e,mode:p.Mode.INFO,noContext:!0,onClick:t.forwardToChat,key:e.id}):r.createElement(h,{active:t.selection,contact:e.contact,onClick:t.forwardToContact,secondary:e.contact.isBlocked()?l10n.t("confirm_unblock_contact_and_forward_text"):null,key:e.id})})}return 0===e.length?null:r.createElement(f,{data:e,ref:"list",scrollTop:this.tabSelected?0:void 0,height:72,extraItems:4})},getTabs:function(){var e=this;return[{tab:S.RECENT,title:l10n.t("web_recent_chats")},{tab:S.GROUPS,title:l10n.t("web_groups")},{tab:S.CONTACTS,title:l10n.t("web_contacts")}].map(function(t){var n=b("menu-item",{active:e.state.selected===t.tab});return r.createElement("button",{className:n,onClick:e.onSelectTab.bind(null,t.tab),key:t.tab,title:t.title},t.title)})},forwardToContact:function(e,t){Store.Chat.find(t.id).then(this.forwardToChat.bind(this,e))},forwardToChat:function(e,t){this.props.onChat(t)},onSearch:function(e){this.setState({searchText:e})},onStopSearch:function(){this.setState({searchText:""})},onCancel:function(){a.closeModal()},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.head(this.getData());t&&this.forwardToContact(e,t)},onFocusList:function(e){e.preventDefault(),e.stopPropagation(),E.flashFocus=Date.now(),this.selection.setFirst()},indicateSearchFocus:function(e){if(this.selection.unset(),!(Date.now()-(E.flashFocus||0)>200)){var t=i.findDOMNode(this.refs.search);Velocity(t,"stop"),Velocity(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},onListFocus:function(e){e.target===i.findDOMNode(this.refs.list)&&(this.selection.index<0?this.selection.setFirst():this.selection.reset())},onNext:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setNext()},onPrev:function(e){e.stopPropagation(),e.preventDefault();var t=this.selection.prev();t>-1?this.selection.setPrev():(this.selection.unset(),E.flashFocus=Date.now(),v.focus(this.refs.search))},render:function(){var e=this.getList();if(this.selection.init(this.getData()),!e)if(this.state.searchText)e=r.createElement(m.Search,null);else switch(this.state.selected){case S.CONTACTS:e=r.createElement(m.ListContacts,null);break;case S.GROUPS:e=r.createElement(m.ListGroups,null);break;case S.RECENT:e=r.createElement(m.ListChats,null)}var t,n="right"===this.state.direction?"slide-forward":"slide-back",i={down:this.onFocusList,enter:this.onSelectFirst},a={down:this.onNext,up:this.onPrev};switch(this.state.selected){case S.CONTACTS:t=l10n.t("search_contacts");break;case S.GROUPS:t=l10n.t("search_groups");break;case S.RECENT:t=l10n.t("search_chats");break;default:t=l10n.t("search")}return r.createElement(o,{type:o.TOWER},r.createElement(s,{key:"chat-modal",onCancel:this.onCancel},r.createElement(c,{title:this.props.title,type:c.Type.POPUP,onCancel:this.onCancel}),r.createElement("div",{className:"menu-tabs menu-tabs-lists","data-active-tab":this.state.selected},this.getTabs()),r.createElement(E,{handlers:i,onFocus:this.indicateSearchFocus},r.createElement(d,{ref:"search",onSearch:this.onSearch,key:this.state.selected,placeholder:t})),r.createElement(l,{"data-list-scroll-container":!0},r.createElement(u,{transitionName:n,className:"column"},r.createElement(E,{handlers:a,onFocus:this.onListFocus,"data-tab":3,className:"column",ref:"list",key:this.state.selected},r.createElement("div",{className:"chatlist column"},e))))))}});e.exports=M},function(e,t,n){"use strict";var r=n(6),i=n(416),o=n(977),a=n(10),s=n(101),c=n(1024),l=n(976),u=n(410),d=r.createClass({displayName:"ClearChatPopup",propTypes:{onCancel:r.PropTypes.func,onDeleteOrExit:r.PropTypes.func,chat:r.PropTypes.instanceOf(o).isRequired},getInitialState:function(){return{keepStarred:!0}},getText:function(){var e=this.props.chat;switch(e.kind){case o.KIND.GROUP:return l10n.t("clear_chat_group",{name:e.formattedTitle});case o.KIND.CHAT:return l10n.t("clear_chat_chat",{name:e.formattedTitle});case o.KIND.BROADCAST:return l10n.t("clear_chat_broadcast");default:return""}},onCancel:function(){a.closeModal()},onClear:function(){var e=this.props.chat;e.pendingAction++,e.sendClear(s.supportsFeature(s.F.STARRED)&&s.supportsFeature(s.F.CHAT_CLEAR_STARRED)&&this.state.keepStarred)["finally"](function(){e.pendingAction--}),a.closeModal()},onToggleStarred:function(){this.setState({keepStarred:!this.state.keepStarred})},render:function(){var e=void 0;return s.supportsFeature(s.F.STARRED)&&s.supportsFeature(s.F.CHAT_CLEAR_STARRED)&&(e=r.createElement("div",{className:"controls-section",onClick:this.onToggleStarred},r.createElement("div",{"data-a8n":i.key("menu-icon-clear-chat"),className:"control"},r.createElement(c,{onChange:this.onToggleStarred,checked:this.state.keepStarred})),r.createElement("div",{className:"label"},l10n.t("keep_starred")))),r.createElement(u,{title:l10n.t("are_you_sure"),onOK:this.onClear,okText:l10n.t("clear_button"),onCancel:this.onCancel},r.createElement("div",null,r.createElement(l,{text:this.getText()}),e))}});e.exports=d},function(e,t,n){"use strict";var r=n(6),i=n(978),o=n(981),a=n(979),s=n(1054),c=n(1005),l=n(133),u=n(134),d=n(131),p=d.HotKeys,h=r.createClass({displayName:"ContactDrawer",mixins:[l],propTypes:{onBack:r.PropTypes.func.isRequired,onClick:r.PropTypes.func.isRequired},getInitialState:function(){return{searchText:"",cancelSearch:!1,active:!1}},componentDidMount:function(){var e=this;this.safeDefer(function(){e.setState({active:!0})})},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},onSearch:function(e){this.setState({searchText:e})},onFocusList:function(e){this.refs.list&&(e.preventDefault(),e.stopPropagation(),p.flashFocus=Date.now(),this.refs.list.focusFirst())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.head(this.getFilteredContacts());t&&(p.flashFocus=Date.now(),this.props.onClick(e,t))},onFocusSearch:function(e){p.flashFocus=Date.now(),u.focus(this.refs.search)},render:function(){var e=this.state.active?r.createElement(s,{ref:"list",contacts:this.getFilteredContacts(),onFocusSearch:this.onFocusSearch,onClick:this.props.onClick}):null,t={down:this.onFocusList,enter:this.onSelectFirst};return r.createElement(i,{key:"contact-modal",onCancel:this.props.onBack},r.createElement(o,{title:this.props.title,type:o.Type.LARGE,onBack:this.props.onBack}),r.createElement(p,{handlers:t},r.createElement(c,{ref:"search",isSearching:!this.state.cancelSearch,onSearch:this.onSearch,placeholder:l10n.t("search_contacts")})),r.createElement(a,{"data-list-scroll-container":!0},e))}});e.exports=h},function(e,t,n){"use strict";var r=n(6),i=n(975),o=n(133),a=n(980),s=n(129),c=n(10),l=n(985),u=n(1),d=n(1031),p=n(1004),h=n(1009),f=n(978),m=n(979),g=n(995),v=n(982),y=n(1058),E=n(976),b=n(14),S=n(200),M=n(1034),T=n(21),C=n(101),w=r.createClass({displayName:"ContactInfoDrawer",mixins:[i,o,a,s],propTypes:{contact:r.PropTypes.instanceOf(S).isRequired,onVerification:r.PropTypes.func},getInitialState:function(){return this.asyncState({status:"contact.Status.status",encryptionStatus:"contact.plaintextDisabled"},{commonGroups:void 0})},componentDidMount:function(){this.safeDelay(function(){var e=this;this.props.contact.findCommonGroups().checkpoint(this.rejectOnUnmount()).then(function(t){e.setState({commonGroups:t}),e.addObserver(Store.GroupMetadata,"group_participant_change",e.commonGroupsUpdate)})["catch"](b.Unmount,_.noop)["catch"](b.WapDrop,_.noop)["catch"](_.noop)},300),C.supportsFeature(C.F.QUERY_IDENTITY)&&this.props.contact.queryIdentity()["catch"](function(e){u.error("contactInfoDrawer:queryIdentity error: "+e)()})},commonGroupsUpdate:function(e){var t=this.state.commonGroups,n=this.props.contact.updateCommonGroups(t,e);n&&this.setState({commonGroups:n})},onDeleteChat:function(){var e=Store.Chat.get(this.props.contact.id);c.deleteOrExitChat(e)},onClose:function(){this.props.onClose?this.props.onClose():c.closeDrawerRight()},parseSelection:function(e){for(var t,n,r="",i=0;i<e.rangeCount;i++)for(n=document.createTreeWalker(e.getRangeAt(i).cloneContents(),window.NodeFilter.SHOW_ALL);n.nextNode();)t=n.currentNode,t instanceof HTMLImageElement?r+=t.alt:t.nodeType===Node.TEXT_NODE&&(r+=t.nodeValue?t.nodeValue:"");return r},onCopyPhone:function(e){var t=this.parseSelection(window.getSelection()),n="​",r="⁠",i=""+n+r+n;if(_.startsWith(t,i)){var o=t.match(new RegExp("^"+i+"(.*?)"+i));o&&o.length>1&&(t=_.last(o))}t=t.replace(new RegExp(""+i),""),e.clipboardData.setData("text/plain",t),e.stopPropagation(),e.preventDefault()},onViewPicture:function(e){if(this.canViewPicture){var t=e.target,n=function(e){e(t)};c.openModalMedia(r.createElement(d,{contact:this.props.contact,animateBorderRadius:!0,getZoomNode:n}),"profile-viewer")}},onDetailImageLoad:function(e){this.canViewPicture=!0},onClick:function(e,t){c.openChat(t),this.onClose()},render:function(){var e,t,n=this,i=this.props.contact,o=this.state.commonGroups;if(o=_.compact(_.values(o)),_.isArray(o)&&o.length){e=o.map(function(e){return r.createElement(p,{chat:e,mode:p.Mode.INFO,onClick:n.onClick,key:e.id})});var a=24,s=M.minHeight(o,a);e=r.createElement(g,{title:l10n.t("web_groups_participation_you_and_name"),subtitle:l10n.n(o.length),classes:"animate-enter drawer-section-list",ref:"container",style:s,expands:!0,noContainer:!0},r.createElement("div",{className:"drawer-section-body drawer-section-body-expand chatlist",ref:"list","data-list-scroll-container":!0},r.createElement(l,{data:e,height:72,extraItems:4})))}var c=Store.Chat.get(i.id);_.isArray(o)&&c&&c.canDelete()&&(t=r.createElement(g,{classes:"animate-enter drawer-section-action"},r.createElement("div",{onClick:this.onDeleteChat,className:"btn btn-danger"},l10n.t("delete_chat"))));var u=this.state.status?r.createElement(g,{title:l10n.t("web_status"),classes:"animate-enter1"},r.createElement(E,{classes:"textfield-static",selectable:!0,direction:"auto",text:this.state.status})):null,d=null,b=null,S=null;if(this.props.onMediaGallery){var C=r.createElement("span",{className:"icon icon-chevron-right-alt"});S=r.createElement(g,{title:l10n.t("media"),titleOnClick:this.props.onMediaGallery,subtitle:C,classes:"animate-enter2",noContainer:!0},r.createElement(h,{chat:c}))}var w=null;return r.createElement(f,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},r.createElement("header",{className:"pane-header"},r.createElement("div",{className:"header-close"},r.createElement("button",{onClick:this.onClose},r.createElement("span",{className:"icon icon-x"}))),r.createElement("div",{className:"header-body"},r.createElement("div",{className:"header-main"},r.createElement("div",{className:"header-title"},l10n.t("web_contact_info"))))),r.createElement(m,{editable:!0},r.createElement(g,{classes:"drawer-scale drawer-section-photo"},r.createElement(v,{id:i.id,size:v.Size.LARGE,loader:!0,onLoad:this.onDetailImageLoad,onClick:this.onViewPicture,quality:v.Quality.HIGH})),S,b,d,u,w,r.createElement(g,{title:l10n.t("web_contact_phone"),classes:"animate-enter2"},r.createElement(y,{className:"textfield-static selectable-text",onCopy:this.onCopyPhone,dir:"auto"},T.formattedUser(i.id))),e,t))}});e.exports=w},function(e,t,n){"use strict";var r=n(6),i=n(10),o=n(975),a=n(129),s=n(980),c=n(978),l=n(981),u=n(979),d=n(995),p=n(1106),h=n(1013),f=n(132),m=n(413),g=n(974),v=n(14),y=n(43),E=n(8),b=r.createClass({displayName:"ContactMsgInfoDrawer",mixins:[o,a,s],propTypes:{msg:r.PropTypes.instanceOf(g)},getInitialState:function(){return{msgInfo:void 0,star:this.async("msg.star")}},componentWillMount:function(){var e=this;Store.MsgInfo.find(this.props.msg.id).checkpoint(this.rejectOnUnmount()).then(function(t){e.setState({msgInfo:t}),e.addObserver(t,"change:playedRemaining change:readRemaining change:deliveryRemaining")})["catch"](v.Unmount,_.noop)["catch"](function(){e.setState({unimplemented:!0}),i.openToast(r.createElement(m,{msg:l10n.t("msg_info_failed"),id:m.genId("msg_info_failed")}))})},componentDidMount:function(){if(this.props.msg.type===g.TYPE.IMAGE&&(this.refs.scrollable.scrollTop=this.refs.scrollable.scrollHeight),this.props.msg.isGif){var e=this.getMsgComponent();e.play()}},isMsgVisible:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];return e===this.props.msg.id&&(!!t||this.getMsgComponent())},getMsgComponent:function(){var e=this.refs.wrapper;if(e)return e.refs.component},onClose:function(){i.closeDrawerRight()},render:function(){var e=this.props.msg,t=this.state,n=t.msgInfo,i=t.star,o=t.unimplemented,a=void 0,s=void 0;if(n){var m=[],v=void 0,_=void 0,b=void 0;n.isPTT&&(s=l10n.t("message_info_seen"),v=n.played.head(),_=v&&v.t,b=r.createElement("span",{className:"icon icon-status icon-status-ptt-blue"}),m.push(r.createElement(p,{title:l10n.t("message_info_played"),t:_,icon:b,key:"played"}))),v=n.read.head(),_=v&&v.t,b=r.createElement("span",{className:"icon icon-status icon-status-dblcheck-ack"}),s=s||l10n.t("message_info_read"),m.push(r.createElement(p,{title:s,t:_,icon:b,key:"read"})),v=n.delivery.head(),_=v&&v.t,b=r.createElement("span",{className:"icon icon-status icon-status-dblcheck"}),m.push(r.createElement(p,{title:l10n.t("message_info_delivered"),t:_,icon:b,key:"delivery"})),a=r.createElement(d,{classes:"drawer-section-info well animate-enter"},m)}var S=void 0;n||o||(S=r.createElement(d,{classes:"drawer-section-spinner",key:"spinner"},r.createElement(f,{size:50,stroke:4})));var M=y("pane-preview-wrapper","pane-preview-wrapper-bg",{"pane-preview-resize":e.type===g.TYPE.PTT||e.type===g.TYPE.IMAGE||e.type===g.TYPE.LOCATION||e.type===g.TYPE.VCARD||e.isGif});return r.createElement(c,{key:"message-info-modal",id:"info",variant:"panel",onCancel:this.onClose},r.createElement(l,{title:l10n.t("message_info"),type:l.Type.SMALL,onCancel:this.onClose}),r.createElement("div",{className:M,ref:"scrollable"},r.createElement("div",{className:"pane-preview"},r.createElement("div",{className:"pane-chat-tile"}),r.createElement(h,{msg:e,key:"star-"+i.toString(),ref:"wrapper",displayType:E.DISP_TYPE.MSG_INFO,isMsgVisible:this.isMsgVisible,position:h.Position.END}))),r.createElement(u,{classes:"drawer-body-msg-info",editable:!0},S,a))}});e.exports=b},function(e,t,n){"use strict";var r=n(6),i=n(416),o=n(1),a=n(977),s=n(10),c=n(975),l=n(976),u=r.createClass({displayName:"DeleteChatPopup",mixins:[c],propTypes:{onCancel:r.PropTypes.func,onDeleteOrExit:r.PropTypes.func,chat:r.PropTypes.instanceOf(a).isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},getText:function(){var e=this.props.chat,t=e.formattedTitle;return e.isGroup?this.state.isReadOnly?l10n.t("web_delete_group_dialog_title",{groupName:t}):l10n.t("web_exit_group_dialog_title",{groupName:t}):e.isUser?l10n.t("delete_chat_dialog_title",{name:t}):e.isBroadcast?l10n.t("delete_list_dialog_title"):void 0},getButton:function(){var e=this.props.chat;return e.isGroup?this.state.isReadOnly?l10n.t("web_delete"):l10n.t("web_exit"):e.isUser||e.isBroadcast?l10n.t("web_delete"):void 0},onCancel:function(){s.closeModal(),_.isFunction(this.props.onCancel)&&this.props.onCancel()},onDelete:function(){var e,t=this.props.chat;t.isGroup?e=this.state.isReadOnly?t.sendDelete():t.sendExit():t.isUser||t.isBroadcast?e=t.sendDelete():o.error("deleteChatPopup:onDelete Unsupported chat type")(),_.isFunction(this.props.onDeleteOrExit)&&e&&this.props.onDeleteOrExit(e),s.closeModal()},render:function(){return r.createElement("div",{className:"backdrop"},r.createElement("div",{className:"popup-container"},r.createElement("div",{className:"popup"},r.createElement("div",{className:"popup-body"},r.createElement("div",{className:"popup-title"},l10n.t("are_you_sure")),r.createElement("div",{className:"popup-contents"},r.createElement(l,{text:this.getText()}))),r.createElement("div",{className:"popup-controls"},r.createElement("button",{"data-a8n":i.key("cancel-btn"),className:"btn-plain popup-controls-item",onClick:this.onCancel},l10n.t("web_cancel")),r.createElement("button",{"data-a8n":i.key("delete-btn"),className:"btn-plain btn-default popup-controls-item",onClick:this.onDelete},this.getButton())))))}});e.exports=u},function(e,t,n){"use strict";var r=n(6),i=n(416),o=n(1),a=n(10),s=n(1024),c=n(413),l=n(43),u=n(0),d={title:0,hour:1,day:24,week:168},p=r.createClass({displayName:"DoNotDisturbSettings",getInitialState:function(){return{notifications:Store.Mute.getGlobalNotifications(),sounds:Store.Mute.getGlobalSounds(),previews:Store.Mute.getGlobalPreviews(),dnd:d.title}},componentWillUnmount:function(){this.state.dnd!==d.title&&a.openToast(r.createElement(c,{msg:this.globalMuteDurationLabel(this.state.dnd),id:c.genId()}))},globalMuteDurationLabel:function(e){switch(this.state.dnd){case 1:return l10n.t("global_muted_1hour");case 24:return l10n.t("global_muted_1day");case 168:return l10n.t("global_muted_1week");default:return o.log("DoNotDisturbSettings:globalMuteDurationLabel non standard global mute duration:"+e)(),l10n.t("global_muted")}},onSounds:function(){var e=!this.state.sounds;this.setState({sounds:e}),Store.Mute.setGlobalSounds(e)},onNotifications:function(){var e=!this.state.notifications;this.setState({notifications:e}),Store.Mute.setGlobalNotifications(e)},onPreviews:function(){var e=!this.state.previews;this.setState({previews:e}),Store.Mute.setGlobalPreviews(e)},onDND:function(e){var t=parseInt(e.target.value,10);if(0===t)return this.setState({dnd:d.title}),void Store.Mute.globalMute().unmute();this.setState({dnd:t});var n=u().unix()+60*e.target.value*60;Store.Mute.globalMute().mute(n)},onClose:function(e){a.closeModal()},render:function(){var e=[];if(window.Notification){e.push(r.createElement("div",{className:"controls-section",onClick:this.onNotifications,key:0},r.createElement("div",{"data-a8n":i.key("menu-icon-notifications"),className:"control"},r.createElement(s,{onChange:this.onNotifications,checked:this.state.notifications})),r.createElement("div",{className:"label"},l10n.t("option_desktop_notifications"))));var t=l("controls-section",{disabled:!this.state.notifications});e.push(r.createElement("div",{className:t,onClick:this.onPreviews,key:1},r.createElement("div",{"data-a8n":i.key("menu-icon-notifications"),className:"control"},r.createElement(s,{onChange:this.onPreviews,checked:this.state.previews})),r.createElement("div",{className:"label"},l10n.t("option_msg_previews"),r.createElement("div",{className:"hint"},l10n.t("option_msg_previews_hint_text")))))}return r.createElement("div",{className:"controls-container drawer-section"},r.createElement("div",{className:"controls-section",onClick:this.onSounds},r.createElement("div",{"data-a8n":i.key("menu-icon-notifications"),className:"control"},r.createElement(s,{onChange:this.onSounds,checked:this.state.sounds})),r.createElement("div",{className:"label"},l10n.t("option_sounds"))),e,r.createElement("div",{className:"controls-section controls-section-wide"},r.createElement("div",{className:"select"},r.createElement("select",{value:this.state.dnd,onChange:this.onDND},r.createElement("option",{value:d.title,disabled:this.state.state===d.title},l10n.t("option_select_mute")),r.createElement("option",{value:d.hour,disabled:this.state.state===d.hour},l10n.t("mute_1hour")),r.createElement("option",{value:d.day,disabled:this.state.state===d.day},l10n.t("mute_1day")),r.createElement("option",{value:d.week,disabled:this.state.state===d.week},l10n.t("mute_1week"))))))}});e.exports=p},function(e,t,n){"use strict";var r=n(6),i=n(43),o=r.createClass({displayName:"DrawerSectionFooter",propTypes:{children:r.PropTypes.node.isRequired,separator:r.PropTypes.bool},getDefaultProps:function(){return{separator:!0}},render:function(){var e=i("drawer-section-footer",{separator:this.props.separator});return r.createElement("div",{className:e},r.createElement("div",{className:"col-main"},this.props.children))}});e.exports=o},function(e,t,n){"use strict";var r=n(6),i=n(10),o=n(8),a=n(80),s=n(21),c=n(410),l=n(63),u=r.createClass({displayName:"E2EInfoModal",propTypes:{e2eSubtype:r.PropTypes.string.isRequired,jid:r.PropTypes.string,chatId:r.PropTypes.string,unencryptedContact:r.PropTypes.string},onLearnMore:function(){var e;switch(this.props.e2eSubtype){case"info_encrypted":case"info_unencrypted":e=o.E2E_FAQ_LINK;break;case"identity":e=o.CODE_CHANGE_FAQ_LINK;break;case"encrypt":default:e=o.SECURITY_LINK}var t=a.build(e,{lg:Store.Conn.lg,lc:Store.Conn.lc});window.open(t,"_blank")},onVerificationClick:function(){i.closeModal(),i.verificationDrawer(this.props.jid)},render:function(){var e,t=null,n=null,o=i.closeModal.bind(i),a=l10n.t("web_ok");switch(this.props.e2eSubtype){case"info_encrypted":s.isGroup(this.props.chatId)?e=l10n.t("web_group_info_encrypted_description"):s.isBroadcast(this.props.chatId)&&(e=l10n.t("web_broadcast_info_encrypted_description"));break;case"info_unencrypted":e=s.isGroup(this.props.chatId)?l10n.t("web_group_info_unencrypted_description"):s.isBroadcast(this.props.chatId)?l10n.t("web_broadcast_info_unencrypted_description"):l10n.t("web_contact_info_unencrypted_description",{contact:this.props.unencryptedContact});break;case"identity":var l=Store.Contact.get(this.props.jid),u=l?l.formattedName:"";e=l10n.t("web_security_code_change_description",{name:u}),t=o,n=a,o=this.onVerificationClick,a=l10n.t("web_verify_button");break;case"encrypt":default:e=s.isGroup(this.props.chatId)?l10n.t("web_group_encryption_state_change_description"):s.isBroadcast(this.props.chatId)?l10n.t("web_broadcast_encryption_state_change_description"):l10n.t("web_individual_chat_encryption_state_change_description")}var d=r.createElement("span",{className:"action",onClick:this.onLearnMore},l10n.t("learn_more"));return r.createElement(c,{onOK:o,okText:a,onCancel:t,cancelText:n},e," ",d)}});u.contextTypes={uim:r.PropTypes.instanceOf(l)},e.exports=u},function(e,t,n){"use strict";var r=n(6),i=n(975),o=n(129),a=n(10),s=n(977),c=n(196),l=n(985),u=n(992),d=n(1009),p=n(978),h=n(979),f=n(995),m=n(1025),g=n(976),v=n(983),y=n(410),_=n(1156),E=n(413),b=n(984),S=n(998),M=n(999),T=n(197),C=n(8),w=E.genId("max_participant_toast"),x=r.createClass({displayName:"GroupInfoDrawer",mixins:[i,o],propTypes:{chat:r.PropTypes.instanceOf(s).isRequired},getInitialState:function(){return{imgFull:this.async("chat.ProfilePicThumb.imgFull"),name:this.async("chat.contact.name")||"",isReadOnly:this.async("chat.isReadOnly"),pendingSubject:!1,pendingPhoto:!1,everyoneEncrypted:this.async("chat.contact.plaintextDisabled"),contextMenu:!1}},componentWillMount:function(){var e=this.props.chat.groupMetadata;this.addObserver(e.participants,"add remove reset sort change:isAdmin")},onImageSet:function(e,t){var n=Store.ProfilePicThumb.get(this.props.chat.id);this.setState({pendingPhoto:!0});var r;r=e&&t?n.setPicture(e,t):n.deletePicture(),r.bind(this).then(function(){this.isMounted()&&this.setState({pendingPhoto:!1})})},onParticipantClick:function(e,t){Store.Conn.me!==t.id&&Store.Chat.find(t.id).then(function(e){a.openChat(e)})},menuEnabled:function(e){var t=this.props.chat.groupMetadata.participants,n=t.get(e.id);return n&&(t.canPromote(n)||t.canRemove(n)||t.canVerifyIdentity(n))},onParticipantMenu:function(e,t){var n=this.props.chat.groupMetadata.participants,i=n.get(t.id);if(this.menuEnabled(t)){var o=[];if(n.canPromote(i)){var a=this.confirmParticipantPromote.bind(this,i);o.push(r.createElement(v,{key:"promote",action:a},l10n.t("menuitem_make_group_admin")))}if(n.canRemove(i)){var s=this.confirmParticipantRemove.bind(this,i);o.push(r.createElement(v,{key:"remove",action:s,shortcut:"d"},l10n.t("menuitem_remove")))}e.event&&e.event.persist(),this.setState({contextMenu:{contactId:t.id,menu:o,anchor:e.anchor,event:e.event}})}},contextClose:function(){this.setState({contextMenu:!1})},confirmParticipantRemove:function(e){var t=this.onParticipantRemove.bind(this,e),n=l10n.t("confirm_remove_group_participant",{
participant:e.contact.formattedName,subject:this.props.chat.contact.name});a.openModal(r.createElement(y,{onOK:t,okText:l10n.t("remove"),onCancel:a.closeModal.bind(a),cancelText:l10n.t("web_cancel")},r.createElement(g,{text:n})))},onParticipantRemove:function(e){e.contact.pendingAction++,this.props.chat.groupMetadata.participants.removeParticipant(e).then(function(){e.contact.pendingAction--}),a.closeModal()},confirmParticipantPromote:function(e){var t=this.onParticipantPromote.bind(this,e),n=l10n.t("confirm_promote_group_participant",{participant:e.contact.formattedName,subject:this.props.chat.contact.name});a.openModal(r.createElement(y,{onOK:t,okText:l10n.t("menuitem_make_group_admin"),onCancel:a.closeModal.bind(a),cancelText:l10n.t("web_cancel")},r.createElement(g,{text:n})))},onParticipantPromote:function(e){e.contact.pendingAction++,this.props.chat.groupMetadata.participants.promoteParticipant(e).then(function(){e.contact.pendingAction--}),a.closeModal()},onVerifyIdentity:function(e){this.props.onVerification(e.contact)},openAddGroupParticipantFlow:function(){if(this.props.chat.groupMetadata.participants.length>=C.MAX_GROUP_SIZE){var e=l10n.t("action_group_create_failed_participant",{max:C.MAX_GROUP_SIZE});a.openToast(r.createElement(E,{msg:e,id:w}))}else{var t=r.createElement(_,{chat:this.props.chat});a.openModal(t,"modal-flow")}},onClose:function(){this.props.onClose?this.props.onClose():a.closeDrawerRight()},onExitOrDeleteGroup:function(){a.deleteOrExitChat(this.props.chat)},onSubjectChange:function(e){this.setState({name:e.target.value})},validateSubject:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return!!e.trim()},onSetSubjectError:function(){a.openModal(r.createElement(y,{onOK:a.closeModal.bind(a),okText:l10n.t("web_ok")},l10n.t("action_group_subject_empty")))},onSetSubject:function(e){var t=this.props.chat,n=t.groupMetadata;if(n.canSetSubject()){var r=b.emojify(this.state.name);if(r===t.contact.name)return this.setState({name:r});this.setState({pendingSubject:!0}),t.setSubject(r).bind(this)["finally"](function(){this.isMounted()&&this.setState({name:t.contact.name,pendingSubject:!1})})}},onCancelSubject:function(){this.setState({name:this.props.chat.contact.name})},render:function(){var e,t,n=this.props.chat,i=n.groupMetadata,o=this,a=i.participants.map(function(e){var t=e.contact,n=o.state.contextMenu&&t.id===o.state.contextMenu.contactId;return r.createElement(u,{contact:t,key:e.id,admin:!!e.isAdmin,onClick:o.onParticipantClick,contextEnabled:o.menuEnabled.bind(o,t),contextMenu:n,onContext:o.onParticipantMenu,showNotifyName:!0})});n.canDelete()&&(t=r.createElement(f,{classes:"animate-enter3 drawer-section-action"},r.createElement("div",{onClick:this.onExitOrDeleteGroup,className:"btn btn-danger"},n.isReadOnly?l10n.t("web_delete_group"):l10n.t("web_exit_group")))),i.participants.canAdd()&&(e=r.createElement("div",{className:"list-action",onClick:this.openAddGroupParticipantFlow},r.createElement("div",{className:"list-action-icon"},r.createElement("span",{className:"icon icon-add-user"})),r.createElement("div",{className:"list-action-body"},l10n.t("add_group_participant"))));var s=24,g=55,v=e?s+g:s,y={minHeight:v+l.DEFAULT_HEIGHT*a.length},_=a.length?r.createElement(f,{title:l10n.t("web_participants_title"),subtitle:l10n.t("web_participants_count",{count:a.length,max:C.MAX_GROUP_SIZE}),"data-list-scroll-offset":!0,classes:"animate-enter2 drawer-section-list",expands:!0,style:y,ref:"container",noContainer:!0},e,r.createElement("div",{className:"drawer-section-body drawer-section-body-expand chatlist"},r.createElement(l,{data:a,height:l.DEFAULT_HEIGHT,extraItems:4}))):null,E=null;if(this.props.onMediaGallery){var b=r.createElement("span",{className:"icon icon-chevron-right-alt"});E=r.createElement(f,{title:l10n.t("media"),titleOnClick:this.props.onMediaGallery,subtitle:b,classes:"animate-enter2",noContainer:!0},r.createElement(d,{chat:n}))}var w=r.createElement(f,{title:l10n.t("subject"),classes:"animate-enter1 with-input"},r.createElement(S,{value:this.state.name,editable:i.canSetSubject(),pending:this.state.pendingSubject,showRemaining:!0,validate:this.validateSubject,maxLength:C.MAX_SUBJECT_LENGTH,onChange:this.onSubjectChange,onSave:this.onSetSubject,onError:this.onSetSubjectError,onCancel:this.onCancelSubject,supportsEmoji:!0,lockable:!0,lowProfile:!0})),x=n.contact.profilePicThumb,N=n.isReadOnly||!x.canDelete()&&!x.canSet()?m.Type.NO_EDIT:m.Type.GROUP,P=r.createElement(m,{type:N,id:n.contact.id,pending:this.state.pendingPhoto,startImage:this.state.imgFull,onImageSet:this.onImageSet}),k=null;n.groupMetadata.creation&&(k=r.createElement("div",{className:"header-secondary"},l10n.t("web_group_creation_time",{when:c.relativeDateAndTimeStr(n.groupMetadata.creation)})));var D=null,O=null,A=void 0;return this.state.contextMenu&&(A=r.createElement(T,{displayName:"ChatContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},r.createElement(M,{contextMenu:this.state.contextMenu}))),r.createElement(p,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},r.createElement("header",{className:"pane-header"},r.createElement("div",{className:"header-close"},r.createElement("button",{onClick:this.onClose},r.createElement("span",{className:"icon icon-x"}))),r.createElement("div",{className:"header-body"},r.createElement("div",{className:"header-main"},r.createElement("div",{className:"header-title"},l10n.t("web_group_info"))),k)),r.createElement(h,{"data-list-scroll-container":!0,editable:!0},r.createElement(f,{classes:"drawer-scale drawer-section-photo"},P),w,E,O,D,_,t),A)}});e.exports=x},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(414),s=r(a),c=n(6),l=n(410),u=n(132),d=n(982),p=n(997),h=n(980),f=n(10),m=n(14),g=n(8),v=n(45),y=n(1015),E={LOADING:0,SUCCESS:1,ACCEPT_ERROR:2,QUERY_ERROR:3},b=c.createClass({displayName:"GroupInviteModal",mixins:[h],props:{groupCode:c.PropTypes.string.isRequired},getInitialState:function(){return{state:E.LOADING,status:void 0,groupMetadata:void 0}},componentWillMount:function(){var e=this;v.groupInviteInfo(this.props.groupCode).checkpoint(this.rejectOnUnmount).then(function(t){var n=t.status,r=(0,s["default"])(t,["status"]);if(200===n){var i=new y(r);Store.Contact.gadd(r.id),e.setState({status:n,groupMetadata:i,state:E.SUCCESS})}else e.setState({status:n,state:E.QUERY_ERROR})})["catch"](m.Unmount,_.noop)},onViewGroup:function(){f.openChat(Store.Chat.get(this.state.groupMetadata.id)),f.closeModal()},onJoinGroup:function(){var e=this;v.acceptGroupInvite(this.props.groupCode).then(function(e){var t=e.status,n=e.gid;return 200===t?Store.Chat.find(n):o["default"].reject(t)}).then(function(e){f.openChat(e),f.closeModal()}).checkpoint(this.rejectOnUnmount)["catch"](m.Unmount,_.noop)["catch"](function(t){e.setState({state:E.ACCEPT_ERROR,status:t})})},onCancel:function(){f.closeModal()},render:function(){var e=this.state,t=e.state,n=e.status,r=e.groupMetadata,i={cancelText:l10n.t("group_invite_cancel"),onCancel:this.onCancel},o=void 0;if(t===E.LOADING)o=c.createElement("div",{className:"group-invite-loading-container"},c.createElement(u,{className:"group-invite-spinner",size:55,stroke:3}),c.createElement("span",null,l10n.t("group_invite_check_link")));else if(t===E.SUCCESS){var a=r.participants.map(function(e){return c.createElement("div",{key:e.id,className:"participant-wrapper"},c.createElement(d,{className:"participant-image",size:50,id:e.id}),c.createElement("span",{className:"participant-text"},e.contact.formattedName))}),s=Store.Contact.gadd(r.owner).formattedName,h=""+g.GROUP_INVITE_URL+this.props.groupCode;o=c.createElement("div",{className:"group-invite-modal"},c.createElement("div",{className:"metadata-container"},c.createElement("div",{className:"metadata-icon"},c.createElement("div",{className:"icon-group-default"}),c.createElement(p,{src:h})),c.createElement("div",{className:"metadata-text"},c.createElement("span",{className:"metadata-title"},r.subject),c.createElement("span",{className:"metadata-subtitle"},l10n.t("group_invite_created_by",{participant:s})))),c.createElement("span",{className:"participants-title"},l10n.t("group_invite_participants",{count:a.length,_plural:a.length})),c.createElement("div",{className:"participants-container"},a));var f=Store.Chat.get(r.id),m=!!f&&!f.isReadOnly;i.onOK=m?this.onViewGroup:this.onJoinGroup,i.okText=m?l10n.t("group_invite_view"):l10n.t("group_invite_join")}else{var v=void 0;if(t===E.QUERY_ERROR)switch(n){case 401:v=l10n.t("group_invite_query_401");break;case 403:v=l10n.t("group_invite_query_403");break;case 404:v=l10n.t("group_invite_query_404");break;case 406:v=l10n.t("group_invite_query_406");break;case 410:v=l10n.t("group_invite_query_410");break;default:v=l10n.t("group_invite_query_500")}else if(t===E.ACCEPT_ERROR)switch(n){case 401:v=l10n.t("group_invite_accept_401");break;case 404:v=l10n.t("group_invite_accept_404");break;case 410:v=l10n.t("group_invite_accept_410");break;case 419:v=l10n.t("group_invite_accept_419");break;default:v=l10n.t("group_invite_accept_500")}i.cancelText=l10n.t("web_ok"),o=c.createElement("div",null,v)}return c.createElement(l,i,o)}});e.exports=b},function(e,t,n){"use strict";var r=n(6),i=n(10),o=n(975),a=n(129),s=n(980),c=n(978),l=n(981),u=n(979),d=n(995),p=n(1175),h=n(1107),f=n(1013),m=n(132),g=n(413),v=n(974),y=n(1034),E=n(14),b=n(43),S=n(8),M=r.createClass({displayName:"GroupMsgInfoDrawer",mixins:[o,a,s],propTypes:{msg:r.PropTypes.instanceOf(v)},getInitialState:function(){return{msgInfo:void 0,star:this.async("msg.star")}},componentWillMount:function(){var e=this;Store.MsgInfo.find(this.props.msg.id).checkpoint(this.rejectOnUnmount()).then(function(t){e.setState({msgInfo:t}),e.addObserver(t.played,"add remove"),e.addObserver(t.read,"add remove"),e.addObserver(t.delivery,"add remove"),e.addObserver(t,"change:playedRemaining change:readRemaining change:deliveryRemaining")})["catch"](E.Unmount,_.noop)["catch"](function(){e.setState({unimplemented:!0}),i.openToast(r.createElement(g,{msg:l10n.t("msg_info_failed"),id:g.genId("msg_info_failed")}))})},getAnimateEnterClass:function(e){return"animate-enter"+(e===-1?"":e)},componentDidMount:function(){if(this.props.msg.type===v.TYPE.IMAGE&&(this.refs.scrollable.scrollTop=this.refs.scrollable.scrollHeight),this.props.msg.isGif){var e=this.getMsgComponent();e.play()}},isMsgVisible:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];return e===this.props.msg.id&&(!!t||this.getMsgComponent())},getMsgComponent:function(){var e=this.refs.wrapper;if(e)return e.refs.component},onClose:function(){i.closeDrawerRight()},render:function(){var e,t=this.props.msg,n=this.state,i=n.msgInfo,o=n.star,a=n.unimplemented,s=-1,g=24,_=26,E=void 0,M=void 0;if(i&&i.isPTT){var T=r.createElement("span",{className:"icon icon-status-ptt-blue"}),C=i.played.map(function(e){return r.createElement(h,{participant:e,key:e.id})}),w=C.length>0?r.createElement("div",{className:"chatlist-plain"},C):null,x=i.playedRemaining>0?r.createElement(p,{separator:0!==i.played.length},l10n.t("message_info_remaining",{count:i.playedRemaining,_plural:i.playedRemaining})):null,N=b(this.getAnimateEnterClass(s),{"drawer-section-bottom":!(i&&i.deliveryRemaining>0||i&&!(i.played.length>0&&0===i.readRemaining))});M=l10n.t("message_info_seen_by"),e=x?g+_:g,I=y.minHeight(C,e),E=r.createElement(d,{classes:N,key:"played-section",expands:!0,style:I,title:l10n.t("message_info_played_by"),subtitle:T,footer:x},w)}var P=void 0;if(i&&(i.read.length>0||i.playedRemaining>0)){var k=r.createElement("span",{className:"icon icon-status-dblcheck-ack"}),D=i.read.map(function(e){return r.createElement(h,{participant:e,key:e.id})}),O=D.length>0?r.createElement("div",{className:"chatlist-plain"},D):null,A=i.readRemaining>0?r.createElement(p,{separator:0!==i.read.length},l10n.t("message_info_remaining",{count:i.readRemaining,_plural:i.readRemaining})):null,R=b(this.getAnimateEnterClass(s),{"drawer-section-bottom":!(i&&i.deliveryRemaining>0)});M=M||l10n.t("message_info_read_by"),e=A?g+_:g;var I=y.minHeight(D,e);P=r.createElement(d,{classes:R,key:"read-section",expands:!0,title:M,style:I,subtitle:k,footer:A},O)}var L=void 0;if(i&&(i.delivery.length>0||i.deliveryRemaining>0)){var F=r.createElement("span",{className:"icon icon-status-dblcheck"}),U=i.delivery.map(function(e){return r.createElement(h,{participant:e,key:e.id})}),j=U.length>0?r.createElement("div",{className:"chatlist-plain"},U):null,B=i.deliveryRemaining>0?r.createElement(p,{separator:0!==i.delivery.length},l10n.t("message_info_remaining",{count:i.deliveryRemaining,_plural:i.deliveryRemaining})):null,G=b(this.getAnimateEnterClass(s),"drawer-section-bottom");e=B?g+_:g,I=y.minHeight(U,e),L=r.createElement(d,{classes:G,key:"delivered-section",expands:!0,style:I,title:l10n.t("message_info_delivered_to"),subtitle:F,footer:B},j)}var z=void 0;i||a||(z=r.createElement(d,{classes:"drawer-section-spinner",key:"spinner"},r.createElement(m,{size:50,stroke:4})));var Y=b("pane-preview-wrapper","pane-preview-wrapper-bg",{"pane-preview-resize":t.type===v.TYPE.PTT||t.type===v.TYPE.IMAGE||t.type===v.TYPE.LOCATION||t.type===v.TYPE.VCARD||t.isGif});return r.createElement(c,{key:"message-info-modal",id:"info",variant:"panel",onCancel:this.onClose},r.createElement(l,{title:l10n.t("message_info"),type:l.Type.SMALL,onCancel:this.onClose}),r.createElement("div",{className:Y,ref:"scrollable"},r.createElement("div",{className:"pane-preview"},r.createElement("div",{className:"pane-chat-tile"}),r.createElement(f,{msg:t,key:"star-"+o.toString(),ref:"wrapper",displayType:S.DISP_TYPE.MSG_INFO,isMsgVisible:this.isMsgVisible,position:f.Position.END}))),r.createElement(u,{classes:"drawer-body-msg-info",editable:!0},z,E,P,L))}});e.exports=M},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(6),s=n(1081),c=n(977),l=n(1004),u=n(987),d=n(990),p=a.createClass({displayName:"GroupsModal",propTypes:{chats:a.PropTypes.arrayOf(a.PropTypes.instanceOf(c)),filter:a.PropTypes.func,onCancel:a.PropTypes.func.isRequired,onGroup:a.PropTypes.func.isRequired},getDefaultProps:function(){return{filter:function(){return!0}}},getInitialState:function(){return this.selection=new u,{loading:!0,searchFilter:void 0}},componentWillMount:function(){var e=this,t=this.props.chats;o["default"].delay(300).then(function(){return o["default"].all(_.map(_.filter(t,function(e){return e.groupMetadata.stale}),function(e){return e.groupMetadata.update()["catch"](_.noop)}))}).then(function(){return e.setState({loading:!1})})},onSelect:function(e,t){var n=t.props.chat;this.props.filter(n)===!0&&this.props.onGroup(t.props.chat)},onSearch:function(e){this.setState({searchFilter:e})},render:function(){var e=this,t=this.props,n=t.chats,r=t.onGroup,i=t.filter,o=t.onCancel,c=void 0;return this.state.loading?c=a.createElement(d.Loading,null):!function(){var t=l10n.accentFold(e.state.searchFilter),o=n.filter(function(e){return i(e)&&(!t||t&&e.contact.searchMatch(t))});o.length?(e.selection.init(_.map(o.filter(function(e){return i(e)===!0}),"id")),c=o.map(function(t){var n=void 0,o=void 0;return _.isString(i(t))&&(n=a.createElement("div",{className:"chat-status ellipsify",title:i(t)},i(t)),o="member"),a.createElement(l,{chat:t,mode:l.Mode.INFO,active:e.selection,secondary:n,noContext:!0,className:o,onClick:_.isString(i(t))?void 0:r.bind(null,t),key:t.id})})):c=a.createElement(d.SearchGroups,null)}(),a.createElement(s,{title:l10n.t("web_groups"),selection:this.selection,onSearch:this.onSearch,searchPlaceholder:l10n.t("search_groups"),onSelect:this.onSelect,onCancel:o},c)}});e.exports=p},function(e,t,n){"use strict";var r=n(6),i=n(978),o=n(981),a=n(979),s=n(1080),c=n(1189),l=n(10),u=n(205),d=n(80),p="animated-doodle",h=n(1253),f={"class":".animated-doodle",low:{"default":h},high:{"default":h}},m=r.createClass({displayName:"HelpDrawer",propTypes:{onClose:r.PropTypes.func.isRequired},componentWillMount:function(){u.isAssetLoaded(p)||u.loadAsset(f,p)},onTOS:function(){var e="https://www.whatsapp.com/legal/";e=d.build(e,{lg:l10n.getLocale()}),window.open(e,"_blank")},onFAQ:function(){var e="http://www.whatsapp.com/faq/web";e=e=d.build(e,{lg:l10n.getLocale()}),window.open(e,"_blank")},onContactUs:function(){l.openModal(r.createElement(c,null))},render:function(){return r.createElement(i,{onCancel:this.onBack,id:"help"},r.createElement(o,{a8n:"drawer-title-help",title:l10n.t("help_drawer_title"),onBack:this.props.onClose,type:o.Type.LARGE}),r.createElement(a,{wide:!0},r.createElement("div",{className:"controls-section animated-doodle"}),r.createElement("div",{className:"chatlist list-icons list-settings"},r.createElement(s,{className:"drawer-list-item",onClick:this.onFAQ},l10n.t("web_settings_faq")),r.createElement(s,{className:"drawer-list-item",onClick:this.onContactUs},l10n.t("send_logs_title")),r.createElement(s,{className:"drawer-list-item",onClick:this.onTOS},l10n.t("terms_and_privacy_link")))))}});e.exports=m},function(e,t,n){"use strict";var r=n(6),i=n(977),o=n(1009),a=n(978),s=n(981),c=r.createClass({displayName:"MediaGalleryDrawer",propTypes:{chat:r.PropTypes.instanceOf(i).isRequired,onBack:r.PropTypes.func.isRequired},render:function(){return r.createElement(a,{id:"media_gallery",onCancel:this.props.onBack},r.createElement(s,{title:l10n.t("media"),onBack:this.props.onBack,type:s.Type.LARGE}),r.createElement(o,{chat:this.props.chat,fullCollection:!0}))}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(975),o=n(196),a=n(43),s=n(982),c=n(976),l=n(101),u=n(974),d=r.createClass({displayName:"MediaPanelHeader",propTypes:{msg:r.PropTypes.instanceOf(u).isRequired,onGoToMsgClick:r.PropTypes.func.isRequired,onUnstarClick:r.PropTypes.func.isRequired,onStarClick:r.PropTypes.func.isRequired,openForwardFlow:r.PropTypes.func.isRequired,onDownloadClick:r.PropTypes.func.isRequired,onClose:r.PropTypes.func.isRequired},mixins:[i],getInitialState:function(){return{url:this.async("msg.url")}},getMenuBtns:function(){var e=this.props.msg,t=null,n=null,i=null,o=null,s="menu-item menu-item-hover";if(t=r.createElement("div",{className:s,onClick:this.props.onGoToMsgClick},r.createElement("span",{className:"icon icon-bubble",title:l10n.t("go_to_message")})),l.supportsFeature(l.F.STARRED)){var c=void 0,u=void 0,d=void 0;e.star?(c=this.props.onUnstarClick,u="icon icon-unstar-btn",d=l10n.t("unstar_message")):(c=this.props.onStarClick,u="icon icon-star-btn",d=l10n.t("star_message")),n=r.createElement("div",{className:s,onClick:c},r.createElement("span",{className:u,title:d}))}return i=r.createElement("div",{className:s,onClick:this.props.openForwardFlow},r.createElement("span",{className:"icon btn-media-forward icon-forward",title:l10n.t("forward")})),o=r.createElement("div",{className:a(s,{disabled:!e.url}),onClick:this.props.onDownloadClick},r.createElement("a",{className:"icon icon-download",title:l10n.t("web_button_download")})),{btnGoToMsg:t,btnStar:n,btnForward:i,btnDownload:o}},render:function(){var e=this.props.msg,t=e.displayName(!0,!0);e.isGroupMsg&&(t+=" @ "+e.chat.formattedTitle);var n=this.getMenuBtns(),i=n.btnGoToMsg,l=n.btnStar,u=n.btnForward,d=n.btnDownload,p=a("media-panel-header",{});return r.createElement("div",{className:p},r.createElement("div",{className:"chat media-chat"},r.createElement("div",{className:"chat-avatar"},r.createElement(s,{id:e.sender,size:40})),r.createElement("div",{className:"chat-body"},r.createElement("div",{className:"chat-main"},r.createElement(c,{text:t,classes:"nowrap"})),r.createElement("div",{className:"chat-secondary"},r.createElement("div",{className:"chat-status ellipsify"},o.relativeDateAndTimeStr(e.t))))),r.createElement("div",{className:"menu menu-horizontal media-panel-tools"},i,l,u,d,r.createElement("div",{className:"menu-item menu-item-hover"},r.createElement("button",{className:"icon icon-x-viewer",title:l10n.t("web_close"),onClick:this.props.onClose}))))}});e.exports=d},function(e,t,n){"use strict";var r=n(6),i=n(34),o=n(974),a=n(975),s=n(130),c=n(78),l=n(976),u=n(997),d=n(1064),p=n(1055),h=n(994),f=n(1011),m=n(10),g=n(1028),v=n(410),y=n(1183),E=n(1032),b=n(101),S=n(1090),M=n(43),T=n(197),C=500,w=2,x=r.createClass({displayName:"MediaViewerModal",mixins:[a,c],propTypes:{msg:r.PropTypes.instanceOf(o).isRequired,zoomIn:r.PropTypes.bool,getZoomNode:r.PropTypes.func,onBack:r.PropTypes.func.isRequired,onExitAnimation:r.PropTypes.func,onNext:r.PropTypes.func,onPrev:r.PropTypes.func,onImgZoomIn:r.PropTypes.func},getDefaultProps:function(){return{getZoomNode:_.noop}},getInitialState:function(){return{star:this.async("msg.star"),mediaState:this.async("msg.mediaState"),imgZoomed:!1}},componentWillMount:function(){if(this.regCmd("open_chat",this.onClose),this.props.msg.mediaState===o.MEDIA_STATE.RESOLVED&&this.props.zoomIn){var e=this.props.getZoomNode(this.props.msg.id);this.setState({zoomElement:e}),this.style={opacity:0}}},componentDidMount:function(){this.style={}},onImageLoad:function(e){var t=this.state.zoomElement;t&&e&&this.props.zoomIn&&!this.zoomed&&(this.animateZoom(t,e),this.zoomed=!0)},animateZoom:function(e,t){var n=this,r=t.getBoundingClientRect(),o=e.getBoundingClientRect(),a=o.top-r.top,s=o.left-r.left,c=e.clientWidth/t.clientWidth,l=(t.clientHeight-e.clientHeight)/2,u=(t.clientWidth-e.clientWidth)/2;a-=l,s-=u,Velocity(t,{opacity:0,translateX:s,translateY:a,scale:c},{duration:0}).then(function(){Velocity(t,{opacity:[1,0],translateX:[0,s],translateY:[0,a],scale:[1,c]},{duration:C,easing:[.1,.82,.25,1]});var e=i.findDOMNode(n.refs.caption);e&&Velocity(e,{opacity:[1,0]},{duration:C})})},openForwardFlow:function(e){e.stopPropagation();var t=this.props.msg;t.isUnsentMedia?m.openModal(r.createElement(v,{title:l10n.t("err_unsent_forward_title"),onOK:m.closeModal.bind(m),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text"))):m.openModal(r.createElement(g,{msgs:[this.props.msg]}),"modal-flow")},onScroll:function(e){Math.abs(e.deltaY)>7&&this.onClose()},onImgZoomIn:function(e){if(e&&this.refs.media){var t=this.refs.media;this.listenToMouseMove=t.heightOveflow>0||t.widthOveflow>0}this.setState({imgZoomed:e}),this.props.onImgZoomIn(e)},onZoomOut:function(){this.refs.media&&this.state.imgZoomed&&this.refs.media.onImageClick()},onMouseMove:function(e){this.handleMouseMove(e.pageX,e.pageY)},handleMouseMove:_.throttle(function(e,t){var n=this.refs.media&&this.refs.media.refs.image,r=i.findDOMNode(n);if(r){var o=r.parentNode,a=o.parentNode,s=this.refs.media.getTranslatePosition(a,e,t),c=s.translateX,l=s.translateY;Velocity(o,"stop"),Velocity(o,{translateX:c,translateY:l,scale:w},{duration:0})}},42),onDownloadClick:function(e){e.stopPropagation(),E.initDownload(this.props.msg)},onStarClick:function(e){e.stopPropagation(),this.props.msg.chat.sendStarMsgs([this.props.msg],!0)},onUnstarClick:function(e){e.stopPropagation(),this.props.msg.chat.sendStarMsgs([this.props.msg],!1)},onGoToMsgClick:function(e){e.stopPropagation();var t=this.props.msg;m.openChat(t.chat,t.chat.getSearchContext(t),!1),m.focusShowMsg(t.id)},getMenuBtns:function(){var e=this.props.msg,t=null,n=null,i=null,o=null,a=M("menu-item menu-item-hover",{disabled:!e.url});if(t=r.createElement("div",{className:"menu-item menu-item-hover",onClick:this.onGoToMsgClick},r.createElement("span",{className:"icon icon-bubble",title:l10n.t("go_to_message")})),b.supportsFeature(b.F.STARRED)){var s=void 0,c=void 0,l=void 0;e.star?(s=this.onUnstarClick,c="icon icon-unstar-btn",l=l10n.t("unstar_message")):(s=this.onStarClick,c="icon icon-star-btn",l=l10n.t("star_message")),n=r.createElement("div",{className:a,onClick:s},r.createElement("span",{className:c,title:l}))}return i=r.createElement("div",{className:a,onClick:this.openForwardFlow},r.createElement("span",{className:"icon btn-media-forward icon-forward",title:l10n.t("forward")})),o=r.createElement("div",{className:a,onClick:this.onDownloadClick},r.createElement("a",{className:"icon icon-download",title:l10n.t("web_button_download")})),{btnGoToMsg:t,btnStar:n,btnForward:i,btnDownload:o}},onClose:function(){var e=this;if(!this.closing){this.closing=!0,_.isFunction(this.props.onExitAnimation)&&this.props.onExitAnimation();var t=this.props.getZoomNode(this.props.msg.id);if(!t)return this.props.onBack();var n=this.refs.media,r=void 0;if(n&&n.refs){var a=this.props.msg.type;a===o.TYPE.IMAGE?r=n.refs.image:this.props.msg.isGif&&(r=n.refs.player)}if(!r)return this.props.onBack();r=i.findDOMNode(r);var s=r.getBoundingClientRect(),c=t.getBoundingClientRect(),l=c.top-s.top,u=c.left-s.left,d=t.clientWidth/r.clientWidth,p=(r.clientHeight-t.clientHeight)/2,h=(r.clientWidth-t.clientWidth)/2;l-=p,u-=h,Velocity(r,{translateX:[u,0],translateY:[l,0],scale:[d,1]},{duration:200,easing:[.1,.82,.25,1]}).then(function(){e.props.onBack()});var f=i.findDOMNode(this.refs.caption);f&&Velocity(f,{opacity:[0,1]},{duration:200,easing:[.1,.82,.25,1]})}},render:function(){var e,t=this.props.msg;switch(t.type){case"image":e=r.createElement(N,{msg:t,key:t.id,style:this.style,onLoad:this.onImageLoad,onImgZoomIn:this.onImgZoomIn,ref:"media"});break;case"video":e=r.createElement(P,{msg:t,key:t.id,onLoad:t.isGif?this.onImageLoad:_.noop,ref:"media"});break;case"audio":e=r.createElement(D,{msg:t,key:t.id})}var n=M("media-caption",{"caption-hidden":this.props.zoomIn&&(t.isGif||"image"===t.type)}),i=void 0;if(t.caption){var o=t.mentionMap();i=r.createElement(l,{ref:"caption",classes:n,linkify:!0,format:!0,mention:o,text:t.caption})}var a=M("media",{"media-with-caption":!!i}),s=r.createElement("span",{className:"icon icon-chevron-right icon-l",title:l10n.t("next_button")}),c=M("btn btn-round btn-media-next",{"disabled-btn":!this.props.onNext}),u=r.createElement("button",{className:c,onClick:this.props.onNext||function(e){return e.stopPropagation()}},s),d=r.createElement("span",{className:"icon icon-chevron-left icon-l",title:l10n.t("previous_button")}),p=M("btn btn-round btn-media-prev",{"disabled-btn":!this.props.onPrev}),h=r.createElement("button",{className:p,onClick:this.props.onPrev||function(e){return e.stopPropagation()}},d),f=M("media-viewer",{"media-viewer-animate":this.props.zoomIn,"cursor-zoom-out":this.state.imgZoomed}),m=this.state.imgZoomed?null:this.onScroll,g=this.state.imgZoomed?null:this.onClose,v=this.state.imgZoomed&&this.listenToMouseMove?this.onMouseMove:null,E=this.state.imgZoomed?this.onZoomOut:null;return r.createElement(T,{displayName:"MediaViewer",escapable:!0,requestDismiss:this.onClose},r.createElement("div",{className:f,onClick:E,onMouseMove:v},r.createElement(y,{msg:this.props.msg,onGoToMsgClick:this.onGoToMsgClick,onUnstarClick:this.onUnstarClick,onStarClick:this.onStarClick,openForwardFlow:this.openForwardFlow,onDownloadClick:this.onDownloadClick,onClose:this.onClose}),r.createElement("div",{className:"media-content",dir:"ltr",ref:"container",onWheel:m,onClick:g},h,r.createElement("div",{className:a},r.createElement(O,{msg:t}),e,i),u)))}}),N=r.createClass({displayName:"MediaImage",mixins:[a,s],propTypes:{msg:r.PropTypes.instanceOf(o).isRequired,style:r.PropTypes.object,onLoad:r.PropTypes.func,onImgZoomIn:r.PropTypes.func},getInitialState:function(){return{mediaState:this.async("msg.mediaState"),zoomIn:null}},componentDidMount:function(){this.props.msg.forceDownloadMedia()},onImageClick:function(e){if(e&&e.stopPropagation(),this.state.zoomIn)return this.props.onImgZoomIn(!1),void this.setState({zoomIn:null});var t=i.findDOMNode(this.refs.image),n=t.parentNode,r=n.parentNode;this.heightOveflow=n.clientHeight*w-r.clientHeight,this.widthOveflow=n.clientWidth*w-r.clientWidth;var o=this.getTranslatePosition(r,e.pageX,e.pageY),a=o.translateX,s=o.translateY;this.props.onImgZoomIn(!0),this.setState({zoomIn:{factor:w,translateX:a,translateY:s}})},getTranslatePosition:function(e,t,n){var r=window.innerWidth/2-t,i=window.innerHeight/2-n,o=this.widthOveflow>0?1.5*r*this.widthOveflow/e.clientWidth:0,a=this.heightOveflow>0?1.5*i*this.heightOveflow/e.clientHeight:0;return{translateX:o,translateY:a}},render:function(){var e=this,t=this.props.msg,n=this.state.zoomIn,i=M("media-viewer-img",{"cursor-zoom-in":!n});if(t.mediaState===o.MEDIA_STATE.RESOLVED){var a={width:t.fullWidth,height:t.fullHeight},s=r.createElement(u,{src:t.url,ref:"image",onClick:this.onImageClick,style:this.props.style,className:i});return n&&(s=r.createElement(T,{displayName:"ZoomInImage",ref:"image",escapable:!0,requestDismiss:function(){return e.onImageClick()}},s)),r.createElement(h,{type:h.TYPES.ZOOM_IN,size:a,zoomIn:this.state.zoomIn,onObjectLoad:this.props.onLoad},s)}return r.createElement(k,{msg:t})}}),P=r.createClass({displayName:"MediaVideo",mixins:[a,s],propTypes:{msg:r.PropTypes.instanceOf(o).isRequired,style:r.PropTypes.object,onLoad:r.PropTypes.func},getInitialState:function(){return{played:!1,mediaState:this.async("msg.mediaState"),size:{width:0,height:0}}},componentWillMount:function(){this.updateSize()},componentWillReceiveProps:function(){this.updateSize()},componentDidMount:function(){var e=this.props.msg;e.forceDownloadMedia()},updateSize:function(){var e=this.props.msg;e.mediaState===o.MEDIA_STATE.RESOLVED&&e.fullWidth&&e.fullHeight&&this.setState({size:this.getSize()})},onPlayerError:function(e){},onPlayerClick:function(e){e.stopPropagation();var t=i.findDOMNode(this.refs.player);e.clientY>t.clientHeight+t.offsetTop-44||(t.paused?t.play():t.pause())},onResize:function(e){this.setState({size:e})},stopPropagation:function(e){e.stopPropagation()},getSize:function(){var e=this.props.msg,t=330;return!e.isGif||e.fullWidth>=t?{width:e.fullWidth,height:e.fullHeight}:{width:t,height:e.fullHeight*t/e.fullWidth}},render:function(){var e=this.props.msg,t="media-viewer-img",n=e.mediaState===o.MEDIA_STATE.RESOLVED;return n?r.createElement(h,{type:h.TYPES.SCALE_DOWN,size:this.state.size,onObjectLoad:this.props.onLoad,style:this.props.style},r.createElement(d,{msg:e,ref:"player",className:t,onError:this.onPlayerError,onClick:e.isGif?this.stopPropagation:this.onPlayerClick,autoPlay:!0,controls:!e.isGif,loop:e.isGif,onResize:this.onResize},l10n.t("video_playback_not_supported"))):r.createElement(k,{msg:e})}}),k=r.createClass({displayName:"BlurredImage",render:function(){var e=this.props.msg,t="data:image/jpeg;base64,"+e.body,n=S.boundHeightWidth(10*e.height,10*e.width,500,500),i={width:n.width,height:n.height};return r.createElement("div",{className:"media-viewer-blur-crop",style:i},r.createElement("img",{className:"media-viewer-blur-img",src:t}))}}),D=r.createClass({displayName:"MediaAudio",mixins:[a,s],propTypes:{msg:r.PropTypes.instanceOf(o).isRequired},getInitialState:function(){return{mediaState:this.async("msg.mediaState")}},onPlayerError:function(e){},render:function(){var e=this.props.msg,t="media-viewer-img media-viewer-audio";return e.mediaState===o.MEDIA_STATE.RESOLVED?r.createElement(p,{msg:e,ref:"player",className:t,onClick:this.onPlayerClick,onError:this.onPlayerError,autoPlay:!0,controls:!0},l10n.t("audio_playback_not_supported")):r.createElement("div",{className:"image-audio"})}}),O=r.createClass({displayName:"MediaState",mixins:[a],propTypes:{msg:r.PropTypes.instanceOf(o).isRequired},getInitialState:function(){return{mediaState:this.async("msg.mediaState")}},downloadMedia:function(){this.props.msg.downloadMedia()},render:function(){var e=this.props.msg,t=null,n=null;if(e.local)return null;switch(e.mediaState){case o.MEDIA_STATE.RESOLVED:case o.MEDIA_STATE.ERROR_MISSING:return null;case o.MEDIA_STATE.NEED_POKE:t=r.createElement(f.Download,{filesize:e.size}),n=this.downloadMedia;break;default:t=r.createElement(f.Pending,null)}return r.createElement("div",{onClick:n},t)}});e.exports=x},function(e,t,n){"use strict";var r=n(6),i=n(977),o=n(10),a=n(0),s=function(){return[{label:l10n.t("web_mute_8hours"),duration:8},{label:l10n.t("web_mute_1week"),duration:168},{label:l10n.t("web_mute_1year"),duration:8760}]},c=r.createClass({displayName:"MutePopup",
propTypes:{onCancel:r.PropTypes.func,onMute:r.PropTypes.func.isRequired,chat:r.PropTypes.instanceOf(i).isRequired},getInitialState:function(){return{mute:8}},onChange:function(e){this.setState({mute:parseInt(e.target.value,10)})},onMute:function(e){e.stopPropagation(),o.closeModal(),this.props.onMute(3600*this.state.mute+a().unix(),!0)},render:function(){var e=this.props.onCancel||function(){o.closeModal()},t=this.state.mute,n=this,i=s().map(function(e){var i=e.duration;return r.createElement("li",{key:"mute-"+i},r.createElement("label",null,r.createElement("input",{type:"radio",name:"duration",value:e.duration,checked:t===i,onChange:n.onChange}),e.label))}),a=this.props.chat.isGroup?l10n.t("web_mute_time"):l10n.t("web_mute_time_chat");return r.createElement("div",{className:"backdrop"},r.createElement("div",{className:"popup-container"},r.createElement("div",{className:"popup"},r.createElement("div",{className:"popup-body"},r.createElement("div",{className:"popup-title",dir:"auto"},a),r.createElement("div",{className:"popup-contents"},r.createElement("form",{ref:"form"},r.createElement("ol",{className:"choices"},i)))),r.createElement("div",{className:"popup-controls"},r.createElement("button",{className:"btn-plain popup-controls-item",onClick:e},l10n.t("web_cancel")),r.createElement("button",{className:"btn-plain btn-default popup-controls-item",onClick:this.onMute},l10n.t("web_ok"))))))}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(978),o=n(981),a=n(979),s=n(998),c=n(1025),l=n(102),u=n(984),d=r.createClass({displayName:"NewGroupDrawer",propTypes:{thumb:r.PropTypes.string,full:r.PropTypes.string,subject:r.PropTypes.string,onBack:r.PropTypes.func.isRequired,onContinue:r.PropTypes.func.isRequired},getInitialState:function(){return{text:this.props.subject||"",thumb:this.props.thumb,full:this.props.full,emojiActive:!1}},componentDidMount:function(){this.refs.emojiInput.restoreFocus()},preventBlur:function(e){e.preventDefault(),e.stopPropagation(),this.refs.emojiInput.restoreFocus()},onImageSet:function(e,t){this.setState({thumb:e,full:t})},onContinue:function(){var e=u.emojify(this.state.text.trim()),t=this.refs.photoPicker;if(t.state.isEditing){var n=this;t.cropImage().then(function(t){n.props.onContinue(e,t.thumb,t.full)})}else this.props.onContinue(e,this.state.thumb,this.state.full)},onInputChange:function(e){var t=e.target.value;this.setState({text:t})},render:function(){var e=this.state.text.trim().length>0,t=e?r.createElement("div",{className:"drawer-section drawer-controls"},r.createElement("button",{className:"btn btn-round",onClick:this.onContinue},r.createElement("span",{className:"icon icon-forward-light icon-l"}))):null;return r.createElement(i,{id:"new-group",onCancel:this.props.onBack},r.createElement(o,{title:l10n.t("new_group_flow_title"),type:o.Type.LARGE,onBack:this.props.onBack}),r.createElement(a,{wide:!0},r.createElement("div",{className:"drawer-section"},r.createElement(c,{type:c.Type.GROUP,startImage:this.state.full,onImageSet:this.onImageSet,ref:"photoPicker"})),r.createElement("div",{className:"drawer-section",onMouseDown:this.preventBlur},r.createElement(s,{ref:"emojiInput",value:this.state.text,maxLength:25,showRemaining:!0,onChange:this.onInputChange,placeholder:l10n.t("group_subject"),onEnter:e?this.onContinue:_.noop,supportsEmoji:!0})),r.createElement(l,{transitionName:"btn"},t)))}});e.exports=d},function(e,t,n){"use strict";var r=n(6),i=n(978),o=n(981),a=n(979),s=n(1054),c=n(1115),l=n(129),u=n(8),d=n(10),p=n(413),h=n(134),f=n(102),m=n(131),g=m.HotKeys,v=p.genId("max_participant_toast"),y=r.createClass({displayName:"NewGroupParticipantsDrawer",mixins:[l],propTypes:{thumb:r.PropTypes.string,full:r.PropTypes.string,subject:r.PropTypes.string.isRequired,onBack:r.PropTypes.func.isRequired,onContinue:r.PropTypes.func.isRequired},getInitialState:function(){var e=this;return this.props.uimContext&&(this.props.uimContext.uimClose=function(){e.onBack()}),{searchText:"",participants:[],shouldFocus:!0}},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts();e=_.difference(e,this.state.participants);var t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},componentDidMount:function(){this.focus()},componentDidUpdate:function(){this.adjustInput()},onKeyDown:function(e){if("Backspace"!==e.key||this.state.searchText||_.isEmpty(this.state.participants))"Enter"===e.key&&_.size(this.state.participants)&&this.onContinue();else{e.preventDefault();var t=this.state.participants;this.setState({participants:t.slice(0,t.length-1),shouldFocus:!0})}},onInput:function(e){this.setState({searchText:e.target.value})},adjustInput:function(){var e=this.refs.input.offsetParent.offsetWidth-10,t=this.refs.sizer.offsetWidth,n=t>e?e:t;this.refs.input.style.width=n+"px";var r;r=e-this.refs.input.offsetLeft-n>0?e-this.refs.input.offsetLeft:e,this.refs.input.style.width=r+"px",this.state.shouldFocus&&this.focus()},onReset:function(){this.setState({searchText:"",shouldFocus:!0})},focus:function(){h.focus(this.refs.input)},onBack:function(){var e=this.props;e.onBack(e.subject,e.thumb,e.full)},onContinue:function(){var e=this.props;e.onContinue(e.subject,e.thumb,e.full,this.state.participants)},onDelete:function(e,t){var n=_.without(this.state.participants,t);this.setState({participants:n,shouldFocus:!n.length})},onContactClick:function(e,t){var n=this.state.participants;if(_.includes(n,t))this.setState({participants:_.without(n,t),shouldFocus:!0});else if(n.length>=u.MAX_GROUP_SIZE){var i=l10n.t("action_group_create_failed_participant",{max:u.MAX_GROUP_SIZE});d.openToast(r.createElement(p,{msg:i,id:v}))}else this.setState({participants:n.concat(t),searchText:"",shouldFocus:!0})},onFocusList:function(e){this.refs.list&&(e.preventDefault(),e.stopPropagation(),g.flashFocus=Date.now(),this.refs.list.focusFirst())},onFocusParticipants:function(e){e.repeat||0!==this.refs.input.selectionStart||this.refs.participantList&&(e.preventDefault(),e.stopPropagation(),g.flashFocus=null,this.refs.participantList.focusLast())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.head(this.getFilteredContacts());t&&this.onContactClick(e,t)},onFocusSearch:function(e){g.flashFocus=Date.now(),h.focus(this.refs.input)},render:function(){var e=_.size(this.state.participants)?r.createElement("button",{className:"btn btn-round",onClick:this.onContinue},r.createElement("span",{className:"icon icon-checkmark-light"})):null,t=_.size(this.state.participants)?" ":l10n.t("group_participant_hint"),n={down:this.onFocusList,enter:this.state.searchText?this.onSelectFirst:_.size(this.state.participants)?this.onContinue:_.noop,up:this.onFocusParticipants};return n[l10n.LR("left","right")]=this.onFocusParticipants,r.createElement(i,{id:"new-group",onCancel:this.onBack},r.createElement(o,{title:l10n.t("add_group_participants_title"),type:o.Type.LARGE,onBack:this.onBack}),r.createElement(a,{flex:!0},r.createElement("div",{className:"drawer-section new-group-search"},r.createElement("div",{className:"input-clear input-ext"},r.createElement(g,{handlers:n,className:"input input-line"},r.createElement("div",{className:"list-names list-deletable new-group-preview"},r.createElement("div",{className:"new-group-participants","data-list-scroll-container":!0},r.createElement(c,{ref:"participantList",contacts:this.state.participants,onDelete:this.onDelete,onFocusSearch:this.onFocusSearch}))),r.createElement("input",{className:"inputarea",ref:"input",placeholder:t,onKeyDown:this.onKeyDown,onChange:this.onInput,value:this.state.searchText}),r.createElement("span",{className:"inputarea-sizer",ref:"sizer"},this.state.searchText)))),r.createElement("div",{className:"new-group-contacts","data-list-scroll-container":!0},r.createElement(s,{ref:"list",contacts:this.getFilteredContacts(),onFocusSearch:this.onFocusSearch,onClick:this.onContactClick})),r.createElement(f,{transitionName:"btn",className:"drawer-section drawer-controls"},e)))}});e.exports=y},function(e,t,n){"use strict";var r=n(6),i=n(978),o=n(981),a=n(979),s=n(1174),c=r.createClass({displayName:"NotificationsDrawer",propTypes:{onClose:r.PropTypes.func.isRequired},render:function(){return r.createElement(i,{onCancel:this.onBack,id:"notifications"},r.createElement(o,{a8n:"drawer-title-notifications",title:l10n.t("notifications_drawer_title"),onBack:this.props.onClose,type:o.Type.LARGE}),r.createElement(a,{wide:!0},r.createElement(s,{key:"notifications"})))}});e.exports=c},function(e,t,n){"use strict";var r=n(6),i=n(133),o=n(410),a=n(10),s=n(1033),c=n(432),l=n(22),u=n(998),d=n(413),p=n(131),h=p.HotKeys,f=320,m=50,g=10,v=500,y=r.createClass({displayName:"SendLogsPopup",mixins:[i],getInitialState:function(){return{email:"",emailError:void 0,confirmEmail:"",confirmEmailError:void 0,subject:l10n.t("send_logs_default_subject"),subjectError:void 0,description:"",descriptionError:void 0}},componentDidMount:function(){this.refs.emailAddr.restoreFocus()},onSend:function(){var e={},t=this.state.email.trim(),n=this.state.confirmEmail.trim();if(this.validateEmail(t)||(e.emailError=l10n.t("send_logs_email_invalid")),this.validateConfirmEmail(n)||(e.confirmEmailError=l10n.t("send_logs_email_nomatch")),this.validateDescription()||(e.descriptionError=l10n.t("send_logs_too_short")),this.validateSubject()||(e.subjectError=l10n.t("send_logs_subject_error")),_.isEmpty(e)){this.setState({email:t,confirmEmail:n,emailError:void 0,confirmEmailError:void 0,descriptionError:void 0,subjectError:void 0});var i=Store.Conn.me?c.format(Store.Conn.me.split("@")[0]):null,o=this.state.subject.trim()||l10n.t("send_logs_default_subject");l.uploadUserReport(i,t,o,this.state.description),a.closeModal(),a.openToast(r.createElement(d,{msg:l10n.t("send_logs_sent"),id:d.genId()}))}else e.email=t,e.confirmEmail=n,this.setState(e)},onCancel:function(){a.closeModal()},onSubjectChange:function(e){var t={subject:e.target.value};this.state.subjectError&&this.validateSubject(t.subject)&&(t.subjectError=void 0),this.setState(t)},onSubjectBlur:function(){var e=void 0;this.validateSubject()||(e=l10n.t("send_logs_subject_error")),this.state.subjectError!==e&&this.setState({subjectError:e})},onDescriptionChange:function(e){var t={description:e.target.value};this.state.descriptionError&&this.validateDescription(t.description)&&(t.descriptionError=void 0),this.setState(t)},onDescriptionBlur:function(){var e=void 0;!this.state.description&&!this.state.descriptionError||this.validateDescription()||(e=l10n.t("send_logs_too_short")),this.state.descriptionError!==e&&this.setState({descriptionError:e})},onEmailChange:function(e){var t={email:e.target.value};this.state.emailError&&this.validateEmail(t.email)&&(t.emailError=void 0),this.setState(t)},onEmailBlur:function(){var e=void 0,t=this.state.email.trim(),n={};!this.state.email&&!this.state.emailError||this.validateEmail(t)||(e=l10n.t("send_logs_email_invalid")),this.state.emailError!==e&&(n.emailError=e),this.state.email!==t&&(n.email=t),_.isEmpty(n)||this.setState(n)},onConfirmEmailChange:function(e){var t={confirmEmail:e.target.value};this.state.confirmEmailError&&this.validateConfirmEmail(t.confirmEmail)&&(t.confirmEmailError=void 0),this.setState(t)},onConfirmEmailBlur:function(){var e=void 0,t=this.state.confirmEmail.trim(),n={};!this.state.confirmEmail&&!this.state.confirmEmailError||this.validateConfirmEmail(t)||(e=l10n.t("send_logs_email_nomatch")),this.state.confirmEmailError!==e&&(n.confirmEmailError=e),this.state.confirmEmail!==t&&(n.confirmEmail=t),_.isEmpty(n)||this.setState(n)},validateEmail:function(){var e=arguments.length<=0||void 0===arguments[0]?this.state.email:arguments[0];return s.validateEmail(e)},validateConfirmEmail:function(){var e=arguments.length<=0||void 0===arguments[0]?this.state.confirmEmail:arguments[0];return this.state.email===e},validateDescription:function(){var e=arguments.length<=0||void 0===arguments[0]?this.state.description:arguments[0];return e.length>g},validateSubject:function(){arguments.length<=0||void 0===arguments[0]?this.state.subject:arguments[0];return!0},stopPropagation:function(e){e.stopPropagation()},render:function(){var e={enter:this.stopPropagation};return r.createElement(o,{title:l10n.t("send_logs_title"),okText:l10n.t("send_logs_confirm"),onOK:this.onSend,onCancel:this.onCancel},r.createElement(h,{handlers:e},r.createElement(u,{className:"send-logs-input",ref:"emailAddr",value:this.state.email,error:this.state.emailError,maxLength:f,onChange:this.onEmailChange,onBlur:this.onEmailBlur,placeholder:l10n.t("send_logs_email_address")}),r.createElement(u,{className:"send-logs-input",editable:!0,value:this.state.confirmEmail,error:this.state.confirmEmailError,maxLength:f,onChange:this.onConfirmEmailChange,onBlur:this.onConfirmEmailBlur,placeholder:l10n.t("send_logs_email_confirm")}),r.createElement(u,{className:"send-logs-input",value:this.state.subject,error:this.state.subjectError,maxLength:m,onChange:this.onSubjectChange,onBlur:this.onSubjectBlur,placeholder:l10n.t("send_logs_email_subject")}),r.createElement(u,{className:"send-logs-input",value:this.state.description,error:this.state.descriptionError,maxLength:v,onChange:this.onDescriptionChange,onBlur:this.onDescriptionBlur,placeholder:l10n.t("describe_logs"),multiline:!0})))}});e.exports=y},function(e,t,n){"use strict";var r=n(6),i=n(978),o=n(981),a=n(979),s=n(1080),c=n(982),l=n(976),u=n(975),d=r.createClass({displayName:"SettingsDrawer",mixins:[u],propTypes:{profileId:r.PropTypes.string.isRequired,onClose:r.PropTypes.func.isRequired,onBlocked:r.PropTypes.func.isRequired,onProfile:r.PropTypes.func.isRequired,onHelp:r.PropTypes.func.isRequired,onNotifications:r.PropTypes.func.isRequired},getInitialState:function(){return{status:this.async("profileId.Status.status")||l10n.t("contact_status_loading")}},render:function(){var e=r.createElement("div",{className:"chat",onClick:this.props.onProfile,"data-ignore-capture":"any"},r.createElement("div",{className:"chat-avatar"},r.createElement(c,{id:Store.Conn.me,size:82,quality:c.Quality.HIGH})),r.createElement("div",{className:"chat-body"},r.createElement("div",{className:"chat-main"},r.createElement("div",{className:"chat-title"},r.createElement("span",{className:"emojitext ellipsify",dir:"auto"},r.createElement(l,{text:Store.Conn.pushname,direction:"auto"})))),r.createElement("div",{className:"chat-status"},r.createElement("span",{className:"emojitext ellipsify",dir:"auto"},r.createElement(l,{text:this.state.status,direction:"auto"})))));return r.createElement(i,{id:"settings",onCancel:this.props.onClose},r.createElement(o,{title:l10n.t("settings_flow_title"),onBack:this.props.onClose,type:o.Type.LARGE}),r.createElement(a,null,r.createElement("div",{className:"chatlist list-profile"},e),r.createElement("div",{className:"chatlist list-icons list-settings"},r.createElement(s,{iconClass:"icon-settings-notifications",onClick:this.props.onNotifications},l10n.t("menuitem_notifications")),r.createElement(s,{iconClass:"icon-settings-wallpaper",onClick:this.props.onWallpaper},l10n.t("menuitem_wallpaper")),r.createElement(s,{iconClass:"icon-settings-blocked",onClick:this.props.onBlocked},l10n.t("menuitem_blocked")),r.createElement(s,{iconClass:"icon-settings-help",onClick:this.props.onHelp},l10n.t("menuitem_help")))))}});e.exports=d},function(e,t,n){"use strict";var r=n(6),i=n(129),o=n(10),a=n(12),s=r.createClass({displayName:"TermsOfServiceModal",mixins:[i],componentDidMount:function(){this.addObserver(Store.Conn,"change:tos",this.close)},close:function(){0===Store.Conn.tos&&o.closeModal()},logout:function(){o.closeModal(),a.logout()},render:function(){var e,t=null;switch(Store.Conn.tos){default:case 1:e=l10n.t("web_terms_of_service_1"),t=r.createElement("div",{className:"popup-controls"},r.createElement("button",{className:"btn-plain btn-default popup-controls-item",onClick:o.closeModal.bind(o)},l10n.t("ok_got_it")));break;case 2:e=l10n.t("web_terms_of_service_2"),t=r.createElement("div",{className:"popup-controls"},r.createElement("button",{className:"btn-plain popup-controls-item",onClick:this.logout},l10n.t("menuitem_logout")))}return r.createElement("div",{className:"backdrop"},r.createElement("div",{className:"popup-container"},r.createElement("div",{className:"popup"},r.createElement("div",{className:"popup-body"},r.createElement("div",{className:"popup-contents"},e)),t)))}});e.exports=s},function(e,t,n){"use strict";var r=n(6),i=n(977),o=n(974),a=n(10),s=n(976),c=n(410),l=r.createClass({displayName:"UnstarAllPopup",propTypes:{chat:r.PropTypes.instanceOf(i),msgs:r.PropTypes.arrayOf(r.PropTypes.instanceOf(o))},onCancel:function(){a.closeModal()},onUnstar:function(){var e=this.props.chat,t=this.props.msgs;e&&e.pendingAction++,Store.Chat.unstarAllMessages(t,e)["finally"](function(){e&&e.pendingAction--}),a.closeModal()},render:function(){return r.createElement(c,{title:l10n.t("are_you_sure"),onOK:this.onUnstar,okText:l10n.t("unstar_all_button"),onCancel:this.onCancel},r.createElement("div",null,r.createElement(s,{text:l10n.t("unstar_all_confirm")})))}});e.exports=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var n=new Uint8Array(e),r=new Uint8Array(t),i=n.length,o=r.length;if(i!==o)return!1;for(var a=0;a<i;a++)if(n[a]!==r[a])return!1;return!0}var o=n(2),a=r(o),s=n(6),c=n(34),l=n(975),u=n(10),d=n(1222).CombinedFingerprint,p=n(8),h=n(200),f=n(978),m=n(995),g=n(979),v=n(14),y=n(1e3),E=n(1),b=n(1017),S=n(980),M=n(971),T=n(431),C=n(132),w=n(133),x=n(1063),N=s.createClass({displayName:"VerificationFilePicker",propTypes:{mime:s.PropTypes.string.isRequired,onPick:s.PropTypes.func.isRequired},stopPropagation:function(e){e.stopPropagation()},render:function(){return s.createElement("input",{accept:this.props.mime,type:"file",style:{display:"none"},onChange:this.props.onPick,onClick:this.stopPropagation})}}),P=s.createClass({displayName:"VerificationQRCode",propTypes:{binary:s.PropTypes.object,contact:s.PropTypes.instanceOf(h).isRequired,visible:s.PropTypes.bool},getDefaultProps:function(){return{binary:null}},getInitialState:function(){return{hover:!1,currentQRBinary:null,currentQRDataURL:null}},componentDidMount:function(){this.props.binary&&this.generateQRCode()},componentDidUpdate:function(e,t){this.generateQRCode()},shouldComponentUpdate:function(e,t){return!(this.compareBinary(e.binary,this.props.binary)&&this.compareBinary(t.currentQRBinary,this.state.currentQRBinary)&&e.visible===this.props.visible&&t.hover===this.state.hover&&t.currentQRDataURL===this.state.currentQRDataURL)},onMouseOver:function(e){this.state.hover||this.setState({hover:!0})},onMouseEnter:function(e){this.state.hover||this.setState({hover:!0})},onMouseLeave:function(e){this.state.hover&&this.setState({hover:!1})},fingerprintsMatched:function(e,t){return i(e.publicKey,t.publicKey)&&i(e.identifier,t.identifier)},compareBinary:function(e,t){if(!e&&!t)return!0;var n=d.parse(e),r=d.parse(t);if(!n&&!r)return!0;if(!(n.version||r.version||n.localFingerprint||r.localFingerprint||n.remoteFingerprint||r.remoteFingerprint))return!0;if(n.version!==r.version)return!1;var i=this.fingerprintsMatched(n.localFingerprint,r.localFingerprint),o=this.fingerprintsMatched(n.remoteFingerprint,r.remoteFingerprint);return i&&o},generateQRCode:function(){var e=c.findDOMNode(this.refs.QRCodeContainer),t=this.props.binary;if(!e||!t)return void this.setState({currentQRBinary:null,currentQRDataURL:null});if(!this.compareBinary(this.state.currentQRBinary,t)){this.qr&&delete this.qr,this.qr=new T(e,{text:t,width:p.QR_EDGE/2,height:p.QR_EDGE/2,correctLevel:T.CorrectLevel.L}),this.setState({currentQRBinary:t});var n=e.getElementsByTagName("canvas")[0];if(!n)return void this.setState({currentQRDataURL:null});var r=n.toDataURL("image/png");this.setState({currentQRDataURL:r})}},render:function(){var e=null;if(this.props.visible){var t=null;if(this.state.hover&&this.state.currentQRDataURL){var n=this.props.contact.formattedUser,r=Store.Contact.get(Store.Conn.me).formattedUser,i="Verification Code between "+r+" and "+n+".png";t=s.createElement("a",{href:this.state.currentQRDataURL,download:i},s.createElement("div",{className:"avatar-overlay",key:"avatar-overlay"},s.createElement("div",{className:"avatar-overlay-text"},l10n.t("web_verify_download_code"))))}e=s.createElement("div",{onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},t,s.createElement("div",{className:"verification-circle",ref:"QRCodeContainer"}))}return e}}),k=s.createClass({displayName:"VerificationSpinner",propTypes:{visible:s.PropTypes.bool},render:function(){var e=null;return this.props.visible&&(e=s.createElement("div",{className:"verification-circle"},s.createElement("div",{className:"spinner"},s.createElement(C,{size:40,stroke:4})))),e}}),D=s.createClass({displayName:"VerificationCircle",propTypes:{binary:s.PropTypes.object,contact:s.PropTypes.instanceOf(h).isRequired,visible:s.PropTypes.bool},render:function(){var e=null;return this.props.visible&&(e=s.createElement("div",{className:"verification-circle-container"},s.createElement(P,{visible:!!this.props.binary,binary:this.props.binary,contact:this.props.contact}),s.createElement(k,{visible:!this.props.binary}))),e}}),O=s.createClass({displayName:"VerificationString",NUM_ROWS:3,NUM_BLOCKS_PER_ROW:4,NUM_DIGITS_PER_BLOCK:5,propTypes:{string:s.PropTypes.string},getDefaultProps:function(){return{string:null}},shouldComponentUpdate:function(e,t){return e.string!==this.props.string},numDigitsInVerificationString:function(){return this.NUM_ROWS*this.NUM_BLOCKS_PER_ROW*this.NUM_DIGITS_PER_BLOCK},render:function(){if(!this.props.string)return s.createElement("div",null,l10n.t("loading"));var e=this.props.string;if(e.length!==this.numDigitsInVerificationString())return E.error("verificationString:render this.props.stringshould be "+this.numDigitsInVerificationString()+" characters long instead of "+e.length+".")(),s.createElement("div",null,l10n.t("web_verify_string_error"));for(var t=[],n=0;n<this.NUM_ROWS;n++){for(var r=[],i=0;i<this.NUM_BLOCKS_PER_ROW;i++){for(var o=[],a=0;a<this.NUM_DIGITS_PER_BLOCK;a++){var c=e.charAt(n*this.NUM_DIGITS_PER_BLOCK*this.NUM_BLOCKS_PER_ROW+i*this.NUM_DIGITS_PER_BLOCK+a);o.push(s.createElement("span",{className:"digit",key:a},c))}r.push(s.createElement("span",{className:"block",key:i},o," "))}t.push(s.createElement("div",{className:"row",key:n},r))}return s.createElement("div",{className:"textfield-static selectable-text"},t)}}),A=s.createClass({displayName:"VerificationCheckmark",propTypes:{visible:s.PropTypes.bool},render:function(){var e=null;return this.props.visible&&(e=s.createElement("div",{className:"verification-checkmark-container"},s.createElement("div",{className:"verification-checkmark"},"✓ "))),e}}),R=s.createClass({displayName:"VerificationError",propTypes:{visible:s.PropTypes.bool},render:function(){var e=null;return this.props.visible&&(e=s.createElement("div",{className:"verification-error-container"},s.createElement("div",{className:"verification-error"},"!"))),e}}),I=s.createClass({displayName:"VerificationBanner",propTypes:{children:s.PropTypes.node.isRequired},render:function(){return s.createElement("div",{className:"error-banner"},this.props.children)}}),L=s.createClass({displayName:"VerificationWebcam",CAPTURE_INTERVAL:200,propTypes:{stream:s.PropTypes.object.isRequired,onCapture:s.PropTypes.func.isRequired,onClose:s.PropTypes.func.isRequired},mixins:[w],getInitialState:function(){return{videoURL:window.URL.createObjectURL(this.props.stream)}},componentDidMount:function(){window.addEventListener("resize",this.adjustOverlayPosition)},componentWillUnmount:function(){if(this.clearSafeInterval(this.captureInterval),this.state.videoURL){var e=this.props.stream;b.stop(e),window.URL.revokeObjectURL(this.state.videoURL)}},onVideoLoaded:function(e){this.captureInterval||(this.adjustOverlayPosition(),this.captureInterval=this.safeInterval(this.capture,this.CAPTURE_INTERVAL))},capture:function(){var e=this;if(this.refs.verificationVideo){var t=document.createElement("canvas"),n=c.findDOMNode(this.refs.verificationVideo);t.width=n.videoWidth/2,t.height=n.videoHeight/2;var r=t.getContext("2d");r.drawImage(n,t.width/2,t.height/2,t.width,t.height,0,0,t.width,t.height),t.toBlob(function(t){var n=window.URL.createObjectURL(t);E.log(n),e.props.onCapture(n)},"image/jpeg",1)}},adjustOverlayPosition:function(){var e=c.findDOMNode(this.refs.verificationVideo),t=c.findDOMNode(this.refs.verificationOverlay);if(e&&t){var n=e.offsetHeight,r=e.offsetWidth,i=r/3,o=i,a=(r-i)/2,s=(n-o)/2;t.style.width=i+"px",t.style.height=o+"px",t.style.margin=s+"px "+a+"px"}},render:function(){var e=null;return this.state.videoURL&&(e=s.createElement("div",{className:"webcam"},s.createElement(x,{autoPlay:!0,ref:"verificationVideo",onPlay:this.onVideoLoaded,src:this.state.videoURL}),s.createElement("div",{className:"overlay",ref:"verificationOverlay"}),s.createElement("button",{onClick:this.props.onClose},s.createElement("span",{className:"icon icon-x-alt"})))),e}}),F=s.createClass({displayName:"VerificationDrawer",ICON_DELAY:3e3,BANNER_DELAY:5e3,HINT_DELAY:7e3,ERROR_TYPE:{CORRECT:0,PUBLIC_KEY_MISMATCHED:1,REMOTE_MISMATCHED:2,LOCAL_MISMATCHED:3,BOTH_MISMATCHED:4,INVALID_QR_CODE:5},mixins:[l,S,w],propTypes:{contact:s.PropTypes.instanceOf(h).isRequired,isFirstLevel:s.PropTypes.bool},getInitialState:function(){return this.asyncState({binary:"contact.verificationBinary",string:"contact.verificationString"},{circleVisible:!0,checkmarkVisible:!1,errorIconVisible:!1,webcamVisible:!1,bannerVisible:!1,bannerText:null,stream:null,isDragging:!1})},componentDidUpdate:function(e,t){(t.binary&&!this.state.binary||t.string&&!this.state.string)&&this.props.contact.queryIdentity()["catch"](function(e){E.error("VerificationDrawer:queryIdentity error: "+e)()})},componentWillMount:function(){this.props.contact.queryIdentity()["catch"](function(e){E.error("verificationDrawer:queryIdentity error: "+e)()})},onDragStart:function(){this.blockDrop=!0},onDragEnd:function(){this.blockDrop=!1},onDragOver:function(){this.state.isDragging||this.blockDrop||this.setState({isDragging:!0})},onDrop:function(e){this.blockDrop||(this.setState({isDragging:!1}),this.state.binary&&this.state.string&&this.onUploadSelect(e))},onDragLeave:function(e){this.setState({isDragging:!1})},showWebcamStream:function(e){this.setState({webcamVisible:!0,circleVisible:!0,checkmarkVisible:!1,errorIconVisible:!1,stream:e}),this.hintTimer&&(this.clearSafeTimeout(this.hintTimer),delete this.hintTimer),this.hintTimer=this.safeDelay(this.showWebcamHint,this.HINT_DELAY)},showWebcamHint:function(){this.state.webcamVisible&&!this.state.bannerVisible&&this.showBanner(l10n.t("web_verify_webcam_hint"))},onWebcamOpen:function(e){var t=this,n=b.start("camera");a["default"].race([n,this.rejectOnUnmount()]).checkpoint(this.rejectOnUnmount()).then(function(e){return t.showWebcamStream(e)})["catch"](v.Unmount,function(){n.then(function(e){return b.stop(e)})["catch"](_.noop)})["catch"](v.GUM.PermissionDeniedError,function(){u.openModal(s.createElement(y,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:y.TYPE.GUIDE_UNBLOCK}))})["catch"](v.GUM.GUMError,function(){u.openModal(s.createElement(y,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:y.TYPE.GUIDE_NONE}))})},onWebcamClose:function(e){this.setState({webcamVisible:!1,bannerVisible:!1,stream:null})},onWebcamCapture:function(e){this.verifyImage(e,!0)},onUploadClick:function(){c.findDOMNode(this.refs.verificationFilePicker).click()},onUploadSelect:function(e){e.stopPropagation();var t=e.target.files||e.dataTransfer.files;if(t&&t[0]){var n=t[0],r=URL.createObjectURL(n);this.verifyImage(r,!1);var i=c.findDOMNode(this.refs.verificationFilePickerForm);i&&i.reset()}},componentWillUnmount:function(){clearTimeout(this.iconTimer),clearTimeout(this.bannerTimer),clearTimeout(this.hintTimer)},onClose:function(e){this.props.onClose?this.props.onClose():u.closeDrawerRight()},getErrorBannerText:function(e){var t=void 0,n=this.props.contact.formattedShortName;switch(e){case this.ERROR_TYPE.REMOTE_MISMATCHED:t=l10n.t("web_verify_error_remote_mismatched",{contact:n});break;case this.ERROR_TYPE.LOCAL_MISMATCHED:case this.ERROR_TYPE.BOTH_MISMATCHED:t=l10n.t("web_verify_error_local_mismatched",{contact:n});break;case this.ERROR_TYPE.INVALID_QR_CODE:default:t=l10n.t("web_verify_error_invalid_upload")}return t},showCheckmark:function(){this.onWebcamClose(),this.setState({circleVisible:!1,checkmarkVisible:!0,errorIconVisible:!1,bannerVisible:!1}),this.iconTimer&&(this.clearSafeTimeout(this.iconTimer),delete this.iconTimer),this.iconTimer=this.safeDelay(this.hideCheckmark,this.ICON_DELAY)},showErrorIcon:function(){this.onWebcamClose(),this.setState({circleVisible:!1,checkmarkVisible:!1,errorIconVisible:!0,bannerVisible:!1}),this.iconTimer&&(this.clearSafeTimeout(this.iconTimer),delete this.iconTimer),this.iconTimer=this.safeDelay(this.hideError,this.ICON_DELAY)},showErrorBanner:function(e){var t=this.getErrorBannerText(e);this.showBanner(t)},showBanner:function(e){this.setState({circleVisible:!0,checkmarkVisible:!1,errorIconVisible:!1,bannerVisible:!0,bannerText:e}),this.bannerTimer&&(this.clearSafeTimeout(this.bannerTimer),delete this.bannerTimer),this.bannerTimer=this.safeDelay(this.hideBanner,this.BANNER_DELAY)},hideCheckmark:function(){this.state.errorIconVisible||this.setState({circleVisible:!0}),this.setState({checkmarkVisible:!1})},hideError:function(){this.state.checkmarkVisible||this.setState({circleVisible:!0}),this.setState({errorIconVisible:!1})},hideBanner:function(){this.setState({bannerVisible:!1})},validateFingerprint:function(e){if(!e||0===!e.version||!e.localFingerprint||!e.remoteFingerprint)return this.ERROR_TYPE.INVALID_QR_CODE;var t=d.parse(this.state.binary),n=i(e.remoteFingerprint.identifier,t.localFingerprint.identifier),r=i(e.localFingerprint.identifier,t.remoteFingerprint.identifier);if(!n&&!r)return this.ERROR_TYPE.BOTH_MISMATCHED;if(!n)return this.ERROR_TYPE.REMOTE_MISMATCHED;if(!r)return this.ERROR_TYPE.LOCAL_MISMATCHED;var o=i(e.remoteFingerprint.publicKey,t.localFingerprint.publicKey),a=i(e.localFingerprint.publicKey,t.remoteFingerprint.publicKey);return o&&a?this.ERROR_TYPE.CORRECT:this.ERROR_TYPE.PUBLIC_KEY_MISMATCHED},decodeQRCode:function(e){return new a["default"](function(t,n){M.callback=function(e,r){if(r)n(r);else if(e.length<1)n("QR decoder did not return decoded binary");else{var i=new Uint8Array(e[0]);t(i)}},M.decode(e)})},verifyImage:function(e,t){var n=this;this.decodeQRCode(e).then(d.parse).then(function(e){var r=n.validateFingerprint(e);r?t&&r===n.ERROR_TYPE.INVALID_QR_CODE||(n.setState({errorType:r}),r===n.ERROR_TYPE.PUBLIC_KEY_MISMATCHED?n.showErrorIcon():n.showErrorBanner(r)):n.showCheckmark()})["catch"](function(e){t||(n.setState({errorType:n.ERROR_TYPE.INVALID_QR_CODE}),n.showErrorBanner(n.ERROR_TYPE.INVALID_QR_CODE))})["finally"](function(){window.URL.revokeObjectURL(e)})},render:function(){var e=null,t=null,n=null;this.state.binary&&(navigator.getUserMedia&&(e=s.createElement(m,{classes:"animate-enter2"},s.createElement("button",{className:"btn btn-info",onClick:this.state.webcamVisible?this.onWebcamClose:this.onWebcamOpen},this.state.webcamVisible?l10n.t("web_verify_webcam_close_button"):l10n.t("web_verify_webcam_open_button")))),t=s.createElement(m,{classes:"animate-enter2"},s.createElement("button",{className:"btn btn-info",onClick:this.onUploadClick},l10n.t("web_verify_upload_button")),s.createElement("p",{className:"drag-and-drop-explanation"},this.state.isDragging?l10n.t("web_verify_drag_and_drop_dragging"):null)),n=s.createElement("form",{ref:"verificationFilePickerForm"},s.createElement(N,{mime:"image/*",onPick:this.onUploadSelect,ref:"verificationFilePicker"})));var r=null;this.state.webcamVisible&&(r=s.createElement(L,{
stream:this.state.stream,onCapture:this.onWebcamCapture,onClose:this.onWebcamClose}));var i=null;this.state.bannerVisible&&(i=s.createElement(I,null,this.state.bannerText));var o="icon icon-";return o+=this.props.isFirstLevel?"x":"back",s.createElement(f,{id:"verification",onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onCancel:this.onClose},s.createElement("header",{className:"pane-header"},s.createElement("div",{className:"header-close"},s.createElement("button",{onClick:this.onClose},s.createElement("span",{className:o}))),s.createElement("div",{className:"header-body"},s.createElement("div",{className:"header-main"},s.createElement("div",{className:"header-title"},l10n.t("web_verify_title"))),s.createElement("div",{className:"header-secondary"},l10n.t("web_you"),", ",this.props.contact.formattedUser))),r,i,s.createElement(g,{classes:this.state.webcamVisible?"webcam-visible":null,editable:!0,onDragStart:this.onDragStart,onDragEnd:this.onDragEnd},s.createElement(m,{classes:"drawer-scale drawer-section-photo"},s.createElement(D,{binary:this.state.binary,contact:this.props.contact,visible:this.state.circleVisible}),s.createElement(A,{visible:this.state.checkmarkVisible}),s.createElement(R,{visible:this.state.errorIconVisible})),s.createElement(m,{classes:"animate-enter2"},s.createElement("div",{className:"verification-string"},s.createElement(O,{string:this.state.string}))),s.createElement(m,{classes:"animate-enter2"},s.createElement("p",{className:"verification-explanation"},s.createElement("span",null,l10n.t("web_verify_explanation")," "),s.createElement("a",{target:"_blank",href:p.E2E_FAQ_LINK},l10n.t("learn_more")))),e,t,n))}});e.exports=F},function(e,t,n){"use strict";var r=n(6),i=n(978),o=n(981),a=n(979),s=n(975),c=n(10),l=n(413),u=n(8),d=r.createClass({displayName:"ColorCanvas",propTypes:{colorHex:r.PropTypes.string.isRequired,isSelected:r.PropTypes.bool.isRequired,isDefault:r.PropTypes.bool.isRequired},getInitialState:function(){return{hover:!1}},onClick:function(e){var t=this.encodeColor(this.props.colorHex);t!==Store.ChatPreference.get("defaultPreference").wallpaperColor&&(Store.ChatPreference.get("defaultPreference").set("wallpaperColor",t),c.openToast(r.createElement(l,{msg:l10n.t("wallpaper_color_set"),id:l.genId()})))},onMouseOver:function(e){this.state.hover||(this.setState({hover:!0}),Store.ChatPreference.trigger("wallpaper_color_preview",this.encodeColor(this.props.colorHex)))},onMouseEnter:function(e){this.state.hover||(this.setState({hover:!0}),Store.ChatPreference.trigger("wallpaper_color_preview",this.encodeColor(this.props.colorHex)))},onMouseLeave:function(e){this.state.hover&&(this.setState({hover:!1}),Store.ChatPreference.trigger("wallpaper_color_preview"))},encodeColor:function(e){return"#ede9e4"===e?u.DEFAULT_CHAT_WALLPAPER:e},render:function(){var e="wallpaper-color-canvas";this.state.hover&&(e+=" canvas-hover"),this.props.isSelected&&(e+=" canvas-active");var t=this.props.isDefault?r.createElement("span",{className:"wallpaper-default-title"},l10n.t("default_wallpaper")):null;return r.createElement("span",{className:e,style:{backgroundColor:this.props.colorHex},onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onClick},t)}}),p=r.createClass({displayName:"ColorGrid",mixins:[s],propTypes:{id:r.PropTypes.string.isRequired,colors:r.PropTypes.array.isRequired},getInitialState:function(){return{wallpaperColor:this.async("id.ChatPreference.wallpaperColor")}},render:function(){for(var e=!0,t=this.state.wallpaperColor,n=this.props.colors.map(function(n){var i=!1,o=!1;return(t===n||t===u.DEFAULT_CHAT_WALLPAPER&&e)&&(i=!0),e&&(o=!0,e=!1),r.createElement(d,{colorHex:n,isSelected:i,isDefault:o,key:n})}),i=0;i<2;i++)n.push(r.createElement("div",{key:"emptyEl"+i,className:"wallpaper-color-empty"}));return r.createElement("div",{className:"wallpaper-color-grid"},n)}}),h=r.createClass({displayName:"WallpaperDrawer",propTypes:{onClose:r.PropTypes.func},render:function(){var e=r.createElement(p,{colors:u.WALLPAPER_COLOR,id:"defaultPreference"});return r.createElement(i,{id:"wallpaper",onCancel:this.props.onClose},r.createElement(o,{title:l10n.t("wallpaper_flow_title"),onBack:this.props.onClose,type:o.Type.LARGE}),r.createElement(a,null,e))}});e.exports=h},function(e,t,n){"use strict";var r=n(79),i=n(200),o=r.extend({Collection:"Blocklist",children:{contact:i},props:{id:"string"},initialize:function(){this.contact=Store.Contact.gadd({id:this.id}),this.listenTo(this.contact,"all",this._getEventBubblingHandler("contact"))}});e.exports=o},function(e,t,n){"use strict";var r=n(411),i=n(1195),o=r.extend({model:i,handle:function(e){var t=e.shift(),n=t.blocklist,r=_.map(n,function(e){return{id:e}});this.set(r)}});e.exports=new o},function(e,t,n){"use strict";var r=n(1),i=n(79),o=n(10),a=i.extend({Collection:"Call",props:{id:"string",type:"string",from:"string"},initialize:function(){this.listenToAndRun(this,"change:type",this.updateNotification)},updateNotification:function(){r.log("call:"+this.type+" id:"+this.id+" from:"+this.from)(),"offer"===this.type||"offer_video"===this.type?o.alertCall(this.id,this.from,"offer_video"===this.type):o.cancelCall(this.id)}});e.exports=a},function(e,t,n){"use strict";var r=n(411),i=n(1197),o=n(206),a=r.extend({model:i,handle:function(e){var t=e.shift();switch(t.type){case"offer":case"offer_video":case"accept":case"reject":case"terminate":o.tosShowCallNotification&&this.add(t,{merge:!0})}}});e.exports=new a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(18),o=r(i),a=n(2),s=r(a),c=n(6),l=n(8),u=n(1),d=n(411),p=n(977),h=n(45),f=n(29),m=n(55),g=n(10),v=n(14),y=n(64).ActionToast,E=n(64).ActionType,b=n(21),S=n(12),M=d.extend({model:p,comparator:function(e,t){return e.t?t.t?""+e.t+e.id>""+t.t+t.id?-1:1:-1:1},initialize:function(){var e=this;d.prototype.initialize.call(this),this.notSpam={},this.promises={sendUnstarAll:null},this.listenTo(this,"change:t",this.sort),this.listenTo(S,"change:stream",function(){S.stream===S.STREAM.RESUMING&&e.forEach(function(e){e.pendingMsgs=!1})})},active:function T(){var T=_.head(this.filter("active"));return T?T.id:void 0},_find:function(e){return s["default"].resolve({id:e,createdLocally:!0})},_findQuery:function(e){var t=this;return h.chatFindQuery(!!e.retry).then(function(e){return"preempted"===e?s["default"].reject("chats preempted"):(Store.Conn.platform===Store.Conn.PLATFORMS.IPHONE&&(_.isEmpty(e)?Store.Msg.trigger(l.COLLECTION_HAS_SYNCED):setTimeout(function(){Store.Msg.trigger(l.COLLECTION_HAS_SYNCED)},2500)),t.trigger(l.COLLECTION_HAS_SYNCED),s["default"].resolve(e))})},handle:function(e){var t=e.shift(),n=this;if(_.isArray(t)){var r=[],i=[];t.forEach(function(e){if("c.us"===e.id)i.push(e);else{var t=!!n.get(e.id),a=["delete","clear","archive","unarchive","star","unstar","spam","modify_tag"].indexOf(e.type)>-1;t||a?t&&a?i.push(e):u.log("Model:chat:handle received junk chat record: "+(0,o["default"])(e))():r.push(e)}});var a=_.findIndex(r,function(e){return b.isPSA(e.id)});a>-1&&(r[a].name=l10n.t("whatsapp_psa_contact_name")),n.add(r,{merge:!0}),i.forEach(function(e){var t=e.type;if("c.us"===e.id)switch(t){case"clear":u.log("Model:chat:handle:clear:all before: "+e.before)(),n.forEach(function(t){"number"==typeof e.before?t.deleteMsgsOlderThan(e.before,e.star):t.deleteMsgs(e.star)});break;case"delete":u.log("Model:chat:handle:delete:all")(),n.forEach(function(e){e["delete"]()});break;case"archive":u.log("Model:chat:handle:archive:all")(),n.forEach(function(e){e.archive=!0});break;case"unarchive":u.log("Model:chat:handle:unarchive:all")(),n.forEach(function(e){e.archive=!1});break;case"unstar":u.log("Model:chat:handle:unstar:all")(),Store.StarredMsg["delete"](),n.forEach(function(e){e.unstarAll()});break;default:u.error("Model:chat:handle unknown "+(0,o["default"])(e),e)()}else{var r=n.get(e.id);if(!r)return;switch(t){case"clear":case"star":case"unstar":if(e.keys){for(var i=e.keys.length,a="star"===t,s=[],c=[],l=[],d=!1,p=0;p<i;p++){var h,f,g,v,y,E=e.keys[p];_.isArray(E)?(h=E[0],f=E[1],g=E[2],v=new m({fromMe:f,remote:e.id,id:h,participant:g}),y=Store.Msg.get(v),y?"clear"===t?y["delete"]():(y.star=a,a&&l.push(y)):a&&(d=!0)):_.isObject(E)&&"star"===t&&(v=E.id,y=Store.Msg.get(E.id),y?(y.star=!0,l.push(y)):c.push(E)),s.push(v.toString())}"star"!==t&&"unstar"!==t||Store.StarredMsg.process(a,c,l,d),u.log("model:Chat:handle:messages:"+[t,e.id,s.join(),e.modifyTag].join())()}else"clear"===t?("number"==typeof e.before?r.deleteMsgsOlderThan(e.before,e.star):r.deleteMsgs(e.star),u.log("model:Chat:handle cleared chat:"+[e.id,e.before,e.modifyTag].join())()):"unstar"===t&&(r.unstarAll(),u.log("model:Chat:handle unstarred chat: "+e.id)());isNaN(e.modifyTag)||(r.modifyTag=e.modifyTag);break;case"delete":r["delete"](),u.log("model:Chat:handle deleted chat for "+e.id)();break;case"archive":r.archive=!0;break;case"unarchive":r.archive=!1;break;case"spam":r.notSpam=e.notSpam;break;case"modify_tag":r.modifyTag=e.modifyTag}}})}else if("leave"===t.cmd)t.gids.forEach(function(e){var t=n.get(e);t&&t.exit()});else if("preempt"===t.cmd)Store.Chat.add(t.response,{merge:!0}),Store.Conn.platform===Store.Conn.PLATFORMS.IPHONE&&(_.isEmpty(t.response)?Store.Msg.trigger(l.COLLECTION_HAS_SYNCED):setTimeout(function(){Store.Msg.trigger(l.COLLECTION_HAS_SYNCED)},2500)),this.trigger(l.COLLECTION_HAS_SYNCED);else if("action"===t.cmd){var s=t.id,c=t.data;if("create"===c[0]||"introduce"===c[0]){var d=c[1],p=c[2],h=_.map(p.admins,function(e){return{id:e,isAdmin:!0}}).concat(_.map(p.regulars,function(e){return{id:e,isAdmin:!1}}));Store.GroupMetadata.add({id:s,creation:p.creation,owner:d,participants:h,stale:!1},{merge:!0}),Store.Contact.add({id:s,name:p.subject},{merge:!0});var f=Store.Chat.get(s);if(!f)return;var v=f.msgs.last();if(!v)return;"gp2"===v.type&&"add"===v.subtype&&_.head(v.recipients)===Store.Conn.me&&g.alertNewMsg(v)}else{var y=Store.Chat.get(t.id);y?y.handleGroupAction.apply(y,t.data):u.error("model:chat: unknown chat for action "+(0,o["default"])(t))()}}else u.error("model:chat: unknown payload: "+(0,o["default"])(t))()},createGroup:function(e,t,n,r,i){var o=this,a=_.map(r,"id"),s=h.createGroup(e,a),l=new E(l10n.t("action_group_creating"));i=i||y.genId();var d=s.then(function(e){return 200===e.status?new E(l10n.t("action_group_created")):406===e.status?new E(l10n.t("action_group_create_failed")+" "+l10n.t("action_group_create_failed_406")):void 0})["catch"](function(a){return u.error("models:chatCollection:createGroup dropped")(a),new E(l10n.t("action_group_create_failed"),l10n.t("action_try_again"),o.createGroup.bind(o,e,t,n,r,i))});return g.openToast(c.createElement(y,{id:i,initialAction:l,pendingAction:d})),s.then(function(e){if(200===e.status&&e.gid&&Store.Chat.find(e.gid).then(function(e){g.openChat(e)}),200===e.status&&!e._duplicate&&t&&n){var r=Store.ProfilePicThumb.gadd(e.gid);return r.setPicture(t,n)}200===e.status&&e._duplicate&&u.error("createGroup failed to set picture.")()})},sync:function(){return this.findQuery({})["catch"](v.WapDrop,_.noop),s["default"].all([f.waitForBBEvent(this,l.COLLECTION_HAS_SYNCED),Store.Msg._hasSynced()])},resyncMessages:function(){u.log("ChatStore:resyncMessages")();var e=Store.Chat.filter(function(e){return!e.isNewlyCreated()}),t=e.map(function(e){var t=e.id,n={wid:t,archive:e.archive,mute:e.mute.expiration,active:e.active,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,unreadCount:e.unreadCount,notSpam:e.notSpam},r=e.lastReceivedKey;if(r){var i=r;n.id=i.id,n.fromMe=i.fromMe.toString(),n.participant=i.participant}return n});return h.resyncMessages(t).then(function(e){return e.status>=400?(u.error("ChatStore:resyncMessages resume error "+e.status)(),s["default"].reject(new Error("ChatStore:resyncMessages resume error "+e.status))):(u.log("ChatStore:resyncMessages resume success")(),e.checksum&&Store.Contact.resyncContacts(e.checksum),e.data.forEach(function(e){if(e.disableUnreadAnchor=!1,"delete"!==e.type&&!b.isPSA(e.id)){var t=Store.Contact.get(e.id);t?e.name&&(t.name=e.name):Store.Contact.add({id:e.id,name:e.name})}var n=Store.Chat.get(e.id);if(!n)return void Store.Chat.add(e);if("clear"===e.type){n.set({t:e.t,unreadCount:e.unreadCount,createdLocally:!1,archive:e.archive,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,msgs:[],notSpam:e.notSpam,unreadMsgAnchor:void 0,disableUnreadAnchor:e.disableUnreadAnchor,pendingMsgs:e.pendingMsgs}),n.mute.setMute(e.muteExpiration);var r=[];n.msgs.forEach(function(e){r.push(e)}),_.each(r,function(e){e["delete"]()}),u.log("model:chat:resume: cleared chat for "+e.id)()}else"delete"===e.type?(n["delete"](),u.log("model:chat:resume: deleted chat for "+e.id)()):(n.set(e,{merge:!0}),n.mute.setMute(e.muteExpiration))}),s["default"].resolve())})["catch"](v.WapDrop,function(e){return u.error("ChatStore:resyncMessages resume dropped")(),s["default"].reject(e)})},unstarAllMessages:function(e,t){var n=this,r=t?t.promises:this.promises,i=t?t.id:void 0;if(r.sendUnstarAll)return r.sendUnstarAll;r.sendUnstarAll=h.sendUnstarAll(i);var o=new E(l10n.t("action_message_unstarring_all")),a=r.sendUnstarAll.then(function(e){return 200===e.status?new E(l10n.t("action_message_unstarred_all")):e.status>=400?new E(l10n.t("action_message_unstar_all_failed")):void 0})["catch"](function(r){return u.error("models:chat:sendUnstarAll dropped")(r),new E(l10n.t("action_message_unstar_all_failed"),l10n.t("action_try_again"),function(){return n.unstarAllMessages(e,t)})});return g.openToast(c.createElement(y,{id:y.genId(),initialAction:o,pendingAction:a})),r.sendUnstarAll.then(function(n){200===n.status&&(_.forEach(e,function(e){e.set("star",!1)}),t?Store.StarredMsg.remove(e):Store.StarredMsg.reset())})["finally"](function(){r.sendUnstarAll=null})}});e.exports=new M},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(411),s=n(974),c=n(8),l={before:"before",after:"after"},u=a.extend({model:s,initialize:function(){var e=this;a.prototype.initialize.call(this),this.hasMediaBefore=!0,this.hasMediaAfter=!0,this.listenTo(Store.Msg,"remove",function(t){t.isMedia&&e.remove(t)})},contains:function(e){return this.models.indexOf(e)>-1},getAfter:function(e){var t=this.models.indexOf(e);return t<0||t===this.models.length-1?null:this.models[t+1]},getBefore:function(e){var t=this.models.indexOf(e);return t<=0?null:this.models[t-1]},loadEarlierMedias:function(){var e=this.head();e&&this.queryMedia(null,e)},loadRecentMedias:function(){var e=this.last();e&&this.queryMedia(null,e,l.after)},loadMoreAroundIfNeeded:function(e){if(e){var t=this.models.indexOf(e);t<20&&this.hasMediaBefore&&this.loadEarlierMedias(),this.models.length-t<20&&this.hasMediaAfter&&this.loadRecentMedias()}},queryMedia:function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?l.before:arguments[2];if(!t){var i=e.msgs.models;if(!i||0===i.length)return new o["default"](function(e){e({eof:!0})});this.add(i.filter(function(e){return e.isMedia}),{at:0});var a=this.models;if(this.downloadMedias(a),a.length<=2*c.MEDIA_QUERY_LIMIT){var s=0===a.length?_.head(i):_.head(a);return this.queryMedia(e,s)}return new o["default"](function(e){e({eof:!1})})}return r===l.before?this.queryMediaBefore?this.queryMediaBefore:this.queryMediaBefore=Store.Msg.queryMedia(t.id.remote,c.MEDIA_QUERY_LIMIT,r,t.id).then(function(e){(!e||e.length<c.MEDIA_QUERY_LIMIT)&&(n.hasMediaBefore=!1);var t=[];return e&&e.length>0&&(t=e.filter(function(e){return e.isMedia}),n.downloadMedias(t)),n.add(t,{at:0}),{length:t.length}})["finally"](function(){n.queryMediaBefore=null,n.trigger("query_media_before")}):r===l.after?this.queryMediaAfter?this.queryMediaAfter:this.queryMediaAfter=Store.Msg.queryMedia(t.id.remote,c.MEDIA_QUERY_LIMIT,r,t.id).then(function(e){(!e||e.length<c.MEDIA_QUERY_LIMIT)&&(n.hasMediaAfter=!1);var t=[];return e&&e.length>0&&(t=e.filter(function(e){return e.isMedia}),n.downloadMedias(t)),n.add(t),{length:t.length}})["finally"](function(){n.queryMediaAfter=null,n.trigger("query_media_after")}):void 0},downloadMedias:function(e){_.forEach(e,function(e){e.downloadMedia()})}});e.exports=u},function(e,t,n){"use strict";var r=n(79),i=r.extend({Collection:"ChatPreference",props:{id:"string",wallpaperColor:"string"}});e.exports=i},function(e,t,n){"use strict";var r=n(411),i=n(1201),o=n(8),a=r.extend({model:i,initialize:function(){r.prototype.initialize.call(this,{CachePolicy:{id:"chat_preference",policy:r.CACHE_POLICY.LOAD,delay:1e3}})},initializeFromCache:function(){this.get("defaultPreference")||this.add({id:"defaultPreference",wallpaperColor:o.DEFAULT_CHAT_WALLPAPER})},get:function(e,t){return r.prototype.get.call(this,e,t)||r.prototype.get.call(this,"defaultPreference")}});e.exports=new a},function(e,t,n){"use strict";var r=n(8),i=n(1),o=n(22),a=n(14),s={handle:function(e){var t=e.shift();switch(t.type){case"const":r[t.key]=t.value;break;case"read":case"unread":var n=Store.Chat.get(t.jid);n&&("read"===t.type?n.markSeen():"unread"===t.type&&n.markUnseen());break;case"picture":Store.ProfilePicThumb.imageChanged(t.jid,t.tag);break;case"log":o.upload("server-requested");break;case"privacy":t.jid?(Store.Presence.update(t.jid)["catch"](a.WapDrop,_.noop),Store.ProfilePicThumb.update(t.jid)["catch"](a.WapDrop,_.noop),Store.Status.update(t.jid)["catch"](a.WapDrop,_.noop)):i.error("Store:Cmd:handle:privacy no jid",t)();break;case"identity":if(t.jid){var s=Store.Contact.get(t.jid);s?s.updateIdentity(t):i.error("Store:Cmd:handle:identity no contact",t)()}else i.error("Store:Cmd:handle:identity no jid",t)();break;default:i.warn("Store.Cmd:handle:unknown "+t.type,t)()}}};e.exports=s},function(e,t,n){"use strict";var r=n(79),i=r.extend({idAttribute:"char",props:{"char":"string",variant:"string"}});e.exports=i},function(e,t,n){"use strict";var r=n(411),i=n(1204),o=n(415),a=r.extend({model:i,initialize:function(){r.prototype.initialize.call(this,{CachePolicy:{id:"emoji_variant_collection",policy:r.CACHE_POLICY.LOAD,delay:1e3}})},setVariant:function(e,t){var n=o.skinToneEmojis[e];if(!n)throw new Error("attempt to store variantless emoji");this.gadd({"char":n,variant:t})},getVariant:function(e){if(o.skinToneEmojis[e]){var t=this.get(e);return t?t.variant:null}throw new Error("attempt to get variantless emoji")}});e.exports=new a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(1),s=n(411),c=n(1015),l=n(45),u=n(14),d=n(21),p=s.extend({model:c,initialize:function(){s.prototype.initialize.call(this,{staleCollection:!0})},onResume:function(){_.union(Store.Chat.where({active:!0}).filter(function(e){return e.isGroup||e.isBroadcast}),Store.Chat.where({isBroadcast:!0})).forEach(function(e){Store.GroupMetadata.find(e.id)["catch"](u.WapDrop,_.noop)})},_find:function(e){var t=this;if(d.isGroup(e)){var n=Store.Chat.get(e);return n&&n.isReadOnly?l.groupMetadataFindFromPhone(e).then(function(t){return"ok"===t.status?t.data:"missing"===t.status?void _.defer(function(){Store.Chat.get(e)["delete"]()}):"error"===t.status?(a.error("model:GroupMetadata:find error "+t.info)(),o["default"].reject(new Error("model:GroupMetadata:find error"))):void 0}):l.groupMetadataFind(e).then(function(n){if(n.status>=400)return{id:e,stale:!1};var r=[],i=t.get(e);return i?i.participants.set(n.participants):r=n.participants,t.updateSubject(e,n.subject),{id:n.id,owner:n.owner,creation:n.creation,participants:r}})}return d.isBroadcast(e)?l.contactFindBroadcast(e).then(function(t){if(200===t.status){var n=Store.GroupMetadata.get(e);if(n&&!n.stale)return o["default"].resolve(n);var r=[];return n?n.participants.set(t.recipients):r=t.recipients,{id:e,participants:r}}return 404===t.status?o["default"].reject("False broadcast list query."):(a.error("models:GroupMetadataCollection:_find:bclist error: "+t.status)(),o["default"].reject(new Error("models:GroupMetadataCollection:_find:bclist error: "+t.status)))}):(a.log("groupMetadata:find trying to fetch non-group/bclist wid "+e)(),o["default"].reject(new Error("groupMetadata:find trying to fetch non-group/bclist wid "+e)))},_handle:function(e){return e},updateSubject:function(e,t){_.isString(t)&&Store.Contact.find(e).then(function(e){e.name||(e.name=t)})}});e.exports=new p},function(e,t,n){"use strict";e.exports={Blocklist:n(1196),Call:n(1198),Chat:n(1199),Cmd:n(1203),GroupMetadata:n(1206),Msg:n(1208),MsgInfo:n(1210),StarredMsg:n(1217),Mute:n(1211),Presence:n(1212),ProfilePicThumb:n(1213),Props:n(1214),RecentEmoji:n(1216),EmojiVariant:n(1205),Status:n(1218),ChatPreference:n(1202)}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(e.notifyName){var t=Store.Contact.get(e.sender);t&&!t.isMe&&(!t.notifyName||t.notifyName.t<e.t)&&(t.notifyName={name:e.notifyName,t:e.t})}}function o(e,t,n,r){var o=[],a=[];if(t.forEach(function(t,s){t.id instanceof w||(v.error("msgCollection:_processMultipleMessages: el.id is not a MsgKey"+(new Error).stack)(),D.upload("forgot-to-create-msgkey"),t.id=new w({from:t.from,to:t.to,id:t.id,participant:t.participant,self:t.self})),_.isString(e)&&b.isBroadcast(e)&&delete t.broadcast,"ptt"===t.type&&!t.id.fromMe&&t.ack<0&&(t.ack=0);var c=Store.Msg.get(t.id);if(c){t.ack<c.ack&&delete t.ack;for(var l in t)t.hasOwnProperty(l)&&"undefined"==typeof t[l]&&delete t[l];t.id.fromMe&&!c.clientUrl&&t.clientUrl&&(c.promises.mediaPromise?c.promises.mediaPromise.control.phoneResolved(!0):t.mediaState=M.MEDIA_STATE.INIT),n.isHistory&&(t.isNewMsg=!1);var u=c.t?_.omit(t,"t"):t;c.set(u),n.isHistory&&(c.recvFresh||r)&&!c.search?(v.warn("model:Msg:handle:processMM:"+(c.recvFresh?"dup:":"overlap:")+c.id)(),a.push(c)):n.isHistory&&c.search?(c.search=!1,v.warn("model:Msg:handle:processMM load search as history "+c.id)(),o.push(c.toJSON())):"search"!==n.add&&"resync"!==n.add||o.push(c.toJSON()),i(c)}else M.typeIsMMS(t.type)&&!t.clientUrl&&(t.id.fromMe&&0===t.ack?t.mediaState=M.MEDIA_STATE.REMOTE_UPLOADING:t.mediaState=M.MEDIA_STATE.REMOTE_NEED_UPLOAD),"search"===n.add&&(t.search=!0),n.update||o.push(t)}),0===o.length&&0===a.length){if(e&&n.pendingMsgsDone){var s=Store.Chat.get(e);s&&(s.pendingMsgs=!1)}return m["default"].resolve(t.map(function(e){return Store.Msg.get(e.id)}))}var l=d(o).then(function(e){var t=Store.Msg.add(e,{merge:!0});return _.each(t,function(e){i(e)}),t});return e?m["default"].all([l,Store.Chat.find(e)]).spread(function(i,o){var s,l,d="after"===n.add||"last"===n.add,p=!n.isHistory,h=!1;if("unread"===n.add?(s=r,o.msgChunks.push(s),l=n.firstUnreadKey):"last"===n.add&&n.resume?(s=r,h=!0):s="function"==typeof r?r():r,c(t,i,a,o,d,s||o.msgs,l,h),n.pendingMsgsDone&&(o.pendingMsgs=!1),p&&b.isBroadcast(e)&&i.forEach(function(t){if("broadcast_notification"===t.type){var n=Store.GroupMetadata.get(e);"add"===t.subtype?n.participants.add({id:t.body},{merge:!0}):"remove"===t.subtype&&n.participants.remove(t.body),o.groupMetadata.stale=!1}else t.recvFresh&&!t.isNotification&&u(t)}),S.supportsFeature(S.F.RECENT_EMOJI_SYNC)&&!Store.RecentEmoji.syncDue)for(var f=0;f<i.length;f++){var m=i[f];if(m.isNewMsg&&m.isSentByMe&&m.containsEmoji){Store.RecentEmoji.periodicSync();break}}return t.map(function(e){return Store.Msg.get(e.id)})}):l.then(function(e){return t.map(function(e){return Store.Msg.get(e.id)})})}function a(e,t,n,r,i,o){var a=r||t.msgs;if(e=_.isArray(e)?e:[e],0!==e.length){var s=a===t.msgs;if(o){s&&v.error("models:msg:store:resetMostRecentMsgs .msgs === cmc !")(),s=!0,t.lastReceivedKey=_.last(e).id,a.add(e);var c=new P;c.replace(t.msgs),t.msgChunks.push(c),t.replaceMsgsCollection(a),t.msgs.trigger("change:last",t.msgs.last())}else n?(s&&(t.lastReceivedKey=_.last(e).id),a.add(e)):a.add(e,{at:0});if(n&&s||!Store.Msg.lastReceivedReceipt[t.id])for(var l=e.length,u=l-1;u>=0;u--){var d=e[u],p=d.id;if(p.fromMe&&!d.isNotification){Store.Msg.updateLastReceipt(p.remote,d.t);break}}i&&!t.unreadMsgAnchor&&(t.disableUnreadAnchor?t.disableUnreadAnchor=!1:t.unreadMsgAnchor=_.find(e,function(e){return e.id.toString()===i.toString()}))}}function s(e,t,n,r,i){var o,a,s,c={},l={},u=n.length,d=i;if(0===u)return{msgs:t,collection:d};for(o=0;o<u;o++)a=n[o],l[a.id]=a;for(u=t.length,o=0;o<u;o++)a=t[o],c[a.id]=a;var p=[];for(u=e.length,o=0;o<u;o++)if(a=e[o],s=c[a.id],s&&p.push(s),s=l[a.id])if(s.recvFresh)p.push(s),r.removeMsg(s),s.unset("recvFresh");else{var h=r.getAllCMCs(),f=_.find(h,function(e){return e.get(a.id)});i&&f===i||(f?(f.forEach(function(e){p.push(e),delete l[e.id]}),f===r.msgs?(r.replaceMsgsCollection(i),d=r.msgs):(r.notifyMsgCollectionMerge(i,f,i),r.removeMsgsCollection(f))):(v.error("models:Msg:reorder trying to merge CMC of orphaned message "+a.id,a)(),p.push(l[a.id])))}return{msgs:p,collection:d}}function c(e,t,n,r,i,o,c,l){var u=s(e,t,n,r,o);a(u.msgs,r,i,u.collection,c,l)}function l(e){return _.isObject(e)?JSON.parse((0,h["default"])(e)):e}function u(e){function t(t){var n=new w({from:e.from,to:t,id:r.id});if(!Store.Msg.some(_.matches({id:n}))){var i=l(e);i.to=t,i.id=n,i.broadcast=!0;var o=Store.Msg.add(i,{merge:!0});Store.Chat.find(t).then(function(e){a(o,e,!0)})}}var n,r=e.id;if(!e.invis)if(e.recipients&&0!==e.recipients.length)n=e.recipients,e.recipients.forEach(t);else{var i=Store.GroupMetadata.get(r.remote);i?(n=l(i.participants),_.map(n,"id").forEach(t)):v.log("model:msgs:broadcastFanout no group_metadata rec for bclist, cant fanout: "+r.remote)()}return n}function d(e){return m["default"].all(e.map(function(e){return["image","video"].indexOf(e.type)>-1&&!parseInt(e.width||0,10)&&e.body?k.loadImage("data:image/jpeg;base64,"+e.body).then(function(t){return e.width=t.width,e.height=t.height,e})["catch"](function(t){return v.assert(!1,"fillInThumbnailDims","model:msgs:fillInThumbnailDims thumb failed to load msg: "+e.id.toString()+" error: "+t)(t),e.width=void 0,e.height=void 0,e.body=void 0,m["default"].resolve(e)}):m["default"].resolve(e)}))}var p=n(18),h=r(p),f=n(2),m=r(f),g=n(8),v=n(1),y=n(411),E=n(14),b=n(21),S=n(101),M=n(974),T=n(29),C=n(80),w=n(55),x=n(12),N=n(45),P=n(1007),k=n(993),D=n(22),O=6e4,A=y.extend({model:M,initialize:function(){y.prototype.initialize.call(this),this.lastReceivedReceipt={},this.preAck={},this.pendingAdd={},this.ftsCache={},this.listenTo(x,"change:stream",function(){x.stream===x.STREAM.DISCONNECTED&&(this.preAck={})})},_findQuery:function(e){var t,n=this;switch(e.direction){case"before":case"after":t=e.direction;break;default:t="before"}return N.msgFindQuery(t,e).then(function(r){if(r.status>=400)return v.error("model:Msg:findQuery error "+r.status)(),m["default"].reject(r.status);var i=function(){var t=n.get(e),r=Store.Chat.get(e.remote);return t?t.msgChunk:r?r.msgs:void 0};return r.forEach(function(e){e.invis=!0}),v.log("model:Msg:findQuery:got:"+r.length+":"+e.direction)(),n.processMultipleMessages(e.remote,r,{add:t,isHistory:!0},i)})},resyncChatMsgs:function(e,t){var n=this,r="number"!=typeof t||isNaN(t)?g.PAGE_SIZE:t;return N.msgFindQuery("before",{remote:e,count:r}).then(function(e){return e.status>=400?(v.error("model:Msg:resyncChatMsgs error "+e.status)(),m["default"].reject(e.status)):n.processMultipleMessages(void 0,e,{add:"resync"})})},getStarred:function(e,t,n,r){var i=this,o={count:"number"!=typeof t||isNaN(t)?g.PAGE_SIZE:t,chat:e&&_.isString(e)?e:void 0,remote:n&&n.remote,id:n&&n.id,fromMe:n&&n.fromMe,participant:n&&n.participant,media:r?"gif":void 0};return N.msgFindQuery("star",o).then(function(e){return e.status>=400?(v.error("model:Msg:getStarred error "+e.status)(),m["default"].reject(e.status)):i.processMultipleMessages(void 0,e,{add:"search"})})},incrementalStarredUpdate:function(e){return this.processMultipleMessages(void 0,e,{add:"search"})},search:function R(e){var t=arguments.length<=1||void 0===arguments[1]?1:arguments[1],n=this,r=arguments[2],i=arguments[3];if(1!==t||i)return this._search(e,t,r,i);var o=this.ftsCache[e];if(o)return o;var R=this._search(e,t,r,i);this.ftsCache[e]=R;var a=function(){n.ftsCache[e]=null};return _.delay(a,O),R["catch"](a),R},_search:function(e,t,n,r){var i=this,o={searchTerm:e,page:t&&_.isNumber(t)?t:1,count:n&&_.isNumber(n)?n:g.PAGE_SIZE,remote:r};return N.msgFindQuery("search",o).then(function(e){if(e.status>=400)return v.error("model:Msg:search error "+e.status)(),m["default"].reject(e.status);var t=_.isArray(e)?e:e.messages,n=!!_.isArray(e)||e.eof;return m["default"].props({messages:i.processMultipleMessages(void 0,t,{add:"search"}),eof:n})})},queryMedia:function(e,t,n,r,i){var o=this,a={remote:e,count:t&&_.isNumber(t)?t:g.PAGE_SIZE,id:r&&r.id,fromMe:r&&r.fromMe,participant:r&&r.participant,direction:n||"before",media:i};return N.msgFindQuery("media",a).then(function(e){return e.status>=400?(v.error("model:Msg:media error "+e.status)(),m["default"].reject(e.status)):o.processMultipleMessages(void 0,e,{add:"search"})})},getContext:function(e,t){var n=this,r=this.get(e);return r?m["default"].all([N.msgFindQuery("before",e),N.msgFindQuery("after",e)]).spread(function(i,o){return _.isArray(i)&&_.isArray(o)?(r.search=!1,m["default"].all([n.processMultipleMessages(e.remote,i,{add:"before",isHistory:!0},t),n.processMultipleMessages(e.remote,o,{add:"after",isHistory:!0},t)])):(v.error("model:msg:getContext fetch error",i,o)(),m["default"].reject(i.status||o.status))}):N.msgFindQuery("after",e).then(function(r){return _.isArray(r)?n.processMultipleMessages(e.remote,r,{add:"after",isHistory:!0},t):(v.error("model:msg:getContext:after fetch error",r)(),m["default"].reject(r.status))}).then(function(t){var r=t[0],i=r.id.clone();return i.count=e.count+1,m["default"].all([N.msgFindQuery("before",i).then(function(t){if(!_.isArray(t))return v.error("model:msg:getContext:before fetch error",t)(),m["default"].reject(t.status);var i=t[t.length-1],o=i.id;if(!o.equals(e))return v.error("model:msg:getContext:before ctx message mismatch",t)(),m["default"].reject(405);var a=function(){return r.msgChunk};return n.processMultipleMessages(e.remote,t,{add:"before",isHistory:!0},a)}),m["default"].resolve(t)])})},handle:function(e){function t(e,t){var n=new w({from:a.from,to:e,id:t,participant:void 0,selfDir:"out"}),r=o.get(n);if(r){r.updateAck(a.ack),o.updateLastReceipt(n.remote,a.t);var i=n.remote;b.isUser(i)&&(Store.MsgInfo.update(t,a.from,e,a.ack,i,a.t),b.isBroadcast(a.broadcast)&&Store.MsgInfo.update(t,a.from,a.broadcast,a.ack,i,a.t))}else v.log("Msg:out of order ack",a)(),o.preAck[n]=a}var n,r,i,o=this,a=e.shift();if("ack"===a.cmd){var s=[a.to];if(b.isBroadcast(a.to)&&1===a.ack){var c=Store.GroupMetadata.get(a.to);c&&Array.prototype.push.apply(s,_.map(c.participants.toArray(),"id"))}return s.forEach(function(e){t(e,a.id)}),!0}if("acks"===a.cmd)return a.id.forEach(function(e){t(a.to,e)}),!0;if(a.msg)return a.msg.recvFresh=!0,a.msg.isNewMsg=!0,this.processMultipleMessages(a.chat,[a.msg],{add:"after",update:"update"===a.meta.add,isHistory:!1}),!0;if(a.msgs){var l=a.msgs.length;if(!l)return!1;r=a.meta,r.isHistory=!0,"unread"===r.add&&(r.firstUnreadKey=new w({fromMe:r.unreadFromMe,remote:a.chat,id:r.unreadId,participant:r.unreadParticipant}),i=new P);for(var u=0;u<l;u++)n=a.msgs[u],n.invis=!0;return Store.Conn.platform===Store.Conn.PLATFORMS.IPHONE&&this.trigger(g.COLLECTION_HAS_SYNCED),this.processMultipleMessages(a.chat,a.msgs,r,i),!0}if(a.recent){r=a.meta,delete a.recent,delete a.meta,this.trigger(g.COLLECTION_HAS_SYNCED),r.isHistory=!0;for(var d in a)"last"===r.add&&r.resume&&(i=new P),n=a[d],n.invis=!0,this.processMultipleMessages(d,[n],r,i)}else v.log("************** Msg else clause. something strange is going on")()},_hasSynced:function(){return T.waitForBBEvent(this,g.COLLECTION_HAS_SYNCED)},"delete":function(){y.prototype["delete"].call(this),this.lastReceivedReceipt={},this.preAck={}},send:function(e){return m["default"].callSynchronously(function(){var t=e.id,n=e.toJSON();if(S.supportsFeature(S.F.SPAM)&&Store.Chat.find(e.id.remote).then(function(e){e.isTrusted()||e.sendNotSpam()["catch"](_.noop)}),e.isNewMsg=!0,!e.isGroupMsg&&Store.Blocklist.get(e.to))return m["default"].reject(new E.ContactBlocked("Contact is blocked"));
if(b.isBroadcast(n.to))var r=u(n);delete n.status,delete n.mimetype,delete n.height,delete n.width,delete n.recipients,delete n.chat,delete n.broadcast,delete n.ack,delete n.invis,delete n.filehash,delete n.recvFresh,C.isHttp(e.url)||delete n.url,C.isHttp(e.clientUrl)||delete n.clientUrl;for(var i in n)null!==n[i]&&"undefined"!=typeof n[i]||delete n[i];return e.isMMS&&(n.avparams=e.avParams()),"chat"!==n.type||"url"!==n.subtype||S.supportsFeature(S.F.URL)||delete n.subtype,n.quotedMsg&&!S.supportsFeature(S.F.REPLIES_OUT)&&(delete n.quotedMsg,delete n.quotedStanzaID,delete n.quotedParticipant),n.mentionedJidList&&!S.supportsFeature(S.F.MENTIONS_OUT)&&delete n.mentionedJidList,Store.Chat.find(e.id.remote).then(function(t){return t.sendSeen(),m["default"].props({reply:N.msgCreateRecord(n,e.local),chat:t})}).then(function(n){var i=n.reply,o=n.chat;if(200===i.status){var a=t.remote,s=t.fromMe&&t.remote===Store.Conn.me?3:i.data?i.data.ack:1;return e.updateAck(s),o.lastReceivedKey=t,Store.Msg.updateLastReceipt(a,i.t),b.isBroadcast(a)&&(r?r.forEach(function(e){var n=new w({from:Store.Conn.me,to:e.id,id:t.id}),r=Store.Msg.get(n);r&&(r.ack=1,Store.Msg.updateLastReceipt(e,r.t),Store.Chat.find(e).then(function(e){e.lastReceivedKey=n}))}):v.log("model:msg:createRecord bclist server ack, no recipients")()),"success"}return 408!==i.status&&v.assert(!1,"send-not-200","Phone responded "+i.status)(),"dropped"})["catch"](function(e){return v.error("model:msg:createRecord dropped msg: "+n.id)(n.type),v.assert(!1,"send-msg-error","Got error "+e)(e),"dropped"})})},resyncReceipts:function(){v.log("Msg:resyncReceipts")();var e=[];for(var t in Store.Msg.lastReceivedReceipt){var n,r=Store.Chat.get(t);if(n=r?S.gte([0,5])?r.getFirstMsgWithStatus():r.getFirstMsgFromMe():void 0){var i=n.id;i.t=Store.Msg.lastReceivedReceipt[t]||n.t||0,e.push(i)}else v.error("Msg:resyncReceipts wid in lastReceivedReceipt, but no msg: "+t)()}return 0===e.length?m["default"].resolve():N.resyncReceipts(e).then(function(e){_.isArray(e)?(v.log("Msg:resyncReceipts success")(),e.forEach(function(e){Store.Msg.updateLastReceipt(e.id,e.t),e.acks.forEach(function(t){if(4===t.length){var n=new w({fromMe:t[1],remote:e.id,id:t[0],participant:t[2]}),r=Store.Msg.get(n);r&&r.updateAck(t[3])}else v.error("Msg:resyncReceipts invalid response: "+(0,h["default"])(t))()})})):v.error("Msg:resyncReceipts error",e)()})["catch"](E.LogoutDrop,E.EphemeralDrop,E.BrowserReplacedDrop,_.noop)["catch"](function(e){throw v.error("Msg:resyncReceipts dropped "+e+" "+(e?e.stack:"no stack"))(),new Error("Msg:resyncReceipts dropped")})},updateLastReceipt:function(e,t){var n=this.lastReceivedReceipt[e];(!n||t>n)&&(this.lastReceivedReceipt[e]=t)},processMultipleMessages:function(e,t,n,r){var i=this,a=arguments;if(e){var s,c=this.pendingAdd[e];return s=c?c.then(function(){return o.apply(i,a)}):o.apply(i,a),s["finally"](function(){i.pendingAdd[e]===s&&(i.pendingAdd[e]=null)}),this.pendingAdd[e]=s}return o.apply(i,a)}});e.exports=new A},function(e,t,n){"use strict";var r=n(79),i=n(1084),o=n(200),a=n(421),s=n(423),c=r.extend({props:{id:"id",t:"number"},children:{contact:o},initialize:function(){this.contact=Store.Contact.gadd({id:this.id}),this.listenTo(this.contact,"all",this._getEventBubblingHandler("contact"))},getCollection:function(){return this.collection}}),l=a.extend(s,{model:c,comparator:function(e,t){return o.Comparator(e.contact,t.contact)},isStateStale:function(e){var t=this.get(e);return t&&t.stale}}),u=r.extend(i,{Collection:"MsgInfo",props:{id:"msgKey",isPTT:"boolean",playedRemaining:{type:"number","default":0},readRemaining:{type:"number","default":0},deliveryRemaining:{type:"number","default":0}},collections:{played:l,read:l,delivery:l},derived:{settled:{deps:["isPTT","playedRemaining","readRemaining"],fn:function(){return this.isPTT?!this.playedRemaining:!this.readRemaining}}}});e.exports=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(1),s=n(21),c=n(55),l=n(411),u=n(974),d=n(1209),p=n(12),h=n(45),f=l.extend({model:d,initialize:function(){l.prototype.initialize.call(this,{staleCollection:!0})},_initializeStaleCollection:function(){var e=this;this.listenTo(p,"change:stream",function(){p.stream===p.STREAM.DISCONNECTED&&e.forEach(function(e){e.settled||e.set("stale",!0)})})},_find:function(e){var t=Store.Msg.get(e);return t?t.isSentByMe?h.queryMsgInfo(t.id).then(function(e){return e.status>=400?(a.log("model:MsgInfo:findQuery error "+e.status)(),o["default"].reject(e.status)):(e.id=t.id,e.isPTT=t.type===u.TYPE.PTT,o["default"].resolve(e))}):o["default"].reject("message not sent by me"):o["default"].reject("No message found for id: "+e)},update:function(e,t,n,r,i,o){var l=new c({from:t,to:n,id:e,participant:i}),u=new c({from:t,to:n,id:e}),d=this.get(l)?this.get(l):this.get(u),p=s.isUser(u.remote),h=void 0,f=void 0;if(d)switch(r){case 4:if(h=d.played.get(i),h||(d.played.add({id:i,t:o}),d.playedRemaining-=1),p)break;case 3:if(f=d.read.filter(function(e){return e.id===i}),d.read.remove(f),3===r&&(d.read.add({id:i,t:o}),0===f.length&&(d.readRemaining-=1)),p)break;case 2:f=d.delivery.filter(function(e){return e.id===i}),d.delivery.remove(f),2===r&&(d.delivery.add({id:i,t:o}),0===f.length&&(d.deliveryRemaining-=1));break;default:a.error("model:MsgInfo:handle ack err: "+r,arguments)()}},handle:function(e){var t=this,n=e.shift();switch(n.cmd){case"ack":this.update(n.id,n.from,n.to,n.ack,n.participant,n.t);break;case"acks":n.id.forEach(function(e){t.update(e,n.from,n.to,n.ack,n.participant,n.t)})}}});e.exports=new f},function(e,t,n){"use strict";var r=n(1),i=n(411),o=n(1085),a=n(15),s="global_mute",c=!0,l=!0,u=!0,d=i.extend({model:o,initialize:function(){i.prototype.initialize.call(this,{CachePolicy:{id:"mute",policy:i.CACHE_POLICY.LOAD,delay:1e3}})},initializeFromCache:function(){var e=a.getGlobalSounds();this.setGlobalSounds(e);var t=a.getGlobalNotifications();this.setGlobalNotifications(t);var n=a.getGlobalPreviews();this.setGlobalPreviews(n)},saveToCache:function(){if(Store.Conn.me){var e=this._config.CachePolicy.id;r.log("models:mute:cache-save: "+e)(),a.setCollection(e,[this.globalMute().toJSON()])}},globalMute:function(){var e=this.get(s);return e?e:this.add({id:s})},getGlobalSounds:function(){return c},setGlobalSounds:function(e){c=e,a.setGlobalSounds(e)},getGlobalNotifications:function(){return l},setGlobalNotifications:function(e){l=e,a.setGlobalNotifications(e)},getGlobalPreviews:function(){return u},setGlobalPreviews:function(e){u=e,a.setGlobalPreviews(e)},handle:function(e){for(var t=0;t<e.length;t++){var n=e[t],r=Store.Chat.get(n.id);r&&"mute"===n.type&&r.mute.setMute(n.muteExpiration)}}});e.exports=new d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(1),s=n(411),c=n(1016),l=n(45),u=n(65),d=n(14),p=s.extend({model:c,initialize:function(){s.prototype.initialize.call(this,{staleCollection:!0}),this.listenTo(u,"change:phoneActive",this.onPresenceSubscribabilityChange)},_find:function(e){var t=this.gadd(e);return t.isUser?(t.isSubscribed=!0,l.presenceSubscribe(e)["catch"](function(e){return t.isSubscribed=!1,o["default"].reject(e)})["catch"](d.WapDrop,_.noop),l.lastseenFind(e).then(function(n){return 423===n.status?{id:e,stale:!0,hasData:!1}:401===n.status?(t.handle({id:e,deny:!0}),{id:e}):(n.id=e,t.handle(n),{id:e})})):o["default"].resolve({id:e})},handle:function(e){var t=e.shift();if(t.id===Store.Conn.me)"unavailable"===t.type?this.forEach(function(e){"unavailable"===e.type||e.stale||this.add({id:e.id,type:"unavailable",t:t.t,stale:!1},{merge:!0})}.bind(this)):a.log('models:presence:handle for self is not "unavailable" !')();else{var n=this.get(t.id);n&&("unsubscribe"===t.type?n.set({isSubscribed:!1,stale:!0}):(n.handle(t),n.stale=!1))}},onPresenceSubscribabilityChange:function(){u.phoneActive?Store.Chat.forEach(function(e){e.active&&e.presence.isUser&&e.presence.update()["catch"](d.WapDrop,_.noop)}):this.forEach(function(e){e.reset(),e.set({stale:!0,isSubscribed:!1})})}});e.exports=new p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(1),s=n(411),c=n(433),l=n(15),u=n(45),d=n(14),p=n(21),h=n(426),f=n(65),m=n(12),g=s.extend({model:c,initialize:function(){s.prototype.initialize.call(this,{staleCollection:!0,CachePolicy:{id:"profile_pic_thumb",trigger:"change:tag change:raw",policy:s.CACHE_POLICY.LOAD,delay:5e3}}),this.listenTo(f,"change:phoneActive",function(){f.phoneActive&&this.onPhoneActive()})},get:function(e){var t=s.prototype.get.call(this,e);if(!_.isString(e))return t;var n=s.prototype.get.call(this,h(e));if(n){if(this.remove(n,{silent:!0}),t)return t;var r=n.toJSON();return r.id=e,this.add(r,{silent:!0})}return t?t:void 0},saveToCache:function(){if(Store.Conn.me){var e=this._config.CachePolicy.id,t=this.models.filter(function(e){return p.isWid(e.id)});t=t.map(function(e){return e=e.toJSON(),e.id=h(e.id),e}),a.log("models:profilePic:cache-save: "+e)(),l.setCollection(e,t)}},onPhoneActive:function(){if(m.stream===m.STREAM.CONNECTED){var e=[];this.forEach(function(t){t._uiObservers&&t.stale&&(t.tag||t.unset("tag",{silent:!0}),e.push(t))}),this.resyncPictures(e)}},onResume:function(){var e=this.filter(_.property("_uiObservers")).map(function(e){return e.tag||e.unset("tag",{silent:!0}),e});this.resyncPictures(e)},_find:function(e){var t=Store.Chat.get(e);return t&&t.isReadOnly?u.profilePicFindThumbFromPhone(e,this.get(e)):u.profilePicFind(e).then(function(t){return 401===t.status?{id:e,raw:void 0,tag:""}:423===t.status?{id:e,stale:!0}:t.status>=400?{id:e,tag:null}:"undefined"==typeof t.status?{id:e,tag:t.tag,raw:null,eurl:t.eurl}:void 0})["catch"](d.WapDrop,function(){return{id:e,stale:!0}})},imageChanged:function(e,t){var n=Store.ProfilePicThumb.get(e);n&&("remove"===t?n.unset("tag"):n.tag!==t&&n.update()["catch"](d.WapDrop,_.noop))},resyncPictures:function(e){return 0===e.length?o["default"].resolve():u.resyncPictures(e.map(function(e){return{id:e.id,tag:e.tag}})).then(function(e){if(423===e.status)a.warn("ProfilePicThumbStore:resyncPictures blocked")();else{if(e.status>=400)throw a.error("ProfilePicThumbStore:resyncPictures error "+e.status)(e),new Error("ProfilePicThumbStore:resyncPictures error");if(!_.isArray(e))throw a.error("ProfilePicThumbStore:resyncPictures unknown reply",e)(),new Error("ProfilePicThumbStore:resyncPictures unknown reply");a.log("ProfilePicThumbStore:resyncPictures success")(),e.forEach(function(e){var t=Store.ProfilePicThumb.get(e.id);t&&t.set({tag:e.tag,raw:void 0,stale:!1})})}})["catch"](d.WapDrop,_.noop)["catch"](function(e){a.error("ProfilePicThumbStore:resyncPictures dropped: "+e)()})}});e.exports=new g},function(e,t,n){"use strict";function r(e){return"number"==typeof e&&e>0?e-1:s.MAX_GROUP_SIZE}function i(e){return"number"==typeof e&&e>0?1024*e*1024:s.MAX_MEDIA_UPLOAD_SIZE}function o(e){return"number"==typeof e&&e>0?1024*e:s.IMG_MAX_BYTES}function a(e){var t;c.Global.webcBucket=e.bucket||null;for(t in d)if("undefined"!=typeof e[t]){var n,r,i=d[t];_.isArray(i)?(n=i[0],r=i[1](e[t])):(n=i,r=e[t]),n&&(s[n]=r)}for(t in u.F)"undefined"!=typeof e[t]&&u.setFeature(t,!!e[t])}var s=n(8),c=n(56),l=n(45),u=n(101),d={bucket:null,gifSearch:"SHOW_GIF_SEARCH",imageMaxEdge:"IMG_MAX_EDGE",imageMaxKBytes:["IMG_MAX_BYTES",o],maxParticipants:["MAX_GROUP_SIZE",r],maxSubject:"MAX_SUBJECT_LENGTH",media:["MAX_MEDIA_UPLOAD_SIZE",i]},p={handle:function(e){var t=e.shift();"number"==typeof t.status&&t.status>=400||a(t)},fetch:function(){return l.queryServerProps().then(function(e){"number"==typeof e.status&&e.status>=400||a(e)})}};e.exports=p},function(e,t,n){"use strict";var r=n(79),i=r.extend({idAttribute:"char",props:{"char":"string",weight:"number"}});e.exports=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(8),s=n(1),c=n(411),l=n(1215),u=n(45),d=n(14),p=n(415),h=n(101),f=c.extend({model:l,comparator:function(e,t){return e.weight>t.weight?-1:1},initialize:function(){c.prototype.initialize.call(this,{CachePolicy:{id:"recent_emoji_collection",policy:c.CACHE_POLICY.LOAD,delay:2e3}}),this.listenTo(this,"change:weight change:length",this.sortTrimScale),this.dirty=!1,this.syncDue=!1},"delete":function(){c.prototype["delete"].call(this),this.dirty=!1,this.syncDue=!1},_findQuery:function(e){return h.supportsFeature(h.F.RECENT_EMOJI_SYNC)?u.recentEmojiQuery(e?this.toArray():void 0).then(function(e){return _.isArray(e)?(e.forEach(function(e){e["char"]=p.normalizeEmoji(e["char"])}),o["default"].resolve(e)):(s.error("models:recentEmoji:findQuery error",e)(),o["default"].reject("recent emoji fetch error"))}):o["default"].reject("gk recent emoji sync unsupported")},sync:function(){var e=this;return this.findQuery(this.dirty)["finally"](function(){e.dirty=!1})["catch"](d.WapDrop,_.isString,_.noop)},_sync:_.throttle(function(e,t){e.sync()["finally"](t)},a.EMOJI_SYNC_DELAY,{leading:!1}),periodicSync:function(){h.supportsFeature(h.F.RECENT_EMOJI_SYNC)&&(s.log("models:recentEmoji:periodicSync due:"+this.syncDue+" dirty: "+this.dirty)(),this.syncDue=!0,this._sync(this,function(){this.syncDue=!1}.bind(this)))},sortTrimScale:function(){var e=this.length;e&&(this.sort(),e>30&&this.remove(this.models.slice(30)),_.head(this.models).weight<10&&_.last(this.models).weight>.01||this.forEach(function(t,n){t.weight=1+3*((e-n)/e)}))},increment:function(e){this.forEach(function(t){t["char"]===e?t.weight+=1:t.weight*=.9,t.weight=Math.round(1e3*t.weight)/1e3}),this.get(e)||this.add({"char":e,weight:1}),this.dirty=!0,this.periodicSync()}});e.exports=new f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(411),s=n(974),c=n(12),l=n(101),u=n(1),d=n(8),p=a.extend({model:s,initialize:function(){var e=this;a.prototype.initialize.call(this);var t={NONE:"none",SYNCING:"syncing",READY:"ready"};this.ALL="all",this.SYNC_STATES=t,this.syncState={},this.syncState[this.ALL]=this.SYNC_STATES.NONE,this.syncedAll={},this.loadMarker={},this.syncPromise=o["default"].resolve(),this.listenTo(c,"change:stream",function(){c.stream===c.STREAM.DISCONNECTED?e.syncState[e.ALL]=e.SYNC_STATES.NONE:c.stream===c.STREAM.CONNECTED&&e["delete"]()})},comparator:function(e,t){return t.t-e.t},process:function(e,t,n,r){r?this["delete"]():this.update(e,t,n)},sync:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]||arguments[0],n=arguments[1],r=n||this.ALL;if(!t&&this.syncState[r]===this.SYNC_STATES.READY||this.syncState[r]===this.SYNC_STATES.SYNCING)return this.syncPromise;if(l.supportsFeature(l.F.FULL_TEXT_SEARCH)){var i,o=function(){i=e;var t=e.syncState[r]||e.SYNC_STATES.NONE;if(e.syncState[r]=e.SYNC_STATES.SYNCING,e.trigger("sync"),!l.supportsFeature(l.F.STARRED_PAGINATION))return e.syncPromise=e.syncPromise.then(function(){return Store.Msg.getStarred().then(function(e){e.length&&(i.loadMarker[r]=_.last(e).id),i.set(e),i.syncedAll[r]=!0,i.syncState[r]=i.SYNC_STATES.READY,i.trigger("sync")})["catch"](function(e){u.error("starred msg sync error: ",e)(),i.syncState[r]=t})}),{v:e.syncPromise};var o=function(){var o=e.loadMarker[r];return e.syncPromise=e.syncPromise.then(function(){return Store.Msg.getStarred(n,d.PAGE_SIZE,o).then(function(e){e.length&&(i.loadMarker[r]=_.last(e).id,i.add(e,{silent:!0})),e.length<d.PAGE_SIZE&&(i.syncedAll[r]=!0),i.syncState[r]=i.SYNC_STATES.READY,i.trigger("sync")})["catch"](function(e){u.error("starred msg sync error: ",e)(),i.syncState[r]=t})}),{v:{v:e.syncPromise}}}();return"object"==typeof o?o.v:void 0}();if("object"==typeof o)return o.v}},isSynced:function(e){return this.syncedAll[this.ALL]||this.syncedAll[e]},update:function(e,t,n){var r=this,i=this.ALL,a=this.syncState[i];a!==this.SYNC_STATES.NONE&&(this.syncPromise=this.syncPromise.then(function(){if(e){r.syncState[i]=r.SYNC_STATES.SYNCING;var s=t.length>0?Store.Msg.incrementalStarredUpdate(t):o["default"].resolve([]);return s.then(function(e){r.add(e.concat(n),{silent:!0}),r.syncState[i]=a,r.trigger("sync")})["catch"](function(e){u.error("models:starred:update:error: ",e)(),r.syncState[i]=a})}return r.filter(function(e){return!e.star}).forEach(function(e){r.remove(e.id)}),o["default"].resolve()}))},updateLoadMarker:function(e,t){var n=this.loadMarker[t];if(e===n){var r=this.get(n).t,i=t===this.ALL?this.filter(function(e){return e.t>r}):this.filter(function(e){return e.chat.id===t&&e.t>r});this.loadMarker[t]=i.length?_.last(i).id:void 0}},removeSingleton:function(e,t){var n=e.remote;this.updateLoadMarker(e,n),this.updateLoadMarker(e,this.ALL)},remove:function(e,t){var n=this;Array.isArray(e)?e.forEach(function(e){return n.removeSingleton(e,t)}):this.removeSingleton(e,t),a.prototype.remove.call(this,e,t)},"delete":function(){this.syncState={},this.syncState[this.ALL]=this.SYNC_STATES.NONE,this.syncedAll={},this.loadMarker={},this.syncPromise=o["default"].resolve(),a.prototype["delete"].call(this)}});e.exports=new p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(6),s=n(1),c=n(411),l=n(424),u=n(45),d=n(14),p=n(65),h=n(12),f=n(10),m=n(101),g=n(64).ActionToast,v=n(64).ActionType,y=c.extend({model:l,initialize:function(){c.prototype.initialize.call(this,{staleCollection:!0}),this.listenTo(p,"change:phoneActive",function(){p.phoneActive&&this.onPhoneActive()})},onPhoneActive:function(){h.stream===h.STREAM.CONNECTED&&this.onResume()},onResume:function(){this.filter(_.property("_uiObservers")).forEach(function(e){Store.Status.find(e.id)["catch"](d.WapDrop,_.noop)})},_find:function(e){return u.statusFind(e).then(function(t){return _.isNumber(t.status)?423===t.status?{id:e,stale:!0,status:""}:t.status>=400?{id:e,status:""}:void 0:{id:e,status:t.status}})["catch"](d.WapDrop,function(){return{id:e,stale:!0,status:""}})},_handle:function(e){return e},canSetMyStatus:function(){return m.supportsFeature(m.F.SET_STATUS)},setMyStatus:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],n=arguments[1];if(t=t.trim(),!t)return o["default"].reject(new d.ActionError);if(!this.canSetMyStatus())return o["default"].reject(new d.ActionError);var r=u.sendSetStatus(t),i=new v(l10n.t("action_status_setting")),c=this.get(Store.Conn.me).status;n=n||g.genId();var l=r.then(function(t){return 200===t.status?new v(l10n.t("action_status_set"),l10n.t("action_undo"),e.setMyStatus.bind(e,c,n)):t.status>=400?new v(l10n.t("action_status_set_failed")):void 0})["catch"](function(r){throw s.error("models:statusCollection:setMyStatus dropped")(r),new v(l10n.t("action_status_set_failed"),l10n.t("action_try_again"),e.setMyStatus.bind(e,t,n))});return f.openToast(a.createElement(g,{id:n,initialAction:i,pendingAction:l})),r.bind(this).then(function(e){200!==e.status||e._duplicate||(this.get(Store.Conn.me).status=t)})}});e.exports=new y},function(e,t,n){"use strict";var r=n(6),i=n(974),o=n(977),a=n(10),s=n(410),c=n(976),l=n(1028),u=n(101),d=n(129),p=r.createClass({displayName:"MultiselectFooter",mixins:[d],propTypes:{chat:r.PropTypes.instanceOf(o).isRequired,selectedMessages:r.PropTypes.arrayOf(r.PropTypes.instanceOf(i)).isRequired,onCancel:r.PropTypes.func.isRequired},componentWillMount:function(){this.componentWillReceiveProps()},componentWillReceiveProps:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=t.selectedMessages||[],r=this.props.selectedMessages;_.difference(n,r).forEach(function(t){return e.addObserver(t,"change:star")}),_.difference(r,n).forEach(function(t){return e.removeObserver(t,"change:star")})},onStarSelected:function(){this.props.chat.sendStarMsgs(this.props.selectedMessages,!0),this.props.onCancel()},onUnstarSelected:function(){this.props.chat.sendStarMsgs(this.props.selectedMessages,!1),this.props.onCancel()},onDeleteSelected:function(){var e=this,t=this.props.selectedMessages,n=function(){a.closeModal(),e.props.chat.sendDeleteMsgs(t),e.props.onCancel()},i=_.size(t),o=l10n.t("delete_message_confirmation",{count:i,_plural:i});a.openModal(r.createElement(s,{onOK:n,okText:l10n.t("web_delete"),onCancel:a.closeModal.bind(a),cancelText:l10n.t("web_cancel")},r.createElement(c,{text:o})))},onForwardSelected:function(){var e=this,t=this.props.chat.sortMsgs(this.props.selectedMessages),n=_.size(t),i=function(){e.props.onCancel()},o=_.filter(t,function(e){return e.canForward()});if(_.size(o))if(n!==_.size(o)){var c=function(){a.openModal(r.createElement(l,{msgs:o,onForward:i}),"modal-flow")};a.openModal(r.createElement(s,{title:l10n.t("confirm_forward_partial_messages_title"),onOK:c,okText:l10n.t("web_ok"),onCancel:a.closeModal.bind(a),cancelText:l10n.t("web_cancel")},l10n.t("confirm_forward_partial_messages_text")))}else a.openModal(r.createElement(l,{msgs:t,onForward:i}),"modal-flow");else a.openModal(r.createElement(s,{title:l10n.t("err_unsent_forward_title"),onOK:a.closeModal.bind(a),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text",{count:n,_plural:n})))},render:function(){var e,t=this.props.selectedMessages,n=_.size(t),o=u.supportsFeature(u.F.ENC_DOC)||_.every(t,function(e){return e.type!==i.TYPE.DOCUMENT}),a=r.createElement("button",{className:"btn-icon btn-forward",disabled:n&&o?null:"disabled",title:l10n.t("forward_message",{count:n,_plural:n}),onClick:this.onForwardSelected},r.createElement("span",{className:"icon icon-forward"}));u.supportsFeature(u.F.MESSAGE_DELETE)&&(e=r.createElement("button",{className:"btn-icon btn-delete",disabled:n?null:"disabled",title:l10n.t("delete_message",{count:n,_plural:n}),onClick:this.onDeleteSelected},r.createElement("span",{className:"icon icon-delete"})));var s;if(u.supportsFeature(u.F.STARRED)){var c,l,d;n&&_.every(t,"star")?(c=this.onUnstarSelected,l=r.createElement("span",{className:"icon icon-unstar-btn"}),d=l10n.t("unstar_message",{count:n,_plural:n})):(c=this.onStarSelected,l=r.createElement("span",{className:"icon icon-star-btn"}),d=l10n.t("star_message",{count:n,_plural:n})),s=r.createElement("button",{className:"btn-icon btn-star",disabled:n?null:"disabled",title:d,onClick:c},l)}return r.createElement("div",{className:"multi-controls"},r.createElement("button",{className:"btn-icon btn-cancel",onClick:this.props.onCancel},r.createElement("span",{className:"icon icon-x"})),r.createElement("span",{className:"multi-count"},l10n.t("selected_count",{count:n,_plural:n})),s,e,a)}});e.exports=p},function(e,t){e.exports={Action:"keyboard_action",Event:"keyboard_event",Events:{LOGGED_IN:"logged_in",LOGGED_OUT:"logged_out",ARCHIVE:"archived",MUTE:"muted",READ:"read",READ_ONLY:"read_only",CHAT_KIND:"chat_kind",ZOOM:"zoom",LAUNCH:"launch"},Actions:{PREFERENCES:"preferences",NEW_CHAT:"new_chat",NEW_GROUP:"new_group",PROFILE_STATUS:"profile_status",LOGOUT:"logout",SEARCH:"search",ZOOM_IN:"zoom_in",ZOOM_OUT:"zoom_out",ZOOM_RESET:"zoom_reset",TOGGLE_UNREAD:"toggle_unread",DELETE_CHAT:"delete_chat",DELETE_GROUP:"delete_group",EXIT_GROUP:"exit_group",TOGGLE_ARCHIVE:"toggle_archive",TOGGLE_MUTE:"toggle_mute",SEARCH_CHAT:"search_chat",NEXT_CHAT:"next_chat",PREV_CHAT:"prev_chat",CONTACT_US:"contact_us",METRIC_UPDATE:"metric_update"},Metrics:{BETA_UPDATES:"beta_updates"}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(6),s=n(8),c=n(78),l=n(129),u=n(130),d=n(21),p=n(65),h=n(14),f=n(984),m=n(209),g=a.createClass({displayName:"NotificationManager",mixins:[c,l,u],componentWillMount:function(){this.tone=new Audio(s.NOTIFICATION_TONE_PATH),this.regCmd("alert_new_msg",this.alertNewMsg),this.regCmd("alert_call",this.showCallNotification),this.regCmd("cancel_call",this.cancelCallNotification),this.addObserver(Store.Chat,"add remove reset change:archive change:unreadCount",this.updateUnreadCount),this.addObserver(Store.Chat,"change:hasUnread",this.closeNotifications),this.addObserver(p,"change:displayInfo",this.updateUnreadCount)},componentDidMount:function(){this.updateUnreadCount()},componentWillUnmount:function(){m.setTitleAndIcon(0),m.closeAllNotifications()},closeNotifications:function(e,t){t||m.closeChatNotifications(e.id)},updateUnreadCount:function(){var e;e=p.displayInfo===p.INFO.OFFLINE?-1:p.displayInfo===p.INFO.TIMEOUT?-1:Store.Chat.filter(function(e){return!e.archive&&e.isDirty()}).length,this.count!==e&&(this.count=e,m.setTitleAndIcon(e))},alertNewMsg:function(e){var t=e.chat;if(!(document.hasFocus()&&t.get("active")||Store.Mute.globalMute().isMuted)){if(t.mute.isMuted){if(!e.isGroupMsg)return;if(!e.isMentioned(Store.Conn.me)&&!e.isQuoted(Store.Conn.me))return;var n=Store.Chat.get(e.sender);if(n&&n.mute.isMuted)return}if(Store.Mute.getGlobalNotifications()&&this.showDesktopNotification(e),Store.Mute.getGlobalSounds())if(t.isGroup){var r=Date.now(),i=t.squelch||0;r>i&&(this.playAudioNotification(),Store.GroupMetadata.find(t.id).then(function(e){var n=e.participants.length,i=1e3*Math.min(120,30+5*n);t.squelch=r+i})["catch"](h.WapDrop,function(){t.squelch=r+6e4}))}else this.playAudioNotification()}},showCallNotification:function(e,t,n){if(window.Notification&&window.Notification.permission===s.PERMISSION_ALLOWED){var r=Store.Contact.get(t),i=r?r.get("formattedName"):d.formattedUser(t),a=n?l10n.t("incoming_video_call_notification_title",{name:i}):l10n.t("incoming_voice_call_notification_title",{name:i}),c=l10n.t("incoming_call_notification_text");Store.ProfilePicThumb.find(t).timeout(1e3,"showCallNotificationTimeout").then(function(n){var r=n&&n.get("img")?n.get("img"):s.USER_DEFAULT_ICON;m.showNotification(t,e,a,c,r,!0)})["catch"](h.WapDrop,o["default"].TimeoutError,function(n){m.showNotification(t,e,a,c,s.USER_DEFAULT_ICON,!0)}),Store.Mute.getGlobalSounds()&&this.playAudioNotification()}},cancelCallNotification:function(e){m.closeNotification(e),Store.Call.remove(Store.Call.get(e))},showDesktopNotification:function(e){if(window.Notification&&window.Notification.permission===s.PERMISSION_ALLOWED){var t=e.get("chat"),n=t.get("id"),r=f.asDesktopNotification(e);r&&r.charCodeAt(0)>=128&&(r=" "+r);var i=t.isGroup?s.GROUP_DEFAULT_ICON:s.USER_DEFAULT_ICON,a=t.isGroup?l10n.t("default_group_message_notification_title"):l10n.t("default_contact_message_notification_title");Store.ProfilePicThumb.find(n).timeout(1500,"showDesktopNotificationTimeout").then(function(o){var s=t.contact.formattedName||a,c=o?o.img:"";m.showNotification(n,e.id,s,r,c||i,!1)})["catch"](h.WapDrop,o["default"].TimeoutError,function(o){var s=t.contact.formattedName||a;m.showNotification(n,e.id,s,r,i,!1)})}},playAudioNotification:function(){this.tone.play()},render:function(){return null}});e.exports=g},function(e,t,n){"use strict";function r(e){s(this,r,e)}function i(e){s(this,i,e)}var o=n(211),a=o.defineProtobufClass,s=o.construct,c=3,l=13,u=14;a(r,{publicKey:[1,l],identifier:[2,l]}),a(i,{version:[1,c],localFingerprint:[2,u,r],remoteFingerprint:[3,u,r]}),e.exports={FingerprintData:r,CombinedFingerprint:i}},function(e,t){"use strict";var n=window.matchMedia("\nonly screen and (max-width: 1024px)\n"),r={column:n.matches?2:3},i=function(e){var t=e.matches?2:3;if(r.column!==t){r.column=t;var n=document.createEvent("Event");n.initEvent("columnChange",!0,!0),window.dispatchEvent(n)}};n.addListener(i),e.exports=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var n="​",r="⁠",i=r+r,o=r+r+r,a=i+"([^"+r+"]+)"+o,s=r+r+r+r,c=r+r+r+r+r,l=s+"[^"+r+"]+"+c;if(e=e.replace(new RegExp(n,"g"),""),e=e.replace(new RegExp(""+l,"g"),""),e=e.replace(new RegExp("^[^"+r+"]+"+c+"(.*)","g"),"$1"),e=e.replace(new RegExp("(.*)"+s+"[^"+r+"]+$","g"),"$1"),!new RegExp("^"+a).test(e)&&new RegExp(""+a,"g").test(e)){for(var u,d=t.getRangeAt(0).startContainer,p=0;p<5&&!(u=d.getAttribute&&d.getAttribute("data-id"));p++)d=d.parentNode;var h=Store.Msg.get(u);if(h){var f="["+m.timeStr(h.t)+"]",g=h.senderObj.formattedUser;e=i+f+" "+g+": "+o+e}}e=e.replace(new RegExp("^(.*)"+a+"$","g"),"$1");var v=e.match(new RegExp(a,"g"));return v&&1===v.length&&(e=e.replace(new RegExp(a,"g"),"")),e=e.replace(new RegExp(""+a,"g"),"\n$1"),"\n"===e.charAt(0)&&(e=e.slice(1)),e}function o(e){var t=_.range(e.rangeCount).map(function(t){return e.getRangeAt(t).cloneContents()}).map(s).join("");return i(t,e)}function a(e){var t={},n=_.range(e.rangeCount).map(function(t){return e.getRangeAt(t).cloneContents()}).map(function(e){return c(e,t)}).join("");return(0,p["default"])({text:i(n,e),jids:t})}function s(e){return e instanceof HTMLImageElement?e.alt:e.nodeType===Node.TEXT_NODE?e.nodeValue:_.map(e.childNodes,s).join("")}function c(e,t){if(e instanceof HTMLImageElement)return e.alt;if(e.nodeType===Node.TEXT_NODE)return e.nodeValue;if(u(e)){var n=e.getAttribute("data-jid");return t[n]=!0,"@"+h.user(n)}var r=l(e)||"",i=_.map(e.childNodes,function(e){return c(e,t)}).join("");return r?""+r+i+r:i}function l(e){switch(e.tagName){case"CODE":return"```";case"STRONG":return"*";case"EM":return"_";case"DEL":return"~";default:return""}}function u(e){return e&&e instanceof HTMLSpanElement&&e.hasAttribute("data-jid")&&e.getAttribute("data-display")===f.NodeToEmoji(e)}var d=n(18),p=r(d),h=n(21),f=n(415),m=n(196);e.exports={asPlainText:o,asRichText:a}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),o=r(i),a=n(1236),s=n(201),c=n(1),l={enrich:function(e){switch(s.previewType(e.mimetype)){case"pdf":return this.enrichPdf(e);case"msoffice":return this.enrichDoc(e);default:return o["default"].resolve(e)}},enrichPdf:function(e){var t,n=e.blob;return a.fileToPdf(n).then(function(n){return t=n,a.pdfToImg(n,1).then(function(t){return e.documentPreview=t,e.documentPreview.pdfPages=n.numPages,e})})["catch"](function(t){return c.log("pdf preview generation failed",t)(),e})["finally"](function(){return a.releasePdf(t)})},enrichDoc:function(e){return o["default"].resolve(e)}};e.exports=l},function(e,t){"use strict";e.exports={SMILEYS_PEOPLE:["ordered1456","ordered1500","ordered1457","ordered1458","ordered1459","ordered1460","ordered1461","ordered1462","ordered1463","ordered1465","ordered1466","ordered1522","ordered1523","ordered0078","ordered1467","ordered1468","ordered1469","ordered1480","ordered1479","ordered1481","ordered1482","ordered1484","ordered1485","ordered1483","ordered1749","ordered1751","ordered1470","ordered1755","ordered1471","ordered1510","ordered1472","ordered1473","ordered1474","ordered1524","ordered1752","ordered1507","ordered1486","ordered1487","ordered1488","ordered1489","ordered1476","ordered1477","ordered1521","ordered0077","ordered1491","ordered1478","ordered1499","ordered1497","ordered1492","ordered1502","ordered1505","ordered1496","ordered1504","ordered1503","ordered1494","ordered1495","ordered1490","ordered1493","ordered1498","ordered1475","ordered1501","ordered1509","ordered1506","ordered1748","ordered1511","ordered1750","ordered1753","ordered1508","ordered1200","ordered1205","ordered1464","ordered1105","ordered1094","ordered1095","ordered1096","ordered1106","ordered0069","ordered1103","ordered1104","ordered1754","ordered1514","ordered1512","ordered1513","ordered1515","ordered1516","ordered1517","ordered1520","ordered1519","ordered1518","ordered1576","ordered0923","ordered0911","ordered0917","ordered0893","ordered0150","ordered0899","ordered0881","ordered0887","ordered0869","ordered0875","ordered0905","ordered0063","ordered0162","ordered0156","ordered1413","ordered0929","ordered1206","ordered1606","ordered1425","ordered1756","ordered1419","ordered0168","ordered1138","ordered0867","ordered0868","ordered0855","ordered0861","ordered0853","ordered0852","ordered1446","ordered0954","ordered0955","ordered1070","ordered0956","ordered0962","ordered0968","ordered0974","ordered1029","ordered1028","ordered1058","ordered1064","ordered1040","ordered1047","ordered1046","ordered1009","ordered1008","ordered1077","ordered1076","ordered1120","ordered1119","ordered1393","ordered1392","ordered0622","ordered1088","ordered1022","ordered1097","ordered1550","ordered1549","ordered1108","ordered1107","ordered1526","ordered1525","ordered1538","ordered1537","ordered1565","ordered1564","ordered1595","ordered1594","ordered1583","ordered1582","ordered1157","ordered1156","ordered1145","ordered1144","ordered1131","ordered1021","ordered1020","ordered1700","ordered1699","ordered0685","ordered0684","ordered1005","ordered1007","ordered1006","ordered1180","ordered1181","ordered1179","ordered1176","ordered1177","ordered1175","ordered0990","ordered0992","ordered0993","ordered0991","ordered0994","ordered1000","ordered1002","ordered1003","ordered1001","ordered1004","ordered0985","ordered0987","ordered0988","ordered0986","ordered0989","ordered0995","ordered0997","ordered0998","ordered0996","ordered0999","ordered0980","ordered0982","ordered0983","ordered0981","ordered0984","ordered0944","ordered0939","ordered0940","ordered0938","ordered0941","ordered0943","ordered0942","ordered1137","ordered1171","ordered0953","ordered0950","ordered0951","ordered0952","ordered0948","ordered0949","ordered0936","ordered0658","ordered0641","ordered0935","ordered0119","ordered0640","ordered0947","ordered0945","ordered0946","ordered1229","ordered0937","ordered1404","ordered1173","ordered0493"],
ANIMALS_NATURE:["ordered0842","ordered0837","ordered0833","ordered0845","ordered0836","ordered0847","ordered0848","ordered0828","ordered0835","ordered1763","ordered0834","ordered0843","ordered0849","ordered0844","ordered0813","ordered0841","ordered1561","ordered1562","ordered1563","ordered0806","ordered0808","ordered0827","ordered0826","ordered0824","ordered0823","ordered0825","ordered0846","ordered0811","ordered0840","ordered1766","ordered0817","ordered0815","ordered0800","ordered0818","ordered0816","ordered1405","ordered1764","ordered1762","ordered0801","ordered0822","ordered0820","ordered0819","ordered0821","ordered0832","ordered0839","ordered0799","ordered0798","ordered0794","ordered0793","ordered0791","ordered0790","ordered0792","ordered0830","ordered0831","ordered0812","ordered0804","ordered0803","ordered0805","ordered0802","ordered0810","ordered0788","ordered0789","ordered0807","ordered1765","ordered1359","ordered0809","ordered0829","ordered0796","ordered0795","ordered0851","ordered0850","ordered0797","ordered0838","ordered0542","ordered0621","ordered0539","ordered0540","ordered0541","ordered0538","ordered0552","ordered0062","ordered0553","ordered0635","ordered0633","ordered0556","ordered0555","ordered0554","ordered0551","ordered0547","ordered0548","ordered0546","ordered0544","ordered0549","ordered0545","ordered1178","ordered0557","ordered0537","ordered0620","ordered0814","ordered1406","ordered0505","ordered0504","ordered0506","ordered0512","ordered0513","ordered0514","ordered0515","ordered0508","ordered0509","ordered0510","ordered0511","ordered0517","ordered0520","ordered0518","ordered0519","ordered0521","ordered0516","ordered0206","ordered0522","ordered1212","ordered0180","ordered0057","ordered0053","ordered0525","ordered0115","ordered0526","ordered0527","ordered0054","ordered0528","ordered0116","ordered0530","ordered0107","ordered1333","ordered1201","ordered0183","ordered0529","ordered0056","ordered0114","ordered0533","ordered1204","ordered0531","ordered0532","ordered0055","ordered0060","ordered1203","ordered1202","ordered0501"],FOOD_DRINK:["ordered0568","ordered0567","ordered0569","ordered0563","ordered0564","ordered0565","ordered0562","ordered0560","ordered0572","ordered0561","ordered0571","ordered0570","ordered0566","ordered0558","ordered0559","ordered0543","ordered0550","ordered0585","ordered0600","ordered0583","ordered1767","ordered0576","ordered0575","ordered0589","ordered0604","ordered0573","ordered0584","ordered0534","ordered0574","ordered0582","ordered0535","ordered0536","ordered0581","ordered0603","ordered0590","ordered0588","ordered0602","ordered0580","ordered0578","ordered0579","ordered0577","ordered0587","ordered0586","ordered0592","ordered0593","ordered0591","ordered0601","ordered0619","ordered0599","ordered0597","ordered0598","ordered0596","ordered0616","ordered0594","ordered0595","ordered0611","ordered0612","ordered0608","ordered0609","ordered0610","ordered0615","ordered0607","ordered0606","ordered0061","ordered0613","ordered0605","ordered0614"],ACTIVITY:["ordered0112","ordered0681","ordered0711","ordered0113","ordered0679","ordered0742","ordered0712","ordered0666","ordered0745","ordered0780","ordered0744","ordered0743","ordered0741","ordered0781","ordered0127","ordered0652","ordered0131","ordered0680","ordered0130","ordered0683","ordered0726","ordered0725","ordered0133","ordered0132","ordered0738","ordered0737","ordered0697","ordered0696","ordered0714","ordered0713","ordered1648","ordered1647","ordered0710","ordered1676","ordered1675","ordered1688","ordered1687","ordered1720","ordered1391","ordered0643","ordered0678","ordered0708","ordered0642","ordered0709","ordered0778","ordered0664","ordered0660","ordered0648","ordered0662","ordered0657","ordered0659","ordered0661","ordered0653","ordered0656","ordered0677","ordered0674","ordered0672","ordered0675","ordered0673","ordered0676","ordered0663","ordered0665","ordered0667","ordered0668"],TRAVEL_PLACES:["ordered1635","ordered1633","ordered1637","ordered1624","ordered1626","ordered0740","ordered1631","ordered1629","ordered1630","ordered1628","ordered1638","ordered1639","ordered1640","ordered0739","ordered1673","ordered1663","ordered1632","ordered1625","ordered1636","ordered1634","ordered1645","ordered1644","ordered1643","ordered1615","ordered1623","ordered1641","ordered1616","ordered1617","ordered1620","ordered1642","ordered1614","ordered1618","ordered1619","ordered1622","ordered1621","ordered1613","ordered1743","ordered0148","ordered1744","ordered1745","ordered0129","ordered1742","ordered1659","ordered0128","ordered1747","ordered1612","ordered1746","ordered1227","ordered0099","ordered1662","ordered0145","ordered1627","ordered1661","ordered1660","ordered1450","ordered1646","ordered0650","ordered0651","ordered0649","ordered0749","ordered0492","ordered1452","ordered0771","ordered0126","ordered0639","ordered0124","ordered0746","ordered1451","ordered0502","ordered1454","ordered0747","ordered0144","ordered0756","ordered1740","ordered1741","ordered0496","ordered0495","ordered0754","ordered0748","ordered0755","ordered0498","ordered0497","ordered0751","ordered0494","ordered0500","ordered0503","ordered0523","ordered0629","ordered0628","ordered0499","ordered0750","ordered0774","ordered0773","ordered0757","ordered1453","ordered0758","ordered0759","ordered0752","ordered0760","ordered0770","ordered0761","ordered0762","ordered0763","ordered0764","ordered0766","ordered0768","ordered0769","ordered0767","ordered1182","ordered0753","ordered0123","ordered1361","ordered1362","ordered1360","ordered0122"],OBJECTS:["ordered0027","ordered1282","ordered1283","ordered1228","ordered0029","ordered1431","ordered1432","ordered1433","ordered1434","ordered1407","ordered1442","ordered1230","ordered1231","ordered1232","ordered1233","ordered1293","ordered1288","ordered1289","ordered1290","ordered0654","ordered1294","ordered0647","ordered1263","ordered0058","ordered1264","ordered1265","ordered1291","ordered1292","ordered0644","ordered0645","ordered0646","ordered0038","ordered0039","ordered0037","ordered1389","ordered0040","ordered0028","ordered1266","ordered1307","ordered1308","ordered1197","ordered1334","ordered1388","ordered1439","ordered1739","ordered1225","ordered1222","ordered1221","ordered1223","ordered1224","ordered1217","ordered1220","ordered1174","ordered0101","ordered1335","ordered1336","ordered0098","ordered1737","ordered0118","ordered1337","ordered0103","ordered0120","ordered1339","ordered1199","ordered1338","ordered1445","ordered0100","ordered1738","ordered1667","ordered0110","ordered0111","ordered0782","ordered1342","ordered1295","ordered1168","ordered0102","ordered1341","ordered1340","ordered1390","ordered1170","ordered1169","ordered0524","ordered1717","ordered1719","ordered1726","ordered1734","ordered1313","ordered1443","ordered1665","ordered1731","ordered1732","ordered1735","ordered1435","ordered0125","ordered1455","ordered1733","ordered0618","ordered0630","ordered0637","ordered0617","ordered0632","ordered0631","ordered0638","ordered0772","ordered0636","ordered0149","ordered1274","ordered1273","ordered1272","ordered1172","ordered1270","ordered1269","ordered1271","ordered0779","ordered1318","ordered1275","ordered1276","ordered1277","ordered1278","ordered1279","ordered1280","ordered1261","ordered1236","ordered1237","ordered1250","ordered1243","ordered1241","ordered1242","ordered1440","ordered1441","ordered1239","ordered1238","ordered1240","ordered1437","ordered1449","ordered1438","ordered1244","ordered1234","ordered1235","ordered1436","ordered1444","ordered1281","ordered1252","ordered1253","ordered1251","ordered1254","ordered1256","ordered1257","ordered1258","ordered1259","ordered1255","ordered1319","ordered1247","ordered1408","ordered1249","ordered1248","ordered0146","ordered1245","ordered1246","ordered1664","ordered0634","ordered0775","ordered0777","ordered0682","ordered0776","ordered1411","ordered1412","ordered1409","ordered1410","ordered0175","ordered1262","ordered0174","ordered1311","ordered1312","ordered1314","ordered1315","ordered1309","ordered1310"],SYMBOLS:["ordered0192","ordered1191","ordered1190","ordered1189","ordered1192","ordered1184","ordered0191","ordered1185","ordered1194","ordered1183","ordered1187","ordered1186","ordered1188","ordered1193","ordered1195","ordered0074","ordered0178","ordered0073","ordered1358","ordered0076","ordered0179","ordered1343","ordered1363","ordered0075","ordered0072","ordered1736","ordered0117","ordered0079","ordered0080","ordered0081","ordered0082","ordered0083","ordered0084","ordered0085","ordered0086","ordered0087","ordered0088","ordered0089","ordered0090","ordered0222","ordered0104","ordered0481","ordered0487","ordered0070","ordered0071","ordered1285","ordered1284","ordered0484","ordered0478","ordered0486","ordered0488","ordered0485","ordered0182","ordered0228","ordered0490","ordered1215","ordered0489","ordered0211","ordered0210","ordered0482","ordered0483","ordered0480","ordered0214","ordered0215","ordered0218","ordered0219","ordered0216","ordered0226","ordered0121","ordered1260","ordered1666","ordered0185","ordered0207","ordered1198","ordered0095","ordered1711","ordered1670","ordered1674","ordered1672","ordered1326","ordered1286","ordered0190","ordered0189","ordered0187","ordered0188","ordered0015","ordered0016","ordered1216","ordered1301","ordered1302","ordered1345","ordered0105","ordered0209","ordered0106","ordered1712","ordered1344","ordered0096","ordered0479","ordered1226","ordered0184","ordered0181","ordered0186","ordered0147","ordered0507","ordered0044","ordered1196","ordered0491","ordered0198","ordered0765","ordered0477","ordered1727","ordered1728","ordered1729","ordered1730","ordered0097","ordered1668","ordered1718","ordered0217","ordered1671","ordered1713","ordered1714","ordered1716","ordered1715","ordered1669","ordered0655","ordered1287","ordered0476","ordered1332","ordered1329","ordered1328","ordered1331","ordered0018","ordered0224","ordered0225","ordered0227","ordered0220","ordered0223","ordered0221","ordered0003","ordered0004","ordered0005","ordered0006","ordered0007","ordered0008","ordered0009","ordered0010","ordered0011","ordered0012","ordered1327","ordered1330","ordered0001","ordered0002","ordered0047","ordered0041","ordered0036","ordered0042","ordered0043","ordered0034","ordered0035","ordered0030","ordered0031","ordered0032","ordered0033","ordered0048","ordered1356","ordered1357","ordered0196","ordered0201","ordered0202","ordered0203","ordered0022","ordered0023","ordered0024","ordered0021","ordered0020","ordered0019","ordered0026","ordered0025","ordered0199","ordered0200","ordered1296","ordered1297","ordered1298","ordered1300","ordered1299","ordered0670","ordered0671","ordered0208","ordered0197","ordered0176","ordered0193","ordered0194","ordered0195","ordered0177","ordered1219","ordered1218","ordered0017","ordered0013","ordered0014","ordered1322","ordered1321","ordered1323","ordered1325","ordered1324","ordered0059","ordered1320","ordered0108","ordered0109","ordered1348","ordered1349","ordered1354","ordered1355","ordered1352","ordered1353","ordered1350","ordered1351","ordered1347","ordered1346","ordered0045","ordered0046","ordered0052","ordered0051","ordered0050","ordered0049","ordered0204","ordered0205","ordered1303","ordered1304","ordered1305","ordered1306","ordered1317","ordered1316","ordered1268","ordered1267","ordered0854","ordered1213","ordered1214","ordered1448","ordered0213","ordered0212","ordered0669","ordered0091","ordered0092","ordered0093","ordered0094","ordered1364","ordered1365","ordered1366","ordered1367","ordered1368","ordered1369","ordered1370","ordered1371","ordered1372","ordered1373","ordered1374","ordered1375","ordered1376","ordered1377","ordered1378","ordered1379","ordered1380","ordered1381","ordered1382","ordered1383","ordered1384","ordered1385","ordered1386","ordered1387"],FLAGS:["ordered0231","ordered0243","ordered0234","ordered0289","ordered0239","ordered0229","ordered0236","ordered0233","ordered0237","ordered0232","ordered0238","ordered0235","ordered0242","ordered0241","ordered0240","ordered0244","ordered0260","ordered0251","ordered0247","ordered0246","ordered0263","ordered0248","ordered0264","ordered0253","ordered0255","ordered0261","ordered0257","ordered0258","ordered0245","ordered0262","ordered0259","ordered0334","ordered0464","ordered0256","ordered0250","ordered0249","ordered0252","ordered0279","ordered0345","ordered0274","ordered0265","ordered0328","ordered0352","ordered0268","ordered0441","ordered0273","ordered0275","ordered0281","ordered0266","ordered0276","ordered0347","ordered0269","ordered0267","ordered0272","ordered0277","ordered0325","ordered0278","ordered0280","ordered0282","ordered0283","ordered0286","ordered0285","ordered0287","ordered0288","ordered0290","ordered0292","ordered0436","ordered0316","ordered0294","ordered0291","ordered0296","ordered0297","ordered0300","ordered0302","ordered0299","ordered0298","ordered0303","ordered0308","ordered0402","ordered0442","ordered0304","ordered0313","ordered0307","ordered0284","ordered0310","ordered0311","ordered0317","ordered0312","ordered0306","ordered0315","ordered0320","ordered0319","ordered0309","ordered0314","ordered0321","ordered0322","ordered0326","ordered0324","ordered0323","ordered0327","ordered0337","ordered0333","ordered0329","ordered0336","ordered0335","ordered0330","ordered0332","ordered0331","ordered0338","ordered0271","ordered0340","ordered0342","ordered0339","ordered0341","ordered0353","ordered0343","ordered0346","ordered0470","ordered0351","ordered0344","ordered0354","ordered0363","ordered0355","ordered0360","ordered0359","ordered0364","ordered0357","ordered0361","ordered0362","ordered0375","ordered0371","ordered0369","ordered0383","ordered0385","ordered0382","ordered0372","ordered0380","ordered0370","ordered0377","ordered0378","ordered0381","ordered0472","ordered0384","ordered0301","ordered0367","ordered0366","ordered0374","ordered0368","ordered0379","ordered0365","ordered0386","ordered0373","ordered0387","ordered0396","ordered0395","ordered0393","ordered0388","ordered0398","ordered0392","ordered0389","ordered0391","ordered0397","ordered0390","ordered0376","ordered0349","ordered0394","ordered0399","ordered0405","ordered0412","ordered0410","ordered0400","ordered0403","ordered0413","ordered0401","ordered0404","ordered0408","ordered0406","ordered0411","ordered0409","ordered0414","ordered0415","ordered0416","ordered0418","ordered0419","ordered0254","ordered0426","ordered0348","ordered0356","ordered0407","ordered0462","ordered0469","ordered0430","ordered0435","ordered0420","ordered0431","ordered0417","ordered0422","ordered0429","ordered0425","ordered0437","ordered0428","ordered0427","ordered0421","ordered0432","ordered0473","ordered0318","ordered0350","ordered0434","ordered0295","ordered0358","ordered0423","ordered0433","ordered0439","ordered0424","ordered0270","ordered0438","ordered0454","ordered0445","ordered0455","ordered0444","ordered0447","ordered0443","ordered0446","ordered0450","ordered0452","ordered0449","ordered0451","ordered0448","ordered0440","ordered0453","ordered0457","ordered0456","ordered0230","ordered0305","ordered0458","ordered0465","ordered0459","ordered0460","ordered0467","ordered0461","ordered0463","ordered0466","ordered0468","ordered0293","ordered0471","ordered0474","ordered0475","ordered1769","ordered1770","ordered1771"]}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(44),o=r(i),a=n(52),s=r(a),c=function(){function e(){(0,o["default"])(this,e)}return(0,s["default"])(e,[{key:"trigger",value:function(e){}}]),e}();e.exports=new c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(53),o=r(i),a=n(44),s=r(a),c=n(52),l=r(c),u=n(199),d=r(u),p=n(198),h=r(p),f=n(996),m=n(204),g=n(54),v=n(1002),y=v.matchAll,_=function(e){function t(e){(0,s["default"])(this,t);var n=(0,d["default"])(this,(0,o["default"])(t).call(this));return n._length=e,n._regex=new RegExp("("+m.arabic+"{"+e+"})("+m.arabic+")","g"),n}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"mutate",value:function(e,t){return t[1]+"​"+t[2]}},{key:"match",value:function(e){return g.isWebkit?e.length<=this._length?null:y(this._regex,e):null}},{key:"isFragment",get:function(){return!0}},{key:"alwaysApply",get:function(){return!0}}]),t}(f);e.exports=_},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(1042),o=r(i),a=n(53),s=r(a),c=n(44),l=r(c),u=n(52),d=r(u),p=n(199),h=r(p),f=n(198),m=r(f),g=n(1039),v=n(885),y=function(e){function t(e){(0,l["default"])(this,t);var n=(0,h["default"])(this,(0,s["default"])(t).call(this,e));return n.handlers=new o["default"],n.defaultHandler=null,n}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"onMutatorNode",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0].mutator,i=this.getHandler(r)||this.defaultHandler;return v(i,'Missing handler for "'+r.constructor+'"'),i.call.apply(i,[this].concat(t,[this.args]))}},{key:"addHandler",value:function(e,t){this.handlers.set(e,t)}},{key:"setDefaultHandler",value:function(e){this.defaultHandler=e}},{key:"getHandler",value:function(e){return this.handlers.get(e.constructor)}}]),t}(g);e.exports=y},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(53),o=r(i),a=n(44),s=r(a),c=n(52),l=r(c),u=n(199),d=r(u),p=n(198),h=r(p),f=n(46),m=r(f),g=n(996),v=n(415),y=n(1002),E=y.matchAll,b={"(y)":"👍","(n)":"👎",":-)":"🙂",":-(":"🙁",":-p":"😛",":-|":"😐",":-\\":"😕",":-d":"😀",":-*":"😘","<3":"❤","^_^":"😁",">_<":"😆",";-)":"😉"},S=(0,m["default"])(b).map(window._.escapeRegExp).join("|"),M=new RegExp("((?:"+S+")+)","ig"),T=new RegExp("("+S+")","i"),C=new RegExp("([*_~\\s]|```)"),w=function(e){function t(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];(0,s["default"])(this,t);var n=(0,d["default"])(this,(0,o["default"])(t).call(this));return n.skin=e,n}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"match",value:function(e){return E(M,e,function(t,n){var r=e.substr(Math.max(0,t.index-3),Math.min(3,t.index));if(t.index&&!C.test(r))return null;var i=e.substr(t.index+t[0].length,3);return i&&!C.test(i)?null:t})}},{key:"mutate",value:function(e){var t=this,n=_.compact(e.split(T)),r=_.map(n,function(e){if(!e)return e;var n=b[e.toLowerCase()];return n?t.skin&&v.skinToneEmojis[n]?Store.EmojiVariant.getVariant(n)||n:n:e});return r.join("")}},{key:"isFragment",get:function(){return!0}}]),t}(g);e.exports=w},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(53),o=r(i),a=n(44),s=r(a),c=n(52),l=r(c),u=n(199),d=r(u),p=n(198),h=r(p),f=n(414),m=r(f),g=n(417),v=r(g),y=n(1229),_=n(972),E=n(10),b=n(1002),S=b.jsx,M=n(6),T=n(1019),C=n(1092),w=n(1036),x=n(1037),N=n(1040),P=n(1041),k=n(1093),D=n(1038),O=n(1121),A=function(e,t){var n=t.match.href;return{href:n,title:n,rel:"noopener noreferrer",target:"_blank"}},R=function(e,t,n){var r=(0,v["default"])(n,1),i=r[0];return{emoji:i}},I=function(){return{className:"matched-text"}},L=function(e,t){var n=t.match.jid,r=Store.Contact.gadd({id:n}),i=function(){var e=Store.Chat.gadd(r.id);E.chatInfoDrawer(e)};return{onClick:i,className:"matched-mention","data-jid":n,"data-display":"@"+r.display}},F=function(e){var t=e.children,n=(0,m["default"])(e,["children"]),r=(0,v["default"])(t,1),i=r[0];return M.createElement("span",n,M.createElement("span",{className:"at-symbol"},"@"),i.substring(1))},U=function(e){function t(){var e;(0,s["default"])(this,t);for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];var a=(0,d["default"])(this,(e=(0,o["default"])(t)).call.apply(e,[this].concat(r)));return a.addHandler(C,S.make(O,C,R)),a.addHandler(x,S.make("a",x,A)),a.addHandler(T,S.make("code",T)),a.addHandler(P,S.make("strong",P)),a.addHandler(w,S.make("em",w)),a.addHandler(N,S.make("del",N)),a.addHandler(k,S.make("span",k,I)),a.addHandler(D,S.make(F,D,L)),a}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"onRoot",value:function(e){return _(e.reduce(function(e,t,n){return e["root-child-"+n]=t,e},{}))}},{key:"onDelimiter",value:function(){return null}}]),t}(y);e.exports=U},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(53),o=r(i),a=n(44),s=r(a),c=n(52),l=r(c),u=n(199),d=r(u),p=n(198),h=r(p),f=n(1039),m=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"onRoot",value:function(e){return e.join("")}},{key:"onMutatorNode",value:function(e,t){return t.join("")}}]),t}(f);e.exports=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(53),o=r(i),a=n(44),s=r(a),c=n(52),l=r(c),u=n(199),d=r(u),p=n(198),h=r(p),f=n(1039),m=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(0,o["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,l["default"])(t,[{key:"onRoot",value:function(e){return e.join("")}},{key:"onMutatorNode",value:function(e,t){return t.join("")}},{key:"onDelimiter",value:function(){return""}}]),t}(f);e.exports=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(){return v++,g?g:new window.AudioContext}function o(){v--,0===v&&g&&(g.close&&g.close(),g=void 0)}var a=n(2),s=r(a),c=n(44),l=r(c),u=n(52),d=r(u),p=n(1097),h=n(418),f=n(13),m="audio/wav",g=void 0,v=0,y=function(){function e(t){(0,l["default"])(this,e),this.oggBlob=t}return(0,d["default"])(e,[{key:"generateBlob",value:function(){return this.oggBlobToWAVBlob(this.oggBlob,1)}},{key:"oggBlobToWAVBlob",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?2:arguments[1];return new s["default"](function(r,a){var s=new p,c=[],l=[],u=i(),d={outputBufferSampleRate:u.sampleRate,bufferLength:4096};s.onmessage=function(e){if(null===e.data){for(var i=function(e){c.forEach(function(t,n){t=t[e]||t[0];for(var r=0;r<t.length;r++)l.push(t[r])})},a=0;a<n;a++)i(a);var s=t.encodeWAV(l,u,n),d=new Blob([s.readByteArray()],{type:m});o(),r(d)}else c.push(e.data),n=c[0].length},s.postMessage({command:"decode-init",config:d}),h.blobToArrayBuffer(e).then(function(e){s.postMessage({command:"decode",pages:new Uint8Array(e)}),s.postMessage({command:"decode-done"})})})}},{key:"encodeWAV",value:function(e,t,n){var r=f.newOfCapacity(44+2*e.length);r.littleEndian=!0,r.writeString("RIFF"),r.writeUint32(36+2*e.length),r.writeString("WAVE"),r.writeString("fmt "),r.writeUint32(16),r.writeUint16(1),r.writeUint16(n),r.writeUint32(t.sampleRate),r.writeUint32(t.sampleRate*n*2),r.writeUint16(2*n),r.writeUint16(16),r.writeString("data"),r.writeUint32(2*e.length);for(var i=0;i<e.length;i++){var o=Math.max(-1,Math.min(e[i],1));o*=o>0?32767:32768,r.writeInt16(Math.floor(o))}return r}}]),e}();e.exports=y},function(e,t,n){"use strict";var r=n(1097),i=function o(e){if(!o.isRecordingSupported())throw"Recording is not supported in this browser";this.audioContext=new window.AudioContext,this.config=e=e||{},this.config.command="encode-init",this.config.bufferLength=e.bufferLength||4096,this.config.monitorGain=e.monitorGain||0,this.config.numberOfChannels=e.numberOfChannels||1,this.config.originalSampleRate=this.audioContext.sampleRate,this.config.encoderSampleRate=e.encoderSampleRate||48e3,this.config.streamPages=e.streamPages||!1,this.config.leaveStreamOpen=e.leaveStreamOpen||!1,this.config.maxBuffersPerPage=e.maxBuffersPerPage||40,this.config.encoderApplication=e.encoderApplication||2049,this.config.encoderFrameSize=e.encoderFrameSize||20,this.config.streamOptions=e.streamOptions||{optional:[],mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1}},this.state="inactive",this.eventTarget=document.createDocumentFragment(),this.createAudioNodes()};i.isRecordingSupported=function(){return window.AudioContext&&navigator.getUserMedia},i.prototype.addEventListener=function(e,t,n){this.eventTarget.addEventListener(e,t,n)},i.prototype.clearStream=function(){this.stream&&(this.stream.getTracks().forEach(function(e){e.stop()}),delete this.stream)},i.prototype.createAudioNodes=function(){var e=this;this.scriptProcessorNode=this.audioContext.createScriptProcessor(this.config.bufferLength,this.config.numberOfChannels,this.config.numberOfChannels),this.scriptProcessorNode.onaudioprocess=function(t){e.encodeBuffers(t.inputBuffer)},this.monitorNode=this.audioContext.createGain(),this.setMonitorGain(this.config.monitorGain),this.config.sampleRate<this.audioContext.sampleRate&&this.createButterworthFilter()},i.prototype.createButterworthFilter=function(){this.filterNode=this.audioContext.createBiquadFilter(),this.filterNode2=this.audioContext.createBiquadFilter(),this.filterNode3=this.audioContext.createBiquadFilter(),this.filterNode.type=this.filterNode2.type=this.filterNode3.type="lowpass";var e=this.config.sampleRate/2;this.filterNode.frequency.value=this.filterNode2.frequency.value=this.filterNode3.frequency.value=e-e/3.5355,this.filterNode.Q.value=.51764,this.filterNode2.Q.value=.70711,this.filterNode3.Q.value=1.93184,this.filterNode.connect(this.filterNode2),this.filterNode2.connect(this.filterNode3),this.filterNode3.connect(this.scriptProcessorNode)},i.prototype.encodeBuffers=function(e){if("recording"===this.state){for(var t=[],n=0;n<e.numberOfChannels;n++)t[n]=e.getChannelData(n);this.encoder.postMessage({command:"encode",buffers:t}),this.duration+=e.duration,this.eventTarget.dispatchEvent(new CustomEvent("duration",{detail:this.duration}))}},i.prototype.initStream=function(e){if(this.stream)return void this.eventTarget.dispatchEvent(new Event("streamReady"));if(e)return this.stream=e,this.sourceNode=this.audioContext.createMediaStreamSource(e),this.sourceNode.connect(this.filterNode||this.scriptProcessorNode),this.sourceNode.connect(this.monitorNode),void this.eventTarget.dispatchEvent(new Event("streamReady"));var t=this;navigator.getUserMedia({audio:this.config.streamOptions},function(e){t.stream=e,t.sourceNode=t.audioContext.createMediaStreamSource(e),t.sourceNode.connect(t.filterNode||t.scriptProcessorNode),t.sourceNode.connect(t.monitorNode),t.eventTarget.dispatchEvent(new Event("streamReady"))},function(e){t.eventTarget.dispatchEvent(new ErrorEvent("streamError",{error:e}))})},i.prototype.pause=function(){"recording"===this.state&&(this.state="paused",this.eventTarget.dispatchEvent(new Event("pause")))},i.prototype.removeEventListener=function(e,t,n){this.eventTarget.removeEventListener(e,t,n)},i.prototype.resume=function(){"paused"===this.state&&(this.state="recording",this.eventTarget.dispatchEvent(new Event("resume")))},i.prototype.setMonitorGain=function(e){this.monitorNode.gain.value=e},i.prototype.start=function(){if("inactive"===this.state&&this.stream){var e=this;this.encoder=new r,this.config.streamPages?this.encoder.addEventListener("message",function(t){e.streamPage(t.data)}):(this.recordedPages=[],this.totalLength=0,this.encoder.addEventListener("message",function(t){e.storePage(t.data)})),this.encodeBuffers=function(){delete this.encodeBuffers},this.duration=0,this.state="recording",this.monitorNode.connect(this.audioContext.destination),this.scriptProcessorNode.connect(this.audioContext.destination),this.eventTarget.dispatchEvent(new Event("start")),this.eventTarget.dispatchEvent(new CustomEvent("duration",{detail:this.duration})),this.encoder.postMessage(this.config)}},i.prototype.stop=function(){"inactive"!==this.state&&(this.state="inactive",this.audioContext.close&&this.audioContext.close(),this.monitorNode.disconnect(),this.scriptProcessorNode.disconnect(),this.config.leaveStreamOpen||this.clearStream(),this.encoder.postMessage({command:"encode-done"}))},i.prototype.storePage=function(e){if(this.recordedPages.push(e),this.totalLength+=e.length,4&e[5]){for(var t=new Uint8Array(this.totalLength),n=0,r=0;r<this.recordedPages.length;r++)t.set(this.recordedPages[r],n),n+=this.recordedPages[r].length;this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{detail:new Blob([t],{type:"audio/ogg; codecs=opus"})})),this.recordedPages=[],this.eventTarget.dispatchEvent(new Event("stop"))}},i.prototype.streamPage=function(e){this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{detail:new Blob([e],{type:"audio/ogg; codecs=opus"})})),4&e[5]&&this.eventTarget.dispatchEvent(new Event("stop"))},e.exports=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(){return p.loopOnError(function(e){return u["default"].delay(h.expBackoff(e,12e4,0,0)).then(function(){return new u["default"](function(e,t){n.e(91).then(function(t){var r=n(1052);r.PDFJS.workerSrc="./pdf.worker.js",e(r)}.bind(null,n))["catch"](function(e){n.oe(e)})})})})}var o=n(44),a=r(o),s=n(52),c=r(s),l=n(2),u=r(l),d=n(993),p=n(29),h=n(103);n(1257);var f=function(){function e(){(0,a["default"])(this,e)}return(0,c["default"])(e,null,[{key:"fileToPdf",value:function(e){var t=URL.createObjectURL(e);return i().then(function(e){return e.PDFJS.getDocument(t)})}},{key:"releasePdf",value:function(e){return e.destroy()}},{key:"pdfToImg",value:function(e,t){var n=document.createElement("canvas");return e.getPage(t).then(function(e){var t=e.getViewport(1),r=n.getContext("2d");n.height=t.height,n.width=t.width;var i={canvasContext:r,viewport:t};return e.render(i)}).then(function(){return d.canvasToBlob(n)}).then(function(e){var t=n.height,r=n.width,i=URL.createObjectURL(e);return{url:i,thumbUrl:i,width:r,height:t}})}}]),e}();e.exports=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(46),o=r(i),a=n(52),s=r(a),c=n(44),l=r(c),u=function p(e){(0,l["default"])(this,p),this.promise=e,this.lastUsedTime=this.createdTime=+Date.now()},d=function(){function e(t,n){var r=n.maxCached,i=void 0===r?10:r,o=n.maxAge,a=void 0===o?1/0:o,s=n.shouldCache;(0,l["default"])(this,e),this._cache={},this._maxCached=i,this._maxAge=a,this._createPromiseFunc=t,this._shouldCacheFunc=s}return(0,s["default"])(e,[{key:"getOrRun",value:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n[0],a=this._cache;if(this._maxAge!==1/0)for(var s=Date.now()-this._maxAge,c=(0,o["default"])(a),l=0;l<c.length;l++){var d=c[l];a[d].createdTime<s&&delete a[d]}var p=a[i];if(p)return p.lastUsedTime=+Date.now(),p.promise;var h=(0,o["default"])(a);if(h.length>=this._maxCached){for(var f=void 0,m=void 0,g=0;g<h.length;g++){var v=h[g],y=a[v];(!m||y.lastUsedTime<m)&&(m=y.lastUsedTime,f=v)}delete a[f]}var _=this._createPromiseFunc.apply(void 0,n);return a[i]=new u(_),_.then(function(t){var n=e._shouldCacheFunc;n&&e._cache[i]===_&&!n(t)&&delete e._cache[i]})["catch"](function(){e._cache[i]===_&&delete e._cache[i]}),_}}]),e}();e.exports=d},function(e,t,n){e.exports={"default":n(1240),__esModule:!0}},function(e,t,n){n(215),n(84),n(105),n(1248),n(1250),e.exports=n(9).Map},function(e,t,n){n(1249),e.exports=n(9).Math.trunc},function(e,t,n){var r=n(422);e.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},function(e,t,n){var r=n(66),i=n(213),o=n(83),a=n(142),s=n(1244);e.exports=function(e,t){var n=1==e,c=2==e,l=3==e,u=4==e,d=6==e,p=5==e||d,h=t||s;return function(t,s,f){for(var m,g,v=o(t),y=i(v),_=r(s,f,3),E=a(y.length),b=0,S=n?h(t,E):c?h(t,0):void 0;E>b;b++)if((p||b in y)&&(m=y[b],g=_(m,b,v),e))if(n)S[b]=g;else if(g)switch(e){case 3:return!0;case 5:return m;case 6:return b;case 2:S.push(m)}else if(u)return!1;return d?-1:l||u?u:S}}},function(e,t,n){var r=n(67),i=n(439),o=n(16)("species");e.exports=function(e){var t;return i(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&(t=t[o],null===t&&(t=void 0))),void 0===t?Array:t}},function(e,t,n){var r=n(1243);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){"use strict";var r=n(35).f,i=n(141),o=n(429),a=n(66),s=n(427),c=n(140),l=n(422),u=n(214),d=n(440),p=n(441),h=n(47),f=n(428).fastKey,m=h?"_s":"size",g=function(e,t){
var n,r=f(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,u){var d=e(function(e,r){s(e,d,t,"_i"),e._i=i(null),e._f=void 0,e._l=void 0,e[m]=0,void 0!=r&&l(r,n,e[u],e)});return o(d.prototype,{clear:function(){for(var e=this,t=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete t[n.i];e._f=e._l=void 0,e[m]=0},"delete":function(e){var t=this,n=g(t,e);if(n){var r=n.n,i=n.p;delete t._i[n.i],n.r=!0,i&&(i.n=r),r&&(r.p=i),t._f==n&&(t._f=r),t._l==n&&(t._l=i),t[m]--}return!!n},forEach:function(e){s(this,d,"forEach");for(var t,n=a(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.n:this._f;)for(n(t.v,t.k,this);t&&t.r;)t=t.p},has:function(e){return!!g(this,e)}}),h&&r(d.prototype,"size",{get:function(){return c(this[m])}}),d},def:function(e,t,n){var r,i,o=g(e,t);return o?o.v=n:(e._l=o={i:i=f(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=o),r&&(r.n=o),e[m]++,"F"!==i&&(e._i[i]=o)),e},getEntry:g,setStrong:function(e,t,n){u(e,t,function(e,t){this._t=e,this._k=t,this._l=void 0},function(){for(var e=this,t=e._k,n=e._l;n&&n.r;)n=n.p;return e._t&&(e._l=n=n?n.n:e._t._f)?"keys"==t?d(0,n.k):"values"==t?d(0,n.v):d(0,[n.k,n.v]):(e._t=void 0,d(1))},n?"entries":"values",!n,!0),p(t)}}},function(e,t,n){var r=n(139),i=n(1241);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},function(e,t,n){"use strict";var r=n(23),i=n(25),o=n(428),a=n(69),s=n(57),c=n(429),l=n(422),u=n(427),d=n(67),p=n(104),h=n(35).f,f=n(1242)(0),m=n(47);e.exports=function(e,t,n,g,v,y){var _=r[e],E=_,b=v?"set":"add",S=E&&E.prototype,M={};return m&&"function"==typeof E&&(y||S.forEach&&!a(function(){(new E).entries().next()}))?(E=t(function(t,n){u(t,E,e,"_c"),t._c=new _,void 0!=n&&l(n,v,t[b],t)}),f("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in S&&(!y||"clear"!=e)&&s(E.prototype,e,function(n,r){if(u(this,E,e),!t&&y&&!d(n))return"get"==e&&void 0;var i=this._c[e](0===n?0:n,r);return t?this:i})}),"size"in S&&h(E.prototype,"size",{get:function(){return this._c.size}})):(E=g.getConstructor(t,e,v,b),c(E.prototype,n),o.NEED=!0),p(E,e),M[e]=E,i(i.G+i.W+i.F,M),y||g.setStrong(E,e,v),E}},function(e,t,n){"use strict";var r=n(1245);e.exports=n(1247)("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=r.getEntry(this,e);return t&&t.v},set:function(e,t){return r.def(this,0===e?0:e,t)}},r,!0)},function(e,t,n){var r=n(25);r(r.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},function(e,t,n){var r=n(25);r(r.P+r.R,"Map",{toJSON:n(1246)("Map")})},,,function(e,t,n){e.exports=n.p+"img/878dea5b67a7d82cd485a9a5eb058d7d.png"},function(e,t){e.exports=[65,26,32,26,73,1,11,1,5,1,6,23,24,31,32,449,451,7,21,2,16,5,14,1,130,4,6,2,4,4,5,1,7,1,2,3,4,1,2,20,21,83,84,140,147,166,167,38,40,7,8,39,40,1,7,-1,46,-1,2,-1,3,-1,3,-1,2,-56,64,-1,3,-1,2,-1,14,-48,82,-3,4,-101,116,-2,9,-2,12,-23,24,-30,57,-91,102,-58,67,-2,6,-28,32,-1,10,-1,4,-1,6,-43,46,-135,167,55,56,1,2,4,12,4,5,3,10,10,12,29,30,2,3,8,10,2,4,22,23,7,8,1,4,4,7,4,10,2,4,2,3,1,9,1,5,2,3,3,7,12,14,7,15,1,2,6,10,2,4,22,23,7,8,2,3,2,3,2,6,3,27,4,5,1,8,10,12,3,17,1,2,9,10,3,4,22,23,7,8,2,3,5,8,4,12,1,2,2,5,1,16,2,6,11,19,1,9,2,3,8,10,2,4,22,23,7,8,2,3,5,8,2,3,1,7,2,4,2,12,1,5,2,3,3,7,18,29,1,2,6,9,3,4,4,7,2,3,1,2,2,5,2,5,3,6,12,16,2,3,2,5,3,4,3,6,1,7,1,15,13,27,3,4,8,9,3,4,23,24,16,19,1,4,4,23,3,8,2,6,10,25,1,3,2,3,8,9,3,4,23,24,10,11,5,8,8,9,3,4,2,11,2,9,1,2,2,6,10,11,2,17,2,3,8,9,3,4,41,43,4,9,3,4,3,4,1,9,1,8,3,7,16,19,7,9,2,3,18,21,24,25,9,10,1,3,7,15,3,9,8,14,10,12,3,15,48,49,2,14,7,15,13,50,2,3,1,3,2,3,1,3,1,7,4,5,7,8,3,4,1,2,1,3,2,3,4,5,2,11,1,3,5,6,1,10,10,12,4,36,24,26,27,28,1,2,1,6,10,11,36,54,1,6,1,3,5,54,8,9,6,7,13,50,45,49,1,7,1,3,2,4,25,27,4,7,16,20,13,14,2,4,6,7,15,16,40,41,1,6,1,3,377,378,4,6,7,8,1,2,4,6,41,42,4,6,33,34,4,6,7,8,1,2,4,6,15,16,57,58,4,6,67,72,29,32,16,32,86,88,6,9,639,640,26,31,89,96,13,14,4,18,18,21,2,11,18,32,13,14,3,18,52,54,1,8,8,9,2,13,7,8,1,4,10,48,10,16,88,96,41,42,1,6,70,80,31,35,4,6,3,7,2,3,6,19,40,42,5,16,44,48,26,32,11,48,23,25,2,5,56,57,1,10,1,2,2,10,6,19,10,16,10,16,14,100,48,49,1,6,1,2,5,6,9,13,27,36,9,14,32,36,2,4,1,4,56,57,1,3,3,4,1,4,2,10,48,56,2,7,15,18,51,115,8,19,1,14,1,8,4,5,6,7,2,11,192,256,278,280,6,8,38,40,6,8,8,9,1,2,1,2,1,2,31,33,53,54,7,8,1,4,3,4,7,10,4,6,6,10,13,18,3,4,7,24,1,1,-1,98,1,14,1,17,13,114,1,5,1,3,10,11,1,4,5,11,1,2,1,2,1,2,4,5,11,13,4,9,5,9,2,18,41,470,69,95,1,263,78,528,1,340,256,1024,47,48,47,48,133,139,4,7,2,14,38,39,1,6,1,3,56,63,2,17,23,32,7,8,7,8,7,8,7,8,7,8,7,8,7,8,7,557,3,28,9,13,2,3,5,7,5,9,86,92,3,4,90,91,4,9,41,44,94,95,43,96,45,48,48,64,28,31,50,65,12,16,47,48,119,123,99,101,31,32,6582,6656,20950,20992,1165,1232,317,320,28,48,47,64,30,32,80,82,6,48,102,103,37,39,8,71,11,12,3,4,4,5,25,27,1,9,8,16,52,64,68,78,12,36,12,14,38,46,25,36,2,13,30,36,48,49,2,6,2,3,17,18,11,15,7,8,25,26,41,47,2,4,2,13,3,4,8,9,1,3,10,12,32,33,51,52,1,4,2,4,5,7,1,2,1,25,17,19,8,19,6,8,6,8,6,15,7,8,7,8,54,64,117,118,2,3,4,7,10,16,11172,11184,23,27,49,2101,6766,6768,106,144,7,19,5,10,-1,2,-10,11,-532,534,-144,176,-13,14,-2,114,-143,177,26,32,26,37,89,92,6,8,6,8,6,8,3,38,12,13,26,27,19,20,2,3,15,17,14,48,123,128,1,2,1,5,45,48,9,153,45,176,29,32,49,96,36,48,27,32,38,48,30,31,37,41,14,56,158,160,10,96,40,48,52,63,1,145,311,320,22,32,8,160,-287,288,-225,228,-1,3,-5,9,-40,43,-4,5,-165,167,-82,89,-800,831,-385,385,1,2,54,69,7,31,10,28,49,53,2,4,7,21,25,32,10,19,36,41,1,10,14,26,35,36,3,14,52,61,11,14,1,3,16,17,20,31,18,19,28,31,2,3,1,3,6,72,7,8,1,2,4,5,15,16,11,17,47,48,3,16,10,18,2,3,8,10,2,4,22,23,7,8,2,3,5,8,3,4,4,6,2,4,3,5,1,7,1,6,7,291,51,57,1,2,4,6,1,3,4,12,10,176,50,56,4,6,1,3,27,63,51,59,2,3,1,3,4,15,10,48,43,44,1,2,2,8,1,10,10,64,26,32,2,6,1,10,16,368,83,95,1,449,57,1344,922,1024,111,112,5,16,196,2944,1071,5120,583,9216,569,576,31,32,10,14,2,98,30,37,1,11,48,55,15,25,10,11,7,8,21,26,19,899,69,80,47,67,13,16493,2,3072,107,112,13,16,9,16,10,12,1,3,1,4961,246,256,39,41,62,65,9,25,2,9,30,34,59,434,18,160,85,86,71,72,2,4,1,3,2,4,4,5,12,13,1,2,7,8,65,66,4,6,8,9,7,8,28,29,4,5,5,6,1,4,7,8,340,342,51,52,57,58,57,58,57,58,57,58,8,60,512,567,4,54,8,9,14,15,7,3451,-208,215,-1561,1563,-270,542,31,32,58,64,43,118,29,42,43,48,9,16,2,3504,42711,42752,4149,4160,222,224,5762,16352,542,788480,65534,65536,65534]},function(e,t,n){e.exports=function(){return n(443)('/*! Copyright (c) 2015 WhatsApp Inc.  All Rights Reserved. */\n!function(t){function n(e){if(r[e])return r[e].exports;var i=r[e]={exports:{},id:e,loaded:!1};return t[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var r={};return n.m=t,n.c=r,n.oe=function(t){throw t},n.p="/",n(n.s=44)}([function(t,n,r){!function(r,e){t.exports=n=e()}(this,function(){var t=t||function(t,n){var r={},e=r.lib={},i=e.Base=function(){function t(){}return{extend:function(n){t.prototype=this;var r=new t;return n&&r.mixIn(n),r.hasOwnProperty("init")||(r.init=function(){r.$super.init.apply(this,arguments)}),r.init.prototype=r,r.$super=this,r},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),o=e.WordArray=i.extend({init:function(t,r){t=this.words=t||[],r!=n?this.sigBytes=r:this.sigBytes=4*t.length},toString:function(t){return(t||u).stringify(this)},concat:function(t){var n=this.words,r=t.words,e=this.sigBytes,i=t.sigBytes;if(this.clamp(),e%4)for(var o=0;o<i;o++){var a=r[o>>>2]>>>24-o%4*8&255;n[e+o>>>2]|=a<<24-(e+o)%4*8}else for(var o=0;o<i;o+=4)n[e+o>>>2]=r[o>>>2];return this.sigBytes+=i,this},clamp:function(){var n=this.words,r=this.sigBytes;n[r>>>2]&=4294967295<<32-r%4*8,n.length=t.ceil(r/4)},clone:function(){var t=i.clone.call(this);return t.words=this.words.slice(0),t},random:function(n){for(var r,e=[],i=function(n){var n=n,r=987654321,e=4294967295;return function(){r=36969*(65535&r)+(r>>16)&e,n=18e3*(65535&n)+(n>>16)&e;var i=(r<<16)+n&e;return i/=4294967296,i+=.5,i*(t.random()>.5?1:-1)}},a=0;a<n;a+=4){var u=i(4294967296*(r||t.random()));r=987654071*u(),e.push(4294967296*u()|0)}return new o.init(e,n)}}),a=r.enc={},u=a.Hex={stringify:function(t){for(var n=t.words,r=t.sigBytes,e=[],i=0;i<r;i++){var o=n[i>>>2]>>>24-i%4*8&255;e.push((o>>>4).toString(16)),e.push((15&o).toString(16))}return e.join("")},parse:function(t){for(var n=t.length,r=[],e=0;e<n;e+=2)r[e>>>3]|=parseInt(t.substr(e,2),16)<<24-e%8*4;return new o.init(r,n/2)}},c=a.Latin1={stringify:function(t){for(var n=t.words,r=t.sigBytes,e=[],i=0;i<r;i++){var o=n[i>>>2]>>>24-i%4*8&255;e.push(String.fromCharCode(o))}return e.join("")},parse:function(t){for(var n=t.length,r=[],e=0;e<n;e++)r[e>>>2]|=(255&t.charCodeAt(e))<<24-e%4*8;return new o.init(r,n)}},s=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(n){throw new Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},f=e.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=s.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(n){var r=this._data,e=r.words,i=r.sigBytes,a=this.blockSize,u=4*a,c=i/u;c=n?t.ceil(c):t.max((0|c)-this._minBufferSize,0);var s=c*a,f=t.min(4*s,i);if(s){for(var l=0;l<s;l+=a)this._doProcessBlock(e,l);var p=e.splice(0,s);r.sigBytes-=f}return new o.init(p,f)},clone:function(){var t=i.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),l=(e.Hasher=f.extend({cfg:i.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){t&&this._append(t);var n=this._doFinalize();return n},blockSize:16,_createHelper:function(t){return function(n,r){return new t.init(r).finalize(n)}},_createHmacHelper:function(t){return function(n,r){return new l.HMAC.init(t,r).finalize(n)}}}),r.algo={});return r}(Math);return t})},function(t,n,r){var e=r(32)("wks"),i=r(35),o=r(2).Symbol,a="function"==typeof o,u=t.exports=function(t){return e[t]||(e[t]=a&&o[t]||(a?o:i)("Symbol."+t))};u.store=e},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n,r){var e=r(11);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n,r){var e=r(12),i=r(31);t.exports=r(6)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){t.exports=!r(26)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n){t.exports={}},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n,r){var e=r(13);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n,r){var e=r(4),i=r(57),o=r(77),a=Object.defineProperty;n.f=r(6)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return a(t,n,r)}catch(u){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can\'t call method on  "+t);return t}},function(t,n,r){var e=r(11),i=r(2).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,r){var e=r(2),i=r(3),o=r(9),a=r(5),u="prototype",c=function(t,n,r){var s,f,l,p=t&c.F,h=t&c.G,d=t&c.S,v=t&c.P,m=t&c.B,g=t&c.W,y=h?i:i[n]||(i[n]={}),_=y[u],x=h?e:d?e[n]:(e[n]||{})[u];h&&(r=n);for(s in r)f=!p&&x&&void 0!==x[s],f&&s in y||(l=f?x[s]:r[s],y[s]=h&&"function"!=typeof x[s]?r[s]:m&&f?o(l,e):g&&x[s]==l?function(t){var n=function(n,r,e){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,r)}return new t(n,r,e)}return t.apply(this,arguments)};return n[u]=t[u],n}(l):v&&"function"==typeof l?o(Function.call,l):l,v&&((y.virtual||(y.virtual={}))[s]=l,t&c.R&&_&&!_[s]&&a(_,s,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,n,r){var e=r(12).f,i=r(10),o=r(1)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(32)("keys"),i=r(35);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n,r){var e=r(59),i=r(14);t.exports=function(t){return e(i(t))}},function(t,n,r){!function(e,i){t.exports=n=i(r(0))}(this,function(t){return function(){var n=t,r=n.lib,e=r.WordArray,i=n.enc;i.Base64={stringify:function(t){var n=t.words,r=t.sigBytes,e=this._map;t.clamp();for(var i=[],o=0;o<r;o+=3)for(var a=n[o>>>2]>>>24-o%4*8&255,u=n[o+1>>>2]>>>24-(o+1)%4*8&255,c=n[o+2>>>2]>>>24-(o+2)%4*8&255,s=a<<16|u<<8|c,f=0;f<4&&o+.75*f<r;f++)i.push(e.charAt(s>>>6*(3-f)&63));var l=e.charAt(64);if(l)for(;i.length%4;)i.push(l);return i.join("")},parse:function(t){var n=t.length,r=this._map,i=r.charAt(64);if(i){var o=t.indexOf(i);o!=-1&&(n=o)}for(var a=[],u=0,c=0;c<n;c++)if(c%4){var s=r.indexOf(t.charAt(c-1))<<c%4*2,f=r.indexOf(t.charAt(c))>>>6-c%4*2,l=s|f;a[u>>>2]|=l<<24-u%4*8,u++}return e.create(a,u)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),t.enc.Base64})},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{"default":t}}function i(t,n,r,e){function i(t){l.isFunction(n)?this.message=n.apply(this,arguments):arguments.length>0?this.message=""+t:n?this.message=n:this.message=this.name;var r=this.message!==this.name?this.name+": "+this.message:this.name,i=new Error(r).stack;if(!i)try{throw new Error(r)}catch(o){i=o.stack,i||(i="Error: "+r+"\\n    at (unspecified)")}this.stack=i,l.isFunction(e)&&e.apply(this,l.tail(arguments))}return r=r||Error,i.prototype=(0,f["default"])(r.prototype),i.prototype.name=t,i}function o(t,n){return l.reduce(t,function(t,r,e){var o,a;return l.isString(e)?(o=e,a=r):o=r,t[o]=i(o,a,n),t},{})}function a(t){this.event=t;try{return(0,c["default"])(t)}catch(n){return""+t}}var u=r(47),c=e(u),s=r(48),f=e(s),l=r(37),p=i("WAPStatusCode"),h=i("401",null,p),d=i("404",null,p),v=i("500",null,p),m=i("WapDrop"),g=i("EphemeralDrop",null,m),y=i("LogoutDrop",null,m),_=i("Server5xxDrop",null,m),x=i("ConventionViolationDrop",null,m),w=i("BrowserReplacedDrop",null,m),b=i("ShouldLoop"),k=i("GaveUpRetry"),A=i("GUMError"),E=o({NotSupportedError:"The operation is not supported.",PermissionDeniedError:"The user did not grant permission for the operation",ConstraintNotSatisfiedError:"One of the mandatory Constraints could not be satisfied.",OverconstrainedError:"Due to changes in the environment, one or more mandatory constraints can no longer be satisfied.",NotFoundError:"The object can not be found here.",AbortError:"The operation was aborted.",SourceUnavailableError:"The source of the MediaStream could not be accessed due to a hardware error (e.g. lock from another process)."},A),S=i("MediaNeedsReupload"),j=i("MediaFileError"),z=i("InvalidMediaFileType",null,j),M=i("MediaFileTooLarge",function(t){return this.file=t,"File ("+t.type+") size = "+t.size},j),C=i("MediaEncryptionError",null,j),O=i("MediaFileFailedLoad",null,j),B=i("ImageError","Image failed to load.",null,function(t){this.src=t,this.target={src:t}}),I=i("ServerStatusError","Server replied with a fail status code",null,function(t,n){this.url=t,this.status=n}),U=i("ContactBlocked","Contact is blocked",null,function(t){this.contact=t}),R=i("CapabilityError"),T=i("CapabilityUnsupported",null,R,function(t){this.jidCapabilities=t}),W=i("CapabilityInvalid",null,R),D=i("CapabilityUnknown",null,R),F=i("MediaMissing","Media is no longer available on your phone"),P=i("MediaLoadError",null,null,function(t){this.src=t}),L=i("MediaDragDropError",null,P,function(t){this.src=t}),q=i("SocketError",a),H=i("SocketClosed",a),K=i("SocketNotOpen",function(t){return"socket not open, is "+t}),N=i("BlockedByProxy");t.exports={define:i,defineAll:o,QueryDrop:i("QueryDrop"),WapDrop:m,EphemeralDrop:g,LogoutDrop:y,Server5xxDrop:_,ConventionViolationDrop:x,BrowserReplacedDrop:w,ShouldLoop:b,GaveUpRetry:k,MediaFileError:j,InvalidMediaFileType:z,MediaFileTooLarge:M,MediaEncryptionError:C,MediaFileFailedLoad:O,WAPStatusCode:p,E401:h,E404:d,E500:v,SocketError:q,SocketClosed:H,SocketNotOpen:K,BlockedByProxy:N,ImageError:B,ServerStatusError:I,ContactBlocked:U,MediaNeedsReupload:S,MediaMissing:F,MediaLoadError:P,MediaDragDropError:L,CapabilityError:R,CapabilityUnsupported:T,CapabilityInvalid:W,CapabilityUnknown:D,CanNotSendUnencrypted:i("CanNotSendUnencrypted"),ActionError:i("ActionError","Could not perform action."),GUM:l.defaults(E,{GUMError:A,PERMISSION_DENIED:E.PermissionDeniedError,NOT_SUPPORTED_ERROR:E.ConstraintNotSatisfiedError,MANDATORY_UNSATISFIED_ERROR:E.NotFoundError}),Unmount:i("unmount"),ActiveChatChanged:i("ActiveChatChanged")}},function(t,n){"use strict";function r(t){if((Array.isArray(t)||t instanceof ArrayBuffer)&&(t=new Uint8Array(t)),t.length<=a)return e(t);for(var n=[],r=0;r<t.length;r+=a)n.push(e(t.subarray(r,r+a)));return n.join("")}function e(t){for(var n=Math.ceil(4*t.length/3),r=4*Math.ceil(t.length/3),e=new Array(r),i=0,o=0;i<r;i+=4,o+=3){var a=t[o]<<16|t[o+1]<<8|t[o+2];e[i]=a>>18,e[i+1]=a>>12&63,e[i+2]=a>>6&63,e[i+3]=63&a}for(var u=0;u<n;u++){var c=e[u];c<26?e[u]=65+c:c<52?e[u]=71+c:c<62?e[u]=c-4:62===c?e[u]=43:e[u]=47}for(var s=n;s<r;s++)e[s]=61;return String.fromCharCode.apply(String,e)}function i(t){for(var n=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],r=t.length,e=new Int32Array(r+r%4),i=0;i<r;i++){var o=t.charCodeAt(i);if(65<=o&&o<=90)e[i]=o-65;else if(97<=o&&o<=122)e[i]=o-71;else if(48<=o&&o<=57)e[i]=o+4;else if(43===o)e[i]=62;else{if(47!==o){if(61===o){r=i;break}return null}e[i]=63}}for(var a=e.length/4,u=0,c=0;u<a;u++,c+=4)e[u]=e[c]<<18|e[c+1]<<12|e[c+2]<<6|e[c+3];for(var s=Math.floor(3*r/4),f=new Uint8Array(s),l=0,p=0;p+3<=s;l++,p+=3){var h=e[l];f[p]=h>>16,f[p+1]=h>>8&255,f[p+2]=255&h}switch(s-p){case 2:f[p]=e[l]>>16,f[p+1]=e[l]>>8&255;break;case 1:f[p]=e[l]>>16}return n?Array.prototype.slice.call(f):f.buffer}function o(t){return t.replace(/\\+/g,"-").replace(/\\//g,"_")}var a=3e3;t.exports={encode:r,decode:i,urlSafe:o}},function(t,n,r){var e=r(8),i=r(1)("toStringTag"),o="Arguments"==e(function(){return arguments}()),a=function(t,n){try{return t[n]}catch(r){}};t.exports=function(t){var n,r,u;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=a(n=Object(t),i))?r:o?e(n):"Object"==(u=e(n))&&"function"==typeof n.callee?"Arguments":u}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports=function(t){try{return!!t()}catch(n){return!0}}},function(t,n,r){t.exports=r(2).document&&document.documentElement},function(t,n,r){"use strict";var e=r(29),i=r(16),o=r(71),a=r(5),u=r(10),c=r(7),s=r(62),f=r(17),l=r(67),p=r(1)("iterator"),h=!([].keys&&"next"in[].keys()),d="@@iterator",v="keys",m="values",g=function(){return this};t.exports=function(t,n,r,y,_,x,w){s(r,n,y);var b,k,A,E=function(t){if(!h&&t in M)return M[t];switch(t){case v:return function(){return new r(this,t)};case m:return function(){return new r(this,t)}}return function(){return new r(this,t)}},S=n+" Iterator",j=_==m,z=!1,M=t.prototype,C=M[p]||M[d]||_&&M[_],O=C||E(_),B=_?j?E("entries"):O:void 0,I="Array"==n?M.entries||C:C;if(I&&(A=l(I.call(new t)),A!==Object.prototype&&(f(A,S,!0),e||u(A,p)||a(A,p,g))),j&&C&&C.name!==m&&(z=!0,O=function(){return C.call(this)}),e&&!w||!h&&!z&&M[p]||a(M,p,O),c[n]=O,c[S]=g,_)if(b={values:j?O:E(m),keys:x?O:E(v),entries:B},w)for(k in b)k in M||o(M,k,b[k]);else i(i.P+i.F*(h||z),n,b);return b}},function(t,n){t.exports=!0},function(t,n,r){var e=r(4),i=r(66),o=r(25),a=r(18)("IE_PROTO"),u=function(){},c="prototype",s=function(){var t,n=r(15)("iframe"),e=o.length,i="<",a=">";for(n.style.display="none",r(27).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write(i+"script"+a+"document.F=Object"+i+"/script"+a),t.close(),s=t.F;e--;)delete s[c][o[e]];return s()};t.exports=Object.create||function(t,n){var r;return null!==t?(u[c]=e(t),r=new u,u[c]=null,r[a]=t):r=s(),void 0===n?r:i(r,n)}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n,r){var e=r(2),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n,r){var e,i,o,a=r(9),u=r(58),c=r(27),s=r(15),f=r(2),l=f.process,p=f.setImmediate,h=f.clearImmediate,d=f.MessageChannel,v=0,m={},g="onreadystatechange",y=function(){var t=+this;if(m.hasOwnProperty(t)){var n=m[t];delete m[t],n()}},_=function(t){y.call(t.data)};p&&h||(p=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return m[++v]=function(){u("function"==typeof t?t:Function(t),n)},e(v),v},h=function(t){delete m[t]},"process"==r(8)(l)?e=function(t){l.nextTick(a(y,t,1))}:d?(i=new d,o=i.port2,i.port1.onmessage=_,e=a(o.postMessage,o,1)):f.addEventListener&&"function"==typeof postMessage&&!f.importScripts?(e=function(t){f.postMessage(t+"","*")},f.addEventListener("message",_,!1)):e=g in s("script")?function(t){c.appendChild(s("script"))[g]=function(){c.removeChild(this),y.call(t)}}:function(t){setTimeout(a(y,t,1),0)}),t.exports={set:p,clear:h}},function(t,n,r){var e=r(19),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){!function(e,i){t.exports=n=i(r(0))}(this,function(t){!function(){var n=t,r=n.lib,e=r.Base,i=n.enc,o=i.Utf8,a=n.algo;a.HMAC=e.extend({init:function(t,n){t=this._hasher=new t.init,"string"==typeof n&&(n=o.parse(n));var r=t.blockSize,e=4*r;n.sigBytes>e&&(n=t.finalize(n)),n.clamp();for(var i=this._oKey=n.clone(),a=this._iKey=n.clone(),u=i.words,c=a.words,s=0;s<r;s++)u[s]^=1549556828,c[s]^=909522486;i.sigBytes=a.sigBytes=e,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var n=this._hasher,r=n.finalize(t);n.reset();var e=n.finalize(this._oKey.clone().concat(r));return e}})}()})},function(t,n,r){var e;(function(t,i){(function(){function o(t,n){return t.set(n[0],n[1]),t}function a(t,n){return t.add(n),t}function u(t,n,r){var e=r.length;switch(e){case 0:return t.call(n);case 1:return t.call(n,r[0]);case 2:return t.call(n,r[0],r[1]);case 3:return t.call(n,r[0],r[1],r[2])}return t.apply(n,r)}function c(t,n,r,e){for(var i=-1,o=t?t.length:0;++i<o;){var a=t[i];n(e,a,r(a),t)}return e}function s(t,n){for(var r=-1,e=t?t.length:0;++r<e&&n(t[r],r,t)!==!1;);return t}function f(t,n){for(var r=t?t.length:0;r--&&n(t[r],r,t)!==!1;);return t}function l(t,n){for(var r=-1,e=t?t.length:0;++r<e;)if(!n(t[r],r,t))return!1;return!0}function p(t,n){for(var r=-1,e=t?t.length:0,i=0,o=[];++r<e;){var a=t[r];n(a,r,t)&&(o[i++]=a)}return o}function h(t,n){var r=t?t.length:0;return!!r&&b(t,n,0)>-1}function d(t,n,r){for(var e=-1,i=t?t.length:0;++e<i;)if(r(n,t[e]))return!0;return!1}function v(t,n){for(var r=-1,e=t?t.length:0,i=Array(e);++r<e;)i[r]=n(t[r],r,t);return i}function m(t,n){for(var r=-1,e=n.length,i=t.length;++r<e;)t[i+r]=n[r];return t}function g(t,n,r,e){var i=-1,o=t?t.length:0;for(e&&o&&(r=t[++i]);++i<o;)r=n(r,t[i],i,t);return r}function y(t,n,r,e){var i=t?t.length:0;for(e&&i&&(r=t[--i]);i--;)r=n(r,t[i],i,t);return r}function _(t,n){for(var r=-1,e=t?t.length:0;++r<e;)if(n(t[r],r,t))return!0;return!1}function x(t,n,r){var e;return r(t,function(t,r,i){if(n(t,r,i))return e=r,!1}),e}function w(t,n,r,e){for(var i=t.length,o=r+(e?1:-1);e?o--:++o<i;)if(n(t[o],o,t))return o;return-1}function b(t,n,r){if(n!==n)return L(t,r);for(var e=r-1,i=t.length;++e<i;)if(t[e]===n)return e;return-1}function k(t,n,r,e){for(var i=r-1,o=t.length;++i<o;)if(e(t[i],n))return i;return-1}function A(t,n){var r=t?t.length:0;return r?j(t,n)/r:St}function E(t,n,r,e,i){return i(t,function(t,i,o){r=e?(e=!1,t):n(r,t,i,o)}),r}function S(t,n){var r=t.length;for(t.sort(n);r--;)t[r]=t[r].value;return t}function j(t,n){for(var r,e=-1,i=t.length;++e<i;){var o=n(t[e]);o!==Y&&(r=r===Y?o:r+o)}return r}function z(t,n){for(var r=-1,e=Array(t);++r<t;)e[r]=n(r);return e}function M(t,n){return v(n,function(n){return[n,t[n]]})}function C(t){return function(n){return t(n)}}function O(t,n){return v(n,function(n){return t[n]})}function B(t,n){return t.has(n)}function I(t,n){for(var r=-1,e=t.length;++r<e&&b(n,t[r],0)>-1;);return r}function U(t,n){for(var r=t.length;r--&&b(n,t[r],0)>-1;);return r}function R(t){return t&&t.Object===Object?t:null}function T(t,n){for(var r=t.length,e=0;r--;)t[r]===n&&e++;return e}function W(t){return Mr[t]}function D(t){return Cr[t]}function F(t){return"\\\\"+Br[t]}function P(t,n){return null==t?Y:t[n]}function L(t,n,r){for(var e=t.length,i=n+(r?1:-1);r?i--:++i<e;){var o=t[i];if(o!==o)return i}return-1}function q(t){var n=!1;if(null!=t&&"function"!=typeof t.toString)try{n=!!(t+"")}catch(r){}return n}function H(t){for(var n,r=[];!(n=t.next()).done;)r.push(n.value);return r}function K(t){var n=-1,r=Array(t.size);return t.forEach(function(t,e){r[++n]=[e,t]}),r}function N(t,n){for(var r=-1,e=t.length,i=0,o=[];++r<e;){var a=t[r];a!==n&&a!==et||(t[r]=et,o[i++]=r)}return o}function J(t){var n=-1,r=Array(t.size);return t.forEach(function(t){r[++n]=t}),r}function $(t){var n=-1,r=Array(t.size);return t.forEach(function(t){r[++n]=[t,t]}),r}function V(t){if(!t||!kr.test(t))return t.length;for(var n=wr.lastIndex=0;wr.test(t);)n++;return n}function X(t){return t.match(wr)}function G(t){return Or[t]}function Z(t){function n(t){if(yu(t)&&!gl(t)&&!(t instanceof i)){if(t instanceof e)return t;if(Ms.call(t,"__wrapped__"))return lo(t)}return new e(t)}function r(){}function e(t,n){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=Y}function i(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=jt,this.__views__=[]}function R(){var t=new i(this.__wrapped__);return t.__actions__=ri(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=ri(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=ri(this.__views__),t}function Tn(){if(this.__filtered__){var t=new i(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Wn(){var t=this.__wrapped__.value(),n=this.__dir__,r=gl(t),e=n<0,i=r?t.length:0,o=qi(0,i,this.__views__),a=o.start,u=o.end,c=u-a,s=e?u:a-1,f=this.__iteratees__,l=f.length,p=0,h=Qs(c,this.__takeCount__);if(!r||i<tt||i==c&&h==c)return We(t,this.__actions__);var d=[];t:for(;c--&&p<h;){s+=n;for(var v=-1,m=t[s];++v<l;){var g=f[v],y=g.iteratee,_=g.type,x=y(m);if(_==wt)m=x;else if(!x){if(_==xt)continue t;break t}}d[p++]=m}return d}function Dn(t){var n=-1,r=t?t.length:0;for(this.clear();++n<r;){var e=t[n];this.set(e[0],e[1])}}function Fn(){this.__data__=lf?lf(null):{}}function Pn(t){return this.has(t)&&delete this.__data__[t]}function Ln(t){var n=this.__data__;if(lf){var r=n[t];return r===rt?Y:r}return Ms.call(n,t)?n[t]:Y}function qn(t){var n=this.__data__;return lf?n[t]!==Y:Ms.call(n,t)}function Hn(t,n){var r=this.__data__;return r[t]=lf&&n===Y?rt:n,this}function Kn(t){var n=-1,r=t?t.length:0;for(this.clear();++n<r;){var e=t[n];this.set(e[0],e[1])}}function Nn(){this.__data__=[]}function Jn(t){var n=this.__data__,r=dr(n,t);if(r<0)return!1;var e=n.length-1;return r==e?n.pop():Ks.call(n,r,1),!0}function $n(t){var n=this.__data__,r=dr(n,t);return r<0?Y:n[r][1]}function Vn(t){return dr(this.__data__,t)>-1}function Xn(t,n){var r=this.__data__,e=dr(r,t);return e<0?r.push([t,n]):r[e][1]=n,this}function Gn(t){var n=-1,r=t?t.length:0;for(this.clear();++n<r;){var e=t[n];this.set(e[0],e[1])}}function Zn(){this.__data__={hash:new Dn,map:new(uf||Kn),string:new Dn}}function Yn(t){return Ti(this,t)["delete"](t)}function Qn(t){return Ti(this,t).get(t)}function tr(t){return Ti(this,t).has(t)}function nr(t,n){return Ti(this,t).set(t,n),this}function rr(t){var n=-1,r=t?t.length:0;for(this.__data__=new Gn;++n<r;)this.add(t[n])}function er(t){return this.__data__.set(t,rt),this}function ir(t){return this.__data__.has(t)}function or(t){this.__data__=new Kn(t)}function ar(){this.__data__=new Kn}function ur(t){return this.__data__["delete"](t)}function cr(t){return this.__data__.get(t)}function sr(t){return this.__data__.has(t)}function fr(t,n){var r=this.__data__;return r instanceof Kn&&r.__data__.length==tt&&(r=this.__data__=new Gn(r.__data__)),r.set(t,n),this}function lr(t,n,r,e){return t===Y||nu(t,As[r])&&!Ms.call(e,r)?n:t}function pr(t,n,r){(r===Y||nu(t[n],r))&&("number"!=typeof n||r!==Y||n in t)||(t[n]=r)}function hr(t,n,r){var e=t[n];Ms.call(t,n)&&nu(e,r)&&(r!==Y||n in t)||(t[n]=r)}function dr(t,n){for(var r=t.length;r--;)if(nu(t[r][0],n))return r;return-1}function vr(t,n,r,e){return kf(t,function(t,i,o){n(e,t,r(t),o)}),e}function mr(t,n){return t&&ei(n,ec(n),t)}function gr(t,n){for(var r=-1,e=null==t,i=n.length,o=Array(i);++r<i;)o[r]=e?Y:tc(t,n[r]);return o}function yr(t,n,r){return t===t&&(r!==Y&&(t=t<=r?t:r),n!==Y&&(t=t>=n?t:n)),t}function wr(t,n,r,e,i,o,a){var u;if(e&&(u=o?e(t,i,o,a):e(t)),u!==Y)return u;if(!gu(t))return t;var c=gl(t);if(c){if(u=Ki(t),!n)return ri(t,u)}else{var f=Li(t),l=f==Rt||f==Tt;if(yl(t))return Ke(t,n);if(f==Ft||f==Ct||l&&!o){if(q(t))return o?t:{};if(u=Ni(l?{}:t),!n)return ii(t,mr(u,t))}else{if(!zr[f])return o?t:{};u=Ji(t,f,wr,n)}}a||(a=new or);var p=a.get(t);if(p)return p;if(a.set(t,u),!c)var h=r?Oi(t):ec(t);return s(h||t,function(i,o){h&&(o=i,i=t[o]),hr(u,o,wr(i,n,r,e,o,t,a))}),u}function Mr(t){var n=ec(t),r=n.length;return function(e){if(null==e)return!r;for(var i=r;i--;){var o=n[i],a=t[o],u=e[o];if(u===Y&&!(o in Object(e))||!a(u))return!1}return!0}}function Cr(t){return gu(t)?qs(t):{}}function Or(t,n,r){if("function"!=typeof t)throw new bs(nt);return Ns(function(){t.apply(Y,r)},n)}function Br(t,n,r,e){var i=-1,o=h,a=!0,u=t.length,c=[],s=n.length;if(!u)return c;r&&(n=v(n,C(r))),e?(o=d,a=!1):n.length>=tt&&(o=B,a=!1,n=new rr(n));t:for(;++i<u;){var f=t[i],l=r?r(f):f;if(f=e||0!==f?f:0,a&&l===l){for(var p=s;p--;)if(n[p]===l)continue t;c.push(f)}else o(n,l,e)||c.push(f)}return c}function Rr(t,n){var r=!0;return kf(t,function(t,e,i){return r=!!n(t,e,i)}),r}function Tr(t,n,r){for(var e=-1,i=t.length;++e<i;){var o=t[e],a=n(o);if(null!=a&&(u===Y?a===a&&!Bu(a):r(a,u)))var u=a,c=o}return c}function Dr(t,n,r,e){var i=t.length;for(r=Fu(r),r<0&&(r=-r>i?0:i+r),e=e===Y||e>i?i:Fu(e),e<0&&(e+=i),e=r>e?0:Pu(e);r<e;)t[r++]=n;return t}function Fr(t,n){var r=[];return kf(t,function(t,e,i){n(t,e,i)&&r.push(t)}),r}function Pr(t,n,r,e,i){var o=-1,a=t.length;for(r||(r=Vi),i||(i=[]);++o<a;){var u=t[o];n>0&&r(u)?n>1?Pr(u,n-1,r,e,i):m(i,u):e||(i[i.length]=u)}return i}function Hr(t,n){return t&&Ef(t,n,ec)}function Kr(t,n){return t&&Sf(t,n,ec)}function Nr(t,n){return p(n,function(n){return du(t[n])})}function Jr(t,n){n=Yi(n,t)?[n]:qe(n);for(var r=0,e=n.length;null!=t&&r<e;)t=t[so(n[r++])];return r&&r==e?t:Y}function $r(t,n,r){var e=n(t);return gl(t)?e:m(e,r(t))}function Vr(t,n){return t>n}function Xr(t,n){return null!=t&&(Ms.call(t,n)||"object"==typeof t&&n in t&&null===Fi(t))}function Gr(t,n){return null!=t&&n in Object(t)}function Zr(t,n,r){return t>=Qs(n,r)&&t<Ys(n,r)}function Yr(t,n,r){for(var e=r?d:h,i=t[0].length,o=t.length,a=o,u=Array(o),c=1/0,s=[];a--;){var f=t[a];a&&n&&(f=v(f,C(n))),c=Qs(f.length,c),u[a]=!r&&(n||i>=120&&f.length>=120)?new rr(a&&f):Y}f=t[0];var l=-1,p=u[0];t:for(;++l<i&&s.length<c;){var m=f[l],g=n?n(m):m;if(m=r||0!==m?m:0,!(p?B(p,g):e(s,g,r))){for(a=o;--a;){var y=u[a];if(!(y?B(y,g):e(t[a],g,r)))continue t}p&&p.push(g),s.push(m)}}return s}function Qr(t,n,r,e){return Hr(t,function(t,i,o){n(e,r(t),i,o)}),e}function te(t,n,r){Yi(n,t)||(n=qe(n),t=uo(t,n),n=Oo(n));var e=null==t?t:t[so(n)];return null==e?Y:u(e,t,r)}function ne(t,n,r,e,i){return t===n||(null==t||null==n||!gu(t)&&!yu(n)?t!==t&&n!==n:re(t,n,ne,r,e,i))}function re(t,n,r,e,i,o){var a=gl(t),u=gl(n),c=Ot,s=Ot;a||(c=Li(t),c=c==Ct?Ft:c),u||(s=Li(n),s=s==Ct?Ft:s);var f=c==Ft&&!q(t),l=s==Ft&&!q(n),p=c==s;if(p&&!f)return o||(o=new or),a||Iu(t)?zi(t,n,r,e,i,o):Mi(t,n,c,r,e,i,o);if(!(i&vt)){var h=f&&Ms.call(t,"__wrapped__"),d=l&&Ms.call(n,"__wrapped__");if(h||d){var v=h?t.value():t,m=d?n.value():n;return o||(o=new or),r(v,m,e,i,o)}}return!!p&&(o||(o=new or),Ci(t,n,r,e,i,o))}function ee(t,n,r,e){var i=r.length,o=i,a=!e;if(null==t)return!o;for(t=Object(t);i--;){var u=r[i];if(a&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++i<o;){u=r[i];var c=u[0],s=t[c],f=u[1];if(a&&u[2]){if(s===Y&&!(c in t))return!1}else{var l=new or;if(e)var p=e(s,f,c,t,n,l);if(!(p===Y?ne(f,s,e,dt|vt,l):p))return!1}}return!0}function ie(t){if(!gu(t)||no(t))return!1;var n=du(t)||q(t)?Us:Cn;return n.test(fo(t))}function oe(t){return"function"==typeof t?t:null==t?Jc:"object"==typeof t?gl(t)?le(t[0],t[1]):fe(t):ts(t)}function ae(t){return Zs(Object(t))}function ue(t){t=null==t?t:Object(t);var n=[];for(var r in t)n.push(r);return n}function ce(t,n){return t<n}function se(t,n){var r=-1,e=iu(t)?Array(t.length):[];return kf(t,function(t,i,o){e[++r]=n(t,i,o)}),e}function fe(t){var n=Wi(t);return 1==n.length&&n[0][2]?io(n[0][0],n[0][1]):function(r){return r===t||ee(r,t,n)}}function le(t,n){return Yi(t)&&eo(n)?io(so(t),n):function(r){var e=tc(r,t);return e===Y&&e===n?rc(r,t):ne(n,e,Y,dt|vt)}}function pe(t,n,r,e,i){if(t!==n){if(!gl(n)&&!Iu(n))var o=ic(n);s(o||n,function(a,u){if(o&&(u=a,a=n[u]),gu(a))i||(i=new or),he(t,n,u,r,pe,e,i);else{var c=e?e(t[u],a,u+"",t,n,i):Y;c===Y&&(c=a),pr(t,u,c)}})}}function he(t,n,r,e,i,o,a){var u=t[r],c=n[r],s=a.get(c);if(s)return void pr(t,r,s);var f=o?o(u,c,r+"",t,n,a):Y,l=f===Y;l&&(f=c,gl(c)||Iu(c)?gl(u)?f=u:ou(u)?f=ri(u):(l=!1,f=wr(c,!0)):ju(c)||ru(c)?ru(u)?f=qu(u):!gu(u)||e&&du(u)?(l=!1,f=wr(c,!0)):f=u:l=!1),a.set(c,f),l&&i(f,c,e,o,a),a["delete"](c),pr(t,r,f)}function de(t,n){var r=t.length;if(r)return n+=n<0?r:0,Gi(n,r)?t[n]:Y}function ve(t,n,r){var e=-1;n=v(n.length?n:[Jc],C(Ri()));var i=se(t,function(t,r,i){var o=v(n,function(n){return n(t)});return{criteria:o,index:++e,value:t}});return S(i,function(t,n){return Qe(t,n,r)})}function me(t,n){return t=Object(t),g(n,function(n,r){return r in t&&(n[r]=t[r]),n},{})}function ge(t,n){for(var r=-1,e=Bi(t),i=e.length,o={};++r<i;){var a=e[r],u=t[a];n(u,a)&&(o[a]=u)}return o}function ye(t){return function(n){return null==n?Y:n[t]}}function _e(t){return function(n){return Jr(n,t)}}function xe(t,n,r,e){var i=e?k:b,o=-1,a=n.length,u=t;for(t===n&&(n=ri(n)),r&&(u=v(t,C(r)));++o<a;)for(var c=0,s=n[o],f=r?r(s):s;(c=i(u,f,c,e))>-1;)u!==t&&Ks.call(u,c,1),Ks.call(t,c,1);return t}function we(t,n){for(var r=t?n.length:0,e=r-1;r--;){var i=n[r];if(r==e||i!==o){var o=i;if(Gi(i))Ks.call(t,i,1);else if(Yi(i,t))delete t[so(i)];else{var a=qe(i),u=uo(t,a);null!=u&&delete u[so(Oo(a))]}}}return t}function be(t,n){return t+$s(nf()*(n-t+1))}function ke(t,n,r,e){for(var i=-1,o=Ys(Js((n-t)/(r||1)),0),a=Array(o);o--;)a[e?o:++i]=t,t+=r;return a}function Ae(t,n){var r="";if(!t||n<1||n>At)return r;do n%2&&(r+=t),n=$s(n/2),n&&(t+=t);while(n);return r}function Ee(t,n,r,e){n=Yi(n,t)?[n]:qe(n);for(var i=-1,o=n.length,a=o-1,u=t;null!=u&&++i<o;){var c=so(n[i]);if(gu(u)){var s=r;if(i!=a){var f=u[c];s=e?e(f,c,u):Y,s===Y&&(s=null==f?Gi(n[i+1])?[]:{}:f)}hr(u,c,s)}u=u[c]}return t}function Se(t,n,r){var e=-1,i=t.length;n<0&&(n=-n>i?0:i+n),r=r>i?i:r,r<0&&(r+=i),i=n>r?0:r-n>>>0,n>>>=0;for(var o=Array(i);++e<i;)o[e]=t[e+n];return o}function je(t,n){var r;return kf(t,function(t,e,i){return r=n(t,e,i),!r}),!!r}function ze(t,n,r){var e=0,i=t?t.length:e;if("number"==typeof n&&n===n&&i<=Mt){for(;e<i;){var o=e+i>>>1,a=t[o];null!==a&&!Bu(a)&&(r?a<=n:a<n)?e=o+1:i=o}return i}return Me(t,n,Jc,r)}function Me(t,n,r,e){n=r(n);for(var i=0,o=t?t.length:0,a=n!==n,u=null===n,c=Bu(n),s=n===Y;i<o;){var f=$s((i+o)/2),l=r(t[f]),p=l!==Y,h=null===l,d=l===l,v=Bu(l);if(a)var m=e||d;else m=s?d&&(e||p):u?d&&p&&(e||!h):c?d&&p&&!h&&(e||!v):!h&&!v&&(e?l<=n:l<n);m?i=f+1:o=f}return Qs(o,zt)}function Ce(t,n){for(var r=-1,e=t.length,i=0,o=[];++r<e;){var a=t[r],u=n?n(a):a;if(!r||!nu(u,c)){var c=u;o[i++]=0===a?0:a}}return o}function Oe(t){return"number"==typeof t?t:Bu(t)?St:+t}function Be(t){if("string"==typeof t)return t;if(Bu(t))return bf?bf.call(t):"";var n=t+"";return"0"==n&&1/t==-kt?"-0":n}function Ie(t,n,r){var e=-1,i=h,o=t.length,a=!0,u=[],c=u;if(r)a=!1,i=d;else if(o>=tt){var s=n?null:zf(t);if(s)return J(s);a=!1,i=B,c=new rr}else c=n?[]:u;t:for(;++e<o;){var f=t[e],l=n?n(f):f;if(f=r||0!==f?f:0,a&&l===l){for(var p=c.length;p--;)if(c[p]===l)continue t;n&&c.push(l),u.push(f)}else i(c,l,r)||(c!==u&&c.push(l),u.push(f))}return u}function Ue(t,n){n=Yi(n,t)?[n]:qe(n),t=uo(t,n);var r=so(Oo(n));return!(null!=t&&Xr(t,r))||delete t[r]}function Re(t,n,r,e){return Ee(t,n,r(Jr(t,n)),e)}function Te(t,n,r,e){for(var i=t.length,o=e?i:-1;(e?o--:++o<i)&&n(t[o],o,t););return r?Se(t,e?0:o,e?o+1:i):Se(t,e?o+1:0,e?i:o)}function We(t,n){var r=t;return r instanceof i&&(r=r.value()),g(n,function(t,n){return n.func.apply(n.thisArg,m([t],n.args))},r)}function De(t,n,r){for(var e=-1,i=t.length;++e<i;)var o=o?m(Br(o,t[e],n,r),Br(t[e],o,n,r)):t[e];return o&&o.length?Ie(o,n,r):[]}function Fe(t,n,r){for(var e=-1,i=t.length,o=n.length,a={};++e<i;){var u=e<o?n[e]:Y;r(a,t[e],u)}return a}function Pe(t){return ou(t)?t:[]}function Le(t){return"function"==typeof t?t:Jc}function qe(t){return gl(t)?t:Uf(t)}function He(t,n,r){var e=t.length;return r=r===Y?e:r,\n!n&&r>=e?t:Se(t,n,r)}function Ke(t,n){if(n)return t.slice();var r=new t.constructor(t.length);return t.copy(r),r}function Ne(t){var n=new t.constructor(t.byteLength);return new Ds(n).set(new Ds(t)),n}function Je(t,n){var r=n?Ne(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}function $e(t,n,r){var e=n?r(K(t),!0):K(t);return g(e,o,new t.constructor)}function Ve(t){var n=new t.constructor(t.source,Sn.exec(t));return n.lastIndex=t.lastIndex,n}function Xe(t,n,r){var e=n?r(J(t),!0):J(t);return g(e,a,new t.constructor)}function Ge(t){return wf?Object(wf.call(t)):{}}function Ze(t,n){var r=n?Ne(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function Ye(t,n){if(t!==n){var r=t!==Y,e=null===t,i=t===t,o=Bu(t),a=n!==Y,u=null===n,c=n===n,s=Bu(n);if(!u&&!s&&!o&&t>n||o&&a&&c&&!u&&!s||e&&a&&c||!r&&c||!i)return 1;if(!e&&!o&&!s&&t<n||s&&r&&i&&!e&&!o||u&&r&&i||!a&&i||!c)return-1}return 0}function Qe(t,n,r){for(var e=-1,i=t.criteria,o=n.criteria,a=i.length,u=r.length;++e<a;){var c=Ye(i[e],o[e]);if(c){if(e>=u)return c;var s=r[e];return c*("desc"==s?-1:1)}}return t.index-n.index}function ti(t,n,r,e){for(var i=-1,o=t.length,a=r.length,u=-1,c=n.length,s=Ys(o-a,0),f=Array(c+s),l=!e;++u<c;)f[u]=n[u];for(;++i<a;)(l||i<o)&&(f[r[i]]=t[i]);for(;s--;)f[u++]=t[i++];return f}function ni(t,n,r,e){for(var i=-1,o=t.length,a=-1,u=r.length,c=-1,s=n.length,f=Ys(o-u,0),l=Array(f+s),p=!e;++i<f;)l[i]=t[i];for(var h=i;++c<s;)l[h+c]=n[c];for(;++a<u;)(p||i<o)&&(l[h+r[a]]=t[i++]);return l}function ri(t,n){var r=-1,e=t.length;for(n||(n=Array(e));++r<e;)n[r]=t[r];return n}function ei(t,n,r,e){r||(r={});for(var i=-1,o=n.length;++i<o;){var a=n[i],u=e?e(r[a],t[a],a,r,t):t[a];hr(r,a,u)}return r}function ii(t,n){return ei(t,Pi(t),n)}function oi(t,n){return function(r,e){var i=gl(r)?c:vr,o=n?n():{};return i(r,t,Ri(e),o)}}function ai(t){return Na(function(n,r){var e=-1,i=r.length,o=i>1?r[i-1]:Y,a=i>2?r[2]:Y;for(o=t.length>3&&"function"==typeof o?(i--,o):Y,a&&Zi(r[0],r[1],a)&&(o=i<3?Y:o,i=1),n=Object(n);++e<i;){var u=r[e];u&&t(n,u,e,o)}return n})}function ui(t,n){return function(r,e){if(null==r)return r;if(!iu(r))return t(r,e);for(var i=r.length,o=n?i:-1,a=Object(r);(n?o--:++o<i)&&e(a[o],o,a)!==!1;);return r}}function ci(t){return function(n,r,e){for(var i=-1,o=Object(n),a=e(n),u=a.length;u--;){var c=a[t?u:++i];if(r(o[c],c,o)===!1)break}return n}}function si(t,n,r){function e(){var n=this&&this!==Lr&&this instanceof e?o:t;return n.apply(i?r:this,arguments)}var i=n&it,o=pi(t);return e}function fi(t){return function(n){n=Ku(n);var r=kr.test(n)?X(n):Y,e=r?r[0]:n.charAt(0),i=r?He(r,1).join(""):n.slice(1);return e[t]()+i}}function li(t){return function(n){return g(qc(bc(n).replace(_r,"")),t,"")}}function pi(t){return function(){var n=arguments;switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3]);case 5:return new t(n[0],n[1],n[2],n[3],n[4]);case 6:return new t(n[0],n[1],n[2],n[3],n[4],n[5]);case 7:return new t(n[0],n[1],n[2],n[3],n[4],n[5],n[6])}var r=Cr(t.prototype),e=t.apply(r,n);return gu(e)?e:r}}function hi(t,n,r){function e(){for(var o=arguments.length,a=Array(o),c=o,s=Ui(e);c--;)a[c]=arguments[c];var f=o<3&&a[0]!==s&&a[o-1]!==s?[]:N(a,s);if(o-=f.length,o<r)return Ai(t,n,mi,e.placeholder,Y,a,f,Y,Y,r-o);var l=this&&this!==Lr&&this instanceof e?i:t;return u(l,this,a)}var i=pi(t);return e}function di(t){return function(n,r,e){var i=Object(n);if(r=Ri(r,3),!iu(n))var o=ec(n);var a=t(o||n,function(t,n){return o&&(n=t,t=i[n]),r(t,n,i)},e);return a>-1?n[o?o[a]:a]:Y}}function vi(t){return Na(function(n){n=Pr(n,1);var r=n.length,i=r,o=e.prototype.thru;for(t&&n.reverse();i--;){var a=n[i];if("function"!=typeof a)throw new bs(nt);if(o&&!u&&"wrapper"==Ii(a))var u=new e([],(!0))}for(i=u?i:r;++i<r;){a=n[i];var c=Ii(a),s="wrapper"==c?Mf(a):Y;u=s&&to(s[0])&&s[1]==(lt|ut|st|pt)&&!s[4].length&&1==s[9]?u[Ii(s[0])].apply(u,s[3]):1==a.length&&to(a)?u[c]():u.thru(a)}return function(){var t=arguments,e=t[0];if(u&&1==t.length&&gl(e)&&e.length>=tt)return u.plant(e).value();for(var i=0,o=r?n[i].apply(this,t):e;++i<r;)o=n[i].call(this,o);return o}})}function mi(t,n,r,e,i,o,a,u,c,s){function f(){for(var g=arguments.length,y=Array(g),_=g;_--;)y[_]=arguments[_];if(d)var x=Ui(f),w=T(y,x);if(e&&(y=ti(y,e,i,d)),o&&(y=ni(y,o,a,d)),g-=w,d&&g<s){var b=N(y,x);return Ai(t,n,mi,f.placeholder,r,y,b,u,c,s-g)}var k=p?r:this,A=h?k[t]:t;return g=y.length,u?y=co(y,u):v&&g>1&&y.reverse(),l&&c<g&&(y.length=c),this&&this!==Lr&&this instanceof f&&(A=m||pi(A)),A.apply(k,y)}var l=n&lt,p=n&it,h=n&ot,d=n&(ut|ct),v=n&ht,m=h?Y:pi(t);return f}function gi(t,n){return function(r,e){return Qr(r,t,n(e),{})}}function yi(t){return function(n,r){var e;if(n===Y&&r===Y)return 0;if(n!==Y&&(e=n),r!==Y){if(e===Y)return r;"string"==typeof n||"string"==typeof r?(n=Be(n),r=Be(r)):(n=Oe(n),r=Oe(r)),e=t(n,r)}return e}}function _i(t){return Na(function(n){return n=1==n.length&&gl(n[0])?v(n[0],C(Ri())):v(Pr(n,1,Xi),C(Ri())),Na(function(r){var e=this;return t(n,function(t){return u(t,e,r)})})})}function xi(t,n){n=n===Y?" ":Be(n);var r=n.length;if(r<2)return r?Ae(n,t):n;var e=Ae(n,Js(t/V(n)));return kr.test(n)?He(X(e),0,t).join(""):e.slice(0,t)}function wi(t,n,r,e){function i(){for(var n=-1,c=arguments.length,s=-1,f=e.length,l=Array(f+c),p=this&&this!==Lr&&this instanceof i?a:t;++s<f;)l[s]=e[s];for(;c--;)l[s++]=arguments[++n];return u(p,o?r:this,l)}var o=n&it,a=pi(t);return i}function bi(t){return function(n,r,e){return e&&"number"!=typeof e&&Zi(n,r,e)&&(r=e=Y),n=Lu(n),n=n===n?n:0,r===Y?(r=n,n=0):r=Lu(r)||0,e=e===Y?n<r?1:-1:Lu(e)||0,ke(n,r,e,t)}}function ki(t){return function(n,r){return"string"==typeof n&&"string"==typeof r||(n=Lu(n),r=Lu(r)),t(n,r)}}function Ai(t,n,r,e,i,o,a,u,c,s){var f=n&ut,l=f?a:Y,p=f?Y:a,h=f?o:Y,d=f?Y:o;n|=f?st:ft,n&=~(f?ft:st),n&at||(n&=~(it|ot));var v=[t,n,i,h,l,d,p,u,c,s],m=r.apply(Y,v);return to(t)&&If(m,v),m.placeholder=e,m}function Ei(t){var n=xs[t];return function(t,r){if(t=Lu(t),r=Qs(Fu(r),292)){var e=(Ku(t)+"e").split("e"),i=n(e[0]+"e"+(+e[1]+r));return e=(Ku(i)+"e").split("e"),+(e[0]+"e"+(+e[1]-r))}return n(t)}}function Si(t){return function(n){var r=Li(n);return r==Wt?K(n):r==qt?$(n):M(n,t(n))}}function ji(t,n,r,e,i,o,a,u){var c=n&ot;if(!c&&"function"!=typeof t)throw new bs(nt);var s=e?e.length:0;if(s||(n&=~(st|ft),e=i=Y),a=a===Y?a:Ys(Fu(a),0),u=u===Y?u:Fu(u),s-=i?i.length:0,n&ft){var f=e,l=i;e=i=Y}var p=c?Y:Mf(t),h=[t,n,r,e,i,f,l,o,a,u];if(p&&oo(h,p),t=h[0],n=h[1],r=h[2],e=h[3],i=h[4],u=h[9]=null==h[9]?c?0:t.length:Ys(h[9]-s,0),!u&&n&(ut|ct)&&(n&=~(ut|ct)),n&&n!=it)d=n==ut||n==ct?hi(t,n,u):n!=st&&n!=(it|st)||i.length?mi.apply(Y,h):wi(t,n,r,e);else var d=si(t,n,r);var v=p?jf:If;return v(d,h)}function zi(t,n,r,e,i,o){var a=i&vt,u=t.length,c=n.length;if(u!=c&&!(a&&c>u))return!1;var s=o.get(t);if(s)return s==n;var f=-1,l=!0,p=i&dt?new rr:Y;for(o.set(t,n);++f<u;){var h=t[f],d=n[f];if(e)var v=a?e(d,h,f,n,t,o):e(h,d,f,t,n,o);if(v!==Y){if(v)continue;l=!1;break}if(p){if(!_(n,function(t,n){if(!p.has(n)&&(h===t||r(h,t,e,i,o)))return p.add(n)})){l=!1;break}}else if(h!==d&&!r(h,d,e,i,o)){l=!1;break}}return o["delete"](t),l}function Mi(t,n,r,e,i,o,a){switch(r){case Vt:if(t.byteLength!=n.byteLength||t.byteOffset!=n.byteOffset)return!1;t=t.buffer,n=n.buffer;case $t:return!(t.byteLength!=n.byteLength||!e(new Ds(t),new Ds(n)));case Bt:case It:return+t==+n;case Ut:return t.name==n.name&&t.message==n.message;case Dt:return t!=+t?n!=+n:t==+n;case Lt:case Ht:return t==n+"";case Wt:var u=K;case qt:var c=o&vt;if(u||(u=J),t.size!=n.size&&!c)return!1;var s=a.get(t);return s?s==n:(o|=dt,a.set(t,n),zi(u(t),u(n),e,i,o,a));case Kt:if(wf)return wf.call(t)==wf.call(n)}return!1}function Ci(t,n,r,e,i,o){var a=i&vt,u=ec(t),c=u.length,s=ec(n),f=s.length;if(c!=f&&!a)return!1;for(var l=c;l--;){var p=u[l];if(!(a?p in n:Xr(n,p)))return!1}var h=o.get(t);if(h)return h==n;var d=!0;o.set(t,n);for(var v=a;++l<c;){p=u[l];var m=t[p],g=n[p];if(e)var y=a?e(g,m,p,n,t,o):e(m,g,p,t,n,o);if(!(y===Y?m===g||r(m,g,e,i,o):y)){d=!1;break}v||(v="constructor"==p)}if(d&&!v){var _=t.constructor,x=n.constructor;_!=x&&"constructor"in t&&"constructor"in n&&!("function"==typeof _&&_ instanceof _&&"function"==typeof x&&x instanceof x)&&(d=!1)}return o["delete"](t),d}function Oi(t){return $r(t,ec,Pi)}function Bi(t){return $r(t,ic,Of)}function Ii(t){for(var n=t.name+"",r=df[n],e=Ms.call(df,n)?r.length:0;e--;){var i=r[e],o=i.func;if(null==o||o==t)return i.name}return n}function Ui(t){var r=Ms.call(n,"placeholder")?n:t;return r.placeholder}function Ri(){var t=n.iteratee||$c;return t=t===$c?oe:t,arguments.length?t(arguments[0],arguments[1]):t}function Ti(t,n){var r=t.__data__;return Qi(n)?r["string"==typeof n?"string":"hash"]:r.map}function Wi(t){for(var n=ec(t),r=n.length;r--;){var e=n[r],i=t[e];n[r]=[e,i,eo(i)]}return n}function Di(t,n){var r=P(t,n);return ie(r)?r:Y}function Fi(t){return Vs(Object(t))}function Pi(t){return Ps(Object(t))}function Li(t){return Bs.call(t)}function qi(t,n,r){for(var e=-1,i=r.length;++e<i;){var o=r[e],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":n-=a;break;case"take":n=Qs(n,t+a);break;case"takeRight":t=Ys(t,n-a)}}return{start:t,end:n}}function Hi(t,n,r){n=Yi(n,t)?[n]:qe(n);for(var e,i=-1,o=n.length;++i<o;){var a=so(n[i]);if(!(e=null!=t&&r(t,a)))break;t=t[a]}if(e)return e;var o=t?t.length:0;return!!o&&mu(o)&&Gi(a,o)&&(gl(t)||Ou(t)||ru(t))}function Ki(t){var n=t.length,r=t.constructor(n);return n&&"string"==typeof t[0]&&Ms.call(t,"index")&&(r.index=t.index,r.input=t.input),r}function Ni(t){return"function"!=typeof t.constructor||ro(t)?{}:Cr(Fi(t))}function Ji(t,n,r,e){var i=t.constructor;switch(n){case $t:return Ne(t);case Bt:case It:return new i((+t));case Vt:return Je(t,e);case Xt:case Gt:case Zt:case Yt:case Qt:case tn:case nn:case rn:case en:return Ze(t,e);case Wt:return $e(t,e,r);case Dt:case Ht:return new i(t);case Lt:return Ve(t);case qt:return Xe(t,e,r);case Kt:return Ge(t)}}function $i(t){var n=t?t.length:Y;return mu(n)&&(gl(t)||Ou(t)||ru(t))?z(n,String):null}function Vi(t){return gl(t)||ru(t)}function Xi(t){return gl(t)&&!(2==t.length&&!du(t[0]))}function Gi(t,n){return n=null==n?At:n,!!n&&("number"==typeof t||Bn.test(t))&&t>-1&&t%1==0&&t<n}function Zi(t,n,r){if(!gu(r))return!1;var e=typeof n;return!!("number"==e?iu(r)&&Gi(n,r.length):"string"==e&&n in r)&&nu(r[n],t)}function Yi(t,n){if(gl(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!Bu(t))||(mn.test(t)||!vn.test(t)||null!=n&&t in Object(n))}function Qi(t){var n=typeof t;return"string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t}function to(t){var r=Ii(t),e=n[r];if("function"!=typeof e||!(r in i.prototype))return!1;if(t===e)return!0;var o=Mf(e);return!!o&&t===o[0]}function no(t){return!!js&&js in t}function ro(t){var n=t&&t.constructor,r="function"==typeof n&&n.prototype||As;return t===r}function eo(t){return t===t&&!gu(t)}function io(t,n){return function(r){return null!=r&&(r[t]===n&&(n!==Y||t in Object(r)))}}function oo(t,n){var r=t[1],e=n[1],i=r|e,o=i<(it|ot|lt),a=e==lt&&r==ut||e==lt&&r==pt&&t[7].length<=n[8]||e==(lt|pt)&&n[7].length<=n[8]&&r==ut;if(!o&&!a)return t;e&it&&(t[2]=n[2],i|=r&it?0:at);var u=n[3];if(u){var c=t[3];t[3]=c?ti(c,u,n[4]):u,t[4]=c?N(t[3],et):n[4]}return u=n[5],u&&(c=t[5],t[5]=c?ni(c,u,n[6]):u,t[6]=c?N(t[5],et):n[6]),u=n[7],u&&(t[7]=u),e&lt&&(t[8]=null==t[8]?n[8]:Qs(t[8],n[8])),null==t[9]&&(t[9]=n[9]),t[0]=n[0],t[1]=i,t}function ao(t,n,r,e,i,o){return gu(t)&&gu(n)&&pe(t,n,Y,ao,o.set(n,t)),t}function uo(t,n){return 1==n.length?t:Jr(t,Se(n,0,-1))}function co(t,n){for(var r=t.length,e=Qs(n.length,r),i=ri(t);e--;){var o=n[e];t[e]=Gi(o,r)?i[o]:Y}return t}function so(t){if("string"==typeof t||Bu(t))return t;var n=t+"";return"0"==n&&1/t==-kt?"-0":n}function fo(t){if(null!=t){try{return zs.call(t)}catch(n){}try{return t+""}catch(n){}}return""}function lo(t){if(t instanceof i)return t.clone();var n=new e(t.__wrapped__,t.__chain__);return n.__actions__=ri(t.__actions__),n.__index__=t.__index__,n.__values__=t.__values__,n}function po(t,n,r){n=(r?Zi(t,n,r):n===Y)?1:Ys(Fu(n),0);var e=t?t.length:0;if(!e||n<1)return[];for(var i=0,o=0,a=Array(Js(e/n));i<e;)a[o++]=Se(t,i,i+=n);return a}function ho(t){for(var n=-1,r=t?t.length:0,e=0,i=[];++n<r;){var o=t[n];o&&(i[e++]=o)}return i}function vo(){for(var t=arguments.length,n=Array(t?t-1:0),r=arguments[0],e=t;e--;)n[e-1]=arguments[e];return t?m(gl(r)?ri(r):[r],Pr(n,1)):[]}function mo(t,n,r){var e=t?t.length:0;return e?(n=r||n===Y?1:Fu(n),Se(t,n<0?0:n,e)):[]}function go(t,n,r){var e=t?t.length:0;return e?(n=r||n===Y?1:Fu(n),n=e-n,Se(t,0,n<0?0:n)):[]}function yo(t,n){return t&&t.length?Te(t,Ri(n,3),!0,!0):[]}function _o(t,n){return t&&t.length?Te(t,Ri(n,3),!0):[]}function xo(t,n,r,e){var i=t?t.length:0;return i?(r&&"number"!=typeof r&&Zi(t,n,r)&&(r=0,e=i),Dr(t,n,r,e)):[]}function wo(t,n,r){var e=t?t.length:0;if(!e)return-1;var i=null==r?0:Fu(r);return i<0&&(i=Ys(e+i,0)),w(t,Ri(n,3),i)}function bo(t,n,r){var e=t?t.length:0;if(!e)return-1;var i=e-1;return r!==Y&&(i=Fu(r),i=r<0?Ys(e+i,0):Qs(i,e-1)),w(t,Ri(n,3),i,!0)}function ko(t){var n=t?t.length:0;return n?Pr(t,1):[]}function Ao(t){var n=t?t.length:0;return n?Pr(t,kt):[]}function Eo(t,n){var r=t?t.length:0;return r?(n=n===Y?1:Fu(n),Pr(t,n)):[]}function So(t){for(var n=-1,r=t?t.length:0,e={};++n<r;){var i=t[n];e[i[0]]=i[1]}return e}function jo(t){return t&&t.length?t[0]:Y}function zo(t,n,r){var e=t?t.length:0;if(!e)return-1;var i=null==r?0:Fu(r);return i<0&&(i=Ys(e+i,0)),b(t,n,i)}function Mo(t){return go(t,1)}function Co(t,n){return t?Gs.call(t,n):""}function Oo(t){var n=t?t.length:0;return n?t[n-1]:Y}function Bo(t,n,r){var e=t?t.length:0;if(!e)return-1;var i=e;if(r!==Y&&(i=Fu(r),i=(i<0?Ys(e+i,0):Qs(i,e-1))+1),n!==n)return L(t,i-1,!0);for(;i--;)if(t[i]===n)return i;return-1}function Io(t,n){return t&&t.length?de(t,Fu(n)):Y}function Uo(t,n){return t&&t.length&&n&&n.length?xe(t,n):t}function Ro(t,n,r){return t&&t.length&&n&&n.length?xe(t,n,Ri(r)):t}function To(t,n,r){return t&&t.length&&n&&n.length?xe(t,n,Y,r):t}function Wo(t,n){var r=[];if(!t||!t.length)return r;var e=-1,i=[],o=t.length;for(n=Ri(n,3);++e<o;){var a=t[e];n(a,e,t)&&(r.push(a),i.push(e))}return we(t,i),r}function Do(t){return t?ef.call(t):t}function Fo(t,n,r){var e=t?t.length:0;return e?(r&&"number"!=typeof r&&Zi(t,n,r)?(n=0,r=e):(n=null==n?0:Fu(n),r=r===Y?e:Fu(r)),Se(t,n,r)):[]}function Po(t,n){return ze(t,n)}function Lo(t,n,r){return Me(t,n,Ri(r))}function qo(t,n){var r=t?t.length:0;if(r){var e=ze(t,n);if(e<r&&nu(t[e],n))return e}return-1}function Ho(t,n){return ze(t,n,!0)}function Ko(t,n,r){return Me(t,n,Ri(r),!0)}function No(t,n){var r=t?t.length:0;if(r){var e=ze(t,n,!0)-1;if(nu(t[e],n))return e}return-1}function Jo(t){return t&&t.length?Ce(t):[]}function $o(t,n){return t&&t.length?Ce(t,Ri(n)):[]}function Vo(t){return mo(t,1)}function Xo(t,n,r){return t&&t.length?(n=r||n===Y?1:Fu(n),Se(t,0,n<0?0:n)):[]}function Go(t,n,r){var e=t?t.length:0;return e?(n=r||n===Y?1:Fu(n),n=e-n,Se(t,n<0?0:n,e)):[]}function Zo(t,n){return t&&t.length?Te(t,Ri(n,3),!1,!0):[]}function Yo(t,n){return t&&t.length?Te(t,Ri(n,3)):[]}function Qo(t){return t&&t.length?Ie(t):[]}function ta(t,n){return t&&t.length?Ie(t,Ri(n)):[]}function na(t,n){return t&&t.length?Ie(t,Y,n):[]}function ra(t){if(!t||!t.length)return[];var n=0;return t=p(t,function(t){if(ou(t))return n=Ys(t.length,n),!0}),z(n,function(n){return v(t,ye(n))})}function ea(t,n){if(!t||!t.length)return[];var r=ra(t);return null==n?r:v(r,function(t){return u(n,Y,t)})}function ia(t,n){return Fe(t||[],n||[],hr)}function oa(t,n){return Fe(t||[],n||[],Ee)}function aa(t){var r=n(t);return r.__chain__=!0,r}function ua(t,n){return n(t),t}function ca(t,n){return n(t)}function sa(){return aa(this)}function fa(){return new e(this.value(),this.__chain__)}function la(){this.__values__===Y&&(this.__values__=Wu(this.value()));var t=this.__index__>=this.__values__.length,n=t?Y:this.__values__[this.__index__++];return{done:t,value:n}}function pa(){return this}function ha(t){for(var n,e=this;e instanceof r;){var i=lo(e);i.__index__=0,i.__values__=Y,n?o.__wrapped__=i:n=i;var o=i;e=e.__wrapped__}return o.__wrapped__=t,n}function da(){var t=this.__wrapped__;if(t instanceof i){var n=t;return this.__actions__.length&&(n=new i(this)),n=n.reverse(),n.__actions__.push({func:ca,args:[Do],thisArg:Y}),new e(n,this.__chain__)}return this.thru(Do)}function va(){return We(this.__wrapped__,this.__actions__)}function ma(t,n,r){var e=gl(t)?l:Rr;return r&&Zi(t,n,r)&&(n=Y),e(t,Ri(n,3))}function ga(t,n){var r=gl(t)?p:Fr;return r(t,Ri(n,3))}function ya(t,n){return Pr(Aa(t,n),1)}function _a(t,n){return Pr(Aa(t,n),kt)}function xa(t,n,r){return r=r===Y?1:Fu(r),Pr(Aa(t,n),r)}function wa(t,n){var r=gl(t)?s:kf;return r(t,Ri(n,3))}function ba(t,n){var r=gl(t)?f:Af;return r(t,Ri(n,3))}function ka(t,n,r,e){t=iu(t)?t:mc(t),r=r&&!e?Fu(r):0;var i=t.length;return r<0&&(r=Ys(i+r,0)),Ou(t)?r<=i&&t.indexOf(n,r)>-1:!!i&&b(t,n,r)>-1}function Aa(t,n){var r=gl(t)?v:se;return r(t,Ri(n,3))}function Ea(t,n,r,e){return null==t?[]:(gl(n)||(n=null==n?[]:[n]),r=e?Y:r,gl(r)||(r=null==r?[]:[r]),ve(t,n,r))}function Sa(t,n,r){var e=gl(t)?g:E,i=arguments.length<3;return e(t,Ri(n,4),r,i,kf)}function ja(t,n,r){var e=gl(t)?y:E,i=arguments.length<3;return e(t,Ri(n,4),r,i,Af)}function za(t,n){var r=gl(t)?p:Fr;return n=Ri(n,3),r(t,function(t,r,e){return!n(t,r,e)})}function Ma(t){var n=iu(t)?t:mc(t),r=n.length;return r>0?n[be(0,r-1)]:Y}function Ca(t,n,r){var e=-1,i=Wu(t),o=i.length,a=o-1;for(n=(r?Zi(t,n,r):n===Y)?1:yr(Fu(n),0,o);++e<n;){var u=be(e,a),c=i[u];i[u]=i[e],i[e]=c}return i.length=n,i}function Oa(t){return Ca(t,jt)}function Ba(t){if(null==t)return 0;if(iu(t)){var n=t.length;return n&&Ou(t)?V(t):n}if(yu(t)){var r=Li(t);if(r==Wt||r==qt)return t.size}return ec(t).length}function Ia(t,n,r){var e=gl(t)?_:je;return r&&Zi(t,n,r)&&(n=Y),e(t,Ri(n,3))}function Ua(){return ys.now()}function Ra(t,n){if("function"!=typeof n)throw new bs(nt);return t=Fu(t),function(){if(--t<1)return n.apply(this,arguments)}}function Ta(t,n,r){return n=r?Y:n,n=t&&null==n?t.length:n,ji(t,lt,Y,Y,Y,Y,n)}function Wa(t,n){var r;if("function"!=typeof n)throw new bs(nt);return t=Fu(t),function(){return--t>0&&(r=n.apply(this,arguments)),t<=1&&(n=Y),r}}function Da(t,n,r){n=r?Y:n;var e=ji(t,ut,Y,Y,Y,Y,Y,n);return e.placeholder=Da.placeholder,e}function Fa(t,n,r){n=r?Y:n;var e=ji(t,ct,Y,Y,Y,Y,Y,n);return e.placeholder=Fa.placeholder,e}function Pa(t,n,r){function e(n){var r=p,e=h;return p=h=Y,y=n,v=t.apply(e,r)}function i(t){return y=t,m=Ns(u,n),_?e(t):v}function o(t){var r=t-g,e=t-y,i=n-r;return x?Qs(i,d-e):i}function a(t){var r=t-g,e=t-y;return g===Y||r>=n||r<0||x&&e>=d}function u(){var t=Ua();return a(t)?c(t):void(m=Ns(u,o(t)))}function c(t){return m=Y,w&&p?e(t):(p=h=Y,v)}function s(){y=0,p=g=h=m=Y}function f(){return m===Y?v:c(Ua())}function l(){var t=Ua(),r=a(t);if(p=arguments,h=this,g=t,r){if(m===Y)return i(g);if(x)return m=Ns(u,n),e(g)}return m===Y&&(m=Ns(u,n)),v}var p,h,d,v,m,g,y=0,_=!1,x=!1,w=!0;if("function"!=typeof t)throw new bs(nt);return n=Lu(n)||0,gu(r)&&(_=!!r.leading,x="maxWait"in r,d=x?Ys(Lu(r.maxWait)||0,n):d,w="trailing"in r?!!r.trailing:w),l.cancel=s,l.flush=f,l}function La(t){return ji(t,ht)}function qa(t,n){if("function"!=typeof t||n&&"function"!=typeof n)throw new bs(nt);var r=function(){var e=arguments,i=n?n.apply(this,e):e[0],o=r.cache;if(o.has(i))return o.get(i);var a=t.apply(this,e);return r.cache=o.set(i,a),a};return r.cache=new(qa.Cache||Gn),r}function Ha(t){if("function"!=typeof t)throw new bs(nt);return function(){return!t.apply(this,arguments)}}function Ka(t){return Wa(2,t)}function Na(t,n){if("function"!=typeof t)throw new bs(nt);return n=Ys(n===Y?t.length-1:Fu(n),0),function(){for(var r=arguments,e=-1,i=Ys(r.length-n,0),o=Array(i);++e<i;)o[e]=r[n+e];switch(n){case 0:return t.call(this,o);case 1:return t.call(this,r[0],o);case 2:return t.call(this,r[0],r[1],o)}var a=Array(n+1);for(e=-1;++e<n;)a[e]=r[e];return a[n]=o,u(t,this,a)}}function Ja(t,n){if("function"!=typeof t)throw new bs(nt);return n=n===Y?0:Ys(Fu(n),0),Na(function(r){var e=r[n],i=He(r,0,n);return e&&m(i,e),u(t,this,i)})}function $a(t,n,r){var e=!0,i=!0;if("function"!=typeof t)throw new bs(nt);return gu(r)&&(e="leading"in r?!!r.leading:e,i="trailing"in r?!!r.trailing:i),Pa(t,n,{leading:e,maxWait:n,trailing:i})}function Va(t){return Ta(t,1)}function Xa(t,n){return n=null==n?Jc:n,pl(n,t)}function Ga(){if(!arguments.length)return[];var t=arguments[0];return gl(t)?t:[t]}function Za(t){return wr(t,!1,!0)}function Ya(t,n){return wr(t,!1,!0,n)}function Qa(t){return wr(t,!0,!0)}function tu(t,n){return wr(t,!0,!0,n)}function nu(t,n){return t===n||t!==t&&n!==n}function ru(t){return ou(t)&&Ms.call(t,"callee")&&(!Hs.call(t,"callee")||Bs.call(t)==Ct)}function eu(t){return yu(t)&&Bs.call(t)==$t}function iu(t){return null!=t&&mu(Cf(t))&&!du(t)}function ou(t){return yu(t)&&iu(t)}function au(t){return t===!0||t===!1||yu(t)&&Bs.call(t)==Bt}function uu(t){return yu(t)&&Bs.call(t)==It}function cu(t){return!!t&&1===t.nodeType&&yu(t)&&!ju(t)}function su(t){if(iu(t)&&(gl(t)||Ou(t)||du(t.splice)||ru(t)||yl(t)))return!t.length;if(yu(t)){var n=Li(t);if(n==Wt||n==qt)return!t.size}for(var r in t)if(Ms.call(t,r))return!1;return!(hf&&ec(t).length)}function fu(t,n){return ne(t,n)}function lu(t,n,r){r="function"==typeof r?r:Y;var e=r?r(t,n):Y;return e===Y?ne(t,n,r):!!e}function pu(t){return!!yu(t)&&(Bs.call(t)==Ut||"string"==typeof t.message&&"string"==typeof t.name)}function hu(t){return"number"==typeof t&&Xs(t)}function du(t){var n=gu(t)?Bs.call(t):"";return n==Rt||n==Tt}function vu(t){return"number"==typeof t&&t==Fu(t)}function mu(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=At}function gu(t){var n=typeof t;return!!t&&("object"==n||"function"==n)}function yu(t){return!!t&&"object"==typeof t}function _u(t){return yu(t)&&Li(t)==Wt}function xu(t,n){return t===n||ee(t,n,Wi(n))}function wu(t,n,r){return r="function"==typeof r?r:Y,ee(t,n,Wi(n),r)}function bu(t){return Su(t)&&t!=+t}function ku(t){if(Bf(t))throw new _s("This method is not supported with `core-js`. Try https://github.com/es-shims.");return ie(t)}function Au(t){return null===t}function Eu(t){return null==t}function Su(t){return"number"==typeof t||yu(t)&&Bs.call(t)==Dt}function ju(t){if(!yu(t)||Bs.call(t)!=Ft||q(t))return!1;var n=Fi(t);if(null===n)return!0;var r=Ms.call(n,"constructor")&&n.constructor;return"function"==typeof r&&r instanceof r&&zs.call(r)==Os}function zu(t){return gu(t)&&Bs.call(t)==Lt}function Mu(t){return vu(t)&&t>=-At&&t<=At}function Cu(t){return yu(t)&&Li(t)==qt}function Ou(t){return"string"==typeof t||!gl(t)&&yu(t)&&Bs.call(t)==Ht}function Bu(t){return"symbol"==typeof t||yu(t)&&Bs.call(t)==Kt}function Iu(t){return yu(t)&&mu(t.length)&&!!jr[Bs.call(t)]}function Uu(t){return t===Y}function Ru(t){return yu(t)&&Li(t)==Nt}function Tu(t){return yu(t)&&Bs.call(t)==Jt}function Wu(t){if(!t)return[];if(iu(t))return Ou(t)?X(t):ri(t);if(Ls&&t[Ls])return H(t[Ls]());var n=Li(t),r=n==Wt?K:n==qt?J:mc;return r(t)}function Du(t){if(!t)return 0===t?t:0;if(t=Lu(t),t===kt||t===-kt){var n=t<0?-1:1;return n*Et}return t===t?t:0}function Fu(t){var n=Du(t),r=n%1;return n===n?r?n-r:n:0}function Pu(t){return t?yr(Fu(t),0,jt):0}function Lu(t){if("number"==typeof t)return t;if(Bu(t))return St;if(gu(t)){var n=du(t.valueOf)?t.valueOf():t;t=gu(n)?n+"":n}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(xn,"");var r=Mn.test(t);return r||On.test(t)?Ur(t.slice(2),r?2:8):zn.test(t)?St:+t}function qu(t){return ei(t,ic(t))}function Hu(t){return yr(Fu(t),-At,At)}function Ku(t){return null==t?"":Be(t)}function Nu(t,n){var r=Cr(t);return n?mr(r,n):r}function Ju(t,n){return x(t,Ri(n,3),Hr)}function $u(t,n){return x(t,Ri(n,3),Kr)}function Vu(t,n){return null==t?t:Ef(t,Ri(n,3),ic)}function Xu(t,n){return null==t?t:Sf(t,Ri(n,3),ic)}function Gu(t,n){return t&&Hr(t,Ri(n,3))}function Zu(t,n){return t&&Kr(t,Ri(n,3))}function Yu(t){return null==t?[]:Nr(t,ec(t))}function Qu(t){return null==t?[]:Nr(t,ic(t))}function tc(t,n,r){var e=null==t?Y:Jr(t,n);return e===Y?r:e}function nc(t,n){return null!=t&&Hi(t,n,Xr)}function rc(t,n){return null!=t&&Hi(t,n,Gr)}function ec(t){var n=ro(t);if(!n&&!iu(t))return ae(t);var r=$i(t),e=!!r,i=r||[],o=i.length;for(var a in t)!Xr(t,a)||e&&("length"==a||Gi(a,o))||n&&"constructor"==a||i.push(a);return i}function ic(t){for(var n=-1,r=ro(t),e=ue(t),i=e.length,o=$i(t),a=!!o,u=o||[],c=u.length;++n<i;){var s=e[n];a&&("length"==s||Gi(s,c))||"constructor"==s&&(r||!Ms.call(t,s))||u.push(s)}return u}function oc(t,n){var r={};return n=Ri(n,3),Hr(t,function(t,e,i){r[n(t,e,i)]=t}),r}function ac(t,n){var r={};return n=Ri(n,3),Hr(t,function(t,e,i){r[e]=n(t,e,i)}),r}function uc(t,n){return n=Ri(n),ge(t,function(t,r){return!n(t,r)})}function cc(t,n){return null==t?{}:ge(t,Ri(n))}function sc(t,n,r){n=Yi(n,t)?[n]:qe(n);var e=-1,i=n.length;for(i||(t=Y,i=1);++e<i;){var o=null==t?Y:t[so(n[e])];o===Y&&(e=i,o=r),t=du(o)?o.call(t):o}return t}function fc(t,n,r){return null==t?t:Ee(t,n,r)}function lc(t,n,r,e){return e="function"==typeof e?e:Y,null==t?t:Ee(t,n,r,e)}function pc(t,n,r){var e=gl(t)||Iu(t);if(n=Ri(n,4),null==r)if(e||gu(t)){var i=t.constructor;r=e?gl(t)?new i:[]:du(i)?Cr(Fi(t)):{}}else r={};return(e?s:Hr)(t,function(t,e,i){return n(r,t,e,i)}),r}function hc(t,n){return null==t||Ue(t,n)}function dc(t,n,r){return null==t?t:Re(t,n,Le(r))}function vc(t,n,r,e){return e="function"==typeof e?e:Y,null==t?t:Re(t,n,Le(r),e)}function mc(t){return t?O(t,ec(t)):[]}function gc(t){return null==t?[]:O(t,ic(t))}function yc(t,n,r){return r===Y&&(r=n,n=Y),r!==Y&&(r=Lu(r),r=r===r?r:0),n!==Y&&(n=Lu(n),n=n===n?n:0),yr(Lu(t),n,r)}function _c(t,n,r){return n=Lu(n)||0,r===Y?(r=n,n=0):r=Lu(r)||0,t=Lu(t),Zr(t,n,r)}function xc(t,n,r){if(r&&"boolean"!=typeof r&&Zi(t,n,r)&&(n=r=Y),r===Y&&("boolean"==typeof n?(r=n,n=Y):"boolean"==typeof t&&(r=t,t=Y)),t===Y&&n===Y?(t=0,n=1):(t=Lu(t)||0,n===Y?(n=t,t=0):n=Lu(n)||0),t>n){var e=t;t=n,n=e}if(r||t%1||n%1){var i=nf();return Qs(t+i*(n-t+Ir("1e-"+((i+"").length-1))),n)}return be(t,n)}function wc(t){return Kl(Ku(t).toLowerCase())}function bc(t){return t=Ku(t),t&&t.replace(In,W).replace(xr,"")}function kc(t,n,r){t=Ku(t),n=Be(n);var e=t.length;return r=r===Y?e:yr(Fu(r),0,e),r-=n.length,r>=0&&t.indexOf(n,r)==r}function Ac(t){return t=Ku(t),t&&ln.test(t)?t.replace(sn,D):t}function Ec(t){return t=Ku(t),t&&_n.test(t)?t.replace(yn,"\\\\$&"):t}function Sc(t,n,r){t=Ku(t),n=Fu(n);var e=n?V(t):0;if(!n||e>=n)return t;var i=(n-e)/2;return xi($s(i),r)+t+xi(Js(i),r)}function jc(t,n,r){t=Ku(t),n=Fu(n);var e=n?V(t):0;return n&&e<n?t+xi(n-e,r):t}function zc(t,n,r){t=Ku(t),n=Fu(n);var e=n?V(t):0;return n&&e<n?xi(n-e,r)+t:t}function Mc(t,n,r){return r||null==n?n=0:n&&(n=+n),t=Ku(t).replace(xn,""),tf(t,n||(jn.test(t)?16:10))}function Cc(t,n,r){return n=(r?Zi(t,n,r):n===Y)?1:Fu(n),Ae(Ku(t),n)}function Oc(){var t=arguments,n=Ku(t[0]);return t.length<3?n:rf.call(n,t[1],t[2])}function Bc(t,n,r){return r&&"number"!=typeof r&&Zi(t,n,r)&&(n=r=Y),(r=r===Y?jt:r>>>0)?(t=Ku(t),t&&("string"==typeof n||null!=n&&!zu(n))&&(n=Be(n),""==n&&kr.test(t))?He(X(t),0,r):of.call(t,n,r)):[]}function Ic(t,n,r){return t=Ku(t),r=yr(Fu(r),0,t.length),t.lastIndexOf(Be(n),r)==r}function Uc(t,r,e){var i=n.templateSettings;e&&Zi(t,r,e)&&(r=Y),t=Ku(t),r=kl({},r,i,lr);var o,a,u=kl({},r.imports,i.imports,lr),c=ec(u),s=O(u,c),f=0,l=r.interpolate||Un,p="__p += \'",h=ws((r.escape||Un).source+"|"+l.source+"|"+(l===dn?En:Un).source+"|"+(r.evaluate||Un).source+"|$","g"),d="//# sourceURL="+("sourceURL"in r?r.sourceURL:"lodash.templateSources["+ ++Sr+"]")+"\\n";t.replace(h,function(n,r,e,i,u,c){return e||(e=i),p+=t.slice(f,c).replace(Rn,F),r&&(o=!0,p+="\' +\\n__e("+r+") +\\n\'"),u&&(a=!0,p+="\';\\n"+u+";\\n__p += \'"),e&&(p+="\' +\\n((__t = ("+e+")) == null ? \'\' : __t) +\\n\'"),f=c+n.length,n}),p+="\';\\n";var v=r.variable;v||(p="with (obj) {\\n"+p+"\\n}\\n"),p=(a?p.replace(on,""):p).replace(an,"$1").replace(un,"$1;"),p="function("+(v||"obj")+") {\\n"+(v?"":"obj || (obj = {});\\n")+"var __t, __p = \'\'"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\\nfunction print() { __p += __j.call(arguments, \'\') }\\n":";\\n")+p+"return __p\\n}";var m=Nl(function(){return Function(c,d+"return "+p).apply(Y,s)});if(m.source=p,pu(m))throw m;return m}function Rc(t){return Ku(t).toLowerCase()}function Tc(t){return Ku(t).toUpperCase()}function Wc(t,n,r){if(t=Ku(t),t&&(r||n===Y))return t.replace(xn,"");if(!t||!(n=Be(n)))return t;var e=X(t),i=X(n),o=I(e,i),a=U(e,i)+1;return He(e,o,a).join("")}function Dc(t,n,r){if(t=Ku(t),t&&(r||n===Y))return t.replace(bn,"");if(!t||!(n=Be(n)))return t;var e=X(t),i=U(e,X(n))+1;return He(e,0,i).join("")}function Fc(t,n,r){if(t=Ku(t),t&&(r||n===Y))return t.replace(wn,"");if(!t||!(n=Be(n)))return t;var e=X(t),i=I(e,X(n));return He(e,i).join("")}function Pc(t,n){var r=mt,e=gt;if(gu(n)){var i="separator"in n?n.separator:i;r="length"in n?Fu(n.length):r,e="omission"in n?Be(n.omission):e}t=Ku(t);var o=t.length;if(kr.test(t)){var a=X(t);o=a.length}if(r>=o)return t;var u=r-V(e);if(u<1)return e;var c=a?He(a,0,u).join(""):t.slice(0,u);if(i===Y)return c+e;if(a&&(u+=c.length-u),zu(i)){if(t.slice(u).search(i)){var s,f=c;for(i.global||(i=ws(i.source,Ku(Sn.exec(i))+"g")),i.lastIndex=0;s=i.exec(f);)var l=s.index;c=c.slice(0,l===Y?u:l)}}else if(t.indexOf(Be(i),u)!=u){var p=c.lastIndexOf(i);p>-1&&(c=c.slice(0,p))}return c+e}function Lc(t){return t=Ku(t),t&&fn.test(t)?t.replace(cn,G):t}function qc(t,n,r){return t=Ku(t),n=r?Y:n,n===Y&&(n=Ar.test(t)?br:kn),t.match(n)||[]}function Hc(t){var n=t?t.length:0,r=Ri();return t=n?v(t,function(t){if("function"!=typeof t[1])throw new bs(nt);return[r(t[0]),t[1]]}):[],Na(function(r){for(var e=-1;++e<n;){var i=t[e];if(u(i[0],this,r))return u(i[1],this,r)}})}function Kc(t){return Mr(wr(t,!0))}function Nc(t){return function(){return t}}function Jc(t){return t}function $c(t){return oe("function"==typeof t?t:wr(t,!0))}function Vc(t){return fe(wr(t,!0))}function Xc(t,n){return le(t,wr(n,!0))}function Gc(t,n,r){var e=ec(n),i=Nr(n,e);null!=r||gu(n)&&(i.length||!e.length)||(r=n,n=t,t=this,i=Nr(n,ec(n)));var o=!(gu(r)&&"chain"in r&&!r.chain),a=du(t);return s(i,function(r){var e=n[r];t[r]=e,a&&(t.prototype[r]=function(){var n=this.__chain__;if(o||n){var r=t(this.__wrapped__),i=r.__actions__=ri(this.__actions__);return i.push({func:e,args:arguments,thisArg:t}),r.__chain__=n,r}return e.apply(t,m([this.value()],arguments))})}),t}function Zc(){return Lr._===this&&(Lr._=Is),this}function Yc(){}function Qc(t){return t=Fu(t),Na(function(n){return de(n,t)})}function ts(t){return Yi(t)?ye(so(t)):_e(t)}function ns(t){return function(n){return null==t?Y:Jr(t,n)}}function rs(){return[]}function es(){return!1}function is(){return{}}function os(){return""}function as(){return!0}function us(t,n){if(t=Fu(t),t<1||t>At)return[];var r=jt,e=Qs(t,jt);n=Ri(n),t-=jt;for(var i=z(e,n);++r<t;)n(r);return i}function cs(t){return gl(t)?v(t,so):Bu(t)?[t]:ri(Uf(t))}function ss(t){var n=++Cs;return Ku(t)+n}function fs(t){return t&&t.length?Tr(t,Jc,Vr):Y}function ls(t,n){return t&&t.length?Tr(t,Ri(n),Vr):Y}function ps(t){return A(t,Jc)}function hs(t,n){return A(t,Ri(n))}function ds(t){return t&&t.length?Tr(t,Jc,ce):Y}function vs(t,n){return t&&t.length?Tr(t,Ri(n),ce):Y}function ms(t){return t&&t.length?j(t,Jc):0}function gs(t,n){return t&&t.length?j(t,Ri(n)):0}t=t?qr.defaults({},t,qr.pick(Lr,Er)):Lr;var ys=t.Date,_s=t.Error,xs=t.Math,ws=t.RegExp,bs=t.TypeError,ks=t.Array.prototype,As=t.Object.prototype,Es=t.String.prototype,Ss=t["__core-js_shared__"],js=function(){var t=/[^.]+$/.exec(Ss&&Ss.keys&&Ss.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),zs=t.Function.prototype.toString,Ms=As.hasOwnProperty,Cs=0,Os=zs.call(Object),Bs=As.toString,Is=Lr._,Us=ws("^"+zs.call(Ms).replace(yn,"\\\\$&").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,"$1.*?")+"$"),Rs=Wr?t.Buffer:Y,Ts=t.Reflect,Ws=t.Symbol,Ds=t.Uint8Array,Fs=Ts?Ts.enumerate:Y,Ps=Object.getOwnPropertySymbols,Ls="symbol"==typeof(Ls=Ws&&Ws.iterator)?Ls:Y,qs=Object.create,Hs=As.propertyIsEnumerable,Ks=ks.splice,Ns=function(n,r){\nreturn t.setTimeout.call(Lr,n,r)},Js=xs.ceil,$s=xs.floor,Vs=Object.getPrototypeOf,Xs=t.isFinite,Gs=ks.join,Zs=Object.keys,Ys=xs.max,Qs=xs.min,tf=t.parseInt,nf=xs.random,rf=Es.replace,ef=ks.reverse,of=Es.split,af=Di(t,"DataView"),uf=Di(t,"Map"),cf=Di(t,"Promise"),sf=Di(t,"Set"),ff=Di(t,"WeakMap"),lf=Di(Object,"create"),pf=ff&&new ff,hf=!Hs.call({valueOf:1},"valueOf"),df={},vf=fo(af),mf=fo(uf),gf=fo(cf),yf=fo(sf),_f=fo(ff),xf=Ws?Ws.prototype:Y,wf=xf?xf.valueOf:Y,bf=xf?xf.toString:Y;n.templateSettings={escape:pn,evaluate:hn,interpolate:dn,variable:"",imports:{_:n}},n.prototype=r.prototype,n.prototype.constructor=n,e.prototype=Cr(r.prototype),e.prototype.constructor=e,i.prototype=Cr(r.prototype),i.prototype.constructor=i,Dn.prototype.clear=Fn,Dn.prototype["delete"]=Pn,Dn.prototype.get=Ln,Dn.prototype.has=qn,Dn.prototype.set=Hn,Kn.prototype.clear=Nn,Kn.prototype["delete"]=Jn,Kn.prototype.get=$n,Kn.prototype.has=Vn,Kn.prototype.set=Xn,Gn.prototype.clear=Zn,Gn.prototype["delete"]=Yn,Gn.prototype.get=Qn,Gn.prototype.has=tr,Gn.prototype.set=nr,rr.prototype.add=rr.prototype.push=er,rr.prototype.has=ir,or.prototype.clear=ar,or.prototype["delete"]=ur,or.prototype.get=cr,or.prototype.has=sr,or.prototype.set=fr;var kf=ui(Hr),Af=ui(Kr,!0),Ef=ci(),Sf=ci(!0);Fs&&!Hs.call({valueOf:1},"valueOf")&&(ue=function(t){return H(Fs(t))});var jf=pf?function(t,n){return pf.set(t,n),t}:Jc,zf=sf&&1/J(new sf([,-0]))[1]==kt?function(t){return new sf(t)}:Yc,Mf=pf?function(t){return pf.get(t)}:Yc,Cf=ye("length");Ps||(Pi=rs);var Of=Ps?function(t){for(var n=[];t;)m(n,Pi(t)),t=Fi(t);return n}:Pi;(af&&Li(new af(new ArrayBuffer(1)))!=Vt||uf&&Li(new uf)!=Wt||cf&&Li(cf.resolve())!=Pt||sf&&Li(new sf)!=qt||ff&&Li(new ff)!=Nt)&&(Li=function(t){var n=Bs.call(t),r=n==Ft?t.constructor:Y,e=r?fo(r):Y;if(e)switch(e){case vf:return Vt;case mf:return Wt;case gf:return Pt;case yf:return qt;case _f:return Nt}return n});var Bf=Ss?du:es,If=function(){var t=0,n=0;return function(r,e){var i=Ua(),o=_t-(i-n);if(n=i,o>0){if(++t>=yt)return r}else t=0;return jf(r,e)}}(),Uf=qa(function(t){var n=[];return Ku(t).replace(gn,function(t,r,e,i){n.push(e?i.replace(An,"$1"):r||t)}),n}),Rf=Na(function(t,n){return ou(t)?Br(t,Pr(n,1,ou,!0)):[]}),Tf=Na(function(t,n){var r=Oo(n);return ou(r)&&(r=Y),ou(t)?Br(t,Pr(n,1,ou,!0),Ri(r)):[]}),Wf=Na(function(t,n){var r=Oo(n);return ou(r)&&(r=Y),ou(t)?Br(t,Pr(n,1,ou,!0),Y,r):[]}),Df=Na(function(t){var n=v(t,Pe);return n.length&&n[0]===t[0]?Yr(n):[]}),Ff=Na(function(t){var n=Oo(t),r=v(t,Pe);return n===Oo(r)?n=Y:r.pop(),r.length&&r[0]===t[0]?Yr(r,Ri(n)):[]}),Pf=Na(function(t){var n=Oo(t),r=v(t,Pe);return n===Oo(r)?n=Y:r.pop(),r.length&&r[0]===t[0]?Yr(r,Y,n):[]}),Lf=Na(Uo),qf=Na(function(t,n){n=Pr(n,1);var r=t?t.length:0,e=gr(t,n);return we(t,v(n,function(t){return Gi(t,r)?+t:t}).sort(Ye)),e}),Hf=Na(function(t){return Ie(Pr(t,1,ou,!0))}),Kf=Na(function(t){var n=Oo(t);return ou(n)&&(n=Y),Ie(Pr(t,1,ou,!0),Ri(n))}),Nf=Na(function(t){var n=Oo(t);return ou(n)&&(n=Y),Ie(Pr(t,1,ou,!0),Y,n)}),Jf=Na(function(t,n){return ou(t)?Br(t,n):[]}),$f=Na(function(t){return De(p(t,ou))}),Vf=Na(function(t){var n=Oo(t);return ou(n)&&(n=Y),De(p(t,ou),Ri(n))}),Xf=Na(function(t){var n=Oo(t);return ou(n)&&(n=Y),De(p(t,ou),Y,n)}),Gf=Na(ra),Zf=Na(function(t){var n=t.length,r=n>1?t[n-1]:Y;return r="function"==typeof r?(t.pop(),r):Y,ea(t,r)}),Yf=Na(function(t){t=Pr(t,1);var n=t.length,r=n?t[0]:0,o=this.__wrapped__,a=function(n){return gr(n,t)};return!(n>1||this.__actions__.length)&&o instanceof i&&Gi(r)?(o=o.slice(r,+r+(n?1:0)),o.__actions__.push({func:ca,args:[a],thisArg:Y}),new e(o,this.__chain__).thru(function(t){return n&&!t.length&&t.push(Y),t})):this.thru(a)}),Qf=oi(function(t,n,r){Ms.call(t,r)?++t[r]:t[r]=1}),tl=di(wo),nl=di(bo),rl=oi(function(t,n,r){Ms.call(t,r)?t[r].push(n):t[r]=[n]}),el=Na(function(t,n,r){var e=-1,i="function"==typeof n,o=Yi(n),a=iu(t)?Array(t.length):[];return kf(t,function(t){var c=i?n:o&&null!=t?t[n]:Y;a[++e]=c?u(c,t,r):te(t,n,r)}),a}),il=oi(function(t,n,r){t[r]=n}),ol=oi(function(t,n,r){t[r?0:1].push(n)},function(){return[[],[]]}),al=Na(function(t,n){if(null==t)return[];var r=n.length;return r>1&&Zi(t,n[0],n[1])?n=[]:r>2&&Zi(n[0],n[1],n[2])&&(n=[n[0]]),n=1==n.length&&gl(n[0])?n[0]:Pr(n,1,Xi),ve(t,n,[])}),ul=Na(function(t,n,r){var e=it;if(r.length){var i=N(r,Ui(ul));e|=st}return ji(t,e,n,r,i)}),cl=Na(function(t,n,r){var e=it|ot;if(r.length){var i=N(r,Ui(cl));e|=st}return ji(n,e,t,r,i)}),sl=Na(function(t,n){return Or(t,1,n)}),fl=Na(function(t,n,r){return Or(t,Lu(n)||0,r)});qa.Cache=Gn;var ll=Na(function(t,n){n=1==n.length&&gl(n[0])?v(n[0],C(Ri())):v(Pr(n,1,Xi),C(Ri()));var r=n.length;return Na(function(e){for(var i=-1,o=Qs(e.length,r);++i<o;)e[i]=n[i].call(this,e[i]);return u(t,this,e)})}),pl=Na(function(t,n){var r=N(n,Ui(pl));return ji(t,st,Y,n,r)}),hl=Na(function(t,n){var r=N(n,Ui(hl));return ji(t,ft,Y,n,r)}),dl=Na(function(t,n){return ji(t,pt,Y,Y,Y,Pr(n,1))}),vl=ki(Vr),ml=ki(function(t,n){return t>=n}),gl=Array.isArray,yl=Rs?function(t){return t instanceof Rs}:es,_l=ki(ce),xl=ki(function(t,n){return t<=n}),wl=ai(function(t,n){if(hf||ro(n)||iu(n))return void ei(n,ec(n),t);for(var r in n)Ms.call(n,r)&&hr(t,r,n[r])}),bl=ai(function(t,n){if(hf||ro(n)||iu(n))return void ei(n,ic(n),t);for(var r in n)hr(t,r,n[r])}),kl=ai(function(t,n,r,e){ei(n,ic(n),t,e)}),Al=ai(function(t,n,r,e){ei(n,ec(n),t,e)}),El=Na(function(t,n){return gr(t,Pr(n,1))}),Sl=Na(function(t){return t.push(Y,lr),u(kl,Y,t)}),jl=Na(function(t){return t.push(Y,ao),u(Bl,Y,t)}),zl=gi(function(t,n,r){t[n]=r},Nc(Jc)),Ml=gi(function(t,n,r){Ms.call(t,n)?t[n].push(r):t[n]=[r]},Ri),Cl=Na(te),Ol=ai(function(t,n,r){pe(t,n,r)}),Bl=ai(function(t,n,r,e){pe(t,n,r,e)}),Il=Na(function(t,n){return null==t?{}:(n=v(Pr(n,1),so),me(t,Br(Bi(t),n)))}),Ul=Na(function(t,n){return null==t?{}:me(t,v(Pr(n,1),so))}),Rl=Si(ec),Tl=Si(ic),Wl=li(function(t,n,r){return n=n.toLowerCase(),t+(r?wc(n):n)}),Dl=li(function(t,n,r){return t+(r?"-":"")+n.toLowerCase()}),Fl=li(function(t,n,r){return t+(r?" ":"")+n.toLowerCase()}),Pl=fi("toLowerCase"),Ll=li(function(t,n,r){return t+(r?"_":"")+n.toLowerCase()}),ql=li(function(t,n,r){return t+(r?" ":"")+Kl(n)}),Hl=li(function(t,n,r){return t+(r?" ":"")+n.toUpperCase()}),Kl=fi("toUpperCase"),Nl=Na(function(t,n){try{return u(t,Y,n)}catch(r){return pu(r)?r:new _s(r)}}),Jl=Na(function(t,n){return s(Pr(n,1),function(n){n=so(n),t[n]=ul(t[n],t)}),t}),$l=vi(),Vl=vi(!0),Xl=Na(function(t,n){return function(r){return te(r,t,n)}}),Gl=Na(function(t,n){return function(r){return te(t,r,n)}}),Zl=_i(v),Yl=_i(l),Ql=_i(_),tp=bi(),np=bi(!0),rp=yi(function(t,n){return t+n}),ep=Ei("ceil"),ip=yi(function(t,n){return t/n}),op=Ei("floor"),ap=yi(function(t,n){return t*n}),up=Ei("round"),cp=yi(function(t,n){return t-n});return n.after=Ra,n.ary=Ta,n.assign=wl,n.assignIn=bl,n.assignInWith=kl,n.assignWith=Al,n.at=El,n.before=Wa,n.bind=ul,n.bindAll=Jl,n.bindKey=cl,n.castArray=Ga,n.chain=aa,n.chunk=po,n.compact=ho,n.concat=vo,n.cond=Hc,n.conforms=Kc,n.constant=Nc,n.countBy=Qf,n.create=Nu,n.curry=Da,n.curryRight=Fa,n.debounce=Pa,n.defaults=Sl,n.defaultsDeep=jl,n.defer=sl,n.delay=fl,n.difference=Rf,n.differenceBy=Tf,n.differenceWith=Wf,n.drop=mo,n.dropRight=go,n.dropRightWhile=yo,n.dropWhile=_o,n.fill=xo,n.filter=ga,n.flatMap=ya,n.flatMapDeep=_a,n.flatMapDepth=xa,n.flatten=ko,n.flattenDeep=Ao,n.flattenDepth=Eo,n.flip=La,n.flow=$l,n.flowRight=Vl,n.fromPairs=So,n.functions=Yu,n.functionsIn=Qu,n.groupBy=rl,n.initial=Mo,n.intersection=Df,n.intersectionBy=Ff,n.intersectionWith=Pf,n.invert=zl,n.invertBy=Ml,n.invokeMap=el,n.iteratee=$c,n.keyBy=il,n.keys=ec,n.keysIn=ic,n.map=Aa,n.mapKeys=oc,n.mapValues=ac,n.matches=Vc,n.matchesProperty=Xc,n.memoize=qa,n.merge=Ol,n.mergeWith=Bl,n.method=Xl,n.methodOf=Gl,n.mixin=Gc,n.negate=Ha,n.nthArg=Qc,n.omit=Il,n.omitBy=uc,n.once=Ka,n.orderBy=Ea,n.over=Zl,n.overArgs=ll,n.overEvery=Yl,n.overSome=Ql,n.partial=pl,n.partialRight=hl,n.partition=ol,n.pick=Ul,n.pickBy=cc,n.property=ts,n.propertyOf=ns,n.pull=Lf,n.pullAll=Uo,n.pullAllBy=Ro,n.pullAllWith=To,n.pullAt=qf,n.range=tp,n.rangeRight=np,n.rearg=dl,n.reject=za,n.remove=Wo,n.rest=Na,n.reverse=Do,n.sampleSize=Ca,n.set=fc,n.setWith=lc,n.shuffle=Oa,n.slice=Fo,n.sortBy=al,n.sortedUniq=Jo,n.sortedUniqBy=$o,n.split=Bc,n.spread=Ja,n.tail=Vo,n.take=Xo,n.takeRight=Go,n.takeRightWhile=Zo,n.takeWhile=Yo,n.tap=ua,n.throttle=$a,n.thru=ca,n.toArray=Wu,n.toPairs=Rl,n.toPairsIn=Tl,n.toPath=cs,n.toPlainObject=qu,n.transform=pc,n.unary=Va,n.union=Hf,n.unionBy=Kf,n.unionWith=Nf,n.uniq=Qo,n.uniqBy=ta,n.uniqWith=na,n.unset=hc,n.unzip=ra,n.unzipWith=ea,n.update=dc,n.updateWith=vc,n.values=mc,n.valuesIn=gc,n.without=Jf,n.words=qc,n.wrap=Xa,n.xor=$f,n.xorBy=Vf,n.xorWith=Xf,n.zip=Gf,n.zipObject=ia,n.zipObjectDeep=oa,n.zipWith=Zf,n.entries=Rl,n.entriesIn=Tl,n.extend=bl,n.extendWith=kl,Gc(n,n),n.add=rp,n.attempt=Nl,n.camelCase=Wl,n.capitalize=wc,n.ceil=ep,n.clamp=yc,n.clone=Za,n.cloneDeep=Qa,n.cloneDeepWith=tu,n.cloneWith=Ya,n.deburr=bc,n.divide=ip,n.endsWith=kc,n.eq=nu,n.escape=Ac,n.escapeRegExp=Ec,n.every=ma,n.find=tl,n.findIndex=wo,n.findKey=Ju,n.findLast=nl,n.findLastIndex=bo,n.findLastKey=$u,n.floor=op,n.forEach=wa,n.forEachRight=ba,n.forIn=Vu,n.forInRight=Xu,n.forOwn=Gu,n.forOwnRight=Zu,n.get=tc,n.gt=vl,n.gte=ml,n.has=nc,n.hasIn=rc,n.head=jo,n.identity=Jc,n.includes=ka,n.indexOf=zo,n.inRange=_c,n.invoke=Cl,n.isArguments=ru,n.isArray=gl,n.isArrayBuffer=eu,n.isArrayLike=iu,n.isArrayLikeObject=ou,n.isBoolean=au,n.isBuffer=yl,n.isDate=uu,n.isElement=cu,n.isEmpty=su,n.isEqual=fu,n.isEqualWith=lu,n.isError=pu,n.isFinite=hu,n.isFunction=du,n.isInteger=vu,n.isLength=mu,n.isMap=_u,n.isMatch=xu,n.isMatchWith=wu,n.isNaN=bu,n.isNative=ku,n.isNil=Eu,n.isNull=Au,n.isNumber=Su,n.isObject=gu,n.isObjectLike=yu,n.isPlainObject=ju,n.isRegExp=zu,n.isSafeInteger=Mu,n.isSet=Cu,n.isString=Ou,n.isSymbol=Bu,n.isTypedArray=Iu,n.isUndefined=Uu,n.isWeakMap=Ru,n.isWeakSet=Tu,n.join=Co,n.kebabCase=Dl,n.last=Oo,n.lastIndexOf=Bo,n.lowerCase=Fl,n.lowerFirst=Pl,n.lt=_l,n.lte=xl,n.max=fs,n.maxBy=ls,n.mean=ps,n.meanBy=hs,n.min=ds,n.minBy=vs,n.stubArray=rs,n.stubFalse=es,n.stubObject=is,n.stubString=os,n.stubTrue=as,n.multiply=ap,n.nth=Io,n.noConflict=Zc,n.noop=Yc,n.now=Ua,n.pad=Sc,n.padEnd=jc,n.padStart=zc,n.parseInt=Mc,n.random=xc,n.reduce=Sa,n.reduceRight=ja,n.repeat=Cc,n.replace=Oc,n.result=sc,n.round=up,n.runInContext=Z,n.sample=Ma,n.size=Ba,n.snakeCase=Ll,n.some=Ia,n.sortedIndex=Po,n.sortedIndexBy=Lo,n.sortedIndexOf=qo,n.sortedLastIndex=Ho,n.sortedLastIndexBy=Ko,n.sortedLastIndexOf=No,n.startCase=ql,n.startsWith=Ic,n.subtract=cp,n.sum=ms,n.sumBy=gs,n.template=Uc,n.times=us,n.toFinite=Du,n.toInteger=Fu,n.toLength=Pu,n.toLower=Rc,n.toNumber=Lu,n.toSafeInteger=Hu,n.toString=Ku,n.toUpper=Tc,n.trim=Wc,n.trimEnd=Dc,n.trimStart=Fc,n.truncate=Pc,n.unescape=Lc,n.uniqueId=ss,n.upperCase=Hl,n.upperFirst=Kl,n.each=wa,n.eachRight=ba,n.first=jo,Gc(n,function(){var t={};return Hr(n,function(r,e){Ms.call(n.prototype,e)||(t[e]=r)}),t}(),{chain:!1}),n.VERSION=Q,s(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){n[t].placeholder=n}),s(["drop","take"],function(t,n){i.prototype[t]=function(r){var e=this.__filtered__;if(e&&!n)return new i(this);r=r===Y?1:Ys(Fu(r),0);var o=this.clone();return e?o.__takeCount__=Qs(r,o.__takeCount__):o.__views__.push({size:Qs(r,jt),type:t+(o.__dir__<0?"Right":"")}),o},i.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}}),s(["filter","map","takeWhile"],function(t,n){var r=n+1,e=r==xt||r==bt;i.prototype[t]=function(t){var n=this.clone();return n.__iteratees__.push({iteratee:Ri(t,3),type:r}),n.__filtered__=n.__filtered__||e,n}}),s(["head","last"],function(t,n){var r="take"+(n?"Right":"");i.prototype[t]=function(){return this[r](1).value()[0]}}),s(["initial","tail"],function(t,n){var r="drop"+(n?"":"Right");i.prototype[t]=function(){return this.__filtered__?new i(this):this[r](1)}}),i.prototype.compact=function(){return this.filter(Jc)},i.prototype.find=function(t){return this.filter(t).head()},i.prototype.findLast=function(t){return this.reverse().find(t)},i.prototype.invokeMap=Na(function(t,n){return"function"==typeof t?new i(this):this.map(function(r){return te(r,t,n)})}),i.prototype.reject=function(t){return t=Ri(t,3),this.filter(function(n){return!t(n)})},i.prototype.slice=function(t,n){t=Fu(t);var r=this;return r.__filtered__&&(t>0||n<0)?new i(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),n!==Y&&(n=Fu(n),r=n<0?r.dropRight(-n):r.take(n-t)),r)},i.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},i.prototype.toArray=function(){return this.take(jt)},Hr(i.prototype,function(t,r){var o=/^(?:filter|find|map|reject)|While$/.test(r),a=/^(?:head|last)$/.test(r),u=n[a?"take"+("last"==r?"Right":""):r],c=a||/^find/.test(r);u&&(n.prototype[r]=function(){var r=this.__wrapped__,s=a?[1]:arguments,f=r instanceof i,l=s[0],p=f||gl(r),h=function(t){var r=u.apply(n,m([t],s));return a&&d?r[0]:r};p&&o&&"function"==typeof l&&1!=l.length&&(f=p=!1);var d=this.__chain__,v=!!this.__actions__.length,g=c&&!d,y=f&&!v;if(!c&&p){r=y?r:new i(this);var _=t.apply(r,s);return _.__actions__.push({func:ca,args:[h],thisArg:Y}),new e(_,d)}return g&&y?t.apply(this,s):(_=this.thru(h),g?a?_.value()[0]:_.value():_)})}),s(["pop","push","shift","sort","splice","unshift"],function(t){var r=ks[t],e=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",i=/^(?:pop|shift)$/.test(t);n.prototype[t]=function(){var t=arguments;if(i&&!this.__chain__){var n=this.value();return r.apply(gl(n)?n:[],t)}return this[e](function(n){return r.apply(gl(n)?n:[],t)})}}),Hr(i.prototype,function(t,r){var e=n[r];if(e){var i=e.name+"",o=df[i]||(df[i]=[]);o.push({name:r,func:e})}}),df[mi(Y,ot).name]=[{name:"wrapper",func:Y}],i.prototype.clone=R,i.prototype.reverse=Tn,i.prototype.value=Wn,n.prototype.at=Yf,n.prototype.chain=sa,n.prototype.commit=fa,n.prototype.next=la,n.prototype.plant=ha,n.prototype.reverse=da,n.prototype.toJSON=n.prototype.valueOf=n.prototype.value=va,Ls&&(n.prototype[Ls]=pa),n}var Y,Q="4.13.1",tt=200,nt="Expected a function",rt="__lodash_hash_undefined__",et="__lodash_placeholder__",it=1,ot=2,at=4,ut=8,ct=16,st=32,ft=64,lt=128,pt=256,ht=512,dt=1,vt=2,mt=30,gt="...",yt=150,_t=16,xt=1,wt=2,bt=3,kt=1/0,At=9007199254740991,Et=1.7976931348623157e308,St=NaN,jt=4294967295,zt=jt-1,Mt=jt>>>1,Ct="[object Arguments]",Ot="[object Array]",Bt="[object Boolean]",It="[object Date]",Ut="[object Error]",Rt="[object Function]",Tt="[object GeneratorFunction]",Wt="[object Map]",Dt="[object Number]",Ft="[object Object]",Pt="[object Promise]",Lt="[object RegExp]",qt="[object Set]",Ht="[object String]",Kt="[object Symbol]",Nt="[object WeakMap]",Jt="[object WeakSet]",$t="[object ArrayBuffer]",Vt="[object DataView]",Xt="[object Float32Array]",Gt="[object Float64Array]",Zt="[object Int8Array]",Yt="[object Int16Array]",Qt="[object Int32Array]",tn="[object Uint8Array]",nn="[object Uint8ClampedArray]",rn="[object Uint16Array]",en="[object Uint32Array]",on=/\\b__p \\+= \'\';/g,an=/\\b(__p \\+=) \'\' \\+/g,un=/(__e\\(.*?\\)|\\b__t\\)) \\+\\n\'\';/g,cn=/&(?:amp|lt|gt|quot|#39|#96);/g,sn=/[&<>"\'`]/g,fn=RegExp(cn.source),ln=RegExp(sn.source),pn=/<%-([\\s\\S]+?)%>/g,hn=/<%([\\s\\S]+?)%>/g,dn=/<%=([\\s\\S]+?)%>/g,vn=/\\.|\\[(?:[^[\\]]*|(["\'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,mn=/^\\w*$/,gn=/[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|(["\'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(\\.|\\[\\])(?:\\4|$))/g,yn=/[\\\\^$.*+?()[\\]{}|]/g,_n=RegExp(yn.source),xn=/^\\s+|\\s+$/g,wn=/^\\s+/,bn=/\\s+$/,kn=/[a-zA-Z0-9]+/g,An=/\\\\(\\\\)?/g,En=/\\$\\{([^\\\\}]*(?:\\\\.[^\\\\}]*)*)\\}/g,Sn=/\\w*$/,jn=/^0x/i,zn=/^[-+]0x[0-9a-f]+$/i,Mn=/^0b[01]+$/i,Cn=/^\\[object .+?Constructor\\]$/,On=/^0o[0-7]+$/i,Bn=/^(?:0|[1-9]\\d*)$/,In=/[\\xc0-\\xd6\\xd8-\\xde\\xdf-\\xf6\\xf8-\\xff]/g,Un=/($^)/,Rn=/[\'\\n\\r\\u2028\\u2029\\\\]/g,Tn="\\\\ud800-\\\\udfff",Wn="\\\\u0300-\\\\u036f\\\\ufe20-\\\\ufe23",Dn="\\\\u20d0-\\\\u20f0",Fn="\\\\u2700-\\\\u27bf",Pn="a-z\\\\xdf-\\\\xf6\\\\xf8-\\\\xff",Ln="\\\\xac\\\\xb1\\\\xd7\\\\xf7",qn="\\\\x00-\\\\x2f\\\\x3a-\\\\x40\\\\x5b-\\\\x60\\\\x7b-\\\\xbf",Hn="\\\\u2000-\\\\u206f",Kn=" \\\\t\\\\x0b\\\\f\\\\xa0\\\\ufeff\\\\n\\\\r\\\\u2028\\\\u2029\\\\u1680\\\\u180e\\\\u2000\\\\u2001\\\\u2002\\\\u2003\\\\u2004\\\\u2005\\\\u2006\\\\u2007\\\\u2008\\\\u2009\\\\u200a\\\\u202f\\\\u205f\\\\u3000",Nn="A-Z\\\\xc0-\\\\xd6\\\\xd8-\\\\xde",Jn="\\\\ufe0e\\\\ufe0f",$n=Ln+qn+Hn+Kn,Vn="[\'’]",Xn="["+Tn+"]",Gn="["+$n+"]",Zn="["+Wn+Dn+"]",Yn="\\\\d+",Qn="["+Fn+"]",tr="["+Pn+"]",nr="[^"+Tn+$n+Yn+Fn+Pn+Nn+"]",rr="\\\\ud83c[\\\\udffb-\\\\udfff]",er="(?:"+Zn+"|"+rr+")",ir="[^"+Tn+"]",or="(?:\\\\ud83c[\\\\udde6-\\\\uddff]){2}",ar="[\\\\ud800-\\\\udbff][\\\\udc00-\\\\udfff]",ur="["+Nn+"]",cr="\\\\u200d",sr="(?:"+tr+"|"+nr+")",fr="(?:"+ur+"|"+nr+")",lr="(?:"+Vn+"(?:d|ll|m|re|s|t|ve))?",pr="(?:"+Vn+"(?:D|LL|M|RE|S|T|VE))?",hr=er+"?",dr="["+Jn+"]?",vr="(?:"+cr+"(?:"+[ir,or,ar].join("|")+")"+dr+hr+")*",mr=dr+hr+vr,gr="(?:"+[Qn,or,ar].join("|")+")"+mr,yr="(?:"+[ir+Zn+"?",Zn,or,ar,Xn].join("|")+")",_r=RegExp(Vn,"g"),xr=RegExp(Zn,"g"),wr=RegExp(rr+"(?="+rr+")|"+yr+mr,"g"),br=RegExp([ur+"?"+tr+"+"+lr+"(?="+[Gn,ur,"$"].join("|")+")",fr+"+"+pr+"(?="+[Gn,ur+sr,"$"].join("|")+")",ur+"?"+sr+"+"+lr,ur+"+"+pr,Yn,gr].join("|"),"g"),kr=RegExp("["+cr+Tn+Wn+Dn+Jn+"]"),Ar=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Er=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","Reflect","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","isFinite","parseInt","setTimeout"],Sr=-1,jr={};jr[Xt]=jr[Gt]=jr[Zt]=jr[Yt]=jr[Qt]=jr[tn]=jr[nn]=jr[rn]=jr[en]=!0,jr[Ct]=jr[Ot]=jr[$t]=jr[Bt]=jr[Vt]=jr[It]=jr[Ut]=jr[Rt]=jr[Wt]=jr[Dt]=jr[Ft]=jr[Lt]=jr[qt]=jr[Ht]=jr[Nt]=!1;var zr={};zr[Ct]=zr[Ot]=zr[$t]=zr[Vt]=zr[Bt]=zr[It]=zr[Xt]=zr[Gt]=zr[Zt]=zr[Yt]=zr[Qt]=zr[Wt]=zr[Dt]=zr[Ft]=zr[Lt]=zr[qt]=zr[Ht]=zr[Kt]=zr[tn]=zr[nn]=zr[rn]=zr[en]=!0,zr[Ut]=zr[Rt]=zr[Nt]=!1;var Mr={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},Cr={"&":"&amp;","<":"&lt;",">":"&gt;",\'"\':"&quot;","\'":"&#39;","`":"&#96;"},Or={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":\'"\',"&#39;":"\'","&#96;":"`"},Br={"\\\\":"\\\\","\'":"\'","\\n":"n","\\r":"r","\\u2028":"u2028","\\u2029":"u2029"},Ir=parseFloat,Ur=parseInt,Rr="object"==typeof n&&n,Tr=Rr&&"object"==typeof t&&t,Wr=Tr&&Tr.exports===Rr,Dr=R("object"==typeof i&&i),Fr=R("object"==typeof self&&self),Pr=R("object"==typeof this&&this),Lr=Dr||Fr||Pr||Function("return this")(),qr=Z();(Fr||{})._=qr,e=function(){return qr}.call(n,r,n,t),!(e!==Y&&(t.exports=e))}).call(this)}).call(n,r(92)(t),function(){return this}())},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{"default":t}}function i(t){return CryptoJS.lib.WordArray.create(new Uint8Array(t))}function o(t,n){return t instanceof ArrayBuffer||t instanceof Uint8Array||(t=new Uint8Array(t)),n instanceof ArrayBuffer||n instanceof Uint8Array||(n=new Uint8Array(n)),l.build(t,n).readBuffer()}var a=r(49),u=e(a),c=r(22),s=r(45),f=r(23),l=r(46),p=r(43),h={image:"WhatsApp Image Keys",video:"WhatsApp Video Keys",audio:"WhatsApp Audio Keys",ptt:"WhatsApp Audio Keys",document:"WhatsApp Document Keys"},d={decryptE2EMediaWithWebCrypto:function(t,n,r,e){if(n.length<10)throw new c.MediaEncryptionError("ciphertext too short: "+n.length);var i=this.computeKeys(t,r),a=i.iv,u=i.cipherKey,s=i.macKey,l={name:"HMAC",hash:{name:"SHA-256"}},h={name:"AES-CBC",iv:new Uint8Array(a)};return this.getWebCrypto().then(function(r){var i=f.encode(n.slice(-10)),d=n.slice(0,-10),v=o(a,d);return r.importKey("raw",new Uint8Array(s),l,!1,["sign"]).then(function(t){return r.sign(l,t,v)}).then(function(t){var n=f.encode(new Uint8Array(t)),r=f.encode(f.decode(n).slice(0,10));if(!r||!i||r!==i)throw new c.MediaEncryptionError("hmac fail computed: "+r+" given: "+i)}).then(function(){return r.importKey("raw",new Uint8Array(u),h,!1,["decrypt"])}).then(function(t){return r.decrypt(h,t,d)}).then(function(n){return new Blob([n],{type:p.getMediaMimeType(t,n,e)})})})["catch"](c.MediaEncryptionError,function(t){throw t})["catch"](function(t){return!(t instanceof c.MediaEncryptionError)},function(t){throw new c.MediaEncryptionError("encryption error: "+t+"; stack: "+t.stack)})},encryptE2EMediaWithWebCrypto:function(t,n,r){var e=this.computeKeys(t,r),i=e.iv,a=e.cipherKey,u=e.macKey,s={name:"HMAC",hash:{name:"SHA-256"}},f={name:"AES-CBC",iv:new Uint8Array(i)};return this.getWebCrypto().then(function(t){return t.importKey("raw",new Uint8Array(a),f,!1,["encrypt"]).then(function(r){return t.encrypt(f,r,n)}).then(function(n){var r=o(i,n);return t.importKey("raw",new Uint8Array(u),s,!1,["sign"]).then(function(n){return t.sign(s,n,r)}).then(function(t){var r=t.slice(0,10),e=o(n,r);return new Blob([e])})})})["catch"](c.MediaEncryptionError,function(t){throw t})["catch"](function(t){return!(t instanceof c.MediaEncryptionError)},function(t){throw new c.MediaEncryptionError("encryption error: "+t+"; stack: "+t.stack)})},decryptE2EMediaWithCryptoJS:function(t,n,r,e){try{if(n.length<10)throw new c.MediaEncryptionError("ciphertext too short: "+n.length);var a=this.computeKeys(t,r),u=a.iv,s=a.cipherKey,l=a.macKey,h=f.encode(n.slice(-10)),d=n.slice(0,-10),v=o(u,d),m=CryptoJS.lib.WordArray.create(v),g=CryptoJS.HmacSHA256(m,i(l)).toString(CryptoJS.enc.Base64),y=f.encode(f.decode(g).slice(0,10));if(!y||!h||y!==h)throw new c.MediaEncryptionError("hmac fail computed: "+y+" given: "+h);var _=CryptoJS.AES.decrypt({ciphertext:CryptoJS.lib.WordArray.create(d),salt:void 0},i(s),{iv:i(u),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),x=f.decode(_.toString(CryptoJS.enc.Base64));return new Blob([x],{type:p.getMediaMimeType(t,x,e)})}catch(w){throw w instanceof c.MediaEncryptionError?w:new c.MediaEncryptionError("unknown decrypt error: "+w+" stack: "+w.stack)}},encryptE2EMediaWithCryptoJS:function(t,n,r){try{var e=this.computeKeys(t,r),o=e.iv,a=e.cipherKey,u=e.macKey,s=CryptoJS.AES.encrypt(CryptoJS.lib.WordArray.create(n),i(a),{iv:i(o),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),l=s.iv.concat(s.ciphertext),p=CryptoJS.HmacSHA256(l,i(u));p.sigBytes=10,p.clamp();var h=s.ciphertext.concat(p),d=f.decode(h.toString(CryptoJS.enc.Base64));return new Blob([d])}catch(v){throw v instanceof c.MediaEncryptionError?v:new c.MediaEncryptionError("unknown encrypt error: "+v+" stack: "+v.stack)}},computeKeys:function(t,n){var r=h[t];if(!n||!r)throw new c.MediaEncryptionError("computeKeys fail: !!mediakey: "+!!n+" info: "+r+" type: "+t);var e=s.extractAndExpand(f.decode(n),void 0,r,112,!0);if(!e||e.length<112)throw new c.MediaEncryptionError("computeKeys:hkdf error");return{iv:e.slice(0,16),cipherKey:e.slice(16,48),macKey:e.slice(48,80),refKey:e.slice(80,112)}},getWebCryptoObject:function(){return new u["default"](function(t,n){var r=window.crypto||window.msCrypto;r?t(r):n("browser doesn\'t support crypto")})},getWebCrypto:function(){return this.getWebCryptoObject().then(function(t){var n=t.subtle||t.webkitSubtle;return n?n:u["default"].reject("browser doesn\'t support crypto.subtle")})}};t.exports=d},function(t,n,r){!function(e,i,o){t.exports=n=i(r(0),r(21),r(87),r(86),r(85))}(this,function(t){return function(){var n=t,r=n.lib,e=r.BlockCipher,i=n.algo,o=[],a=[],u=[],c=[],s=[],f=[],l=[],p=[],h=[],d=[];!function(){for(var t=[],n=0;n<256;n++)n<128?t[n]=n<<1:t[n]=n<<1^283;for(var r=0,e=0,n=0;n<256;n++){var i=e^e<<1^e<<2^e<<3^e<<4;i=i>>>8^255&i^99,o[r]=i,a[i]=r;var v=t[r],m=t[v],g=t[m],y=257*t[i]^16843008*i;u[r]=y<<24|y>>>8,c[r]=y<<16|y>>>16,s[r]=y<<8|y>>>24,f[r]=y;var y=16843009*g^65537*m^257*v^16843008*r;l[i]=y<<24|y>>>8,p[i]=y<<16|y>>>16,h[i]=y<<8|y>>>24,d[i]=y,r?(r=v^t[t[t[g^v]]],e^=t[t[e]]):r=e=1}}();var v=[0,1,2,4,8,16,32,64,128,27,54],m=i.AES=e.extend({_doReset:function(){for(var t=this._key,n=t.words,r=t.sigBytes/4,e=this._nRounds=r+6,i=4*(e+1),a=this._keySchedule=[],u=0;u<i;u++)if(u<r)a[u]=n[u];else{var c=a[u-1];u%r?r>6&&u%r==4&&(c=o[c>>>24]<<24|o[c>>>16&255]<<16|o[c>>>8&255]<<8|o[255&c]):(c=c<<8|c>>>24,c=o[c>>>24]<<24|o[c>>>16&255]<<16|o[c>>>8&255]<<8|o[255&c],c^=v[u/r|0]<<24),a[u]=a[u-r]^c}for(var s=this._invKeySchedule=[],f=0;f<i;f++){var u=i-f;if(f%4)var c=a[u];else var c=a[u-4];f<4||u<=4?s[f]=c:s[f]=l[o[c>>>24]]^p[o[c>>>16&255]]^h[o[c>>>8&255]]^d[o[255&c]]}},encryptBlock:function(t,n){this._doCryptBlock(t,n,this._keySchedule,u,c,s,f,o)},decryptBlock:function(t,n){var r=t[n+1];t[n+1]=t[n+3],t[n+3]=r,this._doCryptBlock(t,n,this._invKeySchedule,l,p,h,d,a);var r=t[n+1];t[n+1]=t[n+3],t[n+3]=r},_doCryptBlock:function(t,n,r,e,i,o,a,u){for(var c=this._nRounds,s=t[n]^r[0],f=t[n+1]^r[1],l=t[n+2]^r[2],p=t[n+3]^r[3],h=4,d=1;d<c;d++){var v=e[s>>>24]^i[f>>>16&255]^o[l>>>8&255]^a[255&p]^r[h++],m=e[f>>>24]^i[l>>>16&255]^o[p>>>8&255]^a[255&s]^r[h++],g=e[l>>>24]^i[p>>>16&255]^o[s>>>8&255]^a[255&f]^r[h++],y=e[p>>>24]^i[s>>>16&255]^o[f>>>8&255]^a[255&l]^r[h++];s=v,f=m,l=g,p=y}var v=(u[s>>>24]<<24|u[f>>>16&255]<<16|u[l>>>8&255]<<8|u[255&p])^r[h++],m=(u[f>>>24]<<24|u[l>>>16&255]<<16|u[p>>>8&255]<<8|u[255&s])^r[h++],g=(u[l>>>24]<<24|u[p>>>16&255]<<16|u[s>>>8&255]<<8|u[255&f])^r[h++],y=(u[p>>>24]<<24|u[s>>>16&255]<<16|u[f>>>8&255]<<8|u[255&l])^r[h++];t[n]=v,t[n+1]=m,t[n+2]=g,t[n+3]=y},keySize:8});n.AES=e._createHelper(m)}(),t.AES})},function(t,n,r){!function(e,i,o){t.exports=n=i(r(0),r(89),r(36))}(this,function(t){return t.HmacSHA256})},function(t,n,r){!function(e,i){t.exports=n=i(r(0))}(this,function(t){return function(){if("function"==typeof ArrayBuffer){var n=t,r=n.lib,e=r.WordArray,i=e.init,o=e.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var n=t.byteLength,r=[],e=0;e<n;e++)r[e>>>2]|=t[e]<<24-e%4*8;i.call(this,r,n)}else i.apply(this,arguments)};o.prototype=e}}(),t.lib.WordArray})},function(t,n,r){"use strict";function e(t,n,r,i){if(o.isArray(t)||o.isString(t)){o.isString(t)&&(t=[t]);for(var a=0;a<t.length;a++)n[t[a]]=i+r}else for(var u in t)e(t[u],n,u,i+r)}function i(t){var n;try{n=t?JSON.parse(t):a}catch(r){return null}var i={};return e(n,i,"",""),i}var o=r(37),a=r(91);t.exports=i},function(t,n,r){"use strict";function e(){return _.chain(u).pickBy(function(t,n){return"document"===t.msgType&&t.canSend}).keys().value().join(",")}var i=r(42),o=r(22),a=r(90),u={"text/plain":{ext:"TXT",msgType:"document",icon:"icon-doc-txt",canSend:!1},"text/rtf":{ext:"RTF",msgType:"document",icon:"icon-doc-doc",canSend:!1,signatureMimetype:"application/rtf"},"application/pdf":{ext:"PDF",msgType:"document",icon:"icon-doc-pdf",canSend:!0,signatureMimetype:"application/pdf",previewType:"pdf"},"application/msword":{ext:"DOC",msgType:"document",icon:"icon-doc-doc",canSend:!1,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.ms-excel":{ext:"XLS",msgType:"document",icon:"icon-doc-xls",canSend:!1,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.ms-powerpoint":{ext:"PPT",msgType:"document",icon:"icon-doc-ppt",canSend:!1,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{ext:"DOCX",msgType:"document",icon:"icon-doc-doc",canSend:!1,signatureMimetype:"application/zip",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{ext:"PPTX",msgType:"document",icon:"icon-doc-ppt",canSend:!1,signatureMimetype:"application/zip",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{ext:"XLSX",msgType:"document",icon:"icon-doc-xls",canSend:!1,signatureMimetype:"application/zip",previewType:"msoffice"},"audio/aac":{msgType:"audio"},"audio/mp4":{msgType:"audio"},"audio/amr":{msgType:"audio"},"audio/mpeg":{msgType:"audio"},"audio/ogg; codecs=opus":{msgType:"audio"},"video/mp4":{msgType:"video"},"video/3gpp":{msgType:"video"},"image/jpeg":{msgType:"image"}},c={MIMETYPES:u,DOC_MIMES:e(),EXT_TO_MIME:i(),updateDocMimes:function(t){if("*"===t)c.DOC_MIMES="*";else if(_.isString(t)){var n=t.split(",");for(var r in u){var i=u[r];"document"===i.msgType&&(_.isString(i.ext)&&n.indexOf(i.ext.toLowerCase())>-1?i.canSend=!0:i.canSend=!1)}c.DOC_MIMES=e()}},isAllowedDocumentMimetype:function(t,n){var r=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];for(var e in u){var i=u[e];if("document"===i.msgType){var o=r?i.signatureMimetype:e;if(o===t&&i.canSend&&n&&n.toLowerCase().endsWith(i.ext.toLowerCase()))return e}}return!1},getExtension:function(t){var n=u[t];return n?"."+(n.ext||t.split("/")[1]).toLowerCase():""},previewType:function(t){var n=_.find(u,function(n,r){return n.previewType&&(r===t||n.signatureMimetype===t)});return n?n.previewType:void 0},getMediaMimeType:function(t,n,r){if(r)return r;var e=a(new Uint8Array(n,0,Math.min(262,n.byteLength)));if(e)return e.mime;if("image"===t)return"image/jpeg";throw new o.MediaEncryptionError("unknown mime decrypt error for type:"+t)}};t.exports=c},function(t,n,r){"use strict";function e(t){var n=t.data,r=n.type,e=n.buffer,i=n.mediaKey,a=n.mimetype;postMessage(o.decryptE2EMediaWithCryptoJS(r,e,i,a))}function i(t){var n=t.data,r=n.type,e=n.buffer,i=n.mediaKey;postMessage(o.encryptE2EMediaWithCryptoJS(r,e,i))}self.CryptoJS=r(0),r(41),r(21),r(40),r(39);var o=r(38);self.onmessage=function(t){switch(t.data.command){case"decrypt-e2e-media":e(t);break;case"encrypt-e2e-media":i(t);break;default:throw new Error("unknown crypto worker command: "+t.data.command)}}},function(t,n,r){"use strict";function e(t){return"string"==typeof t?t:CryptoJS.lib.WordArray.create(new Uint8Array(t))}function i(t,n){return c.decode(t.toString(CryptoJS.enc.Base64),!!n)}function o(t){var n=arguments.length<=1||void 0===arguments[1]?new Uint8Array(s):arguments[1],r=arguments[2];return i(CryptoJS.HmacSHA256(e(t),e(n)),r)}function a(t,n,r,o){if(r<0||r>255*s)return null;var a=e(t),u=e(n),c=Math.ceil(r/s),f=new Array(c+1);f[0]="";for(var l=new Uint8Array(1),p=0;p<c;p++){l[0]=p+1;var h=CryptoJS.algo.HMAC.create(CryptoJS.algo.SHA256,a);h.update(f[p]),h.update(u),h.update(e(l)),f[p+1]=h.finalize()}for(var d=new Uint8Array(r),v=0,m=0;v<c;v++)for(var g=new Uint8Array(i(f[v+1])),y=0;y<s&&m<r;y++,m++)d[m]=g[y];return o?Array.prototype.slice.call(d):d.buffer}function u(t,n,r,e,i){return a(o(t,n),r,e,i)}var c=r(23),s=32;t.exports={extract:o,expand:a,extractAndExpand:u}},function(t,n){"use strict";function r(){var t=arguments.length<=0||void 0===arguments[0]?void 0:arguments[0];t instanceof ArrayBuffer&&(t=new Uint8Array(t)),t instanceof Uint8Array?(this._buffer=t,this._writeIndex=this._readEndIndex=t.byteLength):(this._buffer=null,this._writeIndex=this._readEndIndex=0),this._readIndex=0,this._view=null,this.littleEndian=!1,this._hiddenWrites=0}function e(t){var n=new r;return n._buffer=new Uint8Array(t),n}function i(){for(var t=0,n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];for(var u=0;u<i.length;u++){var c=i[u];"string"==typeof c?t+=o(c):"number"==typeof c?t++:c instanceof r?t+=c.size():c instanceof ArrayBuffer?t+=c.byteLength:c instanceof Uint8Array&&(t+=c.length)}var s=e(t);return s.write.apply(s,i),s}function o(t){if(t===g)return y;for(var n=0,r=0;r<t.length;r++){var e=t.charCodeAt(r);e<128?n++:e<2048?n+=2:e<55296||57344<=e&&e<=65535?n+=3:(u(t,r,e),r++,n+=4)}return g=t,y=n}function a(t,n,r){var e=t._writeIndex;try{n(t,r),e=t._writeIndex}finally{t._writeIndex=e}}function u(t,n,r){if(r<55296||56320<=r)throw new TypeError("Invalid first surrogate at wchar-position "+n+\' in "\'+t+\'"\');\nif(++n===t.length)throw new TypeError(\'String ends with incomplete surrogate pair in "\'+t+\'"\');var e=t.charCodeAt(n);if(e<56320||57344<=e)throw new TypeError("Invalid second surrogate at wchar-position "+n+\' in "\'+t+\'"\')}function c(t,n,r,e){if("number"!=typeof t||t!==t||Math.floor(t)!==t||t<n||t>=r)throw new TypeError("string"==typeof t?\'WriteError: string "\'+t+\'" is not a valid \'+e:"WriteError: "+t+" is not a valid "+e)}function s(t){return t._view||(t._view=new DataView(t._buffer.buffer,t._buffer.byteOffset))}function f(t,n){if(n<0)throw new Error("ReadError: given negative number of bytes to read");var r=t._readIndex,e=r+n;if(e>t._readEndIndex)throw new Error(r===t._readEndIndex?"ReadError: tried to read from depleted binary":"ReadError: tried to read beyond end of binary");return t._readIndex=e,r}function l(t,n){var r=t._writeIndex,e=r+n,i=t._buffer;if(!i||e>i.length){var o=Math.max(e,i?2*i.length:64),a=new Uint8Array(o);i&&a.set(i),t._buffer=a,t._view=null}return t._writeIndex=e,t._hiddenWrites||(t._readEndIndex=e),r}function p(t,n,r){var e=f(r,8),i=s(r),o=i.getInt32(n?e+4:e,n),a=i.getInt32(n?e:e+4,n);return d(t,o,a)}function h(t,n,r){var e=l(r,8),i=t<0;i&&(t=-t);var o=Math.floor(t/4294967296),a=t-4294967296*o,u=s(r);if(u.setUint32(n?e+4:e,o,n),u.setUint32(n?e:e+4,a,n),i){for(var c=r._buffer,f=e;f<e+8;f++)c[f]=255&~c[f];var p=255;if(n)for(var h=e;h<e+8&&255===p;h++)p=c[h],c[h]=255===p?0:p+1;else for(var d=e+7;d>=e&&255===p;d--)p=c[d],c[d]=255===p?0:p+1}}function d(t,n,e){var i=n>>20,o=0===i||t&&i===-1,a=n>=0?n:t?n:4294967296+n,u=e>=0?e:4294967296+e,c=4294967296*a+u;return o?c:r.onLongLong(c,t,n,e)}var v=65533,m=new Uint8Array(10);r.prototype={size:function(){return this._readEndIndex-this._readIndex},peek:function(t){var n=arguments.length<=1||void 0===arguments[1]?void 0:arguments[1],r=this._readIndex;try{return t(this,n)}finally{this._readIndex=r}},advance:function(t){f(this,t)},readUint8:function(){return this._buffer[f(this,1)]},readInt8:function(){var t=f(this,1);return s(this).getInt8(t)},readUint16:function(){var t=arguments.length<=0||void 0===arguments[0]?this.littleEndian:arguments[0],n=f(this,2);return s(this).getUint16(n,t)},readInt32:function(){var t=arguments.length<=0||void 0===arguments[0]?this.littleEndian:arguments[0],n=f(this,4);return s(this).getInt32(n,t)},readUint32:function(){var t=arguments.length<=0||void 0===arguments[0]?this.littleEndian:arguments[0],n=f(this,4);return s(this).getUint32(n,t)},readInt64:function(){var t=arguments.length<=0||void 0===arguments[0]?this.littleEndian:arguments[0];return p(!0,t,this)},readUint64:function(){var t=arguments.length<=0||void 0===arguments[0]?this.littleEndian:arguments[0];return p(!1,t,this)},readFloat32:function(){var t=arguments.length<=0||void 0===arguments[0]?this.littleEndian:arguments[0],n=f(this,4);return s(this).getFloat32(n,t)},readFloat64:function(){var t=arguments.length<=0||void 0===arguments[0]?this.littleEndian:arguments[0],n=f(this,8);return s(this).getFloat64(n,t)},readVarInt:function(){var t=this._readIndex,n=this._readEndIndex-t,r=this._buffer;n<=0&&f(this,1);var e=void 0,i=r[t];for(e=1;e<n&&e<11&&128&i;e++)i=r[t+e];var o=e;if(o>10||10===o&&r[t+9]>1)throw new Error("ParseError: varint exceeds 64 bits");128&i&&f(this,o+1),f(this,o);var a=0,u=0;for(e=0;e<3&&e<o;e++,u+=7)a|=(127&r[t+e])<<u;if(o<4)return a;var c=0;for(u=0,e=3;e<6&&e<o;e++,u+=7)c|=(127&r[t+e])<<u;if(o<5)return c<<21|a;if(o<7)return 2097152*c+a;var s=0;for(u=0,e=6;e<9&&e<o;e++,u+=7)s|=(127&r[t+e])<<u;10===o&&(s|=(1&r[t+9])<<21);var l=s<<10|c>>11,p=c<<21|a;return d(!0,l,p)},readBuffer:function(){var t=arguments.length<=0||void 0===arguments[0]?this.size():arguments[0];if(0===t)return new ArrayBuffer(0);var n=f(this,t),r=this._buffer,e=n+r.byteOffset,i=r.buffer;return 0===e&&this._readIndex===i.byteLength?i:i.slice(e,e+t)},readByteArray:function(){var t=arguments.length<=0||void 0===arguments[0]?this.size():arguments[0];if(0===t)return new Uint8Array(0);var n=f(this,t);return this._buffer.subarray(n,n+t)},readBinary:function(){var t=arguments.length<=0||void 0===arguments[0]?this.size():arguments[0];if(0===t)return new r;var n=f(this,t);return new r(this._buffer.subarray(n,n+t))},readString:function(t){for(var n=f(this,t),r=n+t,e=this._buffer,i=[],o=void 0,a=n,u=t;a<r;a++,u--){i.length>5e3&&(o||(o=[]),o.push(String.fromCharCode.apply(String,i)),i=[]);var c=0|e[a];if(0===(128&c))i.push(c);else if(u>=2&&192===(224&c)){var s=0|e[a+1];if(128===(192&s)){var l=(31&c)<<6|63&s;l>=128?(a++,u--,i.push(l)):i.push(v)}else i.push(v)}else if(u>=3&&224===(240&c)){var p=0|e[a+1],h=0|e[a+2];if(128===(192&p)&&128===(192&h)){var d=(15&c)<<12|(63&p)<<6|63&h;d>=2048&&!(55296<=d&&d<57344)?(a+=2,u-=2,i.push(d)):i.push(v)}else i.push(v)}else if(u>=4&&240===(248&c)){var m=0|e[a+1],g=0|e[a+2],y=0|e[a+3];if(128===(192&m)&&128===(192&g)&&128===(192&y)){var _=(7&c)<<18|(63&m)<<12|(63&g)<<6|63&y;if(_>=65536&&_<=1114111){a+=3,u-=3;var x=_-65536;i.push(55296|x>>10,56320|1023&x)}else i.push(v)}else i.push(v)}else i.push(v)}var w=String.fromCharCode.apply(String,i);return o?(o.push(w),o.join("")):w},write:function(){for(var t=0;t<arguments.length;t++){var n=arguments[t];"string"==typeof n?this.writeString(n):"number"==typeof n?this.writeUint8(n):n instanceof r?this.writeBinary(n):n instanceof ArrayBuffer?this.writeBuffer(n):n instanceof Uint8Array&&this.writeByteArray(n)}},writeUint8:function(t){c(t,0,256,"uint8");var n=l(this,1);this._buffer[n]=t},writeInt8:function(t){c(t,-128,128,"signed int8");var n=l(this,1);this._buffer[n]=t},writeUint16:function(t){var n=arguments.length<=1||void 0===arguments[1]?this.littleEndian:arguments[1];c(t,0,65536,"uint16");var r=l(this,2);s(this).setUint16(r,t,n)},writeInt16:function(t){var n=arguments.length<=1||void 0===arguments[1]?this.littleEndian:arguments[1];c(t,-32768,32768,"signed int16");var r=l(this,2);s(this).setInt16(r,t,n)},writeUint32:function(t){var n=arguments.length<=1||void 0===arguments[1]?this.littleEndian:arguments[1];c(t,0,4294967296,"uint32");var r=l(this,4);s(this).setUint32(r,t,n)},writeInt32:function(t){var n=arguments.length<=1||void 0===arguments[1]?this.littleEndian:arguments[1];c(t,-2147483648,2147483648,"signed int32");var r=l(this,4);s(this).setInt32(r,t,n)},writeUint64:function(t){var n=arguments.length<=1||void 0===arguments[1]?this.littleEndian:arguments[1];c(t,-0x8000000000000000,0x8000000000000000,"signed int64"),h(t,n,this)},writeInt64:function(t){var n=arguments.length<=1||void 0===arguments[1]?this.littleEndian:arguments[1];c(t,0,0x10000000000000000,"uint64"),h(t,n,this)},writeFloat32:function(t){var n=arguments.length<=1||void 0===arguments[1]?this.littleEndian:arguments[1],r=l(this,4);s(this).setFloat32(r,t,n)},writeFloat64:function(t){var n=arguments.length<=1||void 0===arguments[1]?this.littleEndian:arguments[1],r=l(this,8);s(this).setFloat64(r,t,n)},writeVarInt:function(t){c(t,-0x8000000000000000,0x8000000000000000,"varint (signed int64)");var n=t<0;n&&(t=-t);for(var r=t<128&&1||t<16384&&2||t<2097152&&3||t<268435456&&4||t<34359738368&&5||t<4398046511104&&6||t<562949953421312&&7||t<72057594037927940&&8||9,e=l(this,n?10:r),i=this._buffer,o=t,a=e,u=r;u>4;u--){var s=Math.floor(o/128),f=o-128*s;i[a++]=128|127&f,o=s}for(;u>1;u--)i[a++]=128|127&o,o>>=7;if(i[a++]=o,n){for(var p=e;p<a;p++)i[p]=128|127&~i[p];for(var h=a;h<e+9;h++)i[h]=255;i[e+9]=1;for(var d=255,v=e;v<e+9&&255===d;v++)d=i[v],i[v]=255===d?128:d+1}},writeBinary:function(t){var n=t._readIndex,r=t._readEndIndex;if(n!==r){var e=l(this,r-n);this._buffer.set(t._buffer.subarray(n,r),e)}},writeBuffer:function(t){this.writeByteArray(new Uint8Array(t))},writeByteArray:function(t){var n=l(this,t.length);this._buffer.set(t,n)},writeString:function(t){for(var n=l(this,o(t)),r=this._buffer,e=0;e<t.length;e++){var i=t.charCodeAt(e);if(i<128)r[n++]=i;else if(i<2048)r[n++]=192|i>>6,r[n++]=128|63&i;else if(i<55296||57344<=i)r[n++]=224|i>>12,r[n++]=128|i>>6&63,r[n++]=128|63&i;else{var a=65536+((1023&i)<<10|1023&t.charCodeAt(++e));r[n++]=240|a>>18,r[n++]=128|a>>12&63,r[n++]=128|a>>6&63,r[n++]=128|63&a}}},writeBytes:function(){for(var t=0;t<arguments.length;t++)c(arguments[t],0,256,"byte");for(var n=l(this,arguments.length),r=this._buffer,e=0;e<arguments.length;e++)r[n+e]=arguments[e]},writeWithVarIntLength:function(t,n){var r=this._writeIndex;this._hiddenWrites++,a(this,t,n),this._hiddenWrites--;var e=this._writeIndex;this.writeVarInt(e-r);for(var i=this._writeIndex-e,o=this._buffer,u=0;u<i;u++)m[u]=o[e+u];for(var c=e-1;c>=r;c--)o[c+i]=o[c];for(var s=0;s<i;s++)o[r+s]=m[s]}},r.onLongLong=function(t){throw new Error("ReadError: integer exceeded 52 bits ("+t+")")},r.build=i,r.newOfCapacity=e;var g="",y=0;r.numUtf8Bytes=o,t.exports=r},function(t,n,r){t.exports={"default":r(50),__esModule:!0}},function(t,n,r){t.exports={"default":r(51),__esModule:!0}},function(t,n,r){t.exports={"default":r(52),__esModule:!0}},function(t,n,r){var e=r(3),i=e.JSON||(e.JSON={stringify:JSON.stringify});t.exports=function(t){return i.stringify.apply(i,arguments)}},function(t,n,r){r(80);var e=r(3).Object;t.exports=function(t,n){return e.create(t,n)}},function(t,n,r){r(81),r(83),r(84),r(82),t.exports=r(3).Promise},function(t,n){t.exports=function(){}},function(t,n){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},function(t,n,r){var e=r(20),i=r(34),o=r(75);t.exports=function(t){return function(n,r,a){var u,c=e(n),s=i(c.length),f=o(a,s);if(t&&r!=r){for(;s>f;)if(u=c[f++],u!=u)return!0}else for(;s>f;f++)if((t||f in c)&&c[f]===r)return t||f||0;return!t&&-1}}},function(t,n,r){var e=r(9),i=r(61),o=r(60),a=r(4),u=r(34),c=r(78),s={},f={},n=t.exports=function(t,n,r,l,p){var h,d,v,m,g=p?function(){return t}:c(t),y=e(r,l,n?2:1),_=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(o(g)){for(h=u(t.length);h>_;_++)if(m=n?y(a(d=t[_])[0],d[1]):y(t[_]),m===s||m===f)return m}else for(v=g.call(t);!(d=v.next()).done;)if(m=i(v,y,d.value,n),m===s||m===f)return m};n.BREAK=s,n.RETURN=f},function(t,n,r){t.exports=!r(6)&&!r(26)(function(){return 7!=Object.defineProperty(r(15)("div"),"a",{get:function(){return 7}}).a})},function(t,n){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},function(t,n,r){var e=r(8);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n,r){var e=r(7),i=r(1)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||o[i]===t)}},function(t,n,r){var e=r(4);t.exports=function(t,n,r,i){try{return i?n(e(r)[0],r[1]):n(r)}catch(o){var a=t["return"];throw void 0!==a&&e(a.call(t)),o}}},function(t,n,r){"use strict";var e=r(30),i=r(31),o=r(17),a={};r(5)(a,r(1)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(a,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n,r){var e=r(1)("iterator"),i=!1;try{var o=[7][e]();o["return"]=function(){i=!0},Array.from(o,function(){throw 2})}catch(a){}t.exports=function(t,n){if(!n&&!i)return!1;var r=!1;try{var o=[7],a=o[e]();a.next=function(){return{done:r=!0}},o[e]=function(){return a},t(o)}catch(u){}return r}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var e=r(2),i=r(33).set,o=e.MutationObserver||e.WebKitMutationObserver,a=e.process,u=e.Promise,c="process"==r(8)(a);t.exports=function(){var t,n,r,s=function(){var e,i;for(c&&(e=a.domain)&&e.exit();t;){i=t.fn,t=t.next;try{i()}catch(o){throw t?r():n=void 0,o}}n=void 0,e&&e.enter()};if(c)r=function(){a.nextTick(s)};else if(o){var f=!0,l=document.createTextNode("");new o(s).observe(l,{characterData:!0}),r=function(){l.data=f=!f}}else if(u&&u.resolve){var p=u.resolve();r=function(){p.then(s)}}else r=function(){i.call(e,s)};return function(e){var i={fn:e,next:void 0};n&&(n.next=i),t||(t=i,r()),n=i}}},function(t,n,r){var e=r(12),i=r(4),o=r(69);t.exports=r(6)?Object.defineProperties:function(t,n){i(t);for(var r,a=o(n),u=a.length,c=0;u>c;)e.f(t,r=a[c++],n[r]);return t}},function(t,n,r){var e=r(10),i=r(76),o=r(18)("IE_PROTO"),a=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?a:null}},function(t,n,r){var e=r(10),i=r(20),o=r(55)(!1),a=r(18)("IE_PROTO");t.exports=function(t,n){var r,u=i(t),c=0,s=[];for(r in u)r!=a&&e(u,r)&&s.push(r);for(;n.length>c;)e(u,r=n[c++])&&(~o(s,r)||s.push(r));return s}},function(t,n,r){var e=r(68),i=r(25);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(5);t.exports=function(t,n,r){for(var i in n)r&&t[i]?t[i]=n[i]:e(t,i,n[i]);return t}},function(t,n,r){t.exports=r(5)},function(t,n,r){"use strict";var e=r(2),i=r(3),o=r(12),a=r(6),u=r(1)("species");t.exports=function(t){var n="function"==typeof i[t]?i[t]:e[t];a&&n&&!n[u]&&o.f(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(4),i=r(13),o=r(1)("species");t.exports=function(t,n){var r,a=e(t).constructor;return void 0===a||void 0==(r=e(a)[o])?n:i(r)}},function(t,n,r){var e=r(19),i=r(14);t.exports=function(t){return function(n,r){var o,a,u=String(i(n)),c=e(r),s=u.length;return c<0||c>=s?t?"":void 0:(o=u.charCodeAt(c),o<55296||o>56319||c+1===s||(a=u.charCodeAt(c+1))<56320||a>57343?t?u.charAt(c):o:t?u.slice(c,c+2):(o-55296<<10)+(a-56320)+65536)}}},function(t,n,r){var e=r(19),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n,r){var e=r(14);t.exports=function(t){return Object(e(t))}},function(t,n,r){var e=r(11);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can\'t convert object to primitive value")}},function(t,n,r){var e=r(24),i=r(1)("iterator"),o=r(7);t.exports=r(3).getIteratorMethod=function(t){if(void 0!=t)return t[i]||t["@@iterator"]||o[e(t)]}},function(t,n,r){"use strict";var e=r(53),i=r(64),o=r(7),a=r(20);t.exports=r(28)(Array,"Array",function(t,n){this._t=a(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n,r){var e=r(16);e(e.S,"Object",{create:r(30)})},function(t,n){},function(t,n,r){"use strict";var e,i,o,a=r(29),u=r(2),c=r(9),s=r(24),f=r(16),l=r(11),p=r(13),h=r(54),d=r(56),v=r(73),m=r(33).set,g=r(65)(),y="Promise",_=u.TypeError,x=u.process,w=u[y],x=u.process,b="process"==s(x),k=function(){},A=!!function(){try{var t=w.resolve(1),n=(t.constructor={})[r(1)("species")]=function(t){t(k,k)};return(b||"function"==typeof PromiseRejectionEvent)&&t.then(k)instanceof n}catch(e){}}(),E=function(t,n){return t===n||t===w&&n===o},S=function(t){var n;return!(!l(t)||"function"!=typeof(n=t.then))&&n},j=function(t){return E(w,t)?new z(t):new i(t)},z=i=function(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw _("Bad Promise constructor");n=t,r=e}),this.resolve=p(n),this.reject=p(r)},M=function(t){try{t()}catch(n){return{error:n}}},C=function(t,n){if(!t._n){t._n=!0;var r=t._c;g(function(){for(var e=t._v,i=1==t._s,o=0,a=function(n){var r,o,a=i?n.ok:n.fail,u=n.resolve,c=n.reject,s=n.domain;try{a?(i||(2==t._h&&I(t),t._h=1),a===!0?r=e:(s&&s.enter(),r=a(e),s&&s.exit()),r===n.promise?c(_("Promise-chain cycle")):(o=S(r))?o.call(r,u,c):u(r)):c(e)}catch(f){c(f)}};r.length>o;)a(r[o++]);t._c=[],t._n=!1,n&&!t._h&&O(t)})}},O=function(t){m.call(u,function(){var n,r,e,i=t._v;if(B(t)&&(n=M(function(){b?x.emit("unhandledRejection",i,t):(r=u.onunhandledrejection)?r({promise:t,reason:i}):(e=u.console)&&e.error&&e.error("Unhandled promise rejection",i)}),t._h=b||B(t)?2:1),t._a=void 0,n)throw n.error})},B=function(t){if(1==t._h)return!1;for(var n,r=t._a||t._c,e=0;r.length>e;)if(n=r[e++],n.fail||!B(n.promise))return!1;return!0},I=function(t){m.call(u,function(){var n;b?x.emit("rejectionHandled",t):(n=u.onrejectionhandled)&&n({promise:t,reason:t._v})})},U=function(t){var n=this;n._d||(n._d=!0,n=n._w||n,n._v=t,n._s=2,n._a||(n._a=n._c.slice()),C(n,!0))},R=function(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw _("Promise can\'t be resolved itself");(n=S(t))?g(function(){var e={_w:r,_d:!1};try{n.call(t,c(R,e,1),c(U,e,1))}catch(i){U.call(e,i)}}):(r._v=t,r._s=1,C(r,!1))}catch(e){U.call({_w:r,_d:!1},e)}}};A||(w=function(t){h(this,w,y,"_h"),p(t),e.call(this);try{t(c(R,this,1),c(U,this,1))}catch(n){U.call(this,n)}},e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},e.prototype=r(70)(w.prototype,{then:function(t,n){var r=j(v(this,w));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=b?x.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&C(this,!1),r.promise},"catch":function(t){return this.then(void 0,t)}}),z=function(){var t=new e;this.promise=t,this.resolve=c(R,t,1),this.reject=c(U,t,1)}),f(f.G+f.W+f.F*!A,{Promise:w}),r(17)(w,y),r(72)(y),o=r(3)[y],f(f.S+f.F*!A,y,{reject:function(t){var n=j(this),r=n.reject;return r(t),n.promise}}),f(f.S+f.F*(a||!A),y,{resolve:function(t){if(t instanceof w&&E(t.constructor,this))return t;var n=j(this),r=n.resolve;return r(t),n.promise}}),f(f.S+f.F*!(A&&r(63)(function(t){w.all(t)["catch"](k)})),y,{all:function(t){var n=this,r=j(n),e=r.resolve,i=r.reject,o=M(function(){var r=[],o=0,a=1;d(t,!1,function(t){var u=o++,c=!1;r.push(void 0),a++,n.resolve(t).then(function(t){c||(c=!0,r[u]=t,--a||e(r))},i)}),--a||e(r)});return o&&i(o.error),r.promise},race:function(t){var n=this,r=j(n),e=r.reject,i=M(function(){d(t,!1,function(t){n.resolve(t).then(r.resolve,e)})});return i&&e(i.error),r.promise}})},function(t,n,r){"use strict";var e=r(74)(!0);r(28)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){r(79);for(var e=r(2),i=r(5),o=r(7),a=r(1)("toStringTag"),u=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],c=0;c<5;c++){var s=u[c],f=e[s],l=f&&f.prototype;l&&!l[a]&&i(l,a,s),o[s]=o.Array}},function(t,n,r){!function(e,i){t.exports=n=i(r(0))}(this,function(t){t.lib.Cipher||function(n){var r=t,e=r.lib,i=e.Base,o=e.WordArray,a=e.BufferedBlockAlgorithm,u=r.enc,c=(u.Utf8,u.Base64),s=r.algo,f=s.EvpKDF,l=e.Cipher=a.extend({cfg:i.extend(),createEncryptor:function(t,n){return this.create(this._ENC_XFORM_MODE,t,n)},createDecryptor:function(t,n){return this.create(this._DEC_XFORM_MODE,t,n)},init:function(t,n,r){this.cfg=this.cfg.extend(r),this._xformMode=t,this._key=n,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){t&&this._append(t);var n=this._doFinalize();return n},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?k:x}return function(n){return{encrypt:function(r,e,i){return t(e).encrypt(n,r,e,i)},decrypt:function(r,e,i){return t(e).decrypt(n,r,e,i)}}}}()}),p=(e.StreamCipher=l.extend({_doFinalize:function(){var t=this._process(!0);return t},blockSize:1}),r.mode={}),h=e.BlockCipherMode=i.extend({createEncryptor:function(t,n){return this.Encryptor.create(t,n)},createDecryptor:function(t,n){return this.Decryptor.create(t,n)},init:function(t,n){this._cipher=t,this._iv=n}}),d=p.CBC=function(){function t(t,r,e){var i=this._iv;if(i){var o=i;this._iv=n}else var o=this._prevBlock;for(var a=0;a<e;a++)t[r+a]^=o[a]}var r=h.extend();return r.Encryptor=r.extend({processBlock:function(n,r){var e=this._cipher,i=e.blockSize;t.call(this,n,r,i),e.encryptBlock(n,r),this._prevBlock=n.slice(r,r+i)}}),r.Decryptor=r.extend({processBlock:function(n,r){var e=this._cipher,i=e.blockSize,o=n.slice(r,r+i);e.decryptBlock(n,r),t.call(this,n,r,i),this._prevBlock=o}}),r}(),v=r.pad={},m=v.Pkcs7={pad:function(t,n){for(var r=4*n,e=r-t.sigBytes%r,i=e<<24|e<<16|e<<8|e,a=[],u=0;u<e;u+=4)a.push(i);var c=o.create(a,e);t.concat(c)},unpad:function(t){var n=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=n}},g=(e.BlockCipher=l.extend({cfg:l.cfg.extend({mode:d,padding:m}),reset:function(){l.reset.call(this);var t=this.cfg,n=t.iv,r=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var e=r.createEncryptor;else{var e=r.createDecryptor;this._minBufferSize=1}this._mode=e.call(r,this,n&&n.words)},_doProcessBlock:function(t,n){this._mode.processBlock(t,n)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);var n=this._process(!0)}else{var n=this._process(!0);t.unpad(n)}return n},blockSize:4}),e.CipherParams=i.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}})),y=r.format={},_=y.OpenSSL={stringify:function(t){var n=t.ciphertext,r=t.salt;if(r)var e=o.create([1398893684,1701076831]).concat(r).concat(n);else var e=n;return e.toString(c)},parse:function(t){var n=c.parse(t),r=n.words;if(1398893684==r[0]&&1701076831==r[1]){var e=o.create(r.slice(2,4));r.splice(0,4),n.sigBytes-=16}return g.create({ciphertext:n,salt:e})}},x=e.SerializableCipher=i.extend({cfg:i.extend({format:_}),encrypt:function(t,n,r,e){e=this.cfg.extend(e);var i=t.createEncryptor(r,e),o=i.finalize(n),a=i.cfg;return g.create({ciphertext:o,key:r,iv:a.iv,algorithm:t,mode:a.mode,padding:a.padding,blockSize:t.blockSize,formatter:e.format})},decrypt:function(t,n,r,e){e=this.cfg.extend(e),n=this._parse(n,e.format);var i=t.createDecryptor(r,e).finalize(n.ciphertext);return i},_parse:function(t,n){return"string"==typeof t?n.parse(t,this):t}}),w=r.kdf={},b=w.OpenSSL={execute:function(t,n,r,e){e||(e=o.random(8));var i=f.create({keySize:n+r}).compute(t,e),a=o.create(i.words.slice(n),4*r);return i.sigBytes=4*n,g.create({key:i,iv:a,salt:e})}},k=e.PasswordBasedCipher=x.extend({cfg:x.cfg.extend({kdf:b}),encrypt:function(t,n,r,e){e=this.cfg.extend(e);var i=e.kdf.execute(r,t.keySize,t.ivSize);e.iv=i.iv;var o=x.encrypt.call(this,t,n,i.key,e);return o.mixIn(i),o},decrypt:function(t,n,r,e){e=this.cfg.extend(e),n=this._parse(n,e.format);var i=e.kdf.execute(r,t.keySize,t.ivSize,n.salt);e.iv=i.iv;var o=x.decrypt.call(this,t,n,i.key,e);return o}})}()})},function(t,n,r){!function(e,i,o){t.exports=n=i(r(0),r(88),r(36))}(this,function(t){return function(){var n=t,r=n.lib,e=r.Base,i=r.WordArray,o=n.algo,a=o.MD5,u=o.EvpKDF=e.extend({cfg:e.extend({keySize:4,hasher:a,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,n){for(var r=this.cfg,e=r.hasher.create(),o=i.create(),a=o.words,u=r.keySize,c=r.iterations;a.length<u;){s&&e.update(s);var s=e.update(t).finalize(n);e.reset();for(var f=1;f<c;f++)s=e.finalize(s),e.reset();o.concat(s)}return o.sigBytes=4*u,o}});n.EvpKDF=function(t,n,r){return u.create(r).compute(t,n)}}(),t.EvpKDF})},function(t,n,r){!function(e,i){t.exports=n=i(r(0))}(this,function(t){return function(n){function r(t,n,r,e,i,o,a){var u=t+(n&r|~n&e)+i+a;return(u<<o|u>>>32-o)+n}function e(t,n,r,e,i,o,a){var u=t+(n&e|r&~e)+i+a;return(u<<o|u>>>32-o)+n}function i(t,n,r,e,i,o,a){var u=t+(n^r^e)+i+a;return(u<<o|u>>>32-o)+n}function o(t,n,r,e,i,o,a){var u=t+(r^(n|~e))+i+a;return(u<<o|u>>>32-o)+n}var a=t,u=a.lib,c=u.WordArray,s=u.Hasher,f=a.algo,l=[];!function(){for(var t=0;t<64;t++)l[t]=4294967296*n.abs(n.sin(t+1))|0}();var p=f.MD5=s.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,n){for(var a=0;a<16;a++){var u=n+a,c=t[u];t[u]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}var s=this._hash.words,f=t[n+0],p=t[n+1],h=t[n+2],d=t[n+3],v=t[n+4],m=t[n+5],g=t[n+6],y=t[n+7],_=t[n+8],x=t[n+9],w=t[n+10],b=t[n+11],k=t[n+12],A=t[n+13],E=t[n+14],S=t[n+15],j=s[0],z=s[1],M=s[2],C=s[3];j=r(j,z,M,C,f,7,l[0]),C=r(C,j,z,M,p,12,l[1]),M=r(M,C,j,z,h,17,l[2]),z=r(z,M,C,j,d,22,l[3]),j=r(j,z,M,C,v,7,l[4]),C=r(C,j,z,M,m,12,l[5]),M=r(M,C,j,z,g,17,l[6]),z=r(z,M,C,j,y,22,l[7]),j=r(j,z,M,C,_,7,l[8]),C=r(C,j,z,M,x,12,l[9]),M=r(M,C,j,z,w,17,l[10]),z=r(z,M,C,j,b,22,l[11]),j=r(j,z,M,C,k,7,l[12]),C=r(C,j,z,M,A,12,l[13]),M=r(M,C,j,z,E,17,l[14]),z=r(z,M,C,j,S,22,l[15]),j=e(j,z,M,C,p,5,l[16]),C=e(C,j,z,M,g,9,l[17]),M=e(M,C,j,z,b,14,l[18]),z=e(z,M,C,j,f,20,l[19]),j=e(j,z,M,C,m,5,l[20]),C=e(C,j,z,M,w,9,l[21]),M=e(M,C,j,z,S,14,l[22]),z=e(z,M,C,j,v,20,l[23]),j=e(j,z,M,C,x,5,l[24]),C=e(C,j,z,M,E,9,l[25]),M=e(M,C,j,z,d,14,l[26]),z=e(z,M,C,j,_,20,l[27]),j=e(j,z,M,C,A,5,l[28]),C=e(C,j,z,M,h,9,l[29]),M=e(M,C,j,z,y,14,l[30]),z=e(z,M,C,j,k,20,l[31]),j=i(j,z,M,C,m,4,l[32]),C=i(C,j,z,M,_,11,l[33]),M=i(M,C,j,z,b,16,l[34]),z=i(z,M,C,j,E,23,l[35]),j=i(j,z,M,C,p,4,l[36]),C=i(C,j,z,M,v,11,l[37]),M=i(M,C,j,z,y,16,l[38]),z=i(z,M,C,j,w,23,l[39]),j=i(j,z,M,C,A,4,l[40]),C=i(C,j,z,M,f,11,l[41]),M=i(M,C,j,z,d,16,l[42]),z=i(z,M,C,j,g,23,l[43]),j=i(j,z,M,C,x,4,l[44]),C=i(C,j,z,M,k,11,l[45]),M=i(M,C,j,z,S,16,l[46]),z=i(z,M,C,j,h,23,l[47]),j=o(j,z,M,C,f,6,l[48]),C=o(C,j,z,M,y,10,l[49]),M=o(M,C,j,z,E,15,l[50]),z=o(z,M,C,j,m,21,l[51]),j=o(j,z,M,C,k,6,l[52]),C=o(C,j,z,M,d,10,l[53]),M=o(M,C,j,z,w,15,l[54]),z=o(z,M,C,j,p,21,l[55]),j=o(j,z,M,C,_,6,l[56]),C=o(C,j,z,M,S,10,l[57]),M=o(M,C,j,z,g,15,l[58]),z=o(z,M,C,j,A,21,l[59]),j=o(j,z,M,C,v,6,l[60]),C=o(C,j,z,M,b,10,l[61]),M=o(M,C,j,z,h,15,l[62]),z=o(z,M,C,j,x,21,l[63]),s[0]=s[0]+j|0,s[1]=s[1]+z|0,s[2]=s[2]+M|0,s[3]=s[3]+C|0},_doFinalize:function(){var t=this._data,r=t.words,e=8*this._nDataBytes,i=8*t.sigBytes;r[i>>>5]|=128<<24-i%32;var o=n.floor(e/4294967296),a=e;r[(i+64>>>9<<4)+15]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r[(i+64>>>9<<4)+14]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(r.length+1),this._process();for(var u=this._hash,c=u.words,s=0;s<4;s++){var f=c[s];c[s]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8)}return u},clone:function(){var t=s.clone.call(this);return t._hash=this._hash.clone(),t}});a.MD5=s._createHelper(p),a.HmacMD5=s._createHmacHelper(p)}(Math),t.MD5})},function(t,n,r){!function(e,i){t.exports=n=i(r(0))}(this,function(t){return function(){var n=t,r=n.lib,e=r.WordArray,i=r.Hasher,o=n.algo,a=[],u=o.SHA1=i.extend({_doReset:function(){this._hash=new e.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,n){for(var r=this._hash.words,e=r[0],i=r[1],o=r[2],u=r[3],c=r[4],s=0;s<80;s++){if(s<16)a[s]=0|t[n+s];else{var f=a[s-3]^a[s-8]^a[s-14]^a[s-16];a[s]=f<<1|f>>>31}var l=(e<<5|e>>>27)+c+a[s];l+=s<20?(i&o|~i&u)+1518500249:s<40?(i^o^u)+1859775393:s<60?(i&o|i&u|o&u)-1894007588:(i^o^u)-899497514,c=u,u=o,o=i<<30|i>>>2,i=e,e=l}r[0]=r[0]+e|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+u|0,r[4]=r[4]+c|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,e=8*t.sigBytes;return n[e>>>5]|=128<<24-e%32,n[(e+64>>>9<<4)+14]=Math.floor(r/4294967296),n[(e+64>>>9<<4)+15]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});n.SHA1=i._createHelper(u),n.HmacSHA1=i._createHmacHelper(u)}(),t.SHA1})},function(t,n,r){!function(e,i){t.exports=n=i(r(0))}(this,function(t){return function(n){var r=t,e=r.lib,i=e.WordArray,o=e.Hasher,a=r.algo,u=[],c=[];!function(){function t(t){for(var r=n.sqrt(t),e=2;e<=r;e++)if(!(t%e))return!1;return!0}function r(t){return 4294967296*(t-(0|t))|0}for(var e=2,i=0;i<64;)t(e)&&(i<8&&(u[i]=r(n.pow(e,.5))),c[i]=r(n.pow(e,1/3)),i++),e++}();var s=[],f=a.SHA256=o.extend({_doReset:function(){this._hash=new i.init(u.slice(0))},_doProcessBlock:function(t,n){for(var r=this._hash.words,e=r[0],i=r[1],o=r[2],a=r[3],u=r[4],f=r[5],l=r[6],p=r[7],h=0;h<64;h++){if(h<16)s[h]=0|t[n+h];else{var d=s[h-15],v=(d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3,m=s[h-2],g=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;s[h]=v+s[h-7]+g+s[h-16]}var y=u&f^~u&l,_=e&i^e&o^i&o,x=(e<<30|e>>>2)^(e<<19|e>>>13)^(e<<10|e>>>22),w=(u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25),b=p+w+y+c[h]+s[h],k=x+_;p=l,l=f,f=u,u=a+b|0,a=o,o=i,i=e,e=b+k|0}r[0]=r[0]+e|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+a|0,r[4]=r[4]+u|0,r[5]=r[5]+f|0,r[6]=r[6]+l|0,r[7]=r[7]+p|0},_doFinalize:function(){var t=this._data,r=t.words,e=8*this._nDataBytes,i=8*t.sigBytes;return r[i>>>5]|=128<<24-i%32,r[(i+64>>>9<<4)+14]=n.floor(e/4294967296),r[(i+64>>>9<<4)+15]=e,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});r.SHA256=o._createHelper(f),r.HmacSHA256=o._createHmacHelper(f)}(Math),t.SHA256})},function(t,n){"use strict";t.exports=function(t){return t&&t.length>1?255===t[0]&&216===t[1]&&255===t[2]?{ext:"jpg",mime:"image/jpeg"}:137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]?{ext:"png",mime:"image/png"}:71===t[0]&&73===t[1]&&70===t[2]?{ext:"gif",mime:"image/gif"}:87===t[8]&&69===t[9]&&66===t[10]&&80===t[11]?{ext:"webp",mime:"image/webp"}:(73===t[0]&&73===t[1]&&42===t[2]&&0===t[3]||77===t[0]&&77===t[1]&&0===t[2]&&42===t[3])&&67===t[8]&&82===t[9]?{ext:"cr2",mime:"image/x-canon-cr2"}:73===t[0]&&73===t[1]&&42===t[2]&&0===t[3]||77===t[0]&&77===t[1]&&0===t[2]&&42===t[3]?{ext:"tif",mime:"image/tiff"}:66===t[0]&&77===t[1]?{ext:"bmp",mime:"image/bmp"}:73===t[0]&&73===t[1]&&188===t[2]?{ext:"jxr",mime:"image/vnd.ms-photo"}:56===t[0]&&66===t[1]&&80===t[2]&&83===t[3]?{ext:"psd",mime:"image/vnd.adobe.photoshop"}:80===t[0]&&75===t[1]&&3===t[2]&&4===t[3]&&109===t[30]&&105===t[31]&&109===t[32]&&101===t[33]&&116===t[34]&&121===t[35]&&112===t[36]&&101===t[37]&&97===t[38]&&112===t[39]&&112===t[40]&&108===t[41]&&105===t[42]&&99===t[43]&&97===t[44]&&116===t[45]&&105===t[46]&&111===t[47]&&110===t[48]&&47===t[49]&&101===t[50]&&112===t[51]&&117===t[52]&&98===t[53]&&43===t[54]&&122===t[55]&&105===t[56]&&112===t[57]?{ext:"epub",mime:"application/epub+zip"}:80===t[0]&&75===t[1]&&3===t[2]&&4===t[3]&&77===t[30]&&69===t[31]&&84===t[32]&&65===t[33]&&45===t[34]&&73===t[35]&&78===t[36]&&70===t[37]&&47===t[38]&&109===t[39]&&111===t[40]&&122===t[41]&&105===t[42]&&108===t[43]&&108===t[44]&&97===t[45]&&46===t[46]&&114===t[47]&&115===t[48]&&97===t[49]?{ext:"xpi",mime:"application/x-xpinstall"}:80!==t[0]||75!==t[1]||3!==t[2]&&5!==t[2]&&7!==t[2]||4!==t[3]&&6!==t[3]&&8!==t[3]?117===t[257]&&115===t[258]&&116===t[259]&&97===t[260]&&114===t[261]?{ext:"tar",mime:"application/x-tar"}:82!==t[0]||97!==t[1]||114!==t[2]||33!==t[3]||26!==t[4]||7!==t[5]||0!==t[6]&&1!==t[6]?31===t[0]&&139===t[1]&&8===t[2]?{ext:"gz",mime:"application/gzip"}:66===t[0]&&90===t[1]&&104===t[2]?{ext:"bz2",mime:"application/x-bzip2"}:55===t[0]&&122===t[1]&&188===t[2]&&175===t[3]&&39===t[4]&&28===t[5]?{ext:"7z",mime:"application/x-7z-compressed"}:120===t[0]&&1===t[1]?{ext:"dmg",mime:"application/x-apple-diskimage"}:0===t[0]&&0===t[1]&&0===t[2]&&(24===t[3]||32===t[3])&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]||51===t[0]&&103===t[1]&&112===t[2]&&53===t[3]||0===t[0]&&0===t[1]&&0===t[2]&&28===t[3]&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]&&109===t[8]&&112===t[9]&&52===t[10]&&50===t[11]&&109===t[16]&&112===t[17]&&52===t[18]&&49===t[19]&&109===t[20]&&112===t[21]&&52===t[22]&&50===t[23]&&105===t[24]&&115===t[25]&&111===t[26]&&109===t[27]||0===t[0]&&0===t[1]&&0===t[2]&&28===t[3]&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]&&105===t[8]&&115===t[9]&&111===t[10]&&109===t[11]||0===t[0]&&0===t[1]&&0===t[2]&&28===t[3]&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]&&109===t[8]&&112===t[9]&&52===t[10]&&50===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&0===t[15]?{ext:"mp4",mime:"video/mp4"}:0===t[0]&&0===t[1]&&0===t[2]&&28===t[3]&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]&&77===t[8]&&52===t[9]&&86===t[10]?{ext:"m4v",mime:"video/x-m4v"\n}:77===t[0]&&84===t[1]&&104===t[2]&&100===t[3]?{ext:"mid",mime:"audio/midi"}:109===t[31]&&97===t[32]&&116===t[33]&&114===t[34]&&111===t[35]&&115===t[36]&&107===t[37]&&97===t[38]?{ext:"mkv",mime:"video/x-matroska"}:26===t[0]&&69===t[1]&&223===t[2]&&163===t[3]?{ext:"webm",mime:"video/webm"}:0===t[0]&&0===t[1]&&0===t[2]&&20===t[3]&&102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]?{ext:"mov",mime:"video/quicktime"}:82===t[0]&&73===t[1]&&70===t[2]&&70===t[3]&&65===t[8]&&86===t[9]&&73===t[10]?{ext:"avi",mime:"video/x-msvideo"}:48===t[0]&&38===t[1]&&178===t[2]&&117===t[3]&&142===t[4]&&102===t[5]&&207===t[6]&&17===t[7]&&166===t[8]&&217===t[9]?{ext:"wmv",mime:"video/x-ms-wmv"}:0===t[0]&&0===t[1]&&1===t[2]&&"b"===t[3].toString(16)[0]?{ext:"mpg",mime:"video/mpeg"}:73===t[0]&&68===t[1]&&51===t[2]||255===t[0]&&251===t[1]?{ext:"mp3",mime:"audio/mpeg"}:102===t[4]&&116===t[5]&&121===t[6]&&112===t[7]&&77===t[8]&&52===t[9]&&65===t[10]||77===t[0]&&52===t[1]&&65===t[2]&&32===t[3]?{ext:"m4a",mime:"audio/m4a"}:79===t[28]&&112===t[29]&&117===t[30]&&115===t[31]&&72===t[32]&&101===t[33]&&97===t[34]&&100===t[35]?{ext:"opus",mime:"audio/opus"}:79===t[0]&&103===t[1]&&103===t[2]&&83===t[3]?{ext:"ogg",mime:"audio/ogg"}:102===t[0]&&76===t[1]&&97===t[2]&&67===t[3]?{ext:"flac",mime:"audio/x-flac"}:82===t[0]&&73===t[1]&&70===t[2]&&70===t[3]&&87===t[8]&&65===t[9]&&86===t[10]&&69===t[11]?{ext:"wav",mime:"audio/x-wav"}:35===t[0]&&33===t[1]&&65===t[2]&&77===t[3]&&82===t[4]&&10===t[5]?{ext:"amr",mime:"audio/amr"}:37===t[0]&&80===t[1]&&68===t[2]&&70===t[3]?{ext:"pdf",mime:"application/pdf"}:77===t[0]&&90===t[1]?{ext:"exe",mime:"application/x-msdownload"}:67!==t[0]&&70!==t[0]||87!==t[1]||83!==t[2]?123===t[0]&&92===t[1]&&114===t[2]&&116===t[3]&&102===t[4]?{ext:"rtf",mime:"application/rtf"}:119===t[0]&&79===t[1]&&70===t[2]&&70===t[3]&&(0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]||79===t[4]&&84===t[5]&&84===t[6]&&79===t[7])?{ext:"woff",mime:"application/font-woff"}:119===t[0]&&79===t[1]&&70===t[2]&&50===t[3]&&(0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]||79===t[4]&&84===t[5]&&84===t[6]&&79===t[7])?{ext:"woff2",mime:"application/font-woff"}:76===t[34]&&80===t[35]&&(0===t[8]&&0===t[9]&&1===t[10]||1===t[8]&&0===t[9]&&2===t[10]||2===t[8]&&0===t[9]&&2===t[10])?{ext:"eot",mime:"application/octet-stream"}:0===t[0]&&1===t[1]&&0===t[2]&&0===t[3]&&0===t[4]?{ext:"ttf",mime:"application/font-sfnt"}:79===t[0]&&84===t[1]&&84===t[2]&&79===t[3]&&0===t[4]?{ext:"otf",mime:"application/font-sfnt"}:0===t[0]&&0===t[1]&&1===t[2]&&0===t[3]?{ext:"ico",mime:"image/x-icon"}:70===t[0]&&76===t[1]&&86===t[2]&&1===t[3]?{ext:"flv",mime:"video/x-flv"}:37===t[0]&&33===t[1]?{ext:"ps",mime:"application/postscript"}:253===t[0]&&55===t[1]&&122===t[2]&&88===t[3]&&90===t[4]&&0===t[5]?{ext:"xz",mime:"application/x-xz"}:83===t[0]&&81===t[1]&&76===t[2]&&105===t[3]?{ext:"sqlite",mime:"application/x-sqlite3"}:78===t[0]&&69===t[1]&&83===t[2]&&26===t[3]?{ext:"nes",mime:"application/x-nintendo-nes-rom"}:67===t[0]&&114===t[1]&&50===t[2]&&52===t[3]?{ext:"crx",mime:"application/x-google-chrome-extension"}:77===t[0]&&83===t[1]&&67===t[2]&&70===t[3]||73===t[0]&&83===t[1]&&99===t[2]&&40===t[3]?{ext:"cab",mime:"application/vnd.ms-cab-compressed"}:33===t[0]&&60===t[1]&&97===t[2]&&114===t[3]&&99===t[4]&&104===t[5]&&62===t[6]&&10===t[7]&&100===t[8]&&101===t[9]&&98===t[10]&&105===t[11]&&97===t[12]&&110===t[13]&&45===t[14]&&98===t[15]&&105===t[16]&&110===t[17]&&97===t[18]&&114===t[19]&&121===t[20]?{ext:"deb",mime:"application/x-deb"}:33===t[0]&&60===t[1]&&97===t[2]&&114===t[3]&&99===t[4]&&104===t[5]&&62===t[6]?{ext:"ar",mime:"application/x-unix-archive"}:237===t[0]&&171===t[1]&&238===t[2]&&219===t[3]?{ext:"rpm",mime:"application/x-rpm"}:31===t[0]&&160===t[1]||31===t[0]&&157===t[1]?{ext:"Z",mime:"application/x-compress"}:76===t[0]&&90===t[1]&&73===t[2]&&80===t[3]?{ext:"lz",mime:"application/x-lzip"}:208===t[0]&&207===t[1]&&17===t[2]&&224===t[3]&&161===t[4]&&177===t[5]&&26===t[6]&&225===t[7]?{ext:"msi",mime:"application/x-msi"}:null:{ext:"swf",mime:"application/x-shockwave-flash"}:{ext:"rar",mime:"application/x-rar-compressed"}:{ext:"zip",mime:"application/zip"}:null}},function(t,n){t.exports={"application/":{applixware:"aw","atom+xml":"atom","atomcat+xml":"atomcat","atomsvc+xml":"atomsvc","ccxml+xml":"ccxml","cdmi-":{capability:"cdmia",container:"cdmic",domain:"cdmid",object:"cdmio",queue:"cdmiq"},"davmount+xml":"davmount","docbook+xml":"dbk","dssc+der":"dssc","dssc+xml":"xdssc",ecmascript:"ecma","emma+xml":"emma","epub+zip":"epub",exi:"exi","font-":{tdpfr:"pfr",woff:"woff"},"gml+xml":"gml","gpx+xml":"gpx",gxf:"gxf",hyperstudio:"stk","inkml+xml":["ink","inkml"],ipfix:"ipfix","java-":{archive:"jar",vm:"class","serialized-object":"ser"},javascript:"js",json:"json","jsonml+json":"jsonml","lost+xml":"lostxml","mac-":{binhex40:"hqx",compactpro:"cpt"},"mads+xml":"mads",marc:"mrc","marcxml+xml":"mrcx",mathematica:["ma","nb","mb"],"mathml+xml":"mathml",mbox:"mbox","mediaservercontrol+xml":"mscml","metalink+xml":"metalink","metalink4+xml":"meta4","mets+xml":"mets","mods+xml":"mods",mp21:["m21","mp21"],mp4:"mp4s",msword:["doc","dot"],mxf:"mxf",oda:"oda",ogg:"ogx","omdoc+xml":"omdoc",onenote:["onetoc","onetoc2","onetmp","onepkg"],oxps:"oxps",pdf:"pdf","pgp-":{encrypted:"pgp",signature:["asc","sig"]},pkcs10:"p10","pkcs7-":{mime:["p7m","p7c"],signature:"p7s"},pkcs8:"p8","pkix-":{cert:"cer",crl:"crl",pkipath:"pkipath","attr-cert":"ac"},pkixcmp:"pki","pls+xml":"pls",postscript:["ai","eps","ps"],"pskc+xml":"pskcxml","rdf+xml":"rdf","reginfo+xml":"rif","resource-":{"lists+xml":"rl","lists-diff+xml":"rld"},"rpki-":{ghostbusters:"gbr",manifest:"mft",roa:"roa"},"rsd+xml":"rsd","rss+xml":"rss",rtf:"rtf","sbml+xml":"sbml","scvp-":{"cv-":{request:"scq",response:"scs"},"vp-":{request:"spq",response:"spp"}},sdp:"sdp","set-":{"payment-initiation":"setpay","registration-initiation":"setreg"},"shf+xml":"shf","smil+xml":["smi","smil"],"sparql-":{query:"rq","results+xml":"srx"},srgs:"gram","srgs+xml":"grxml","sru+xml":"sru","ssdl+xml":"ssdl","ssml+xml":"ssml","tei+xml":["tei","teicorpus"],"thraud+xml":"tfi","vnd.":{acucobol:"acu",acucorp:["atc","acutc"],"adobe.":{fxp:["fxp","fxpl"],"xdp+xml":"xdp",xfdf:"xfdf","formscentral.fcdt":"fcdt","air-application-installer-package+zip":"air"},"apple.":{"installer+xml":"mpkg",mpegurl:"m3u8"},audiograph:"aep",bmi:"bmi",businessobjects:"rep","chemdraw+xml":"cdxml",cinderella:"cdy",claymore:"cla",commonspace:"csp",cosmocaller:"cmc","crick.":{clicker:"clkx","clicker.":{keyboard:"clkk",palette:"clkp",template:"clkt",wordbank:"clkw"}},"curl.":{car:"car",pcurl:"pcurl"},dart:"dart","dece.":{data:["uvf","uvvf","uvd","uvvd"],"ttml+xml":["uvt","uvvt"],unspecified:["uvx","uvvx"],zip:["uvz","uvvz"]},dna:"dna",dpgraph:"dpg",dreamfactory:"dfac","dvb.":{ait:"ait",service:"svc"},dynageo:"geo",enliven:"nml","epson.":{esf:"esf",msf:"msf",quickanime:"qam",salt:"slt",ssf:"ssf"},"eszigno3+xml":["es3","et3"],"ezpix-":{album:"ez2","package":"ez3"},fdf:"fdf","fdsn.":{mseed:"mseed",seed:["seed","dataless"]},flographit:"gph",framemaker:["fm","frame","maker","book"],"frogans.":{fnc:"fnc",ltf:"ltf"},"fujitsu.":{oasys:"oas",oasys2:"oa2",oasys3:"oa3",oasysgp:"fg5",oasysprs:"bh2"},"fujixerox.":{ddd:"ddd",docuworks:"xdw","docuworks.binder":"xbd"},fuzzysheet:"fzs","geogebra.":{file:"ggb",tool:"ggt"},geonext:"gxt",geoplan:"g2w",geospace:"g3w",gmx:"gmx",grafeq:["gqf","gqs"],"groove-":{account:"gac",help:"ghf",injector:"grv","tool-":{message:"gtm",template:"tpl"},vcard:"vcg","identity-message":"gim"},"hal+xml":"hal",hbci:"hbci","hp-":{hpgl:"hpgl",hpid:"hpid",hps:"hps",jlyt:"jlt",pcl:"pcl",pclxl:"pclxl"},"ibm.":{minipay:"mpy",modcap:["afp","listafp","list3820"],"rights-management":"irm","secure-container":"sc"},iccprofile:["icc","icm"],igloader:"igl","immervision-":{ivp:"ivp",ivu:"ivu"},intergeo:"i2g","intu.":{qbo:"qbo",qfx:"qfx"},jam:"jam",jisp:"jisp",kahootz:["ktz","ktr"],"kde.":{karbon:"karbon",kchart:"chrt",kformula:"kfo",kivio:"flw",kontour:"kon",kpresenter:["kpr","kpt"],kspread:"ksp",kword:["kwd","kwt"]},kenameaapp:"htke",kidspiration:"kia",kinar:["kne","knp"],koan:["skp","skd","skt","skm"],"lotus-":{approach:"apr",freelance:"pre",notes:"nsf",organizer:"org",screencam:"scm",wordpro:"lwp","1-2-3":"123"},mcd:"mcd",medcalcdata:"mc1",mfer:"mwf",mfmp:"mfm","micrografx.":{flo:"flo",igx:"igx"},mif:"mif","mobius.":{daf:"daf",dis:"dis",mbk:"mbk",mqy:"mqy",msl:"msl",plc:"plc",txf:"txf"},"mophun.":{application:"mpn",certificate:"mpc"},"ms-":{artgalry:"cil",excel:["xls","xlm","xla","xlc","xlt","xlw"],"excel.":{"sheet.":{"macroenabled.12":"xlsm","binary.macroenabled.12":"xlsb"},"addin.macroenabled.12":"xlam","template.macroenabled.12":"xltm"},fontobject:"eot",htmlhelp:"chm",ims:"ims",lrm:"lrm",officetheme:"thmx","pki.":{seccat:"cat",stl:"stl"},powerpoint:["ppt","pps","pot"],"powerpoint.":{"addin.macroenabled.12":"ppam","presentation.macroenabled.12":"pptm","slide.macroenabled.12":"sldm","slideshow.macroenabled.12":"ppsm","template.macroenabled.12":"potm"},project:["mpp","mpt"],"word.":{"document.macroenabled.12":"docm","template.macroenabled.12":"dotm"},works:["wps","wks","wcm","wdb"],wpl:"wpl",xpsdocument:"xps","cab-compressed":"cab"},mseq:"mseq",musician:"mus",mynfc:"taglet",nitf:["ntf","nitf"],"noblenet-":{directory:"nnd",sealer:"nns",web:"nnw"},"nokia.":{"radio-":{preset:"rpst",presets:"rpss"},"n-gage.":{data:"ngdat","symbian.install":"n-gage"}},"novadigm.":{edm:"edm",edx:"edx",ext:"ext"},"osgi.":{dp:"dp",subsystem:"esa"},palm:["pdb","pqa","oprc"],pawaafile:"paw","pg.":{format:"str",osasli:"ei6"},picsel:"efif",pocketlearn:"plf",powerbuilder6:"pbd","recordare.":{musicxml:"mxl","musicxml+xml":"musicxml"},"rn-":{realmedia:"rm","realmedia-vbr":"rmvb"},seemail:"see",sema:"sema",semd:"semd",semf:"semf",smaf:"mmf","spotfire.":{dxp:"dxp",sfs:"sfs"},"stardivision.":{calc:"sdc",draw:"sda",impress:"sdd",math:"smf",writer:["sdw","vor"],"writer-global":"sgl"},"stepmania.":{"package":"smzip",stepchart:"sm"},svd:"svd","syncml+xml":"xsm","syncml.":{"dm+wbxml":"bdm","dm+xml":"xdm"},trueapp:"tra",ufdl:["ufd","ufdl"],umajin:"umj",unity:"unityweb","uoml+xml":"uoml",vcx:"vcx",visio:["vsd","vst","vss","vsw"],visionary:"vis",vsf:"vsf","wap.":{wbxml:"wbxml",wmlc:"wmlc",wmlscriptc:"wmlsc"},webturbo:"wtb",wordperfect:"wpd",wqd:"wqd",xara:"xar",xfdl:"xfdl","yamaha.":{"hv-":{dic:"hvd",script:"hvs",voice:"hvp"},openscoreformat:"osf","smaf-":{audio:"saf",phrase:"spf"},"openscoreformat.osfpvg+xml":"osfpvg"},zul:["zir","zirz"],"3gpp2.tcap":"tcap","accpac.simply.":{aso:"aso",imp:"imp"},"ahead.space":"ahead","airzip.filesecure.":{azf:"azf",azs:"azs"},"amazon.ebook":"azw","americandynamics.acc":"acc","amiga.ami":"ami","anser-web-":{"certificate-issue-initiation":"cii","funds-transfer-initiation":"fti"},"aristanetworks.swi":"swi","blueice.multipass":"mpm","cloanto.rp9":"rp9","clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"cluetrust.cartomobile-":{config:"c11amc","config-pkg":"c11amz"},"contact.cmsg":"cdbcmsg","criticaltools.wbs+xml":"wbs","ctc-posml":"pml","cups-ppd":"ppd","dolby.mlp":"mlp","ds-keypoint":"kpxx","ecowin.chart":"mag","fluxtime.clip":"ftc","fsc.weblaunch":"fsc","genomatix.tuxedo":"txd","geometry-explorer":["gex","gre"],"google-earth.":{"kml+xml":"kml",kmz:"kmz"},"handheld-entertainment+xml":"zmm","insors.igm":"igm","intercon.formnet":["xpw","xpx"],"ipunplugged.rcprofile":"rcprofile","irepository.package+xml":"irp","is-xpr":"xpr","isac.fcs":"fcs","kodak-descriptor":"sse","las.las+xml":"lasxml","macports.portpkg":"portpkg","mediastation.cdkey":"cdkey","mozilla.xul+xml":"xul","muvee.style":"msty","neurolanguage.nlu":"nlu","oasis.opendocument.":{chart:"odc",database:"odb",formula:"odf",graphics:"odg",image:"odi",presentation:"odp",spreadsheet:"ods",text:"odt","text-":{master:"odm",template:"ott",web:"oth"},"chart-template":"otc","formula-template":"odft","graphics-template":"otg","image-template":"oti","presentation-template":"otp","spreadsheet-template":"ots"},"olpc-sugar":"xo","oma.dd2+xml":"dd2","openofficeorg.extension":"oxt","openxmlformats-officedocument.":{"presentationml.":{presentation:"pptx",slide:"sldx",slideshow:"ppsx",template:"potx"},"spreadsheetml.":{sheet:"xlsx",template:"xltx"},"wordprocessingml.":{document:"docx",template:"dotx"}},"pmi.widget":"wg","previewsystems.box":"box","proteus.magazine":"mgz","pvi.ptid1":"ptid","quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"realvnc.bed":"bed","rig.cryptonote":"cryptonote","rim.cod":"cod","route66.link66+xml":"link66","sailingtracker.track":"st","shana.informed.":{formdata:"ifm",formtemplate:"itp",interchange:"iif","package":"ipk"},"simtech-mindmapper":["twd","twds"],"smart.teacher":"teacher","solent.sdkm+xml":["sdkm","sdkd"],"sun.xml.":{calc:"sxc",draw:"sxd",impress:"sxi",math:"sxm",writer:"sxw","writer.":{global:"sxg",template:"stw"},"calc.template":"stc","draw.template":"std","impress.template":"sti"},"sus-calendar":["sus","susp"],"symbian.install":["sis","sisx"],"tcpdump.pcap":["pcap","cap","dmp"],"tmobile-livetv":"tmo","trid.tpt":"tpt","triscape.mxs":"mxs","uiq.theme":"utz","wolfram.player":"nbp","wt.stf":"stf","zzazz.deck+xml":"zaz","3gpp.pic-bw-":{large:"plb",small:"psb","var":"pvb"},"3m.post-it-notes":"pwn","android.package-archive":"apk","antix.game-component":"atx","astraea-software.iota":"iota","chipnuts.karaoke-mmd":"mmd","data-vision.rdz":"rdz","denovo.fcselayout-link":"fe_launch","hhe.lesson-player":"les","hydrostatix.sof-data":"sfd-hdstx","jcp.javame.midlet-rms":"rms","joost.joda-archive":"joda","llamagraphics.life-balance.":{desktop:"lbd","exchange+xml":"lbe"},"osgeo.mapguide.package":"mgp","publishare-delta-tree":"qps","tao.intent-module-archive":"tao","yellowriver-custom-menu":"cmp"},"voicexml+xml":"vxml",widget:"wgt",winhlp:"hlp","wsdl+xml":"wsdl","wspolicy+xml":"wspolicy","x-":{abiword:"abw","authorware-":{bin:["aab","x32","u32","vox"],map:"aam",seg:"aas"},bcpio:"bcpio",bittorrent:"torrent",blorb:["blb","blorb"],bzip:"bz",bzip2:["bz2","boz"],cbr:["cbr","cba","cbt","cbz","cb7"],cdlink:"vcd",chat:"chat",conference:"nsc",cpio:"cpio",csh:"csh",director:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],doom:"wad","dtbncx+xml":"ncx","dtbook+xml":"dtb","dtbresource+xml":"res",dvi:"dvi",envoy:"evy",eva:"eva","font-":{bdf:"bdf",ghostscript:"gsf",otf:"otf",pcf:"pcf",snf:"snf",ttf:["ttf","ttc"],type1:["pfa","pfb","pfm","afm"],"linux-psf":"psf"},freearc:"arc",futuresplash:"spl",glulx:"ulx",gnumeric:"gnumeric",gtar:"gtar",hdf:"hdf",latex:"latex",mie:"mie","ms-":{application:"application",shortcut:"lnk",wmd:"wmd",wmz:"wmz",xbap:"xbap"},msaccess:"mdb",msbinder:"obd",mscardfile:"crd",msclip:"clp",msdownload:["exe","dll","com","bat","msi"],msmediaview:["mvb","m13","m14"],msmetafile:["wmf","wmz","emf","emz"],msmoney:"mny",mspublisher:"pub",msschedule:"scd",msterminal:"trm",mswrite:"wri",netcdf:["nc","cdf"],nzb:"nzb",pkcs12:["p12","pfx"],"pkcs7-":{certificates:["p7b","spc"],certreqresp:"p7r"},sh:"sh",shar:"shar",sql:"sql",stuffit:"sit",stuffitx:"sitx",subrip:"srt",sv4cpio:"sv4cpio",sv4crc:"sv4crc",tads:"gam",tar:"tar",tcl:"tcl",tex:"tex",texinfo:["texinfo","texi"],tgif:"obj",ustar:"ustar",xfig:"fig","xliff+xml":"xlf",xpinstall:"xpi",xz:"xz",zmachine:["z1","z2","z3","z4","z5","z6","z7","z8"],"7z-compressed":"7z","ace-compressed":"ace","apple-diskimage":"dmg","cfs-compressed":"cfs","chess-pgn":"pgn","debian-package":["deb","udeb"],"dgc-compressed":"dgc","gca-compressed":"gca","gramps-xml":"gramps","install-instructions":"install","iso9660-image":"iso","lzh-compressed":["lzh","lha"],"mobipocket-ebook":["prc","mobi"],"rar-compressed":"rar","shockwave-flash":"swf","silverlight-app":"xap","t3vm-image":"t3","tex-tfm":"tfm","wais-source":"src","java-jnlp-file":"jnlp","research-info-systems":"ris","x509-ca-cert":["der","crt"]},"xaml+xml":"xaml","xenc+xml":"xenc","xhtml+xml":["xhtml","xht"],xml:["xml","xsl"],"xop+xml":"xop","xproc+xml":"xpl","xslt+xml":"xslt","xspf+xml":"xspf","xv+xml":["mxml","xhvml","xvml","xvm"],yang:"yang","yin+xml":"yin",zip:"zip","andrew-inset":"ez","cu-seeme":"cu","octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy"],"oebps-package+xml":"opf","pics-rules":"prf","prs.cww":"cww","rls-services+xml":"rs","timestamped-data":"tsd","xcap-diff+xml":"xdf","xml-dtd":"dtd","patch-ops-error+xml":"xer","relax-ng-compact-syntax":"rnc"},"audio/":{adpcm:"adp",basic:["au","snd"],midi:["mid","midi","kar","rmi"],mp4:["m4a","mp4a"],mpeg:["mpga","mp2","mp2a","mp3","m2a","m3a"],ogg:["oga","ogg","spx"],s3m:"s3m",silk:"sil","vnd.":{dra:"dra",dts:"dts","nuera.":{ecelp4800:"ecelp4800",ecelp7470:"ecelp7470",ecelp9600:"ecelp9600"},rip:"rip","dece.audio":["uva","uvva"],"digital-winds":"eol","dts.hd":"dtshd","lucent.voice":"lvp","ms-playready.media.pya":"pya"},webm:"weba","x-":{aac:"aac",aiff:["aif","aiff","aifc"],caf:"caf",flac:"flac",matroska:"mka",mpegurl:"m3u","ms-":{wax:"wax",wma:"wma"},"pn-":{realaudio:["ram","ra"],"realaudio-plugin":"rmp"},wav:"wav"},xm:"xm"},"image/":{bmp:"bmp",cgm:"cgm",g3fax:"g3",gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],ktx:"ktx",png:"png",sgi:"sgi","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"vnd.":{djvu:["djvu","djv"],dwg:"dwg",dxf:"dxf",fastbidsheet:"fbs",fpx:"fpx",fst:"fst","ms-":{modi:"mdi",photo:"wdp"},xiff:"xif","adobe.photoshop":"psd","dece.graphic":["uvi","uvvi","uvg","uvvg"],"dvb.subtitle":"sub","fujixerox.edmics-":{mmr:"mmr",rlc:"rlc"},"net-fpx":"npx","wap.wbmp":"wbmp"},webp:"webp","x-":{"3ds":"3ds",cmx:"cmx",freehand:["fh","fhc","fh4","fh5","fh7"],icon:"ico",pcx:"pcx",pict:["pic","pct"],"portable-":{anymap:"pnm",bitmap:"pbm",graymap:"pgm",pixmap:"ppm"},rgb:"rgb",tga:"tga",xbitmap:"xbm",xpixmap:"xpm",xwindowdump:"xwd","cmu-raster":"ras","mrsid-image":"sid"},"prs.btif":"btif"},"model/":{iges:["igs","iges"],mesh:["msh","mesh","silo"],"vnd.":{"collada+xml":"dae",dwf:"dwf",gdl:"gdl",gtw:"gtw",mts:"mts",vtu:"vtu"},vrml:["wrl","vrml"],"x3d+binary":["x3db","x3dbz"],"x3d+vrml":["x3dv","x3dvz"],"x3d+xml":["x3d","x3dz"]},"text/":{calendar:["ics","ifb"],css:"css",csv:"csv",html:["html","htm"],n3:"n3",plain:["txt","text","conf","def","list","log","in"],richtext:"rtx",sgml:["sgml","sgm"],troff:["t","tr","roff","man","me","ms"],turtle:"ttl",vcard:"vcard","vnd.":{curl:"curl","curl.":{dcurl:"dcurl",mcurl:"mcurl",scurl:"scurl"},fly:"fly",graphviz:"gv","in3d.":{"3dml":"3dml",spot:"spot"},"wap.":{wml:"wml",wmlscript:"wmls"},"dvb.subtitle":"sub","fmi.flexstor":"flx","sun.j2me.app-descriptor":"jad"},"x-":{asm:["s","asm"],c:["c","cc","cxx","cpp","h","hh","dic"],fortran:["f","for","f77","f90"],nfo:"nfo",opml:"opml",pascal:["p","pas"],setext:"etx",sfv:"sfv",uuencode:"uu",vcalendar:"vcs",vcard:"vcf","java-source":"java"},"cache-manifest":"appcache","uri-list":["uri","uris","urls"],"prs.lines.tag":"dsc","tab-separated-values":"tsv"},"video/":{"3gpp":"3gp","3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],mp4:["mp4","mp4v","mpg4"],mpeg:["mpeg","mpg","mpe","m1v","m2v"],ogg:"ogv",quicktime:["qt","mov"],"vnd.":{"dece.":{hd:["uvh","uvvh"],mobile:["uvm","uvvm"],pd:["uvp","uvvp"],sd:["uvs","uvvs"],video:["uvv","uvvv"]},fvt:"fvt",mpegurl:["mxu","m4u"],vivo:"viv","dvb.file":"dvb","uvvu.mp4":["uvu","uvvu"],"ms-playready.media.pyv":"pyv"},webm:"webm","x-":{f4v:"f4v",fli:"fli",flv:"flv",m4v:"m4v",matroska:["mkv","mk3d","mks"],mng:"mng","ms-":{asf:["asf","asx"],vob:"vob",wm:"wm",wmv:"wmv",wmx:"wmx",wvx:"wvx"},msvideo:"avi",smv:"smv","sgi-movie":"movie"}},"chemical/x-":{cdx:"cdx",cif:"cif",cmdf:"cmdf",cml:"cml",csml:"csml",xyz:"xyz"},"message/rfc822":["eml","mime"],"x-conference/x-cooltalk":"ice"}},function(t,n){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}}]);',n.p+"08a1eaae6e272c648b44.worker.js");
}},function(e,t,n){e.exports=function(){return new Worker(n.p+"3c0bbc4c8f22fa824d11.worker.js")}},function(e,t,n){e.exports=function(){return new Worker(n.p+"pdf.worker.js")}}]));